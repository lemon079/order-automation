module.exports=[66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},10859,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},52933,(e,t,r)=>{"use strict";t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},41165,(e,t,r)=>{"use strict";let i=e.r(52933);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}let a=(e,t,r)=>new Promise((a,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);let o=setTimeout(()=>{if("function"==typeof r){try{a(r())}catch(e){s(e)}return}let i="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new n(i);"function"==typeof e.cancel&&e.cancel(),s(o)},t);i(e.then(a,s),()=>{clearTimeout(o)})});t.exports=a,t.exports.default=a,t.exports.TimeoutError=n},841,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=n/2|0,s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}},61816,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(841);r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);let n=i.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},81920,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(10859),n=e.r(41165),a=e.r(61816),s=()=>{},o=new n.TimeoutError;r.default=class extends i{constructor(e){var t,r,i,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(t=e.intervalCap)?void 0:t.toString())?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(n=null==(i=e.interval)?void 0:i.toString())?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let a=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&i(o)});r(await a)}catch(e){i(e)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},57006,(e,t,r)=>{"use strict";t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},17518,(e,t,r)=>{"use strict";t.exports="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},66216,(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=e.r(57006),s=e.r(17518),o=(r=t.exports={}).re=[],l=r.safeRe=[],u=r.src=[],c=r.safeSrc=[],d=r.t={},h=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[p,n]],f=(e,t,r)=>{let i=(e=>{for(let[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=h++;s(e,n,t),d[e]=n,u[n]=t,c[n]=i,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(i,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),f("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${p}+`),f("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),f("FULL",`^${u[d.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),f("LOOSE",`^${u[d.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),f("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),f("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),f("COERCERTL",u[d.COERCE],!0),f("COERCERTLFULL",u[d.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",f("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",f("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},24355,(e,t,r)=>{"use strict";let i=Object.freeze({loose:!0}),n=Object.freeze({});t.exports=e=>e?"object"!=typeof e?i:e:n},47277,(e,t,r)=>{"use strict";let i=/^[0-9]+$/,n=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e===t?0:e<t?-1:1;let r=i.test(e),n=i.test(t);return r&&n&&(e*=1,t*=1),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},37898,(e,t,r)=>{"use strict";let i=e.r(17518),{MAX_LENGTH:n,MAX_SAFE_INTEGER:a}=e.r(57006),{safeRe:s,t:o}=e.r(66216),l=e.r(24355),{compareIdentifiers:u}=e.r(47277);class c{constructor(e,t){if(t=l(t),e instanceof c)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else e=e.version;else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw TypeError(`version is longer than ${n} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return(e instanceof c||(e=new c(e,this.options)),this.major<e.major)?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:+(this.patch>e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],n=e.prerelease[t];if(i("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],n=e.build[t];if(i("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===r&&(i=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=c},16460,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r=!1)=>{if(e instanceof i)return e;try{return new i(e,t)}catch(e){if(!r)return null;throw e}}},77156,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,t);return r?r.version:null}},79839,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},5025,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r,n,a)=>{"string"==typeof r&&(a=n,n=r,r=void 0);try{return new i(e instanceof i?e.version:e,r).inc(t,n,a).version}catch(e){return null}}},87740,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,null,!0),n=i(t,null,!0),a=r.compare(n);if(0===a)return null;let s=a>0,o=s?r:n,l=s?n:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"}},55631,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).major},66406,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).minor},76569,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).patch},91870,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,t);return r&&r.prerelease.length?r.prerelease:null}},1070,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r)=>new i(e,r).compare(new i(t,r))},42836,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(t,e,r)},39246,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t)=>i(e,t,!0)},50764,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r)=>{let n=new i(e,r),a=new i(t,r);return n.compare(a)||n.compareBuild(a)}},49535,(e,t,r)=>{"use strict";let i=e.r(50764);t.exports=(e,t)=>e.sort((e,r)=>i(e,r,t))},71739,(e,t,r)=>{"use strict";let i=e.r(50764);t.exports=(e,t)=>e.sort((e,r)=>i(r,e,t))},45008,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(e,t,r)>0},80169,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0>i(e,t,r)},39027,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0===i(e,t,r)},19849,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0!==i(e,t,r)},53425,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(e,t,r)>=0},24891,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0>=i(e,t,r)},40592,(e,t,r)=>{"use strict";let i=e.r(39027),n=e.r(19849),a=e.r(45008),s=e.r(53425),o=e.r(80169),l=e.r(24891);t.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return i(e,r,u);case"!=":return n(e,r,u);case">":return a(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},70537,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(16460),{safeRe:a,t:s}=e.r(66216);t.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let i,n=t.includePrerelease?a[s.COERCERTLFULL]:a[s.COERCERTL];for(;(i=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[s.COERCEFULL]:a[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${u}${c}${d}`,t)}},3228,(e,t,r)=>{"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},51532,(e,t,r)=>{"use strict";let i=/\s+/g;class n{constructor(e,t){if(t=s(t),e instanceof n)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else return new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(i," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(const e of this.set)if(1===e.length&&v(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=a.get(t);if(r)return r;let i=this.options.loose,n=i?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(n,A(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],m));let s=e.split(" ").map(e=>b(e,this.options)).join(" ").split(/\s+/).map(e=>T(e,this.options));i&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let v=[...u.values()];return a.set(t,v),v}intersects(e,t){if(!(e instanceof n))throw TypeError("a Range is required");return this.set.some(r=>_(r,t)&&e.set.some(e=>_(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(N(this.set[t],e,this.options))return!0;return!1}}t.exports=n;let a=new(e.r(3228)),s=e.r(24355),o=e.r(54409),l=e.r(17518),u=e.r(37898),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:m}=e.r(66216),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=e.r(57006),y=e=>"<0.0.0-0"===e.value,v=e=>""===e.value,_=(e,t)=>{let r=!0,i=e.slice(),n=i.pop();for(;r&&i.length;)r=i.every(e=>n.intersects(e,t)),n=i.pop();return r},b=(e,t)=>(l("comp",e=e.replace(c[d.BUILD],""),t),l("caret",e=k(e,t)),l("tildes",e=$(e,t)),l("xrange",e=E(e,t)),l("stars",e=O(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,$=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,i,n,a)=>{let s;return l("tilde",e,t,r,i,n,a),w(r)?s="":w(i)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(n)?s=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:a?(l("replaceTilde pr",a),s=`>=${r}.${i}.${n}-${a} <${r}.${+i+1}.0-0`):s=`>=${r}.${i}.${n} <${r}.${+i+1}.0-0`,l("tilde return",s),s})},k=(e,t)=>e.trim().split(/\s+/).map(e=>I(e,t)).join(" "),I=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],i=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,a,s)=>{let o;return l("caret",e,t,r,n,a,s),w(r)?o="":w(n)?o=`>=${r}.0.0${i} <${+r+1}.0.0-0`:w(a)?o="0"===r?`>=${r}.${n}.0${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${i} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===n?`>=${r}.${n}.${a}-${s} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}-${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${a}${i} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a} <${+r+1}.0.0-0`),l("caret return",o),o})},E=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>S(e,t)).join(" ")),S=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,i,n,a,s,o)=>{l("xRange",e,r,i,n,a,s,o);let u=w(n),c=u||w(a),d=c||w(s);return"="===i&&d&&(i=""),o=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(c&&(a=0),s=0,">"===i?(i=">=",c?(n=+n+1,a=0):a=+a+1,s=0):"<="===i&&(i="<",c?n=+n+1:a=+a+1),"<"===i&&(o="-0"),r=`${i+n}.${a}.${s}${o}`):c?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:d&&(r=`>=${n}.${a}.0${o} <${n}.${+a+1}.0-0`),l("xRange return",r),r})},O=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),T=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),A=e=>(t,r,i,n,a,s,o,l,u,c,d,h)=>(r=w(i)?"":w(n)?`>=${i}.0.0${e?"-0":""}`:w(a)?`>=${i}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),N=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},54409,(e,t,r)=>{"use strict";let i=Symbol("SemVer ANY");class n{static get ANY(){return i}constructor(e,t){if(t=a(t),e instanceof n)if(!!t.loose===e.loose)return e;else e=e.value;u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}t.exports=n;let a=e.r(24355),{safeRe:s,t:o}=e.r(66216),l=e.r(40592),u=e.r(17518),c=e.r(37898),d=e.r(51532)},21152,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t,r)=>{try{t=new i(t,r)}catch(e){return!1}return t.test(e)}},81400,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t)=>new i(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},52862,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||-1===s.compare(e))&&(s=new i(a=e,r))}),a}},67359,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||1===s.compare(e))&&(s=new i(a=e,r))}),a}},14757,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532),a=e.r(45008);t.exports=(e,t)=>{e=new n(e,t);let r=new i("0.0.0");if(e.test(r)||(r=new i("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let n=e.set[t],s=null;n.forEach(e=>{let t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||a(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||a(r,s))&&(r=s)}return r&&e.test(r)?r:null}},25537,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},92538,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(54409),{ANY:a}=n,s=e.r(51532),o=e.r(21152),l=e.r(45008),u=e.r(80169),c=e.r(24891),d=e.r(53425);t.exports=(e,t,r,h)=>{let p,m,f,g,y;switch(e=new i(e,h),t=new s(t,h),r){case">":p=l,m=c,f=u,g=">",y=">=";break;case"<":p=u,m=d,f=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let i=t.set[r],s=null,o=null;if(i.forEach(e=>{e.semver===a&&(e=new n(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:f(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&m(e,o.semver)||o.operator===y&&f(e,o.semver))return!1}return!0}},12352,(e,t,r)=>{"use strict";let i=e.r(92538);t.exports=(e,t,r)=>i(e,t,">",r)},65212,(e,t,r)=>{"use strict";let i=e.r(92538);t.exports=(e,t,r)=>i(e,t,"<",r)},86081,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t,r)=>(e=new i(e,r),t=new i(t,r),e.intersects(t,r))},96485,(e,t,r)=>{"use strict";let i=e.r(21152),n=e.r(1070);t.exports=(e,t,r)=>{let a=[],s=null,o=null,l=e.sort((e,t)=>n(e,t,r));for(let e of l)i(e,t,r)?(o=e,s||(s=e)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);let u=[];for(let[e,t]of a)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},69641,(e,t,r)=>{"use strict";let i=e.r(51532),n=e.r(54409),{ANY:a}=n,s=e.r(21152),o=e.r(1070),l=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],c=(e,t,r)=>{let i,n,c,p,m,f,g;if(e===t)return!0;if(1===e.length&&e[0].semver===a)if(1===t.length&&t[0].semver===a)return!0;else e=r.includePrerelease?l:u;if(1===t.length&&t[0].semver===a)if(r.includePrerelease)return!0;else t=u;let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?n=h(n,t,r):y.add(t.semver);if(y.size>1)return null;if(i&&n&&((c=o(i.semver,n.semver,r))>0||0===c&&(">="!==i.operator||"<="!==n.operator)))return null;for(let e of y){if(i&&!s(e,String(i),r)||n&&!s(e,String(n),r))return null;for(let i of t)if(!s(e,String(i),r))return!1;return!0}let v=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver,_=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver;for(let e of(v&&1===v.prerelease.length&&"<"===n.operator&&0===v.prerelease[0]&&(v=!1),t)){if(g=g||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,i){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),">"===e.operator||">="===e.operator){if((p=d(i,e,r))===e&&p!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1}if(n){if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),"<"===e.operator||"<="===e.operator){if((m=h(n,e,r))===e&&m!==n)return!1}else if("<="===n.operator&&!s(n.semver,String(e),r))return!1}if(!e.operator&&(n||i)&&0!==c)return!1}return(!i||!f||!!n||0===c)&&(!n||!g||!!i||0===c)&&!_&&!v&&!0},d=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};t.exports=(e,t,r={})=>{if(e===t)return!0;e=new i(e,r),t=new i(t,r);let n=!1;e:for(let i of e.set){for(let e of t.set){let t=c(i,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},99136,(e,t,r)=>{"use strict";let i=e.r(66216),n=e.r(57006),a=e.r(37898),s=e.r(47277),o=e.r(16460),l=e.r(77156),u=e.r(79839),c=e.r(5025),d=e.r(87740),h=e.r(55631),p=e.r(66406),m=e.r(76569),f=e.r(91870),g=e.r(1070),y=e.r(42836),v=e.r(39246),_=e.r(50764),b=e.r(49535),w=e.r(71739),$=e.r(45008),x=e.r(80169),k=e.r(39027),I=e.r(19849),E=e.r(53425),S=e.r(24891),O=e.r(40592),T=e.r(70537),A=e.r(54409),N=e.r(51532),C=e.r(21152),j=e.r(81400),P=e.r(52862),R=e.r(67359),U=e.r(14757),L=e.r(25537),z=e.r(92538),D=e.r(12352),M=e.r(65212),Z=e.r(86081);t.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:m,prerelease:f,compare:g,rcompare:y,compareLoose:v,compareBuild:_,sort:b,rsort:w,gt:$,lt:x,eq:k,neq:I,gte:E,lte:S,cmp:O,coerce:T,Comparator:A,Range:N,satisfies:C,toComparators:j,maxSatisfying:P,minSatisfying:R,minVersion:U,validRange:L,outside:z,gtr:D,ltr:M,intersects:Z,simplifyRange:e.r(96485),subset:e.r(69641),SemVer:a,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},48271,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},6920,(e,t,r)=>{"use strict";r.byteLength=function(e){var t=u(e),r=t[0],i=t[1];return(r+i)*3/4-i},r.toByteArray=function(e){var t,r,i=u(e),s=i[0],o=i[1],l=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,a=[],s=0,o=r-n;s<o;s+=16383)a.push(function(e,t,r){for(var n,a=[],s=t;s<r;s+=3)n=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(i[n>>18&63]+i[n>>12&63]+i[n>>6&63]+i[63&n]);return a.join("")}(e,s,s+16383>o?o:s+16383));return 1===n?a.push(i[(t=e[r-1])>>2]+i[t<<4&63]+"=="):2===n&&a.push(i[(t=(e[r-2]<<8)+e[r-1])>>10]+i[t>>4&63]+i[t<<2&63]+"="),a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}n[45]=62,n[95]=63},24605,e=>{"use strict";let t,r,i,n,a,s,o,l,u,c,d;var h,p,m,f,g,y,v,_,b,w,$,x,k,I,E=e.i(47909),S=e.i(74017),O=e.i(96250),T=e.i(59756),A=e.i(61916),N=e.i(14444),C=e.i(37092),j=e.i(69741),P=e.i(16795),R=e.i(87718),U=e.i(95169),L=e.i(47587),z=e.i(66012),D=e.i(70101),M=e.i(26937),Z=e.i(10372),F=e.i(93695);e.i(52474);var B=e.i(5232),V=e.i(89171),q=Object.defineProperty,G=(e,t)=>{for(var r in t)q(e,r,{get:t[r],enumerable:!0})};let W=Symbol.for("ls:tracing_async_local_storage"),J=Symbol.for("lc:context_variables"),H=()=>globalThis[W],K=/[\p{Lu}]/u,X=/[\p{Ll}]/u,Y=/^[\p{Lu}](?![\p{Lu}])/u,Q=/[_.\- ]+/,ee=/([\p{Alpha}\p{N}_]|$)/u,et=RegExp("^"+Q.source),er=RegExp(Q.source+ee.source,"gu"),ei=RegExp(String.raw`\d+`+ee.source,"gu");function en(e,t){return t?.[e]||function(e,{separator:t="_",preserveConsecutiveUppercase:r=!1}={}){if("string"!=typeof e||"string"!=typeof t)throw TypeError("The `text` and `separator` arguments should be of type `string`");if(e.length<2)return r?e:e.toLowerCase();let i=`$1${t}$2`,n=e.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,i);if(r){var a;return(a=n.replace(/((?<![\p{Uppercase_Letter}\d])[\p{Uppercase_Letter}\d](?![\p{Uppercase_Letter}\d]))/gu,e=>e.toLowerCase())).replace(/(?<!\p{Uppercase_Letter})(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(e,r,i)=>r+t+i.toLowerCase())}return n.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,i).toLowerCase()}(e)}function ea(e,t){return t?.[e]||function(e,t){if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,capitalizeAfterNumber:!0,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length>0).join("-"):e.trim()).length)return"";let r=e.match(/^[_$]*/)[0];if(0===(e=e.slice(r.length)).length)return r;let i=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),n=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);if(1===e.length)return Q.test(e)?r:r+(t.pascalCase?n(e):i(e));if(e!==i(e)&&(e=((e,t,r,i)=>{let n=!1,a=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];o=!(l>2)||"-"===e[l-3],n&&K.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,s=a,a=!0,l++):a&&s&&X.test(u)&&(!o||i)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),s=a,a=!1,n=!0):(n=t(u)===u&&r(u)!==u,s=a,a=r(u)===u&&t(u)!==u)}return e})(e,i,n,t.preserveConsecutiveUppercase)),e=e.replace(et,""),t.capitalizeAfterNumber)e=t.preserveConsecutiveUppercase?e.replace(Y,e=>i(e)):i(e);else e=((e,t,r)=>{let i="",n=!1,a=!1,s=[...e];for(let e=0;e<s.length;e++){let o=s[e],l=K.test(o),u=e+1<s.length&&K.test(s[e+1]);n&&/[\p{Alpha}]/u.test(o)?(i+=o,n=!1,a=l):r&&l&&(a||u)?(i+=o,a=!0):(/\d/.test(o)?(i+=o,n=!0):Q.test(o)?i+=o:(i+=t(o),n=!1),a=!1)}return i})(e,i,t.preserveConsecutiveUppercase);return t.pascalCase&&e.length>0&&(e=n(e[0])+e.slice(1)),r+((e,t,{capitalizeAfterNumber:r})=>{let i=r?(e,r,i,n)=>{let a=n.charAt(i+e.length);return Q.test(a)?e:r?e.slice(0,-r.length)+t(r):e}:e=>e;return e.replaceAll(ei,i).replaceAll(er,(e,r)=>t(r))})(e,n,t)}(e)}function es(e,t,r){let i={};for(let n in e)Object.hasOwn(e,n)&&(i[t(n,r)]=e[n]);return i}var eo={};function el(e){return Array.isArray(e)?[...e]:{...e}}function eu(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}G(eo,{Serializable:()=>ec,get_lc_unique_name:()=>eu});var ec=class e{lc_serializable=!1;lc_kwargs;static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,eu(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof e||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let t={},r={},i=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let e=Object.getPrototypeOf(this);e;e=Object.getPrototypeOf(e))Object.assign(t,Reflect.get(e,"lc_aliases",this)),Object.assign(r,Reflect.get(e,"lc_secrets",this)),Object.assign(i,Reflect.get(e,"lc_attributes",this));return Object.keys(r).forEach(e=>{let t=this,r=i,[n,...a]=e.split(".").reverse();for(let e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}n in t&&void 0!==t[n]&&(r[n]=r[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:es(Object.keys(r).length?function(e,t){let r=el(e);for(let[e,i]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),a=r;for(let e of n.reverse()){if(void 0===a[e])break;a[e]=el(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[i]})}return r}(i,r):i,en,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function ed(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function eh(e){return ed(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function ep(e){return ed(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function em(e){return ed(e)&&"text"===e.source_type&&"text"in e&&"string"==typeof e.text}function ef(e){return ed(e)&&"id"===e.source_type&&"id"in e&&"string"==typeof e.id}function eg(e){if(ed(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw Error("mime_type key is required for base64 data.");let t=e.mime_type;return{type:"image_url",image_url:{url:`data:${t};base64,${e.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function ey(e){let t=e.split(";")[0].split("/");if(2!==t.length)throw Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);let r=t[0].trim(),i=t[1].trim();if(""===r||""===i)throw Error(`Invalid mime type: "${e}" - type or subtype is empty.`);let n={};for(let t of e.split(";").slice(1)){let r=t.split("=");if(2!==r.length)throw Error(`Invalid parameter syntax in mime type: "${e}".`);let i=r[0].trim(),a=r[1].trim();if(""===i)throw Error(`Invalid parameter syntax in mime type: "${e}".`);n[i]=a}return{type:r,subtype:i,parameters:n}}function ev({dataUrl:e,asTypedArray:t=!1}){let r=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(r)return{mime_type:r[1].toLowerCase(),data:t?Uint8Array.from(atob(r[2]),e=>e.charCodeAt(0)):r[2]}}function e_(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}function eb(e,t){return ew(e)&&e.type===t}function ew(e){return"object"==typeof e&&null!==e}function e$(e){return Array.isArray(e)}function ex(e){return"string"==typeof e}function ek(e){return"number"==typeof e}function eI(e){return e instanceof Uint8Array}function eE(e){try{return JSON.parse(e)}catch{return}}let eS=e=>e();function eO(e){if(eb(e,"document")&&ew(e.source)&&"type"in e.source){if("base64"===e.source.type&&ex(e.source.media_type)&&ex(e.source.data))return{type:"file",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&ex(e.source.url))return{type:"file",url:e.source.url};else if("file"===e.source.type&&ex(e.source.file_id))return{type:"file",fileId:e.source.file_id};else if("text"===e.source.type&&ex(e.source.data))return{type:"file",mimeType:String(e.source.media_type??"text/plain"),data:e.source.data}}else if(eb(e,"image")&&ew(e.source)&&"type"in e.source){if("base64"===e.source.type&&ex(e.source.media_type)&&ex(e.source.data))return{type:"image",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&ex(e.source.url))return{type:"image",url:e.source.url};else if("file"===e.source.type&&ex(e.source.file_id))return{type:"image",fileId:e.source.file_id}}}function eT(e){return Array.from(function*(){for(let t of e){let e=eO(t);e?yield e:yield t}}())}function eA(e){return Array.from(function*(){for(let r of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(eb(r,"text")&&ex(r.text)){let{text:e,citations:t,...i}=r;if(e$(t)&&t.length){let r=t.reduce((e,t)=>{let r=function(e){if("char_location"===e.type&&ex(e.document_title)&&ek(e.start_char_index)&&ek(e.end_char_index)&&ex(e.cited_text)){let{document_title:t,start_char_index:r,end_char_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"char",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("page_location"===e.type&&ex(e.document_title)&&ek(e.start_page_number)&&ek(e.end_page_number)&&ex(e.cited_text)){let{document_title:t,start_page_number:r,end_page_number:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"page",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("content_block_location"===e.type&&ex(e.document_title)&&ek(e.start_block_index)&&ek(e.end_block_index)&&ex(e.cited_text)){let{document_title:t,start_block_index:r,end_block_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"block",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("web_search_result_location"===e.type&&ex(e.url)&&ex(e.title)&&ex(e.encrypted_index)&&ex(e.cited_text)){let{url:t,title:r,encrypted_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"url",url:t,title:r,startIndex:Number(i),endIndex:Number(i),citedText:n}}if("search_result_location"===e.type&&ex(e.source)&&ex(e.title)&&ek(e.start_block_index)&&ek(e.end_block_index)&&ex(e.cited_text)){let{source:t,title:r,start_block_index:i,end_block_index:n,cited_text:a,...s}=e;return{...s,type:"citation",source:"search",url:t,title:r??void 0,startIndex:i,endIndex:n,citedText:a}}}(t);return r?[...e,r]:e},[]);yield{...i,type:"text",text:e,annotations:r};continue}yield{...i,type:"text",text:e};continue}if(eb(r,"thinking")&&ex(r.thinking)){let{thinking:e,signature:t,...i}=r;yield{...i,type:"reasoning",reasoning:e,signature:t};continue}if(eb(r,"redacted_thinking")){yield{type:"non_standard",value:r};continue}else if(eb(r,"tool_use")&&ex(r.name)&&ex(r.id)){yield{type:"tool_call",id:r.id,name:r.name,args:r.input};continue}else if(eb(r,"input_json_delta")){var t;if(t=e,"function"==typeof t?._getType&&"function"==typeof t.concat&&"ai"===t._getType()&&e.tool_call_chunks?.length){let t=e.tool_call_chunks[0];yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args,index:t.index};continue}}else if(eb(r,"server_tool_use")&&ex(r.name)&&ex(r.id)){let{name:e,id:t}=r;if("web_search"===e){let e=eS(()=>{if("string"==typeof r.input)return r.input;if(ew(r.input)&&ex(r.input.query))return r.input.query;if(ex(r.partial_json)){let e=eE(r.partial_json);if(e?.query)return e.query}return""});yield{id:t,type:"server_tool_call",name:"web_search",args:{query:e}};continue}if("code_execution"===r.name){let e=eS(()=>{if("string"==typeof r.input)return r.input;if(ew(r.input)&&ex(r.input.code))return r.input.code;if(ex(r.partial_json)){let e=eE(r.partial_json);if(e?.code)return e.code}return""});yield{id:t,type:"server_tool_call",name:"code_execution",args:{code:e}};continue}}else if(eb(r,"web_search_tool_result")&&ex(r.tool_use_id)&&e$(r.content)){let{content:e,tool_use_id:t}=r,i=e.reduce((e,t)=>eb(t,"web_search_result")?[...e,t.url]:e,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:t,status:"success",output:{urls:i}};continue}else if(eb(r,"code_execution_tool_result")&&ex(r.tool_use_id)&&ew(r.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(eb(r,"mcp_tool_use")){yield{id:r.id,type:"server_tool_call",name:"mcp_tool_use",args:r.input};continue}else if(eb(r,"mcp_tool_result")&&ex(r.tool_use_id)&&ew(r.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(eb(r,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:r.input};continue}else if(eb(r,"search_result")){yield{id:r.id,type:"non_standard",value:r};continue}else if(eb(r,"tool_result")){yield{id:r.id,type:"non_standard",value:r};continue}else{let e=eO(r);if(e){yield e;continue}}yield{type:"non_standard",value:r}}}())}function eN(e){return eh(e)?{type:e.type,mimeType:e.mime_type,url:e.url,metadata:e.metadata}:ep(e)?{type:e.type,mimeType:e.mime_type??"application/octet-stream",data:e.data,metadata:e.metadata}:ef(e)?{type:e.type,mimeType:e.mime_type,fileId:e.id,metadata:e.metadata}:e}function eC(e){return e.map(eN)}function ej(e){let t=[];for(let r of e)(eb(r,"image_url")&&ew(r.image_url)||eb(r,"input_audio")&&ew(r.input_audio)||eb(r,"file")&&ew(r.file)?0:1)?t.push(r):t.push(function(e){if(eb(e,"image_url")&&ew(e.image_url)&&ex(e.image_url.url)){let t=ev({dataUrl:e.image_url.url});return t?{type:"image",mimeType:t.mime_type,data:t.data}:{type:"image",url:e.image_url.url}}if(eb(e,"input_audio")&&ew(e.input_audio)&&ex(e.input_audio.data)&&ex(e.input_audio.format))return{type:"audio",data:e.input_audio.data,mimeType:`audio/${e.input_audio.format}`};if(eb(e,"file")&&ew(e.file)&&ex(e.file.data)){let t=ev({dataUrl:e.file.data});if(t)return{type:"file",data:t.data,mimeType:t.mime_type};if(ex(e.file.file_id))return{type:"file",fileId:e.file.file_id}}return e}(r));return t}function eP(e){if("url_citation"===e.type){let{url:t,title:r,start_index:i,end_index:n}=e;return{type:"citation",url:t,title:r,startIndex:i,endIndex:n}}if("file_citation"===e.type){let{file_id:t,filename:r,index:i}=e;return{type:"citation",title:r,startIndex:i,endIndex:i,fileId:t}}return e}function eR(e){return Array.from(function*(){if(ew(e.additional_kwargs?.reasoning)&&e$(e.additional_kwargs.reasoning.summary)){let t=e.additional_kwargs.reasoning.summary.reduce((e,t)=>ew(t)&&ex(t.text)?`${e}${t.text}`:e,"");yield{type:"reasoning",reasoning:t}}for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content)if(eb(t,"text")){let{text:e,annotations:r,...i}=t;Array.isArray(r)?yield{...i,type:"text",text:String(e),annotations:r.map(eP)}:yield{...i,type:"text",text:String(e)}}for(let t of e.tool_calls??[])yield{type:"tool_call",id:t.id,name:t.name,args:t.args};if(ew(e.additional_kwargs)&&e$(e.additional_kwargs.tool_outputs))for(let t of e.additional_kwargs.tool_outputs){if(eb(t,"web_search_call")){yield{id:t.id,type:"server_tool_call",name:"web_search",args:{query:t.query}};continue}if(eb(t,"file_search_call")){yield{id:t.id,type:"server_tool_call",name:"file_search",args:{query:t.query}};continue}if(eb(t,"computer_call")){yield{type:"non_standard",value:t};continue}else if(eb(t,"code_interpreter_call")){if(ex(t.code)&&(yield{id:t.id,type:"server_tool_call",name:"code_interpreter",args:{code:t.code}}),e$(t.outputs)){let e=eS(()=>{if("in_progress"!==t.status){if("completed"===t.status)return 0;if("incomplete"===t.status)return 127;if("interpreting"!==t.status&&"failed"===t.status)return 1}});for(let r of t.outputs)if(eb(r,"logs")){yield{type:"server_tool_call_result",toolCallId:t.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:e??0,stderr:[0,void 0].includes(e)?void 0:String(r.logs),stdout:[0,void 0].includes(e)?String(r.logs):void 0}};continue}}continue}else if(eb(t,"mcp_call")){yield{id:t.id,type:"server_tool_call",name:"mcp_call",args:t.input};continue}else if(eb(t,"mcp_list_tools")){yield{id:t.id,type:"server_tool_call",name:"mcp_list_tools",args:t.input};continue}else if(eb(t,"mcp_approval_request")){yield{type:"non_standard",value:t};continue}else if(eb(t,"image_generation_call")){yield{type:"non_standard",value:t};continue}ew(t)&&(yield{type:"non_standard",value:t})}}())}function eU(e){return"object"==typeof e&&null!==e&&"type"in e&&"content"in e&&("string"==typeof e.content||Array.isArray(e.content))}let eL=Symbol.for("langchain.message");function ez(e,t){if("string"==typeof e)return""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&0===t.length?e:Array.isArray(t)&&t.some(e=>ed(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t];return Array.isArray(t)?eB(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>ed(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function eD(e,t){return"error"===e||"error"===t?"error":"success"}var eM=class extends ec{lc_namespace=["langchain_core","messages"];lc_serializable=!0;get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}[eL]=!0;id;name;content;additional_kwargs;response_metadata;_getType(){return this.type}getType(){return this._getType()}constructor(e){const t="string"==typeof e||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={}),super(t),this.name=t.name,void 0===t.content&&void 0!==t.contentBlocks?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):(void 0!==t.content?this.content=t.content??[]:this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}get contentBlocks(){return[eC,ej,eT].reduce((e,t)=>t(e),"string"==typeof this.content?[{type:"text",text:this.content}]:this.content)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return"object"==typeof e&&null!==e&&eL in e&&!0===e[eL]&&eU(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let i=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,i){if("object"!=typeof t||null==t)return t;if(i>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,i+1));let n={};for(let r of Object.keys(t))n[r]=e(t[r],i+1);return n}(t,0),null,2));return`${this.constructor.lc_name()} ${i}`}toFormattedString(e="pretty"){return function(e,t="pretty"){return"pretty"===t?function(e){let t=[],r=` ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} Message `,i=Math.floor((80-r.length)/2),n="=".repeat(i),a=r.length%2==0?n:`${n}=`;if(t.push(`${n}${r}${a}`),"ai"===e.type&&e.tool_calls&&e.tool_calls.length>0)for(let r of(t.push("Tool Calls:"),e.tool_calls))for(let[e,i]of(t.push(`  ${r.name} (${r.id})`),t.push(` Call ID: ${r.id}`),t.push("  Args:"),Object.entries(r.args)))t.push(`    ${e}: ${i}`);return"tool"===e.type&&e.name&&t.push(`Name: ${e.name}`),"string"==typeof e.content&&e.content.trim()&&(t.length>1&&t.push(""),t.push(e.content)),t.join("\n")}(e):JSON.stringify(e)}(this,e)}};function eZ(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}function eF(e={},t={}){let r={...e};for(let[e,i]of Object.entries(t))if(null==r[e])r[e]=i;else if(null==i)continue;else if(typeof r[e]!=typeof i||Array.isArray(r[e])!==Array.isArray(i))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])if("type"===e)continue;else["id","name","output_version","model_provider"].includes(e)?i&&(r[e]=i):r[e]+=i;else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=eB(r[e],i);else{if(r[e]===i)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=eF(r[e],i);return r}function eB(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;let r=[...e];for(let e of t)if("object"==typeof e&&null!==e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>{let r="object"==typeof t,i="index"in t&&t.index===e.index,n="id"in t&&"id"in e&&t?.id===e?.id,a=!("id"in t)||!t?.id||!("id"in e)||!e?.id;return r&&i&&(n||a)});-1!==t&&"object"==typeof r[t]&&null!==r[t]?r[t]=eF(r[t],e):r.push(e)}else{if("object"==typeof e&&null!==e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}function eV(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return eB(e,t);if("object"==typeof e&&"object"==typeof t)return eF(e,t);else if(e===t)return e;else throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}var eq=class e extends eM{static isInstance(t){if(!super.isInstance(t))return!1;let r=Object.getPrototypeOf(t);for(;null!==r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}};function eG(e){return"string"==typeof e.role}function eW(e){return"function"==typeof e?._getType}function eJ(e){return eq.isInstance(e)}var eH={};function eK(e){return null!=e&&"object"==typeof e&&"lc_direct_tool_output"in e&&!0===e.lc_direct_tool_output}G(eH,{ToolMessage:()=>eX,ToolMessageChunk:()=>eY,defaultToolCallParser:()=>eQ,isDirectToolOutput:()=>eK,isToolMessage:()=>e0,isToolMessageChunk:()=>e1});var eX=class extends eM{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}lc_direct_tool_output=!0;type="tool";status;tool_call_id;metadata;artifact;constructor(e,t,r){const i="string"==typeof e||Array.isArray(e)?{content:e,name:r,tool_call_id:t}:e;super(i),this.tool_call_id=i.tool_call_id,this.artifact=i.artifact,this.status=i.status,this.metadata=i.metadata}static isInstance(e){return super.isInstance(e)&&"tool"===e.type}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},eY=class extends eq{type="tool";tool_call_id;status;artifact;constructor(e){super(e),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){return new this.constructor({content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:eF(this.response_metadata,e.response_metadata),artifact:eV(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:eD(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function eQ(e){let t=[],r=[];for(let i of e)if(!i.function)continue;else{let e=i.function.name;try{let r=JSON.parse(i.function.arguments);t.push({name:e||"",args:r||{},id:i.id})}catch{r.push({name:e,args:i.function.arguments,id:i.id,error:"Malformed args."})}}return[t,r]}function e0(e){return"object"==typeof e&&null!==e&&"getType"in e&&"function"==typeof e.getType&&"tool"===e.getType()}function e1(e){return"tool"===e._getType()}function e4(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}function e2(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}var e6=class extends Error{output;constructor(e,t){super(e),this.output=t}};function e9(e,t=e5){let r=(e=e.trim()).indexOf("```");if(-1===r)return t(e);let i=e.substring(r+3);i.startsWith("json\n")?i=i.substring(5):i.startsWith("json")?i=i.substring(4):i.startsWith("\n")&&(i=i.substring(1));let n=i.indexOf("```"),a=i;return -1!==n&&(a=i.substring(0,n)),t(a.trim())}function e5(e){try{if(void 0===e)return null;return function(e){try{return JSON.parse(e)}catch{}let t=e.trim();if(0===t.length)throw Error("Unexpected end of JSON input");let r=0;function i(){for(;r<t.length&&/\s/.test(t[r]);)r+=1}function n(){if('"'!==t[r])throw Error(`Expected '"' at position ${r}, got '${t[r]}'`);r+=1;let e="",i=!1;for(;r<t.length;){let n=t[r];if(i){if("n"===n)e+="\n";else if("t"===n)e+="	";else if("r"===n)e+="\r";else if("\\"===n)e+="\\";else if('"'===n)e+='"';else if("b"===n)e+="\b";else if("f"===n)e+="\f";else if("/"===n)e+="/";else if("u"===n){let i=t.substring(r+1,r+5);if(/^[0-9A-Fa-f]{0,4}$/.test(i))4===i.length?e+=String.fromCharCode(Number.parseInt(i,16)):e+=`u${i}`,r+=i.length;else throw Error(`Invalid unicode escape sequence '\\u${i}' at position ${r}`)}else throw Error(`Invalid escape sequence '\\${n}' at position ${r}`);i=!1}else if("\\"===n)i=!0;else{if('"'===n)return r+=1,e;e+=n}r+=1}return i&&(e+="\\"),e}let a=function e(){if(i(),r>=t.length)throw Error(`Unexpected end of input at position ${r}`);let a=t[r];if("{"===a){if("{"!==t[r])throw Error(`Expected '{' at position ${r}, got '${t[r]}'`);let a={};if(r+=1,i(),r>=t.length)return a;if("}"===t[r])return r+=1,a;for(;r<t.length&&(i(),!(r>=t.length));){let s=n();if(i(),r>=t.length)break;if(":"!==t[r])throw Error(`Expected ':' at position ${r}, got '${t[r]}'`);if(r+=1,i(),r>=t.length||(a[s]=e(),i(),r>=t.length))break;if("}"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or '}' at position ${r}, got '${t[r]}'`)}return a}if("["===a){if("["!==t[r])throw Error(`Expected '[' at position ${r}, got '${t[r]}'`);let n=[];if(r+=1,i(),r>=t.length)return n;if("]"===t[r])return r+=1,n;for(;r<t.length&&(i(),!(r>=t.length))&&(n.push(e()),i(),!(r>=t.length));){;if("]"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or ']' at position ${r}, got '${t[r]}'`)}return n}if('"'===a)return n();if("null".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),null;if("true".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),!0;if("false".startsWith(t.substring(r,r+5)))return r+=Math.min(5,t.length-r),!1;if("-"===a||a>="0"&&a<="9"){let e=r,i="";if("-"===t[r]&&(i+="-",r+=1),r<t.length&&"0"===t[r]&&(i+="0",t[r+=1]>="0"&&t[r]<="9"))throw Error(`Invalid number at position ${e}`);if(r<t.length&&t[r]>="1"&&t[r]<="9")for(;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&"."===t[r])for(i+=".",r+=1;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&("e"===t[r]||"E"===t[r]))for(i+=t[r],(r+=1)<t.length&&("+"===t[r]||"-"===t[r])&&(i+=t[r],r+=1);r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if("-"===i)return -0;let n=Number.parseFloat(i);if(Number.isNaN(n))throw r=e,Error(`Invalid number '${i}' at position ${e}`);return n}throw Error(`Unexpected character '${a}' at position ${r}`)}();if(i(),r<t.length)throw Error(`Unexpected character '${t[r]}' at position ${r}`);return a}(e)}catch{return null}}var e3=class e extends eM{static lc_name(){return"ChatMessage"}type="generic";role;static _chatMessageClass(){return e}constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}},e8=class extends eq{static lc_name(){return"ChatMessageChunk"}type="generic";role;constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}concat(e){return new this.constructor({content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:eF(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}};function e7(e){return"generic"===e._getType()}function te(e){return"generic"===e._getType()}var tt=class extends eM{static lc_name(){return"FunctionMessage"}type="function";name;constructor(e){super(e),this.name=e.name}},tr=class extends eq{static lc_name(){return"FunctionMessageChunk"}type="function";concat(e){return new this.constructor({content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:eF(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function ti(e){return"function"===e._getType()}function tn(e){return"function"===e._getType()}var ta=class extends eM{static lc_name(){return"HumanMessage"}type="human";constructor(e){super(e)}static isInstance(e){return super.isInstance(e)&&"human"===e.type}},ts=class extends eq{static lc_name(){return"HumanMessageChunk"}type="human";constructor(e){super(e)}concat(e){return new this.constructor({content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:eF(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"human"===e.type}};function to(e){return"human"===e.getType()}function tl(e){return"human"===e.getType()}var tu=class extends eM{type="remove";id;constructor(e){super({...e,content:[]}),this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&"remove"===e.type}},tc=class e extends eM{static lc_name(){return"SystemMessage"}type="system";constructor(e){super(e)}concat(t){if("string"==typeof t)return new e({...this,content:ez(this.content,t)});if(e.isInstance(t))return new e({...this,additional_kwargs:{...this.additional_kwargs,...t.additional_kwargs},response_metadata:{...this.response_metadata,...t.response_metadata},content:ez(this.content,t.content)});throw Error("Unexpected chunk type for system message")}static isInstance(e){return super.isInstance(e)&&"system"===e.type}},td=class extends eq{static lc_name(){return"SystemMessageChunk"}type="system";constructor(e){super(e)}concat(e){return new this.constructor({content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:eF(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"system"===e.type}};function th(e){return"system"===e._getType()}function tp(e){return"system"===e._getType()}function tm(e){switch(e){case"csv":return"text/csv";case"doc":case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function tf(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(eb(t,"cache_point")){yield{type:"non_standard",value:t};continue}if(eb(t,"citations_content")&&ew(t.citationsContent)){let e=e$(t.citationsContent.content)?t.citationsContent.content.reduce((e,t)=>ew(t)&&ex(t.text)?e+t.text:e,""):"",r=e$(t.citationsContent.citations)?t.citationsContent.citations.reduce((e,t)=>{if(ew(t)){let r=e$(t.sourceContent)?t.sourceContent.reduce((e,t)=>ew(t)&&ex(t.text)?e+t.text:e,""):"",i=eS(()=>{if(ew(t.location)){let e=t.location.documentChar||t.location.documentPage||t.location.documentChunk;if(ew(e))return{source:ek(e.documentIndex)?e.documentIndex.toString():void 0,startIndex:ek(e.start)?e.start:void 0,endIndex:ek(e.end)?e.end:void 0}}return{}});e.push({type:"citation",citedText:r,...i})}return e},[]):[];yield{type:"text",text:e,annotations:r};continue}if(eb(t,"document")&&ew(t.document)){yield function(e){if(ew(e.document)&&ew(e.document.source)){let t=tm(ew(e.document)&&ex(e.document.format)?e.document.format:"");if(ew(e.document.source)){if(ew(e.document.source.s3Location)&&ex(e.document.source.s3Location.uri))return{type:"file",mimeType:t,fileId:e.document.source.s3Location.uri};if(eI(e.document.source.bytes))return{type:"file",mimeType:t,data:e.document.source.bytes};if(ex(e.document.source.text))return{type:"file",mimeType:t,data:Buffer.from(e.document.source.text).toString("base64")};if(e$(e.document.source.content))return{type:"file",mimeType:t,data:e.document.source.content.reduce((e,t)=>ew(t)&&ex(t.text)?e+t.text:e,"")}}}return{type:"non_standard",value:e}}(t);continue}else if(eb(t,"guard_content")){yield{type:"non_standard",value:t};continue}else if(eb(t,"image")&&ew(t.image)){yield function(e){if(eb(e,"image")&&ew(e.image)){let t=tm(ew(e.image)&&ex(e.image.format)?e.image.format:"");if(ew(e.image.source)){if(ew(e.image.source.s3Location)&&ex(e.image.source.s3Location.uri))return{type:"image",mimeType:t,fileId:e.image.source.s3Location.uri};if(eI(e.image.source.bytes))return{type:"image",mimeType:t,data:e.image.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}else if(eb(t,"reasoning_content")&&ex(t.reasoningText)){yield{type:"reasoning",reasoning:t.reasoningText};continue}else if(eb(t,"text")&&ex(t.text)){yield{type:"text",text:t.text};continue}else if(eb(t,"tool_result")){yield{type:"non_standard",value:t};continue}else if(eb(t,"tool_call"))continue;else if(eb(t,"video")&&ew(t.video)){yield function(e){if(eb(e,"video")&&ew(e.video)){let t=tm(ew(e.video)&&ex(e.video.format)?e.video.format:"");if(ew(e.video.source)){if(ew(e.video.source.s3Location)&&ex(e.video.source.s3Location.uri))return{type:"video",mimeType:t,fileId:e.video.source.s3Location.uri};if(eI(e.video.source.bytes))return{type:"video",mimeType:t,data:e.video.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}yield{type:"non_standard",value:t}}}())}function tg(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(eb(t,"text")&&ex(t.text)){yield{type:"text",text:t.text};continue}if(eb(t,"inlineData")&&ew(t.inlineData)&&ex(t.inlineData.mimeType)&&ex(t.inlineData.data)){yield{type:"file",mimeType:t.inlineData.mimeType,data:t.inlineData.data};continue}if(eb(t,"functionCall")&&ew(t.functionCall)&&ex(t.functionCall.name)&&ew(t.functionCall.args)){yield{type:"tool_call",id:e.id,name:t.functionCall.name,args:t.functionCall.args};continue}else if(eb(t,"functionResponse")){yield{type:"non_standard",value:t};continue}else if(eb(t,"fileData")&&ew(t.fileData)&&ex(t.fileData.mimeType)&&ex(t.fileData.fileUri)){yield{type:"file",mimeType:t.fileData.mimeType,fileId:t.fileData.fileUri};continue}else if(eb(t,"executableCode")){yield{type:"non_standard",value:t};continue}else if(eb(t,"codeExecutionResult")){yield{type:"non_standard",value:t};continue}yield{type:"non_standard",value:t}}}())}function ty(e){return Array.from(function*(){let t="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;for(let r of t){if(eb(r,"reasoning")&&ex(r.reasoning)){let i=eS(()=>{let i=t.indexOf(r);if(e$(e.additional_kwargs?.signatures)&&i>=0)return e.additional_kwargs.signatures.at(i)});ex(i)?yield{type:"reasoning",reasoning:r.reasoning,signature:i}:yield{type:"reasoning",reasoning:r.reasoning};continue}if(eb(r,"text")&&ex(r.text)){yield{type:"text",text:r.text};continue}if(eb(r,"image_url")){if(ex(r.image_url))if(r.image_url.startsWith("data:")){let e=/^data:([^;]+);base64,(.+)$/,t=r.image_url.match(e);t?yield{type:"image",data:t[2],mimeType:t[1]}:yield{type:"image",url:r.image_url}}else yield{type:"image",url:r.image_url};continue}else if(eb(r,"media")&&ex(r.mimeType)&&ex(r.data)){yield{type:"file",mimeType:r.mimeType,data:r.data};continue}yield{type:"non_standard",value:r}}}())}function tv(e){return globalThis.lc_block_translators_registry.get(e)}function t_(e,t){return eF(e??{},t??{})}function tb(e,t){let r={};return(e?.audio!==void 0||t?.audio!==void 0)&&(r.audio=(e?.audio??0)+(t?.audio??0)),(e?.image!==void 0||t?.image!==void 0)&&(r.image=(e?.image??0)+(t?.image??0)),(e?.video!==void 0||t?.video!==void 0)&&(r.video=(e?.video??0)+(t?.video??0)),(e?.document!==void 0||t?.document!==void 0)&&(r.document=(e?.document??0)+(t?.document??0)),(e?.text!==void 0||t?.text!==void 0)&&(r.text=(e?.text??0)+(t?.text??0)),r}function tw(e,t){var r,i,n,a;let s,o;return{input_tokens:(e?.input_tokens??0)+(t?.input_tokens??0),output_tokens:(e?.output_tokens??0)+(t?.output_tokens??0),total_tokens:(e?.total_tokens??0)+(t?.total_tokens??0),input_token_details:(s={...tb(r=e?.input_token_details,i=t?.input_token_details)},(r?.cache_read!==void 0||i?.cache_read!==void 0)&&(s.cache_read=(r?.cache_read??0)+(i?.cache_read??0)),(r?.cache_creation!==void 0||i?.cache_creation!==void 0)&&(s.cache_creation=(r?.cache_creation??0)+(i?.cache_creation??0)),s),output_token_details:(o={...tb(n=e?.output_token_details,a=t?.output_token_details)},(n?.reasoning!==void 0||a?.reasoning!==void 0)&&(o.reasoning=(n?.reasoning??0)+(a?.reasoning??0)),o)}}globalThis.lc_block_translators_registry??=new Map([["anthropic",{translateContent:eA,translateContentChunk:eA}],["bedrock-converse",{translateContent:tf,translateContentChunk:tf}],["google-genai",{translateContent:tg,translateContentChunk:tg}],["google-vertexai",{translateContent:ty,translateContentChunk:ty}],["openai",{translateContent:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...ej(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return eR(e)},translateContentChunk:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...ej(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return Array.from(function*(){for(let t of(yield*eR(e),e.tool_call_chunks??[]))yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args}}())}}]]);var t$=class extends eM{type="ai";tool_calls=[];invalid_tool_calls=[];usage_metadata;get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e){let t;if("string"==typeof e||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const r=t.additional_kwargs?.tool_calls,i=t.tool_calls;null!=r&&r.length>0&&(void 0===i||0===i.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `pnpm install @langchain/anthropic`, pnpm install @langchain/openai`, etc.");try{if(null!=r&&void 0===i){const[e,i]=eQ(r);t.tool_calls=e??[],t.invalid_tool_calls=i??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(void 0!==t.response_metadata&&"output_version"in t.response_metadata&&"v1"===t.response_metadata.output_version&&(t.contentBlocks=t.content,t.content=void 0),void 0!==t.contentBlocks){t.contentBlocks.push(...t.tool_calls.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})));const e=t.contentBlocks.filter(e=>"tool_call"===e.type).filter(e=>!t.tool_calls?.some(t=>t.id===e.id&&t.name===e.name));e.length>0&&(t.tool_calls=e.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})))}}super(t),"string"!=typeof t&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=tv(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls){let t=this.tool_calls.filter(t=>!e.some(e=>e.id===t.id&&e.name===t.name));e.push(...t.map(e=>({...e,type:"tool_call",id:e.id,name:e.name,args:e.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};function tx(e){return"ai"===e._getType()}function tk(e){return"ai"===e._getType()}var tI=class extends eq{type="ai";tool_calls=[];invalid_tool_calls=[];tool_call_chunks=[];usage_metadata;constructor(e){let t;super(t="string"==typeof e||Array.isArray(e)?{content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]}:void 0===e.tool_call_chunks||0===e.tool_call_chunks.length?{...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}:{...e,...tR(e.tool_call_chunks??[]),usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=tv(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls&&"string"!=typeof this.content){let t=this.content.filter(e=>"tool_call"===e.type).map(e=>e.id);for(let r of this.tool_calls)r.id&&!t.includes(r.id)&&e.push({...r,type:"tool_call",id:r.id,name:r.name,args:r.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:ez(this.content,e.content),additional_kwargs:eF(this.additional_kwargs,e.additional_kwargs),response_metadata:t_(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=eB(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}return(void 0!==this.usage_metadata||void 0!==e.usage_metadata)&&(t.usage_metadata=tw(this.usage_metadata,e.usage_metadata)),new this.constructor(t)}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};let tE=e=>e();function tS(e){return e2(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function tO(e){let t,r;if("object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs){let i=e.id.at(-1);t="HumanMessage"===i||"HumanMessageChunk"===i?"user":"AIMessage"===i||"AIMessageChunk"===i?"assistant":"SystemMessage"===i||"SystemMessageChunk"===i?"system":"FunctionMessage"===i||"FunctionMessageChunk"===i?"function":"ToolMessage"===i||"ToolMessageChunk"===i?"tool":"unknown",r=e.kwargs}else{let{type:i,...n}=e;t=i,r=n}if("human"===t||"user"===t)return new ta(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new t$(r);let i=e.map(tS);return new t$({...t,tool_calls:i})}if("system"===t)return new tc(r);if("developer"===t)return new tc({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new eX({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});if("remove"===t&&"id"in r&&"string"==typeof r.id)return new tu({...r,id:r.id});throw e4(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function tT(e){if("string"==typeof e)return new ta(e);if(eW(e))return e;if(Array.isArray(e)){let[t,r]=e;return tO({type:t,content:r})}if(!eG(e))return tO(e);{let{role:t,...r}=e;return tO({...r,type:t})}}function tA(e,t="Human",r="AI"){let i=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let a=n.name?`${n.name}, `:"",s="string"==typeof n.content?n.content:JSON.stringify(n.content,null,2);i.push(`${e}: ${a}${s}`)}return i.join("\n")}function tN(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new ta(t.data);case"ai":return new t$(t.data);case"system":return new tc(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new tt(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new eX(t.data);case"generic":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new e3(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function tC(e){return e.map(tN)}function tj(e){return e.map(e=>e.toDict())}function tP(e){let t=e._getType();if("human"===t)return new ts({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new tI({...t})}if("system"===t)return new td({...e});if("function"===t)return new tr({...e});if(e3.isInstance(e))return new e8({...e});else throw Error("Unknown message type.")}function tR(e){let t=e.reduce((e,t)=>{let r=e.findIndex(([e])=>"id"in t&&t.id&&"index"in t&&void 0!==t.index?t.id===e.id&&t.index===e.index:"id"in t&&t.id?t.id===e.id:"index"in t&&void 0!==t.index&&t.index===e.index);return -1!==r?e[r].push(t):e.push([t]),e},[]),r=[],i=[];for(let e of t){let t=null,n=e[0]?.name??"",a=e.map(e=>e.args||"").join("").trim(),s=a.length?a:"{}",o=e[0]?.id;try{if(t=e5(s),!o||null===t||"object"!=typeof t||Array.isArray(t))throw Error("Malformed tool call chunk args.");r.push({name:n,args:t,id:o,type:"tool_call"})}catch{i.push({name:n,args:s,id:o,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:e,tool_calls:r,invalid_tool_calls:i}}var tU={};G(tU,{getEnv:()=>tF,getEnvironmentVariable:()=>tV,getRuntimeEnvironment:()=>tB,isBrowser:()=>tL,isDeno:()=>tM,isJsDom:()=>tD,isNode:()=>tZ,isWebWorker:()=>tz});let tL=()=>!1,tz=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,tD=()=>"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),tM=()=>"undefined"!=typeof Deno,tZ=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!tM(),tF=()=>tL()?"browser":tZ()?"node":tz()?"webworker":tD()?"jsdom":tM()?"deno":"other";function tB(){return void 0===t&&(t={library:"langchain-js",runtime:tF()}),t}function tV(e){try{if("undefined"!=typeof process)return process.env?.[e];if(tM())return Deno?.env.get(e);return}catch{return}}var tq=e.i(66680);let tG={randomUUID:tq.default.randomUUID},tW=new Uint8Array(256),tJ=tW.length;function tH(){return tJ>tW.length-16&&(tq.default.randomFillSync(tW),tJ=0),tW.slice(tJ,tJ+=16)}let tK=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,tX=function(e){return"string"==typeof e&&tK.test(e)},tY=[];for(let e=0;e<256;++e)tY.push((e+256).toString(16).slice(1));function tQ(e,t=0){return(tY[e[t+0]]+tY[e[t+1]]+tY[e[t+2]]+tY[e[t+3]]+"-"+tY[e[t+4]]+tY[e[t+5]]+"-"+tY[e[t+6]]+tY[e[t+7]]+"-"+tY[e[t+8]]+tY[e[t+9]]+"-"+tY[e[t+10]]+tY[e[t+11]]+tY[e[t+12]]+tY[e[t+13]]+tY[e[t+14]]+tY[e[t+15]]).toLowerCase()}let t0=function(e,t,r){if(tG.randomUUID&&!t&&!e)return tG.randomUUID();let i=(e=e||{}).random||(e.rng||tH)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return tQ(i)};var t1={};G(t1,{BaseCallbackHandler:()=>t6,callbackHandlerPrefersStreaming:()=>t2,isBaseCallbackHandler:()=>t9});var t4=class{};function t2(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}var t6=class extends t4{lc_serializable=!1;get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,eu(this.constructor)]}lc_kwargs;ignoreLLM=!1;ignoreChain=!1;ignoreAgent=!1;ignoreRetriever=!1;ignoreCustomEvent=!1;raiseError=!1;awaitHandlers="false"===tV("LANGCHAIN_CALLBACKS_BACKGROUND");constructor(e){super(),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return ec.prototype.toJSON.call(this)}toJSONNotImplemented(){return ec.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends t6{name=t0();constructor(){super(),Object.assign(this,e)}}return new t}};let t9=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers,t5="gen_ai.request.model",t3="gen_ai.usage.input_tokens",t8="gen_ai.usage.output_tokens",t7="gen_ai.usage.total_tokens",re="langsmith.span.tags";e.s(["__version__",()=>rd],49753);let rt=Symbol.for("ls:fetch_implementation"),rr=()=>rg("PROJECT")??rf("LANGCHAIN_SESSION")??"default",ri=null,rn=null,ra=0,rs=function(e,t,r){e=e||{};let i=t&&r||0,n=t||new Uint8Array(16),a=e.random||(e.rng||tH)(),s=void 0!==e.msecs?e.msecs:Date.now(),o=void 0!==e.seq?e.seq:null,l=rn,u=ri;return s>ra&&void 0===e.msecs&&(ra=s,null!==o&&(l=null,u=null)),null!==o&&(o>0x7fffffff&&(o=0x7fffffff),l=o>>>19&4095,u=524287&o),(null===l||null===u)&&(l=(l=127&a[6])<<8|a[7],u=(u=(u=63&a[8])<<8|a[9])<<5|a[10]>>>3),s+1e4>ra&&null===o?++u>524287&&(u=0,++l>4095&&(l=0,ra++)):ra=s,rn=l,ri=u,n[i++]=ra/0x10000000000&255,n[i++]=ra/0x100000000&255,n[i++]=ra/0x1000000&255,n[i++]=ra/65536&255,n[i++]=ra/256&255,n[i++]=255&ra,n[i++]=l>>>4&15|112,n[i++]=255&l,n[i++]=u>>>13&63|128,n[i++]=u>>>5&255,n[i++]=u<<3&255|7&a[10],n[i++]=a[11],n[i++]=a[12],n[i++]=a[13],n[i++]=a[14],n[i++]=a[15],t||tQ(n)},ro={};function rl(e){ro[e]||(console.warn(e),ro[e]=!0)}let ru=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function rc(e,t){if(!ru.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}let rd="0.3.82",rh=()=>r||(r="undefined"!=typeof Bun?"bun":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node");function rp(){return void 0===i&&(i={library:"langsmith",runtime:rh(),sdk:"langsmith-js",sdk_version:rd,...function(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=rf(t);void 0!==r&&(e[t]=r)}return n=e,e}()}),i}function rm(){let e=function(){let e={};try{if("undefined"!=typeof process&&process.env)for(let[t,r]of Object.entries(process.env))(t.startsWith("LANGCHAIN_")||t.startsWith("LANGSMITH_"))&&null!=r&&((t.toLowerCase().includes("key")||t.toLowerCase().includes("secret")||t.toLowerCase().includes("token"))&&"string"==typeof r?e[t]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2):e[t]=r)}catch(e){}return e}(),t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[i,n]of Object.entries(e))"string"!=typeof n||r.includes(i)||i.toLowerCase().includes("key")||i.toLowerCase().includes("secret")||i.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===i?t.revision_id=n:t[i]=n);return t}function rf(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function rg(e){return rf(`LANGSMITH_${e}`)||rf(`LANGCHAIN_${e}`)}function ry(){return"true"===rf("OTEL_ENABLED")||"true"===rg("OTEL_ENABLED")}class rv{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let r;if(!this.hasWarned&&ry()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?r=t[0]:2===t.length&&"function"==typeof t[1]?r=t[1]:3===t.length&&"function"==typeof t[2]&&(r=t[2]),"function"==typeof r)return r()}}let r_=Symbol.for("ls:otel_trace"),rb=Symbol.for("ls:otel_context"),rw=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),r$=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new rv})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},rx=new class{active(){return{}}with(e,t){return t()}},rk=new class{getTraceInstance(){return globalThis[r_]??r$}getContextInstance(){return globalThis[rb]??rx}initializeGlobalInstances(e){void 0===globalThis[r_]&&(globalThis[r_]=e.trace),void 0===globalThis[rb]&&(globalThis[rb]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[rw]=e}getDefaultOTLPTracerComponents(){return globalThis[rw]??void 0}};function rI(){return rk.getTraceInstance()}let rE={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class rS{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let r of e)try{if(!r.run)continue;if("post"===r.operation){let e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(e){console.error(`Error processing operation ${r.id}:`,e)}}createSpanForRun(e,t,r){let i=r&&rI().getSpan(r);if(i)try{return this.finishSpanSetup(i,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let r=this.spans.get(e.id);if(!r)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(Error(t.error))):r.setStatus({code:1});let i=t.end_time;i&&(r.end(new Date(i)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){var i;e.setAttribute("langsmith.span.kind",t.run_type);let r=rE[i=t.run_type||"chain"]||i;e.setAttribute("gen_ai.operation.name",r)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let n=this.extractModelName(t);for(let[r,i]of(n&&e.setAttribute(t5,n),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(t3,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(t8,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(t7,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=i&&e.setAttribute(`langsmith.metadata.${r}`,String(i));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(re,a.join(", ")):a&&e.setAttribute(re,String(a)),"serialized"in t&&"object"==typeof t.serialized){let r=t.serialized;r.name&&e.setAttribute("gen_ai.serialized.name",String(r.name)),r.signature&&e.setAttribute("gen_ai.serialized.signature",String(r.signature)),r.doc&&e.setAttribute("gen_ai.serialized.doc",String(r.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain",i=this.extractModelName(t);if(i){let e=i.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?r="anthropic":e.includes("bedrock")?r="aws.bedrock":e.includes("azure")&&e.includes("openai")?r="az.ai.openai":e.includes("azure")&&e.includes("inference")?r="az.ai.inference":e.includes("cohere")?r="cohere":e.includes("deepseek")?r="deepseek":e.includes("gemini")?r="gemini":e.includes("groq")?r="groq":e.includes("watson")||e.includes("ibm")?r="ibm.watsonx.ai":e.includes("mistral")?r="mistral_ai":e.includes("gpt")||e.includes("openai")?r="openai":e.includes("perplexity")||e.includes("sonar")?r="perplexity":e.includes("vertex")?r="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(r="xai")}e.setAttribute("gen_ai.system",r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let r=t.extra.metadata.invocation_params;void 0!==r.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",r.max_tokens),void 0!==r.temperature&&e.setAttribute("gen_ai.request.temperature",r.temperature),void 0!==r.top_p&&e.setAttribute("gen_ai.request.top_p",r.top_p),void 0!==r.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",r.frequency_penalty),void 0!==r.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let r=t.run.inputs;"object"==typeof r&&null!==r&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(t5,r.model),void 0!==r.stream&&e.setAttribute("langsmith.request.streaming",r.stream),r.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(r.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(r))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let r=t.run.outputs,i=this.getUnifiedRunTokens(r);if(i&&(e.setAttribute(t3,i[0]),e.setAttribute(t8,i[1]),e.setAttribute(t7,i[0]+i[1])),r&&"object"==typeof r){if(r.model&&e.setAttribute("gen_ai.response.model",String(r.model)),r.id&&e.setAttribute("gen_ai.response.id",r.id),r.choices&&Array.isArray(r.choices)){let t=r.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(r.service_tier&&e.setAttribute("gen_ai.response.service_tier",r.service_tier),r.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",r.system_fingerprint),r.usage_metadata&&"object"==typeof r.usage_metadata){let t=r.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(r))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let r of Object.keys(e)){let i=e[r];if(i&&"object"==typeof i&&((t=this.extractUnifiedRunTokens(i.usage_metadata))||1===i.lc&&i.kwargs&&"object"==typeof i.kwargs&&(t=this.extractUnifiedRunTokens(i.kwargs.usage_metadata))))return t}let r=e.generations||[];if(!Array.isArray(r))return null;for(let e of Array.isArray(r[0])?r.flat():r)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}let rO=Object.prototype.toString,rT=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function rA(e,t,{min:r=0,allowInfinity:i=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${i?" or Infinity":""}.`);if(!i&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<r)throw TypeError(`Expected \`${e}\` to be \u2265 ${r}.`)}}class rN extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}function rC(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function rj({error:e,attemptNumber:t,retriesConsumed:r,startTime:i,options:n}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof rN)throw s.originalError;let o=Number.isFinite(n.retries)?Math.max(0,n.retries-r):n.retries,l=n.maxRetryTime??1/0,u=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:r});if(await n.onFailedAttempt(u),0>=rC(i,l))throw s;let c=await n.shouldConsumeRetry(u),d=rC(i,l);if(d<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===rO.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:r}=e;return"Load failed"===t?void 0===r||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||rT.has(t)}(s)){if(c)throw s;return n.signal?.throwIfAborted(),!1}if(!await n.shouldRetry(u))throw s;if(!c)return n.signal?.throwIfAborted(),!1;let h=Math.min((a=Math.max(1,r+1),Math.min(Math.round((n.randomize?Math.random()+1:1)*n.minTimeout*n.factor**(a-1)),n.maxTimeout)),d);return h>0&&await new Promise((e,t)=>{let r=()=>{clearTimeout(i),n.signal?.removeEventListener("abort",r),t(n.signal.reason)},i=setTimeout(()=>{n.signal?.removeEventListener("abort",r),e()},h);n.unref&&i.unref?.(),n.signal?.addEventListener("abort",r,{once:!0})}),n.signal?.throwIfAborted(),!0}async function rP(e,t={}){var r=(t={...t}).retries;if("number"==typeof r){if(r<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==r)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,rA("factor",t.factor,{min:0,allowInfinity:!1}),rA("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),rA("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),rA("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,n=0,a=performance.now();for(;!Number.isFinite(t.retries)||n<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await rj({error:e,attemptNumber:i,retriesConsumed:n,startTime:a,options:t})&&n++}}throw Error("Retry attempts exhausted without throwing an error.")}var rR=e.i(81920);let rU=[408,425,429,500,502,503,504];class rL{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in rR.default?this.queue=new rR.default.default({concurrency:this.maxConcurrency}):this.queue=new rR.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){return this.callWithOptions({},e,...t)}callWithOptions(e,t,...r){let i=e.sizeBytes??0;if(void 0!==this.maxQueueSizeBytes&&i>0&&this.queueSizeBytes+i>this.maxQueueSizeBytes)return Promise.reject(Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${i} bytes.`));i>0&&(this.queueSizeBytes+=i);let n=this.onFailedResponseHook,a=this.queue.add(()=>rP(()=>t(...r).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt({error:e}){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(n&&await n(t))return;let r=t?.status??e?.status;if(r&&!rU.includes(+r))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return(i>0&&(a=a.finally(()=>{this.queueSizeBytes-=i})),e.signal)?Promise.race([a,new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):a}}function rz(e){return"function"==typeof e?._getType}function rD(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}function rM(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),i=r||"latest";if(t.includes("/")){let[r,n]=t.split("/",2);if(!r||!n)throw Error(`Invalid identifier format: ${e}`);return[r,n,i]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,i]}e.i(99136);class rZ extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function rF(e,t,r){let i;if(e.ok){r&&(i=await e.text());return}if(403===e.status)try{let t=await e.json(),r=t?.error;"org_scoped_key_requires_workspace"===r&&(i="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(r){let t=Error(`${e.status} ${e.statusText}`);throw t.status=e?.status,t}if(void 0===i)try{i=await e.text()}catch(e){i=""}let n=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${i}`;if(409===e.status)throw new rZ(n);let a=Error(n);throw a.status=e.status,a}let rB="ERR_CONFLICTING_ENDPOINTS";class rV extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:rB}),this.name="ConflictingEndpointsError"}}var rq={result:"[Circular]"},rG=[],rW=[];let rJ=new TextEncoder;function rH(e){return rJ.encode(e)}function rK(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);else if(e instanceof Set)return Array.from(e);else if(e instanceof Date)return e.toISOString();else if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function rX(e,t,r,i,n){try{let t=JSON.stringify(e,function(e,t){if(r){let i=r.call(this,e,t);if(void 0!==i)return i}return rK(t)},i);return rH(t)}catch(o){let s;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),rH("[Unserializable]");"true"!==rg("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===n&&(n={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,i,n,a,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<n.length;l++)if(n[l]===t)return void rY(rq,t,r,a);if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit)return void rY("[...]",t,r,a);if(n.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,n,t,s,o);else{var l,u=Object.keys(t=rK(t));for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,n,t,s,o)}}n.pop()}}(e,"",0,[],void 0,0,n);try{var a;s=0===rW.length?JSON.stringify(e,r,i):JSON.stringify(e,(a=r,a=void 0!==a?a:function(e,t){return t},function(e,t){if(rW.length>0)for(var r=0;r<rW.length;r++){var i=rW[r];if(i[1]===e&&i[0]===t){t=i[2],rW.splice(r,1);break}}return a.call(this,e,t)}),i)}catch(e){return rH("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==rG.length;){let e=rG.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return rH(s)}}function rY(e,t,r,i){var n=Object.getOwnPropertyDescriptor(i,r);void 0!==n.get?n.configurable?(Object.defineProperty(i,r,{value:e}),rG.push([i,r,t,n])):rW.push([t,r,e]):(i[r]=e,rG.push([i,r,t]))}function rQ(e,t){let r=rp(),i=t??rm(),n=e.extra??{},a=n.metadata;return e.extra={...n,runtime:{...r,...n?.runtime},metadata:{...i,...i.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??i.revision_id}:{},...a}},e}async function r0(e){let t=[];for await(let r of e)t.push(r);return t}function r1(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let r4=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function r2(e){return"number"==typeof e?Number(e.toFixed(4)):e}let r6="https://api.smith.langchain.com";class r9{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??0x40000000}peek(){return this.items[0]}push(e){let t,r=new Promise(e=>{t=e}),i=rX(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+i>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${i} bytes.`),t()):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i),r}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let r=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0&&r.length<t;){let e=this.items.shift();e&&(r.push(e),i+=e.size,this.sizeBytes-=e.size)}if(0===r.length&&this.items.length>0){let e=this.items.shift();r.push(e),i+=e.size,this.sizeBytes-=e.size}return[r.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,size:e.size})),()=>r.forEach(e=>e.itemPromiseResolve())]}}class r5{get _fetch(){let e;return this.fetchImplementation||(e=this.debug,async(...t)=>{if(e||"true"===rg("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[rt]??((...e)=>fetch(...e)))(...t);return(e||"true"===rg("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r})}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===rf("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===rf("LANGSMITH_DEBUG")});const t=r5.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{let t=e?.toString()??rg("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r})(e.tracingSamplingRate),this.apiUrl=r1(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=r1(e.apiKey??t.apiKey),this.webUrl=r1(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=r1(e.workspaceId??rg("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new rL({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;const r=e.maxIngestMemoryBytes??0x40000000;this.batchIngestCaller=new rL({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:r,...e.callerOptions??{},onFailedResponseHook:r4,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new r9(r),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,ry()&&(this.langSmithToOTELTranslator=new rS),this.cachedLSEnvVarsForMetadata=rm()}static getDefaultClientConfig(){let e=rg("API_KEY");return{apiUrl:rg("ENDPOINT")??r6,apiKey:e,webUrl:void 0,hideInputs:"true"===rg("HIDE_INPUTS"),hideOutputs:"true"===rg("HIDE_OUTPUTS")}}getHostUrl(){let e;if(this.webUrl)return this.webUrl;if("localhost"===(e=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0])||"127.0.0.1"===e||"::1"===e)return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${rd}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",i=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{let t=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,`fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0,n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(n));let a=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(async()=>{let t=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,`fetch ${e}`),t}),o=r?r(await s.json()):await s.json();if(0===o.length||(yield o,o.length<n))break;i+=o.length}}async *_getCursorPaginatedList(e,t=null,r="POST",i="runs"){let n=t?{...t}:{};for(;;){let t=JSON.stringify(n),a=await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await rF(i,`fetch ${e}`),i}),s=await a.json();if(!s||!s[i])break;yield s[i];let o=s.cursors;if(!o||!o.next)break;n.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.trace_id)?r.id===r.trace_id&&this.filteredPostUuids.delete(r.trace_id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;this.filteredPostUuids.has(e)||(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??0x1800000}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??100}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let r=[];for(;this.autoBatchQueue.items.length>0;){let[i,n]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!i.length){n();break}let a=i.reduce((e,t)=>{let r=t.apiUrl??this.apiUrl,i=t.apiKey??this.apiKey,n=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${r}|${i}`;return e[n]||(e[n]=[]),e[n].push(t),e},{}),s=[];for(let[e,t]of Object.entries(a)){let r=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});s.push(r)}let o=Promise.all(s).finally(n);r.push(o)}return Promise.all(r)}async _processBatch(e,t){if(!e.length)return;let r=e.reduce((e,t)=>e+(t.size??0),0);try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let i={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},n=await this._ensureServerInfo();if(n?.batch_ingest_config?.use_multipart_endpoint){let e=n?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(i,{...t,useGzip:e,sizeBytes:r})}else await this.batchIngestRuns(i,{...t,sizeBytes:r})}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,r=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),"create"===i.action?r.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):r.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=rQ(e.item,this.cachedLSEnvVarsForMetadata);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes(),i=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>i)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await rF(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=rI(),t=rk.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},i=e.project_name;delete e.project_name;let n=await this.prepareRunCreateOrUpdateInputs({session_name:i,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:n,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=rQ(n,this.cachedLSEnvVarsForMetadata);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(r["x-tenant-id"]=t.workspaceId);let s=rX(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await rF(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),n=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(i.length>0&&n.length>0){let e=i.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);i=Object.values(e),n=t}let a={post:i,patch:n};if(!a.post.length&&!a.patch.length)return;let s={post:[],patch:[]};for(let e of["post","patch"]){let t=a[e].reverse(),r=t.pop();for(;void 0!==r;)s[e].push(r),r=t.pop()}if(s.post.length>0||s.patch.length>0){let e=s.post.map(e=>e.id).concat(s.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(rX(s,`Ingesting runs with ids: ${e}`),r)}}async _postBatchIngestRuns(e,t){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:t?.sizeBytes},async()=>{let i=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await rF(i,"batch create run",!0),i})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i={},n=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(i[e.id]=e.attachments),delete e.attachments,n.push(e)}let a=[];for(let e of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==n.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(n.length>0&&a.length>0){let e=n.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);n=Object.values(e),a=t}if(0===n.length&&0===a.length)return;let s=[],o=[];for(let[e,t]of[["post",n],["patch",a]])for(let r of t){let{inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c,attachments:d,...h}=r,p={inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c},m=rX(h,`Serializing for multipart ingestion of run with id: ${h.id}`);for(let[t,r]of(o.push({name:`${e}.${h.id}`,payload:new Blob([m],{type:`application/json; length=${m.length}`})}),Object.entries(p))){if(void 0===r)continue;let i=rX(r,`Serializing ${t} for multipart ingestion of run with id: ${h.id}`);o.push({name:`${e}.${h.id}.${t}`,payload:new Blob([i],{type:`application/json; length=${i.length}`})})}if(void 0!==h.id){let e=i[h.id];if(e)for(let[t,r]of(delete i[h.id],Object.entries(e))){let e,i;if(Array.isArray(r)?[e,i]=r:(e=r.mimeType,i=r.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${h.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${h.id}.${t}`,payload:new Blob([i],{type:`${e}; length=${i.byteLength}`})})}}s.push(`trace=${h.trace_id},id=${h.id}`)}await this._sendMultipartRequest(o,s.join("; "),r)}async _createNodeFetchBody(e,t){let r=[];for(let i of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let i=new Blob(r);return await i.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(i){let n=async e=>{"string"==typeof e?i.enqueue(r.encode(e)):i.enqueue(e)};for(let r of e){await n(`--${t}\r
`),await n(`Content-Disposition: form-data; name="${r.name}"\r
`),await n(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)i.enqueue(t.value)}finally{e.releaseLock()}await n("\r\n")}await n(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,r){let i,n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=!!(i=globalThis[rt])&&"function"==typeof i&&"Headers"in i&&"Request"in i&&"Response"in i,s=()=>this._createNodeFetchBody(e,n),o=()=>this._createMultipartStream(e,n),l=async e=>this.batchIngestCaller.callWithOptions({sizeBytes:r?.sizeBytes},async()=>{let t=await e(),i={...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`};r?.apiKey!==void 0&&(i["x-api-key"]=r.apiKey);let a=t;r?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(a=t.pipeThrough(new CompressionStream("gzip")),i["Content-Encoding"]="gzip");let s=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:i,body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(s,"Failed to send multipart request",!0),s});try{let e,i=!1;a||this.multipartStreamingDisabled||"bun"===rh()?e=await l(s):(i=!0,e=await l(o)),(!this.multipartStreamingDisabled||i)&&422===e.status&&(r?.apiUrl??this.apiUrl)!==r6&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,e=await l(s))}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){rc(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let i={...t,id:e};if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){let e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===i.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error)}let n={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(n["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(n["x-tenant-id"]=r.workspaceId);let a=rX(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){rc(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:rg("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await r0(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};for(let n of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===n.parent_run_id||void 0===n.parent_run_id)throw Error(`Child run ${n.id} has no parent`);n.dotted_order?.startsWith(e.dotted_order??"")&&n.id!==e.id&&(n.parent_run_id in r||(r[n.parent_run_id]=[]),r[n.parent_run_id].push(n),i[n.id]=n)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(i[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:i,traceId:n,referenceExampleId:a,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:m,treeFilter:f,limit:g,select:y,order:v}=e,_=[];if(t&&(_=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));_.push(...t)}let b={session:_.length?_:null,run_type:u,reference_example:a,query:h,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:i,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:n,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:v};b.select.includes("child_run_ids")&&rl("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let w=0;for await(let e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){let t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:i,filter:n,startTime:a,endTime:s,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:n,start_time:a?a.toISOString():null,end_time:s?s.toISOString():null,limit:Number(o)||100},c=Number(l)||0,d="/runs/group",h=`${this.apiUrl}${d}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:c}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await rF(t,`Failed to fetch ${d}`),t}),{groups:r,total:i}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((c+=r.length)>=i)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:n,projectIds:a,referenceExampleIds:s,startTime:o,endTime:l,error:u,query:c,filter:d,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:f}){let g=a||[];n&&(g=[...a||[],...await Promise.all(n.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let y=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:s,start_time:o,end_time:l,error:u,query:c,filter:d,trace_filter:h,tree_filter:p,is_root:m,data_source_type:f}).filter(([e,t])=>void 0!==t))),v=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await rF(e,"get run stats"),e});return await v.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||t0()};rc(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await rF(t,"share run"),t}),a=await n.json();if(null===a||!("share_token"in a))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){rc(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"unshare run",!0),t})}async readRunSharedLink(e){rc(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"read run shared link"),t}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);rc(e);let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"list shared runs"),t});return await i.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),rc(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"read dataset shared schema"),t}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};rc(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await rF(t,"share dataset"),t}),a=await n.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){rc(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"unshare dataset",!0),t})}async readSharedDataset(e){rc(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i.append(e,t)):i.append(e,t)});let n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"list shared examples"),t}),a=await n.json();if(!n.ok){if("detail"in a)throw Error(`Failed to list shared examples.
Status: ${n.status}
Message: ${Array.isArray(a.detail)?a.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${n.status} ${n.statusText}`)}return a.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:n=null,referenceDatasetId:a=null}){let s=`${this.apiUrl}/sessions${i?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==a&&(l.reference_dataset_id=a);let u=JSON.stringify(l),c=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await rF(e,"create project"),e});return await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:n=null,endTime:a=null}){let s=`${this.apiUrl}/sessions/${e}`,o=n;i&&(o={...o||{},metadata:i});let l=JSON.stringify({name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await rF(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)rc(e),r+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,"has project"),e});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i,n="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)rc(e),n+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&a.append("include_stats",r.toString());let s=await this._get(n,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:n,includeStats:a,datasetVersion:s,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==r&&u.append("name_contains",r),void 0!==i)u.append("reference_dataset",i);else if(void 0!==n){let e=await this.readDataset({datasetName:n});u.append("reference_dataset",e.id)}for await(let e of(void 0!==a&&u.append("include_stats",a.toString()),void 0!==s&&u.append("dataset_version",s),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");rc(r=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,`delete session ${r} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:n,dataType:a,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),i.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),a&&l.append("data_type",a),s&&l.append("name",s);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await rF(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:n,metadata:a}={}){let s={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(s.data_type=r),i&&(s.inputs_schema_definition=i),n&&(s.outputs_schema_definition=n);let o=JSON.stringify(s),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await rF(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,i="/datasets",n=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)rc(e),i+=`/${e}`;else if(t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let a=await this._get(i,n);if(Array.isArray(a)){if(0===a.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=a[0]}else r=a;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let n=e;if(void 0===n&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof i?i:i.toISOString()});return await this._get(`/datasets/${n}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:n,metadata:a}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==i&&s.append("name",i),void 0!==n&&s.append("name_contains",n),void 0!==a&&s.append("metadata",JSON.stringify(a)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;rc(n);let a=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(e,"update dataset"),e});return await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:i,tag:n}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;rc(a);let s=JSON.stringify({as_of:"string"==typeof i?i:i.toISOString(),tag:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await rF(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(i=(await this.readDataset({datasetName:t})).id),void 0!==i)rc(i),r+=`/${i}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,`delete ${r}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(i||t)if(i&&t)throw Error("Must provide either datasetName or datasetId, not both");else i||(i=(await this.readDataset({datasetName:t})).id);else throw Error("Must provide either datasetName or datasetId");rc(i);let n=JSON.stringify({tag:r}),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await rF(e,"index dataset"),e});await a.json()}async similarExamples(e,t,r,{filter:i}={}){let n={limit:r,inputs:e};void 0!==i&&(n.filter=i),rc(t);let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await rF(e,"fetch similar examples"),e});return(await s.json()).examples}async createExample(e,t,r){let i;if(r3(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let n=t?r?.datasetId:e.dataset_id,a=t?r?.datasetName:e.dataset_name;if(void 0===n&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:a})).id);let s=(t?r?.createdAt:e.created_at)||new Date;i=r3(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let o=await this._uploadExamplesMultipart(n,[i]);return await this.readExample(o.example_ids?.[0]??t0())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let i=await this._uploadExamplesMultipart(t,e);return await Promise.all(i.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:i,splits:n,sourceRunIds:a,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let h=c;if(void 0===h&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===h&&(h=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:r?.[t],metadata:i?.[t],split:n?.[t],id:u?.[t],attachments:l?.[t],source_run_id:a?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(h,p);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let i=e.map(e=>rz(e)?rD(e):e),n=rz(t)?rD(t):t;return this.createExample({input:i},{output:n},r)}async readExample(e){rc(e);let t=`/examples/${e}`,{attachment_urls:r,...i}=await this._get(t);return r&&(i.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),i}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:n,inlineS3Urls:a,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:d}),p=i?"string"==typeof i?i:i?.toISOString():void 0;if(p&&h.append("as_of",p),h.append("inline_s3_urls",(a??!0).toString()),void 0!==r)for(let e of r)h.append("id",e);if(void 0!==n)for(let e of n)h.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==u&&h.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>h.append("select",e));let m=0;for await(let e of this._getPaginated("/examples",h)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,m++}if(void 0!==o&&m>=o)break}}async deleteExample(e){rc(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,`delete ${t}`,!0),e})}async updateExample(e,t){let r,i,n;return rc(r=t?e:e.id),n=void 0!==(i=t?{id:r,...t}:e).dataset_id?i.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(n,[i])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let n;if(rc(n=e||(await this.readDataset({datasetName:t})).id),r&&i||!r&&!i)throw Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;void 0!==r&&a.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==i&&a.append("tag",i);let s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,"read dataset version"),e});return await s.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");rc(i=void 0===e?(await this.readDataset({datasetName:t})).id:e);let n=new URLSearchParams,a=r?"string"==typeof r?r:r?.toISOString():void 0;return a&&n.append("as_of",a),await this._get(`/datasets/${i}/splits`,n)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:n=!1}){let a;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");rc(a=void 0===e?(await this.readDataset({datasetName:t})).id:e);let s=JSON.stringify({split_name:r,examples:i.map(e=>(rc(e),e)),remove:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await rF(e,"update dataset splits",!0),e})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:n}={loadChildRuns:!1}){let a;if(rl("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)a=await this.readRun(e,{loadChildRuns:i});else if("object"==typeof e&&"id"in e)a=e;else throw Error(`Invalid run type: ${typeof e}`);null!==a.reference_example_id&&void 0!==a.reference_example_id&&(n=await this.readExample(a.reference_example_id));let s=await t.evaluateRun(a,n),[o,l]=await this._logEvaluationFeedback(s,a,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:n,comment:a,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:c,projectId:d,comparativeExperimentId:h}){if(!e&&!d)throw Error("One of runId or projectId must be provided");if(e&&d)throw Error("Only one of runId or projectId can be provided");let p={type:o??"api",metadata:s??{}};void 0===l||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:l}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&rc(p.metadata.__run.run_id);let m={id:u??t0(),run_id:e,key:t,score:r2(r),value:i,correction:n,comment:a,feedback_source:p,comparative_experiment_id:h,feedbackConfig:c,session_id:d},f=JSON.stringify(m),g=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await rF(e,"create feedback",!0),e}),m}async updateFeedback(e,{score:t,value:r,correction:i,comment:n}){let a={};null!=t&&(a.score=r2(t)),null!=r&&(a.value=r),null!=i&&(a.correction=i),null!=n&&(a.comment=n),rc(e);let s=JSON.stringify(a);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await rF(t,"update feedback",!0),t})}async readFeedback(e){rc(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){rc(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(e)for(let t of e)rc(t),i.append("run",t);if(t)for(let e of t)i.append("key",e);if(r)for(let e of r)i.append("source",e);for await(let e of this._getPaginated("/feedback",i))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){let n={run_id:e,feedback_key:t,feedback_config:i};r?"string"==typeof r?n.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(n.expires_in=r):n.expires_in={hours:3};let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(e,"create presigned feedback token"),e});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:n,metadata:a,id:s}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:n,created_at:(i??new Date)?.toISOString(),extra:{}};a&&(o.extra.metadata=a);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await rF(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){rc(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let i=this._selectEvalResults(e),n=[];for(let e of i){let i=r||{};e.evaluatorInfo&&(i={...e.evaluatorInfo,...i});let a=null;e.targetRunId?a=e.targetRunId:t&&(a=t.id),n.push(await this.createFeedback(a,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:i,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[i,n]}async logEvaluationFeedback(e,t,r){let[i]=await this._logEvaluationFeedback(e,t,r);return i}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:i,limit:n}=e,a=new URLSearchParams;t&&t.forEach((e,t)=>{rc(e,`queueIds[${t}]`),a.append("ids",e)}),r&&a.append("name",r),i&&a.append("name_contains",i),a.append("limit",(void 0!==n?Math.min(n,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",a))if(yield*e,s++,void 0!==n&&s>=n)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:n}=e,a=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:r,id:i||t0(),rubric_instructions:n}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:r,description:i,rubricInstructions:n}=t,a=JSON.stringify({name:r,description:i,rubric_instructions:n});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let r=JSON.stringify(t.map((e,t)=>rc(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await rF(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${rc(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}/runs/${rc(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${rc(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(t,"get latest commit hash"),t}),r=await t.json();if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,i,n]=rM(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,r,i]=rM(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==i?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==i?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,i]=rM(e),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await rF(e,"get prompt"),e)}),a=await n?.json();return a?.repo?a.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,n,a]=rM(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let s=JSON.stringify({repo_handle:n,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await rF(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,n,a]=rM(e),s=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${i}/${n}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:s}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${i}/${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await rF(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${i}/${n}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,i=new Blob([rX({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([rX(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([rX(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}if(e.attachments_operations){let i=new Blob([rX(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.attachments_operations`,i)}}let i=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${i}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await rF(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??t0()).toString(),i=new Blob([rX({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([rX(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([rX(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await rF(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,i]=rM(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let n={};if(t?.description!==void 0&&(n.description=t.description),t?.readme!==void 0&&(n.readme=t.readme),t?.tags!==void 0&&(n.tags=t.tags),t?.isPublic!==void 0&&(n.is_public=t.isPublic),t?.isArchived!==void 0&&(n.is_archived=t.isArchived),0===Object.keys(n).length)throw Error("No valid update options provided");let a=JSON.stringify(n);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await rF(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,i]=rM(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,"delete prompt"),e})).json()}async pullPromptCommit(e,t){let[r,i,n]=rM(e),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${i}/${n}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rF(e,"pull prompt commit"),e}),s=await a.json();return{owner:r,repo:i,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[n,a]=this.parseTokenOrUrl(e,r),s=new r5({apiUrl:n,apiKey:"placeholder"}),o=await s.readSharedDataset(a),l=i||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}let u=await s.listSharedExamples(a),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return rc(e),[t,e]}catch(e){}try{let n=new URL(e).pathname.split("/").filter(e=>""!==e);if(n.length>=r){let e=n[n.length-r];return[t,e]}throw Error(`Invalid public ${i} URL: ${e}`)}catch(t){throw Error(`Invalid public ${i} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await rk.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function r3(e){return"dataset_id"in e||"dataset_name"in e}let r8=Symbol.for("lc:context_variables"),r7=Symbol.for("langsmith:replica_trace_roots");function ie(e,t){if(r8 in e)return e[r8][t]}let it=function(e){let t;if(!tX(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,r[11]=t/0x100000000&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r},ir=function(e,t,r){function i(e,t,i,n){var a;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=it(t)),(null==(a=t)?void 0:a.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=r(s))[6]=15&s[6]|80,s[8]=63&s[8]|128,i){n=n||0;for(let e=0;e<16;++e)i[n+e]=s[e];return i}return tQ(s)}try{i.name="v5"}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}(0,0,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),tq.default.createHash("sha1").update(e).digest()}),ii="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function ia(e){return ir(Object.keys(e).sort().map(t=>`${t}:${e[t]??""}`).join("|"),ii)}function is(e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${r}Z`}function io(e,t,r=1){let i=is(e,r);return{dottedOrder:i.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:i}}class il{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){let t,r,i=e.split(","),n={},a=[];for(let e of i){let[i,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===i?n=JSON.parse(o):"langsmith-tags"===i?a=o.split(","):"langsmith-project"===i?t=o:"langsmith-replicas"===i&&(r=JSON.parse(o))}return new il(n,a,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class iu{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e))return void Object.assign(this,{...e});const t=iu.getDefaultConfig(),{metadata:r,...i}=e,n=i.client??iu.getSharedClient(),a={...r,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:a},"id"in i&&null==i.id&&delete i.id,Object.assign(this,{...t,...i,client:n}),this.execution_order??=1,this.child_execution_order??=1,this.dotted_order||(this._serialized_start_time=is(this.start_time,this.execution_order)),this.id||(this.id=function(e){return rs({msecs:"string"==typeof e?Date.parse(e):e,seq:0})}(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){return e?e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=rf("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let r=JSON.parse(e);if(Array.isArray(r)){let e=[];for(let t of r){if("object"!=typeof t||null===t){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof t}`);continue}if("string"!=typeof t.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_url}`);continue}if("string"!=typeof t.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_key}`);continue}e.push({apiUrl:t.api_url.replace(/\/$/,""),apiKey:t.api_key})}return e}if("object"!=typeof r||null===r)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof r}`),[];{var t=r;if(Object.keys(t).length>0&&rg("ENDPOINT"))throw new rV;let e=[];for(let[t,i]of Object.entries(r)){let r=t.replace(/\/$/,"");if("string"==typeof i)e.push({apiUrl:r,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${t}: expected string, got ${typeof i}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===rB)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),!this.dotted_order){const{dottedOrder:e}=io(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){let e=Date.now();return{run_type:"chain",project_name:rr(),child_runs:[],api_url:rf("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:rf("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return iu.sharedClient||(iu.sharedClient=new r5),iu.sharedClient}createChild(e){var t,r;let i=this.child_execution_order+1,n=this.replicas?.map(e=>{let{reroot:t,...r}=e;return r}),a=e.replicas??n,s=new iu({...e,parent_run:this,project_name:this.project_name,replicas:a,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:i,child_execution_order:i});r8 in this&&(s[r8]=this[r8]);let o=Symbol.for("lc:child_config"),l=e.extra?.[o]??this.extra[o];if(null!=(t=l)&&"object"==typeof t.callbacks&&(id(t.callbacks?.handlers)||id(t.callbacks))){let e={...l},t="object"==typeof(r=e.callbacks)&&null!=r&&Array.isArray(r.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:s.id}),t.handlers?.find(ic)?.updateFromRunTree?.(s),e.callbacks=t),s.extra[o]=e}let u=new Set,c=this;for(;null!=c&&!u.has(c.id);)u.add(c.id),c.child_execution_order=Math.max(c.child_execution_order,i),c=c.parent_run;return this.child_runs.push(s),s}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){let i,n,a=e.extra??{};if(a?.runtime?.library===void 0&&(a.runtime||(a.runtime={}),t))for(let[e,r]of Object.entries(t))a.runtime[e]||(a.runtime[e]=r);return r?(n=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(e=>this._convertToCreate(e,t,r)),n=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:n,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,t){if(t.dotted_order){let r=t.dotted_order.split("."),i=null;for(let t=0;t<r.length;t++)if(r[t].slice(-36)===e){i=t;break}if(null!==i){let e=r.slice(i+1);t.dotted_order=e.join("."),e.length>0?t.trace_id=e[0].slice(-36):t.trace_id=t.id}}t.parent_run_id===e&&(t.parent_run_id=void 0)}_setReplicaTraceRoot(e,t){let r,i=ie(this,r7)??{};for(let n of(i[e]=t,(r=r8 in this?this[r8]:{})[r7]=i,this[r8]=r,this.child_runs))n._setReplicaTraceRoot(e,t)}_remapForProject(e){let t,r,i,n,{projectName:a,runtimeEnv:s,excludeChildRuns:o=!0,reroot:l=!1,distributedParentId:u,apiUrl:c,apiKey:d,workspaceId:h}=e,p=this._convertToCreate(this,s,o);if(a===this.project_name)return{...p,session_name:a};if(l){if(u)this._sliceParentId(u,p);else if(p.parent_run_id=void 0,p.dotted_order){let e=p.dotted_order.split(".");e.length>0&&(p.dotted_order=e[e.length-1],p.trace_id=p.id)}let e=ia({projectName:a,apiUrl:c,apiKey:d,workspaceId:h});this._setReplicaTraceRoot(e,p.id)}if(!l&&(t=(ie(this,r7)??{})[ia({projectName:a,apiUrl:c,apiKey:d,workspaceId:h})])&&(p.trace_id=t,p.dotted_order)){let e=p.dotted_order.split("."),r=null;for(let i=0;i<e.length;i++)if(e[i].slice(-36)===t){r=i;break}null!==r&&(p.dotted_order=e.slice(r).join("."))}let m=p.id,f=ir(`${m}:${a}`,ii);return r=p.trace_id?ir(`${p.trace_id}:${a}`,ii):f,p.parent_run_id&&(i=ir(`${p.parent_run_id}:${a}`,ii)),p.dotted_order&&(n=p.dotted_order.split(".").map(e=>{let t=e.slice(-36),r=ir(`${t}:${a}`,ii);return e.slice(0,-36)+r}).join(".")),{...p,id:f,trace_id:r,parent_run_id:i,dotted_order:n,session_name:a}}async postRun(e=!0){try{let t=rp();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:r,apiUrl:i,workspaceId:n,reroot:a}of this.replicas){let s=this._remapForProject({projectName:e??this.project_name,runtimeEnv:t,excludeChildRuns:!0,reroot:a,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:r,workspaceId:n});await this.client.createRun(s,{apiKey:r,apiUrl:i,workspaceId:n})}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of(rl("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:r,apiUrl:i,workspaceId:n,updates:a,reroot:s}of this.replicas){let o=this._remapForProject({projectName:t??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:s,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:r,workspaceId:n}),l={id:o.id,name:o.name,run_type:o.run_type,start_time:o.start_time,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...a};e?.excludeInputs||(l.inputs=o.inputs),await this.client.updateRun(o.id,l,{apiKey:r,apiUrl:i,workspaceId:n})}else try{let t={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var r;let i,n,a,s=e?.callbacks,o=void 0!==r?r:!!["TRACING_V2","TRACING"].find(e=>"true"===rg(e));if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");i=t?.getRun?.(e),n=t?.projectName,a=t?.client,o=o||!!t}return i?new iu({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:n,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(t):new iu({...t,client:a,tracingEnabled:o,project_name:n})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||"string"!=typeof i)return;let n=i.trim(),a=n.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=a[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:s,dotted_order:n};if(r.baggage&&"string"==typeof r.baggage){let e=il.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}let l=new iu(o);return l.distributedParentId=l.id,l}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new il(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,i]of Object.entries(t))e.set(r,i);return t}}function ic(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function id(e){return Array.isArray(e)&&e.some(e=>ic(e))}Object.defineProperty(iu,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});var ih={};function ip(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function im(e){return"function"==typeof e._addRunToRunMap}G(ih,{BaseTracer:()=>ig,isBaseTracer:()=>im});var ig=class extends t6{runMap=new Map;runTreeMap=new Map;usesRunTreeMap=!1;constructor(e){super(...arguments)}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?(e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e})(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:r}=io(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},n=this.getRunById(i.parent_run_id);if(void 0!==i.parent_run_id?n&&(this._addChildRun(n,i),n.child_execution_order=Math.max(n.child_execution_order,i.child_execution_order),i.trace_id=n.trace_id,void 0!==n.dotted_order&&(i.dotted_order=[n.dotted_order,t].join("."),i._serialized_start_time=r)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=r),this.usesRunTreeMap){let e=function e(t,r){if(t)return new iu({...t,start_time:t._serialized_start_time??t.start_time,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:tB()},tracingEnabled:!1})}(i,n);void 0!==e&&this.runTreeMap.set(i.id,e)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=ip(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=ip(n.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=ip(n.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,i,n,a){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:a?.chunk}),s}};let iy=(e=0)=>t=>`\u001B[${t+e}m`,iv=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,i_=(e=0)=>(t,r,i)=>`\u001B[${38+e};2;${t};${r};${i}m`,ib={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(ib.modifier),[...Object.keys(ib.color),...Object.keys(ib.bgColor)];let iw=function(){let e=new Map;for(let[t,r]of Object.entries(ib)){for(let[t,i]of Object.entries(r))ib[t]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},r[t]=ib[t],e.set(i[0],i[1]);Object.defineProperty(ib,t,{value:r,enumerable:!1})}return Object.defineProperty(ib,"codes",{value:e,enumerable:!1}),ib.color.close="\x1b[39m",ib.bgColor.close="\x1b[49m",ib.color.ansi=iy(),ib.color.ansi256=iv(),ib.color.ansi16m=i_(),ib.bgColor.ansi=iy(10),ib.bgColor.ansi256=iv(10),ib.bgColor.ansi16m=i_(10),Object.defineProperties(ib,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value(e){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;3===r.length&&(r=[...r].map(e=>e+e).join(""));let i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,255&i]},enumerable:!1},hexToAnsi256:{value:e=>ib.rgbToAnsi256(...ib.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){let t,r,i;if(e<8)return 30+e;if(e<16)return 90+(e-8);if(e>=232)r=t=((e-232)*10+8)/255,i=t;else{let n=(e-=16)%36;t=Math.floor(e/36)/5,r=Math.floor(n/6)/5,i=n%6/5}let n=2*Math.max(t,r,i);if(0===n)return 30;let a=30+(Math.round(i)<<2|Math.round(r)<<1|Math.round(t));return 2===n&&(a+=60),a},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>ib.ansi256ToAnsi(ib.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>ib.ansi256ToAnsi(ib.hexToAnsi256(e)),enumerable:!1}}),ib}();var i$={};function ix(e,t){return`${e.open}${t}${e.close}`}function ik(e,t){try{return JSON.stringify(e,null,2)}catch{return t}}function iI(e){return"string"==typeof e?e.trim():null==e?e:ik(e,e.toString())}function iE(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}G(i$,{ConsoleCallbackHandler:()=>iO});let{color:iS}=iw;var iO=class extends ig{name="console_callback_handler";persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let i=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?ix(iw.bold,i):i}).join(" > ");return ix(iS.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.green,"[chain/start]")} [${t}] Entering Chain run with input: ${ik(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.cyan,"[chain/end]")} [${t}] [${iE(e)}] Exiting Chain run with output: ${ik(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.red,"[chain/error]")} [${t}] [${iE(e)}] Chain run errored with error: ${ik(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${ix(iS.green,"[llm/start]")} [${t}] Entering LLM run with input: ${ik(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.cyan,"[llm/end]")} [${t}] [${iE(e)}] Exiting LLM run with output: ${ik(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.red,"[llm/error]")} [${t}] [${iE(e)}] LLM run errored with error: ${ik(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.green,"[tool/start]")} [${t}] Entering Tool run with input: "${iI(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.cyan,"[tool/end]")} [${t}] [${iE(e)}] Exiting Tool run with output: "${iI(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.red,"[tool/error]")} [${t}] [${iE(e)}] Tool run errored with error: ${ik(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${ik(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.cyan,"[retriever/end]")} [${t}] [${iE(e)}] Exiting Retriever run with output: ${ik(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.red,"[retriever/error]")} [${t}] [${iE(e)}] Retriever run errored with error: ${ik(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${ix(iS.blue,"[agent/action]")} [${t}] Agent selected action: ${ik(e.actions[e.actions.length-1],"[action]")}`)}};e.i(49753);let iT=()=>(void 0===a&&(a=new r5("false"===tV("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{})),a),iA=Symbol.for("ls:tracing_async_local_storage"),iN=new class{getStore(){}run(e,t){return t()}},iC=new class{getInstance(){return globalThis[iA]??iN}initializeGlobalInstance(e){void 0===globalThis[iA]&&(globalThis[iA]=e)}};function ij(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root");var iP={};G(iP,{LangChainTracer:()=>iR});var iR=class e extends ig{name="langchain_tracer";projectName;exampleId;client;replicas;usesRunTreeMap=!0;constructor(t={}){super(t);const{exampleId:r,projectName:i,client:n,replicas:a}=t;this.projectName=i??rr(),this.replicas=a,this.exampleId=r,this.client=n??iT();const s=e.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);){;t=t.parent_run}r.clear();let i=[t];for(;i.length>0;){let e=i.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&i.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new iu({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(e=!1){let t=iC.getInstance().getStore();if(!e&&void 0===t)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}},iU=e.i(48271);iU.default;var iL=iU;class iz extends Error{name="TimeoutError";constructor(e,t){super(e,t),Error.captureStackTrace?.(this,iz)}}let iD=e=>e.reason??new DOMException("This operation was aborted.","AbortError");class iM{#e=[];enqueue(e,t){let{priority:r=0,id:i}=t??{},n={priority:r,id:i,run:e};if(0===this.size||this.#e[this.size-1].priority>=r)return void this.#e.push(n);let a=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=Math.trunc(n/2),s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}(this.#e,n,(e,t)=>t.priority-e.priority);this.#e.splice(a,0,n)}setPriority(e,t){let r=this.#e.findIndex(t=>t.id===e);if(-1===r)throw ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=this.#e.splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){let e=this.#e.shift();return e?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#e.length}}class iZ extends iL.default{#t;#r;#i=0;#n;#a=!1;#s=!1;#o;#l=0;#u=0;#c;#d;#e;#h;#p=0;#m;#f;#g=1n;#y=new Map;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverIntervalCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:iM,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);if(this.#t=e.carryoverIntervalCount??e.carryoverConcurrencyCount??!1,this.#r=e.intervalCap===1/0||0===e.interval,this.#n=e.intervalCap,this.#o=e.interval,this.#e=new e.queueClass,this.#h=e.queueClass,this.concurrency=e.concurrency,void 0!==e.timeout&&!(Number.isFinite(e.timeout)&&e.timeout>0))throw TypeError(`Expected \`timeout\` to be a positive finite number, got \`${e.timeout}\` (${typeof e.timeout})`);this.timeout=e.timeout,this.#f=!1===e.autoStart,this.#v()}get #_(){return this.#r||this.#i<this.#n}get #b(){return this.#p<this.#m}#w(){this.#p--,0===this.#p&&this.emit("pendingZero"),this.#$(),this.emit("next")}#x(){this.#k(),this.#I(),this.#d=void 0}get #E(){let e=Date.now();if(void 0===this.#c){let t=this.#l-e;if(!(t<0))return this.#S(t),!0;if(this.#u>0){let t=e-this.#u;if(t<this.#o)return this.#S(this.#o-t),!0}this.#i=this.#t?this.#p:0}return!1}#S(e){void 0===this.#d&&(this.#d=setTimeout(()=>{this.#x()},e))}#O(){this.#c&&(clearInterval(this.#c),this.#c=void 0)}#T(){this.#d&&(clearTimeout(this.#d),this.#d=void 0)}#$(){if(0===this.#e.size)return this.#O(),this.emit("empty"),0===this.#p&&(this.#T(),this.emit("idle")),!1;let e=!1;if(!this.#f){let t=!this.#E;if(this.#_&&this.#b){let r=this.#e.dequeue();this.#r||(this.#i++,this.#A()),this.emit("active"),this.#u=Date.now(),r(),t&&this.#I(),e=!0}}return e}#I(){this.#r||void 0!==this.#c||(this.#c=setInterval(()=>{this.#k()},this.#o),this.#l=Date.now()+this.#o)}#k(){0===this.#i&&0===this.#p&&this.#c&&this.#O(),this.#i=this.#t?this.#p:0,this.#N(),this.#A()}#N(){for(;this.#$(););}get concurrency(){return this.#m}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#m=e,this.#N()}setPriority(e,t){if("number"!=typeof t||!Number.isFinite(t))throw TypeError(`Expected \`priority\` to be a finite number, got \`${t}\` (${typeof t})`);this.#e.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#g++).toString(),t={timeout:this.timeout,...t},new Promise((r,i)=>{let n=Symbol(`task-${t.id}`);this.#e.enqueue(async()=>{let a;this.#p++,this.#y.set(n,{id:t.id,priority:t.priority??0,startTime:Date.now(),timeout:t.timeout});try{try{t.signal?.throwIfAborted()}catch(e){throw!this.#r&&this.#i--,this.#y.delete(n),e}let i=e({signal:t.signal});if(t.timeout&&(i=function(e,t){let r,i,{milliseconds:n,fallback:a,message:s,customTimers:o={setTimeout,clearTimeout},signal:l}=t,u=new Promise((t,u)=>{if("number"!=typeof n||1!==Math.sign(n))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(l?.aborted)return void u(iD(l));if(l&&(i=()=>{u(iD(l))},l.addEventListener("abort",i,{once:!0})),e.then(t,u),n===1/0)return;let c=new iz;r=o.setTimeout.call(void 0,()=>{if(a){try{t(a())}catch(e){u(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===s?t():s instanceof Error?u(s):(c.message=s??`Promise timed out after ${n} milliseconds`,u(c))},n)}).finally(()=>{u.clear(),i&&l&&l.removeEventListener("abort",i)});return u.clear=()=>{o.clearTimeout.call(void 0,r),r=void 0},u}(Promise.resolve(i),{milliseconds:t.timeout,message:`Task timed out after ${t.timeout}ms (queue has ${this.#p} running, ${this.#e.size} waiting)`})),t.signal){let{signal:e}=t;i=Promise.race([i,new Promise((t,r)=>{a=()=>{r(e.reason)},e.addEventListener("abort",a,{once:!0})})])}let s=await i;r(s),this.emit("completed",s)}catch(e){i(e),this.emit("error",e)}finally{a&&t.signal?.removeEventListener("abort",a),this.#y.delete(n),queueMicrotask(()=>{this.#w()})}},t),this.emit("add"),this.#$()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#f&&(this.#f=!1,this.#N()),this}pause(){this.#f=!0}clear(){this.#e=new this.#h,this.#C()}async onEmpty(){0!==this.#e.size&&await this.#j("empty")}async onSizeLessThan(e){this.#e.size<e||await this.#j("next",()=>this.#e.size<e)}async onIdle(){(0!==this.#p||0!==this.#e.size)&&await this.#j("idle")}async onPendingZero(){0!==this.#p&&await this.#j("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#j("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#j("rateLimitCleared")}async onError(){return new Promise((e,t)=>{let r=e=>{this.off("error",r),t(e)};this.on("error",r)})}async #j(e,t){return new Promise(r=>{let i=()=>{(!t||t())&&(this.off(e,i),r())};this.on(e,i)})}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#p}get isPaused(){return this.#f}#v(){this.#r||(this.on("add",()=>{this.#e.size>0&&this.#A()}),this.on("next",()=>{this.#A()}))}#A(){this.#r||this.#s||(this.#s=!0,queueMicrotask(()=>{this.#s=!1,this.#C()}))}#C(){let e=this.#a,t=!this.#r&&this.#i>=this.#n&&this.#e.size>0;t!==e&&(this.#a=t,this.emit(t?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#a}get isSaturated(){return this.#p===this.#m&&this.#e.size>0||this.isRateLimited&&this.#e.size>0}get runningTasks(){return[...this.#y.values()].map(e=>({...e}))}}async function iF(e,t){if(!0===t){let t=H();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===s&&(s=new("default"in iZ?iZ.default:iZ)({autoStart:!0,concurrency:1})),s.add(async()=>{let t=H();void 0!==t?await t.run(void 0,async()=>e()):await e()})}async function iB(){let e=iT();await Promise.allSettled([void 0!==s?s.onIdle():Promise.resolve(),e.awaitPendingTraceBatches()])}var iV={};function iq(e){let t=H();if(void 0===t)return;let r=t.getStore();return r?.[J]?.[e]}G(iV,{awaitAllCallbacks:()=>iB,consumeCallback:()=>iF});let iG=Symbol("lc:configure_hooks");var iW={};function iJ(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}G(iW,{BaseCallbackManager:()=>iH,BaseRunManager:()=>iK,CallbackManager:()=>i1,CallbackManagerForChainRun:()=>iQ,CallbackManagerForLLMRun:()=>iY,CallbackManagerForRetrieverRun:()=>iX,CallbackManagerForToolRun:()=>i0,ensureHandler:()=>i4,parseCallbackConfigArg:()=>iJ});var iH=class{setHandler(e){return this.setHandlers([e])}},iK=class{constructor(e,t,r,i,n,a,s,o){this.runId=e,this.handlers=t,this.inheritableHandlers=r,this.tags=i,this.inheritableTags=n,this.metadata=a,this.inheritableMetadata=s,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>iF(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(r=>iF(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}},iX=class extends iK{getChild(e){let t=new i1(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},iY=class extends iK{async handleLLMNewToken(e,t,r,i,n,a){await Promise.all(this.handlers.map(r=>iF(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},iQ=class extends iK{getChild(e){let t=new i1(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},i0=class extends iK{getChild(e){let t=new i1(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>iF(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},i1=class e extends iH{handlers=[];inheritableHandlers=[];tags=[];inheritableTags=[];metadata={};inheritableMetadata={};name="callback_manager";_parentRunId;constructor(e,t){super(),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:t0();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return im(r)&&r._createRunForLLMStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),iF(async()=>{try{await r.handleLLMStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new iY(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:t0();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return im(r)&&r._createRunForChatModelStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),iF(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o);else if(r.handleLLMStart){let i=tA(t);await r.handleLLMStart?.(e,[i],a,this._parentRunId,n,this.tags,this.metadata,o)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new iY(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=t0(),i,n,a,s){return await Promise.all(this.handlers.map(n=>{if(!n.ignoreChain)return im(n)&&n._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,s),iF(async()=>{try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,i,s)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new iQ(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=t0(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreAgent)return im(i)&&i._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),iF(async()=>{try{await i.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new i0(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=t0(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreRetriever)return im(i)&&i._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),iF(async()=>{try{await i.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new iX(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(i=>iF(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${e}`),i.raiseError)throw e}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(t=[],r=!0){let i=new e(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);i.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);i.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);i.addMetadata({[e]:this.metadata[e]},t)}for(let e of t)i.handlers.filter(e=>"console_callback_handler"===e.name).some(t=>t.name===e.name)||i.addHandler(e,r);return i}static fromHandlers(e){class t extends t6{name=t0();constructor(){super(),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,n,a,s){return this._configureSync(e,t,r,i,n,a,s)}static _configureSync(t,r,i,n,a,s,o){var l;let u;(t||r)&&(Array.isArray(t)||!t?(u=new e).setHandlers(t?.map(i4)??[],!0):u=t,u=u.copy(Array.isArray(r)?r.map(i4):r?.handlers,!1));let c="true"===tV("LANGCHAIN_VERBOSE")||o?.verbose,d=iR.getTraceableRunTree()?.tracingEnabled||(void 0!==l?l:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===tV(e))),h=d||(tV("LANGCHAIN_TRACING")??!1);if(c||h){if(u||(u=new e),c&&!u.handlers.some(e=>e.name===iO.prototype.name)){let e=new iO;u.addHandler(e,!0)}if(h&&!u.handlers.some(e=>"langchain_tracer"===e.name)&&d){let e=new iR;u.addHandler(e,!0)}if(d){let e=iR.getTraceableRunTree();if(e&&void 0===u._parentRunId){u._parentRunId=e.id;let t=u.handlers.find(e=>"langchain_tracer"===e.name);t?.updateFromRunTree(e)}}}for(let{contextVar:t,inheritable:r=!0,handlerClass:i,envVar:n}of iq(iG)||[]){let a,s=n&&"true"===tV(n)&&i,o=void 0!==t?iq(t):void 0;o&&t9(o)?a=o:s&&(a=new i({})),void 0!==a&&(u||(u=new e),u.handlers.some(e=>e.name===a.name)||u.addHandler(a,r))}return(i||n)&&u&&(u.addTags(i??[]),u.addTags(n??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}};function i4(e){return"name"in e?e:t6.fromMethods(e)}var i2=class{getStore(){}run(e,t){return t()}enterWith(e){}};let i6=new i2,i9=Symbol.for("lc:child_config"),i5=new class{getInstance(){return H()??i6}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[i9]}runWithConfig(e,t,r){let i,n=i1._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),s=a.getStore(),o=n?.getParentRunId(),l=n?.handlers?.find(e=>e?.name==="langchain_tracer");return l&&o?i=l.getRunTreeWithTracingConfig(o):r||(i=new iu({name:"<runnable_lambda>",tracingEnabled:!1})),i&&(i.extra={...i.extra,[i9]:e}),void 0!==s&&void 0!==s[J]&&(void 0===i&&(i={}),i[J]=s[J]),a.run(i,t)}initializeGlobalInstance(e){void 0===H()&&(globalThis[W]=e)}};var i3={};G(i3,{AsyncLocalStorageProviderSingleton:()=>i5,MockAsyncLocalStorage:()=>i2,_CONTEXT_VARIABLES_KEY:()=>J});var i8=e.i(78500),i7=class extends Error{lc_error_code;constructor(e,t){let r=e??"";t?.lc_error_code&&(r=`${r}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/${t.lc_error_code}/
`),super(r),this.lc_error_code=t?.lc_error_code}},ne=class extends i7{get is_bubble_up(){return!0}},nt=class extends i7{constructor(e,t){super(e,t),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}},nr=class extends i7{constructor(e,t){super(e,t),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}},ni=class extends ne{interrupts;constructor(e,t){super(JSON.stringify(e,null,2),t),this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}},nn=class extends ni{constructor(e,t){super([{value:e}],t),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}},na=class extends ne{command;constructor(e){super(),this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}};function ns(e){return void 0!==e&&!0===e.is_bubble_up}function no(e){return void 0!==e&&[ni.unminifiable_name,nn.unminifiable_name].includes(e.name)}var nl=class extends i7{constructor(e,t){super(e,t),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}},nu=class extends i7{constructor(e,t){super(e,t),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}},nc=class extends i7{constructor(e,t){super(e,t),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}},nd=class extends i7{constructor(e,t){super(e,t),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}};let nh=0,np=0,nm=function(e,t,r){let i=t&&r||0,n=t||Array(16),a=(e=e||{}).node,s=e.clockseq;if(e._v6||(a||(a=o),null==s&&(s=l)),null==a||null==s){let t=e.random||(e.rng||tH)();null==a&&(a=[t[0],t[1],t[2],t[3],t[4],t[5]],o||e._v6||(a[0]|=1,o=a)),null==s&&(s=(t[6]<<8|t[7])&16383,void 0!==l||e._v6||(l=s))}let u=void 0!==e.msecs?e.msecs:Date.now(),c=void 0!==e.nsecs?e.nsecs:np+1,d=u-nh+(c-np)/1e4;if(d<0&&void 0===e.clockseq&&(s=s+1&16383),(d<0||u>nh)&&void 0===e.nsecs&&(c=0),c>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");nh=u,np=c,l=s;let h=((0xfffffff&(u+=122192928e5))*1e4+c)%0x100000000;n[i++]=h>>>24&255,n[i++]=h>>>16&255,n[i++]=h>>>8&255,n[i++]=255&h;let p=u/0x100000000*1e4&0xfffffff;n[i++]=p>>>8&255,n[i++]=255&p,n[i++]=p>>>24&15|16,n[i++]=p>>>16&255,n[i++]=s>>>8|128,n[i++]=255&s;for(let e=0;e<6;++e)n[i+e]=a[e];return t||tQ(n)};function nf(e){return function(e={},t,r=0){var i;let n,a=nm({...e,_v6:!0},new Uint8Array(16));return n=function(e,t=!1){return Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof(i=a)?it(i):i),a="string"==typeof i?tQ(n):n,tQ(a)}({clockseq:e})}function ng(e,t){return ir(e,new Uint8Array(t.replace(/-/g,"").match(/.{2}/g).map(e=>parseInt(e,16))))}let ny="__scheduled__";var nv=[],n_=[];function nb(e,t,r,i){var n=Object.getOwnPropertyDescriptor(i,r);void 0!==n.get?n.configurable?(Object.defineProperty(i,r,{value:e}),nv.push([i,r,t,n])):n_.push([t,r,e]):(i[r]=e,nv.push([i,r,t]))}let nw=[];var n$={};async function nx(e){return i1._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function nk(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let i=t[e]??[];t[e]=[...new Set(i.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i))if(e)if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler(i4(e),!0);t.callbacks=r}else t.callbacks=i;else if(i)if(e)if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler(i4(t),!0);t.callbacks=r}else t.callbacks=new i1(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}});else t.callbacks=i}else t[e]=r[e]??t[e];return t}let nI=new Set(["string","number","boolean"]);function nE(e){let t=i5.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:i,...n}=t;r=Object.entries(n).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))nI.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function nS(e={},{callbacks:t,maxConcurrency:r,recursionLimit:i,runName:n,configurable:a,runId:s}={}){let o=nE(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==i&&(o.recursionLimit=i),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==a&&(o.configurable={...o.configurable,...a}),void 0!==s&&delete o.runId,o}function nO(e){if(e)return{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal,store:e.store}}async function nT(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,i)=>{r=()=>{i(nA(t))},t.addEventListener("abort",r),t.aborted&&i(nA(t))})]).finally(()=>t.removeEventListener("abort",r))}function nA(e){return e?.reason instanceof Error?e.reason:"string"==typeof e?.reason?Error(e.reason):Error("Aborted")}var nN={};G(nN,{AsyncGeneratorWithSetup:()=>nR,IterableReadableStream:()=>nC,atee:()=>nj,concat:()=>nP,pipeGeneratorWithSetup:()=>nU});var nC=class e extends ReadableStream{reader;ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){let r=t.getReader();return new e({start:e=>(function t(){return r.read().then(({done:r,value:i})=>r?void e.close():(e.enqueue(i),t()))})(),cancel(){r.releaseLock()}})}static fromAsyncGenerator(t){return new e({async pull(e){let{value:r,done:i}=await t.next();i&&e.close(),e.enqueue(r)},async cancel(e){await t.return(e)}})}};function nj(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function nP(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){let r={...e};for(let[e,i]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=nP(r[e],i):r[e]=i;return r}else throw Error(`Cannot concat ${typeof e} and ${typeof t}`)}var nR=class{generator;setup;config;signal;firstResult;firstResultUsed=!1;constructor(e){this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{i5.runWithConfig(nO(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?i5.runWithConfig(nO(this.config),this.signal?async()=>nT(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}};async function nU(e,t,r,i,...n){let a=new nR({generator:t,startSetup:r,signal:i}),s=await a.setup;return{output:e(a,s,...n),setup:s}}let nL=Object.prototype.hasOwnProperty;function nz(e,t){return nL.call(e,t)}function nD(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)nz(e,r)&&t.push(r);return t}function nM(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function nZ(e){let t,r=0,i=e.length;for(;r<i;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function nF(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function nB(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function nV(e,t){let r=[e];for(let e in t){let i="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==i&&r.push(`${e}: ${i}`)}return r.join("\n")}var nq=class extends Error{constructor(e,t,r,i,n){super(nV(e,{name:t,index:r,operation:i,tree:n})),this.name=t,this.index=r,this.operation=i,this.tree=n,Object.setPrototypeOf(this,new.target.prototype),this.message=nV(e,{name:t,index:r,operation:i,tree:n})}},nG={};G(nG,{JsonPatchError:()=>nW,_areEquals:()=>n2,applyOperation:()=>nY,applyPatch:()=>nQ,applyReducer:()=>n0,deepClone:()=>nJ,getValueByPointer:()=>nX,validate:()=>n4,validator:()=>n1});let nW=nq,nJ=nM,nH={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var i=e[t];return delete e[t],{newDocument:r,removed:i}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:function(e,t,r){let i=nX(r,this.path);i&&(i=nM(i));let n=nY(r,{op:"remove",path:this.from}).removed;return nY(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:i}},copy:function(e,t,r){let i=nX(r,this.from);return nY(r,{op:"add",path:this.path,value:nM(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:n2(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var nK={add:function(e,t,r){return nZ(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:nH.move,copy:nH.copy,test:nH.test,_get:nH._get};function nX(e,t){if(""==t)return e;var r={op:"_get",path:t};return nY(e,r),r.value}function nY(e,t,r=!1,i=!0,n=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):n1(t,0)),""===t.path){let i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=nX(e,t.from),"move"===t.op&&(i.removed=e),i;else if("test"===t.op){if(i.test=n2(e,t.value),!1===i.test)throw new nW("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}else if("remove"===t.op)return i.removed=e,i.newDocument=null,i;else if("_get"===t.op)return t.value=e,i;else if(!r)return i;else throw new nW("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e)}{let s,o,l;i||(e=nM(e));let u=(t.path||"").split("/"),c=e,d=1,h=u.length;for(o="function"==typeof r?r:n1;;){if((s=u[d])&&-1!=s.indexOf("~")&&(s=nB(s)),n&&("__proto__"==s||"prototype"==s&&d>0&&"constructor"==u[d-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===l&&(void 0===c[s]?l=u.slice(0,d).join("/"):d==h-1&&(l=t.path),void 0!==l&&o(t,0,e,l)),d++,Array.isArray(c)){if("-"===s)s=c.length;else if(r&&!nZ(s))throw new nW("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);else nZ(s)&&(s=~~s);if(d>=h){if(r&&"add"===t.op&&s>c.length)throw new nW("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);let i=nK[t.op].call(t,c,s,e);if(!1===i.test)throw new nW("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}}else if(d>=h){let r=nH[t.op].call(t,c,s,e);if(!1===r.test)throw new nW("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(c=c[s],r&&d<h&&(!c||"object"!=typeof c))throw new nW("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function nQ(e,t,r,i=!0,n=!0){if(r&&!Array.isArray(t))throw new nW("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=nM(e));let a=Array(t.length);for(let i=0,s=t.length;i<s;i++)a[i]=nY(e,t[i],r,!0,n,i),e=a[i].newDocument;return a.newDocument=e,a}function n0(e,t,r){let i=nY(e,t);if(!1===i.test)throw new nW("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return i.newDocument}function n1(e,t,r,i){if("object"!=typeof e||null===e||Array.isArray(e))throw new nW("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(nH[e.op]){if("string"!=typeof e.path)throw new nW("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);else if(0!==e.path.indexOf("/")&&e.path.length>0)throw new nW('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new nW("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new nW("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,i=t.length;r<i;r++)if(e(t[r]))return!0}else if("object"==typeof t){let i=nD(t),n=i.length;for(var r=0;r<n;r++)if(e(t[i[r]]))return!0}}return!1}(e.value))throw new nW("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var n=e.path.split("/").length,a=i.split("/").length;if(n!==a+1&&n!==a)throw new nW("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new nW("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=n4([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new nW("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new nW("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function n4(e,t,r){try{if(!Array.isArray(e))throw new nW("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)nQ(nM(t),nM(e),r||!0);else{r=r||n1;for(var i=0;i<e.length;i++)r(e[i],i,t,void 0)}}catch(e){if(e instanceof nW)return e;throw e}}function n2(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,i,n,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((i=e.length)!=t.length)return!1;for(r=i;0!=r--;)if(!n2(e[r],t[r]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((i=o.length)!==Object.keys(t).length)return!1;for(r=i;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=i;0!=r--;)if(!n2(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}function n6(e,t,r=!1){var i=[];return!function e(t,r,i,n,a){if(r!==t){"function"==typeof r.toJSON&&(r=r.toJSON());for(var s=nD(r),o=nD(t),l=!1,u=o.length-1;u>=0;u--){var c=o[u],d=t[c];if(nz(r,c)&&(void 0!==r[c]||void 0===d||!1!==Array.isArray(r))){var h=r[c];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?e(d,h,i,n+"/"+nF(c),a):d!==h&&(a&&i.push({op:"test",path:n+"/"+nF(c),value:nM(d)}),i.push({op:"replace",path:n+"/"+nF(c),value:nM(h)}))}else Array.isArray(t)===Array.isArray(r)?(a&&i.push({op:"test",path:n+"/"+nF(c),value:nM(d)}),i.push({op:"remove",path:n+"/"+nF(c)}),l=!0):(a&&i.push({op:"test",path:n,value:t}),i.push({op:"replace",path:n,value:r}))}if(l||s.length!=o.length)for(var u=0;u<s.length;u++){var c=s[u];nz(t,c)||void 0===r[c]||i.push({op:"add",path:n+"/"+nF(c),value:nM(r[c])})}}}(e,t,i,"",r),i}({...nG,JsonPatchError:nq,deepClone:nM,escapePathComponent:nF,unescapePathComponent:nB});var n9={};G(n9,{LogStreamCallbackHandler:()=>at,RunLog:()=>n3,RunLogPatch:()=>n5,isLogStreamHandler:()=>n8});var n5=class{ops;constructor(e){this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=nQ({},t);return new n3({ops:t,state:r[r.length-1].newDocument})}},n3=class e extends n5{state;constructor(e){super(e),this.state=e.state}concat(t){let r=this.ops.concat(t.ops),i=nQ(this.state,t.ops);return new e({ops:r,state:i[i.length-1].newDocument})}static fromRunLogPatch(t){let r=nQ({},t.ops);return new e({ops:t.ops,state:r[r.length-1].newDocument})}};let n8=e=>"log_stream_tracer"===e.name;async function n7(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function ae(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}var at=class extends ig{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;_schemaFormat="original";rootId;keyMapByRunId={};counterMapByRunName={};transformStream;writer;receiveStream;name="log_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=nC.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new n5({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new n5({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await n7(e,this._schemaFormat)),await this.writer.write(new n5({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await n7(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await ae(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new n5({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){let t=new n5({ops:[{op:"replace",path:"/final_output",value:await ae(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let i,n=this.keyMapByRunId[e.id];if(void 0===n)return;if(void 0!==e.inputs.messages){var a;i=void 0!==(a=r?.chunk)&&void 0!==a.message?r?.chunk:new tI({id:`run-${e.id}`,content:t})}else i=t;let s=new n5({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${n}/streamed_output/-`,value:i}]});await this.writer.write(s)}},ar={};G(ar,{ChatGenerationChunk:()=>aa,GenerationChunk:()=>an,RUN_KEY:()=>ai});let ai="__run";var an=class e{text;generationInfo;constructor(e){this.text=e.text,this.generationInfo=e.generationInfo}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},aa=class e extends an{message;constructor(e){super(e),this.message=e.message}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};let as=Object.prototype.toString,ao=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function al(e,t,{min:r=0,allowInfinity:i=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${i?" or Infinity":""}.`);if(!i&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<r)throw TypeError(`Expected \`${e}\` to be \u2265 ${r}.`)}}var au=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function ac(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function ad({error:e,attemptNumber:t,retriesConsumed:r,startTime:i,options:n}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof au)throw s.originalError;let o=Number.isFinite(n.retries)?Math.max(0,n.retries-r):n.retries,l=n.maxRetryTime??1/0,u=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:r});if(await n.onFailedAttempt(u),0>=ac(i,l))throw s;let c=await n.shouldConsumeRetry(u),d=ac(i,l);if(d<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===as.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:r}=e;return"Load failed"===t?void 0===r||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||ao.has(t)}(s)){if(c)throw s;return n.signal?.throwIfAborted(),!1}if(!await n.shouldRetry(u))throw s;if(!c)return n.signal?.throwIfAborted(),!1;let h=Math.min((a=Math.max(1,r+1),Math.min(Math.round((n.randomize?Math.random()+1:1)*n.minTimeout*n.factor**(a-1)),n.maxTimeout)),d);return h>0&&await new Promise((e,t)=>{let r=()=>{clearTimeout(i),n.signal?.removeEventListener("abort",r),t(n.signal.reason)},i=setTimeout(()=>{n.signal?.removeEventListener("abort",r),e()},h);n.unref&&i.unref?.(),n.signal?.addEventListener("abort",r,{once:!0})}),n.signal?.throwIfAborted(),!0}async function ah(e,t={}){var r=(t={...t}).retries;if("number"==typeof r){if(r<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==r)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,al("factor",t.factor,{min:0,allowInfinity:!1}),al("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),al("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),al("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,n=0,a=performance.now();for(;!Number.isFinite(t.retries)||n<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await ad({error:e,attemptNumber:i,retriesConsumed:n,startTime:a,options:t})&&n++}}throw Error("Retry attempts exhausted without throwing an error.")}var ap={};G(ap,{AsyncCaller:()=>ag});let am=[400,401,402,403,404,405,406,407,409],af=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&am.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};var ag=class{maxConcurrency;maxRetries;onFailedAttempt;queue;constructor(e){this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??af;const t="default"in iZ?iZ.default:iZ;this.queue=new t({concurrency:this.maxConcurrency})}async call(e,...t){return this.queue.add(()=>ah(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:({error:e})=>this.onFailedAttempt?.(e),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){if(e.signal){let i;return Promise.race([this.call(t,...r),new Promise((t,r)=>{i=()=>{r(nA(e.signal))},e.signal?.addEventListener("abort",i)})]).finally(()=>{e.signal&&i&&e.signal.removeEventListener("abort",i)})}return this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}};let ay=Object.freeze({status:"aborted"});function av(e,t,r){function i(r,i){if(r._zod||Object.defineProperty(r,"_zod",{value:{def:i,constr:s,traits:new Set},enumerable:!1}),r._zod.traits.has(e))return;r._zod.traits.add(e),t(r,i);let n=s.prototype,a=Object.keys(n);for(let e=0;e<a.length;e++){let t=a[e];t in r||(r[t]=n[t].bind(r))}}let n=r?.Parent??Object;class a extends n{}function s(e){var t;let n=r?.Parent?new a:this;for(let r of(i(n,e),(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred))r();return n}return Object.defineProperty(a,"name",{value:e}),Object.defineProperty(s,"init",{value:i}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}let a_=Symbol("zod_brand");class ab extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class aw extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}let a$={};function ax(e){return e&&Object.assign(a$,e),a$}function ak(e){return e}function aI(e){return e}function aE(e){}function aS(e){throw Error()}function aO(e){}function aT(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function aA(e,t="|"){return e.map(e=>a9(e)).join(t)}function aN(e,t){return"bigint"==typeof t?t.toString():t}function aC(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function aj(e){return null==e}function aP(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function aR(e,t){let r=(e.toString().split(".")[1]||"").length,i=t.toString(),n=(i.split(".")[1]||"").length;if(0===n&&/\d?e-\d?/.test(i)){let e=i.match(/\d?e-(\d?)/);e?.[1]&&(n=Number.parseInt(e[1]))}let a=r>n?r:n;return Number.parseInt(e.toFixed(a).replace(".",""))%Number.parseInt(t.toFixed(a).replace(".",""))/10**a}e.s(["$ZodAsyncError",()=>ab,"$ZodEncodeError",()=>aw,"$brand",0,a_,"$constructor",()=>av,"NEVER",0,ay,"config",()=>ax,"globalConfig",0,a$],27438);let aU=Symbol("evaluating");function aL(e,t,r){let i;Object.defineProperty(e,t,{get(){if(i!==aU)return void 0===i&&(i=aU,i=r()),i},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function az(e){return Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(e))}function aD(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function aM(...e){let t={};for(let r of e)Object.assign(t,Object.getOwnPropertyDescriptors(r));return Object.defineProperties({},t)}function aZ(e){return aM(e._zod.def)}function aF(e,t){return t?t.reduce((e,t)=>e?.[t],e):e}function aB(e){let t=Object.keys(e);return Promise.all(t.map(t=>e[t])).then(e=>{let r={};for(let i=0;i<t.length;i++)r[t[i]]=e[i];return r})}function aV(e=10){let t="abcdefghijklmnopqrstuvwxyz",r="";for(let i=0;i<e;i++)r+=t[Math.floor(Math.random()*t.length)];return r}function aq(e){return JSON.stringify(e)}function aG(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}let aW="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function aJ(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let aH=aC(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function aK(e){if(!1===aJ(e))return!1;let t=e.constructor;if(void 0===t||"function"!=typeof t)return!0;let r=t.prototype;return!1!==aJ(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function aX(e){return aK(e)?{...e}:Array.isArray(e)?[...e]:e}function aY(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}let aQ=new Set(["string","number","symbol"]),a0=new Set(["string","number","bigint","boolean","symbol","undefined"]);function a1(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a4(e,t,r){let i=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(i._zod.parent=e),i}function a2(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function a6(e){let t;return new Proxy({},{get:(r,i,n)=>(t??(t=e()),Reflect.get(t,i,n)),set:(r,i,n,a)=>(t??(t=e()),Reflect.set(t,i,n,a)),has:(r,i)=>(t??(t=e()),Reflect.has(t,i)),deleteProperty:(r,i)=>(t??(t=e()),Reflect.deleteProperty(t,i)),ownKeys:r=>(t??(t=e()),Reflect.ownKeys(t)),getOwnPropertyDescriptor:(r,i)=>(t??(t=e()),Reflect.getOwnPropertyDescriptor(t,i)),defineProperty:(r,i,n)=>(t??(t=e()),Reflect.defineProperty(t,i,n))})}function a9(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}function a5(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}let a3={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},a8={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function a7(e,t){let r=e._zod.def,i=aM(e._zod.def,{get shape(){let e={};for(let i in t){if(!(i in r.shape))throw Error(`Unrecognized key: "${i}"`);t[i]&&(e[i]=r.shape[i])}return aD(this,"shape",e),e},checks:[]});return a4(e,i)}function se(e,t){let r=e._zod.def,i=aM(e._zod.def,{get shape(){let i={...e._zod.def.shape};for(let e in t){if(!(e in r.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete i[e]}return aD(this,"shape",i),i},checks:[]});return a4(e,i)}function st(e,t){if(!aK(t))throw Error("Invalid input to extend: expected a plain object");let r=e._zod.def.checks;if(r&&r.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let i=aM(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t};return aD(this,"shape",r),r},checks:[]});return a4(e,i)}function sr(e,t){if(!aK(t))throw Error("Invalid input to safeExtend: expected a plain object");let r={...e._zod.def,get shape(){let r={...e._zod.def.shape,...t};return aD(this,"shape",r),r},checks:e._zod.def.checks};return a4(e,r)}function si(e,t){let r=aM(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return aD(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return a4(e,r)}function sn(e,t,r){let i=aM(t._zod.def,{get shape(){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=e?new e({type:"optional",innerType:i[t]}):i[t])}else for(let t in i)n[t]=e?new e({type:"optional",innerType:i[t]}):i[t];return aD(this,"shape",n),n},checks:[]});return a4(t,i)}function sa(e,t,r){let i=aM(t._zod.def,{get shape(){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=new e({type:"nonoptional",innerType:i[t]}))}else for(let t in i)n[t]=new e({type:"nonoptional",innerType:i[t]});return aD(this,"shape",n),n},checks:[]});return a4(t,i)}function ss(e,t=0){if(!0===e.aborted)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function so(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function sl(e){return"string"==typeof e?e:e?.message}function su(e,t,r){let i={...e,path:e.path??[]};return e.message||(i.message=sl(e.inst?._zod.def?.error?.(e))??sl(t?.error?.(e))??sl(r.customError?.(e))??sl(r.localeError?.(e))??"Invalid input"),delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}function sc(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function sd(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function sh(...e){let[t,r,i]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:i}:{...t}}function sp(e){return Object.entries(e).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function sm(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}function sf(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function sg(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-t.length%4)%4);return sm(t+r)}function sy(e){return sf(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function sv(e){let t=e.replace(/^0x/,"");if(t.length%2!=0)throw Error("Invalid hex string length");let r=new Uint8Array(t.length/2);for(let e=0;e<t.length;e+=2)r[e/2]=Number.parseInt(t.slice(e,e+2),16);return r}function s_(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}class sb{constructor(...e){}}e.s(["BIGINT_FORMAT_RANGES",0,a8,"Class",()=>sb,"NUMBER_FORMAT_RANGES",0,a3,"aborted",()=>ss,"allowsEval",0,aH,"assert",()=>aO,"assertEqual",()=>ak,"assertIs",()=>aE,"assertNever",()=>aS,"assertNotEqual",()=>aI,"assignProp",()=>aD,"base64ToUint8Array",()=>sm,"base64urlToUint8Array",()=>sg,"cached",()=>aC,"captureStackTrace",0,aW,"cleanEnum",()=>sp,"cleanRegex",()=>aP,"clone",()=>a4,"cloneDef",()=>aZ,"createTransparentProxy",()=>a6,"defineLazy",()=>aL,"esc",()=>aq,"escapeRegex",()=>a1,"extend",()=>st,"finalizeIssue",()=>su,"floatSafeRemainder",()=>aR,"getElementAtPath",()=>aF,"getEnumValues",()=>aT,"getLengthableOrigin",()=>sd,"getParsedType",0,e=>{let t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return"promise";if("undefined"!=typeof Map&&e instanceof Map)return"map";if("undefined"!=typeof Set&&e instanceof Set)return"set";if("undefined"!=typeof Date&&e instanceof Date)return"date";if("undefined"!=typeof File&&e instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${t}`)}},"getSizableOrigin",()=>sc,"hexToUint8Array",()=>sv,"isObject",()=>aJ,"isPlainObject",()=>aK,"issue",()=>sh,"joinValues",()=>aA,"jsonStringifyReplacer",()=>aN,"merge",()=>si,"mergeDefs",()=>aM,"normalizeParams",()=>a2,"nullish",()=>aj,"numKeys",()=>aY,"objectClone",()=>az,"omit",()=>se,"optionalKeys",()=>a5,"partial",()=>sn,"pick",()=>a7,"prefixIssues",()=>so,"primitiveTypes",0,a0,"promiseAllObject",()=>aB,"propertyKeyTypes",0,aQ,"randomString",()=>aV,"required",()=>sa,"safeExtend",()=>sr,"shallowClone",()=>aX,"slugify",()=>aG,"stringifyPrimitive",()=>a9,"uint8ArrayToBase64",()=>sf,"uint8ArrayToBase64url",()=>sy,"uint8ArrayToHex",()=>s_,"unwrapMessage",()=>sl],86618);let sw=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,aN,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},s$=av("$ZodError",sw),sx=av("$ZodError",sw,{Parent:Error});function sk(e,t=e=>e.message){let r={},i=[];for(let n of e.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:r}}function sI(e,t=e=>e.message){let r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code&&n.errors.length)n.errors.map(e=>i({issues:e}));else if("invalid_key"===n.code)i({issues:n.issues});else if("invalid_element"===n.code)i({issues:n.issues});else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(e),r}function sE(e,t=e=>e.message){let r={errors:[]},i=(e,n=[])=>{var a,s;for(let o of e.issues)if("invalid_union"===o.code&&o.errors.length)o.errors.map(e=>i({issues:e},o.path));else if("invalid_key"===o.code)i({issues:o.issues},o.path);else if("invalid_element"===o.code)i({issues:o.issues},o.path);else{let e=[...n,...o.path];if(0===e.length){r.errors.push(t(o));continue}let i=r,l=0;for(;l<e.length;){let r=e[l],n=l===e.length-1;"string"==typeof r?(i.properties??(i.properties={}),(a=i.properties)[r]??(a[r]={errors:[]}),i=i.properties[r]):(i.items??(i.items=[]),(s=i.items)[r]??(s[r]={errors:[]}),i=i.items[r]),n&&i.errors.push(t(o)),l++}}};return i(e),r}function sS(e){let t=[];for(let r of e.map(e=>"object"==typeof e?e.key:e))"number"==typeof r?t.push(`[${r}]`):"symbol"==typeof r?t.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?t.push(`[${JSON.stringify(r)}]`):(t.length&&t.push("."),t.push(r));return t.join("")}function sO(e){let t=[];for(let r of[...e.issues].sort((e,t)=>(e.path??[]).length-(t.path??[]).length))t.push(` ${r.message}`),r.path?.length&&t.push(`   at ${sS(r.path)}`);return t.join("\n")}e.s(["$ZodError",0,s$,"$ZodRealError",0,sx,"flattenError",()=>sk,"formatError",()=>sI,"prettifyError",()=>sO,"toDotPath",()=>sS,"treeifyError",()=>sE],67021);let sT=e=>(t,r,i,n)=>{let a=i?Object.assign(i,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise)throw new ab;if(s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>su(e,a,ax())));throw aW(t,n?.callee),t}return s.value},sA=sT(sx),sN=e=>async(t,r,i,n)=>{let a=i?Object.assign(i,{async:!0}):{async:!0},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>su(e,a,ax())));throw aW(t,n?.callee),t}return s.value},sC=sN(sx),sj=e=>(t,r,i)=>{let n=i?{...i,async:!1}:{async:!1},a=t._zod.run({value:r,issues:[]},n);if(a instanceof Promise)throw new ab;return a.issues.length?{success:!1,error:new(e??s$)(a.issues.map(e=>su(e,n,ax())))}:{success:!0,data:a.value}},sP=sj(sx),sR=e=>async(t,r,i)=>{let n=i?Object.assign(i,{async:!0}):{async:!0},a=t._zod.run({value:r,issues:[]},n);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>su(e,n,ax())))}:{success:!0,data:a.value}},sU=sR(sx),sL=e=>(t,r,i)=>{let n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return sT(e)(t,r,n)},sz=sL(sx),sD=e=>(t,r,i)=>sT(e)(t,r,i),sM=sD(sx),sZ=e=>async(t,r,i)=>{let n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return sN(e)(t,r,n)},sF=sZ(sx),sB=e=>async(t,r,i)=>sN(e)(t,r,i),sV=sB(sx),sq=e=>(t,r,i)=>{let n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return sj(e)(t,r,n)},sG=sq(sx),sW=e=>(t,r,i)=>sj(e)(t,r,i),sJ=sW(sx),sH=e=>async(t,r,i)=>{let n=i?Object.assign(i,{direction:"backward"}):{direction:"backward"};return sR(e)(t,r,n)},sK=sH(sx),sX=e=>async(t,r,i)=>sR(e)(t,r,i),sY=sX(sx);e.s(["_decode",0,sD,"_decodeAsync",0,sB,"_encode",0,sL,"_encodeAsync",0,sZ,"_parse",0,sT,"_parseAsync",0,sN,"_safeDecode",0,sW,"_safeDecodeAsync",0,sX,"_safeEncode",0,sq,"_safeEncodeAsync",0,sH,"_safeParse",0,sj,"_safeParseAsync",0,sR,"decode",0,sM,"decodeAsync",0,sV,"encode",0,sz,"encodeAsync",0,sF,"parse",0,sA,"parseAsync",0,sC,"safeDecode",0,sJ,"safeDecodeAsync",0,sY,"safeEncode",0,sG,"safeEncodeAsync",0,sK,"safeParse",0,sP,"safeParseAsync",0,sU],15143);let sQ=/^[cC][^\s-]{8,}$/,s0=/^[0-9a-z]+$/,s1=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,s4=/^[0-9a-vA-V]{20}$/,s2=/^[A-Za-z0-9]{27}$/,s6=/^[a-zA-Z0-9_-]{21}$/,s9=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,s5=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,s3=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,s8=s3(4),s7=s3(6),oe=s3(7),ot=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,or=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u;function oi(){return RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}let on=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,oa=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,os=e=>{let t=a1(e??":");return RegExp(`^(?:[0-9A-F]{2}${t}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${t}){5}[0-9a-f]{2}$`)},oo=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,ol=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ou=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,oc=/^[A-Za-z0-9_-]*$/,od=/^\+(?:[0-9]){6,14}[0-9]$/,oh="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",op=RegExp(`^${oh}$`);function om(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function of(e){return RegExp(`^${om(e)}$`)}function og(e){let t=om({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let i=`${t}(?:${r.join("|")})`;return RegExp(`^${oh}T(?:${i})$`)}let oy=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${t}$`)},ov=/^-?\d+n?$/,o_=/^-?\d+$/,ob=/^-?\d+(?:\.\d+)?/,ow=/^(?:true|false)$/i,o$=/^null$/i,ox=/^undefined$/i,ok=/^[^A-Z]*$/,oI=/^[^a-z]*$/;function oE(e,t){return RegExp(`^[A-Za-z0-9+/]{${e}}${t}$`)}function oS(e){return RegExp(`^[A-Za-z0-9_-]{${e}}$`)}let oO=oE(22,"=="),oT=oS(22),oA=oE(27,"="),oN=oS(27),oC=oE(43,"="),oj=oS(43),oP=oE(64,""),oR=oS(64),oU=oE(86,"=="),oL=oS(86);e.s(["base64",0,ou,"base64url",0,oc,"bigint",0,ov,"boolean",0,ow,"browserEmail",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"cidrv4",0,oo,"cidrv6",0,ol,"cuid",0,sQ,"cuid2",0,s0,"date",0,op,"datetime",()=>og,"domain",0,/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,"duration",0,s9,"e164",0,od,"email",0,ot,"emoji",()=>oi,"extendedDuration",0,/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,"guid",0,s5,"hex",0,/^[0-9a-fA-F]*$/,"hostname",0,/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,"html5Email",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"idnEmail",0,or,"integer",0,o_,"ipv4",0,on,"ipv6",0,oa,"ksuid",0,s2,"lowercase",0,ok,"mac",0,os,"md5_base64",0,oO,"md5_base64url",0,oT,"md5_hex",0,/^[0-9a-fA-F]{32}$/,"nanoid",0,s6,"null",()=>o$,"number",0,ob,"rfc5322Email",0,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,"sha1_base64",0,oA,"sha1_base64url",0,oN,"sha1_hex",0,/^[0-9a-fA-F]{40}$/,"sha256_base64",0,oC,"sha256_base64url",0,oj,"sha256_hex",0,/^[0-9a-fA-F]{64}$/,"sha384_base64",0,oP,"sha384_base64url",0,oR,"sha384_hex",0,/^[0-9a-fA-F]{96}$/,"sha512_base64",0,oU,"sha512_base64url",0,oL,"sha512_hex",0,/^[0-9a-fA-F]{128}$/,"string",0,oy,"time",()=>of,"ulid",0,s1,"undefined",()=>ox,"unicodeEmail",0,or,"uppercase",0,oI,"uuid",0,s3,"uuid4",0,s8,"uuid6",0,s7,"uuid7",0,oe,"xid",0,s4],21131);let oz=av("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),oD={number:"number",bigint:"bigint",object:"date"},oM=av("$ZodCheckLessThan",(e,t)=>{oz.init(e,t);let r=oD[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??1/0;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:r,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),oZ=av("$ZodCheckGreaterThan",(e,t)=>{oz.init(e,t);let r=oD[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??-1/0;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:r,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),oF=av("$ZodCheckMultipleOf",(e,t)=>{oz.init(e,t),e._zod.onattach.push(e=>{var r;(r=e._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof r.value?r.value%t.value===BigInt(0):0===aR(r.value,t.value))||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),oB=av("$ZodCheckNumberFormat",(e,t)=>{oz.init(e,t),t.format=t.format||"float64";let r=t.format?.includes("int"),i=r?"int":"number",[n,a]=a3[t.format];e._zod.onattach.push(e=>{let i=e._zod.bag;i.format=t.format,i.minimum=n,i.maximum=a,r&&(i.pattern=o_)}),e._zod.check=s=>{let o=s.value;if(r){if(!Number.isInteger(o))return void s.issues.push({expected:i,format:t.format,code:"invalid_type",continue:!1,input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}))}o<n&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:n,inclusive:!0,inst:e,continue:!t.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inst:e})}}),oV=av("$ZodCheckBigIntFormat",(e,t)=>{oz.init(e,t);let[r,i]=a8[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=r,n.maximum=i}),e._zod.check=n=>{let a=n.value;a<r&&n.issues.push({origin:"bigint",input:a,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),a>i&&n.issues.push({origin:"bigint",input:a,code:"too_big",maximum:i,inst:e})}}),oq=av("$ZodCheckMaxSize",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;i.size<=t.maximum||r.issues.push({origin:sc(i),code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),oG=av("$ZodCheckMinSize",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;i.size>=t.minimum||r.issues.push({origin:sc(i),code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),oW=av("$ZodCheckSizeEquals",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.size,r.maximum=t.size,r.size=t.size}),e._zod.check=r=>{let i=r.value,n=i.size;if(n===t.size)return;let a=n>t.size;r.issues.push({origin:sc(i),...a?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),oJ=av("$ZodCheckMaxLength",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;if(i.length<=t.maximum)return;let n=sd(i);r.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),oH=av("$ZodCheckMinLength",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;if(i.length>=t.minimum)return;let n=sd(i);r.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),oK=av("$ZodCheckLengthEquals",(e,t)=>{var r;oz.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!aj(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let i=r.value,n=i.length;if(n===t.length)return;let a=sd(i),s=n>t.length;r.issues.push({origin:a,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),oX=av("$ZodCheckStringFormat",(e,t)=>{var r,i;oz.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(i=e._zod).check??(i.check=()=>{})}),oY=av("$ZodCheckRegex",(e,t)=>{oX.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),oQ=av("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ok),oX.init(e,t)}),o0=av("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=oI),oX.init(e,t)}),o1=av("$ZodCheckIncludes",(e,t)=>{oz.init(e,t);let r=a1(t.includes),i=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=i,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),o4=av("$ZodCheckStartsWith",(e,t)=>{oz.init(e,t);let r=RegExp(`^${a1(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),o2=av("$ZodCheckEndsWith",(e,t)=>{oz.init(e,t);let r=RegExp(`.*${a1(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}});function o6(e,t,r){e.issues.length&&t.issues.push(...so(r,e.issues))}let o9=av("$ZodCheckProperty",(e,t)=>{oz.init(e,t),e._zod.check=e=>{let r=t.schema._zod.run({value:e.value[t.property],issues:[]},{});if(r instanceof Promise)return r.then(r=>o6(r,e,t.property));o6(r,e,t.property)}}),o5=av("$ZodCheckMimeType",(e,t)=>{oz.init(e,t);let r=new Set(t.mime);e._zod.onattach.push(e=>{e._zod.bag.mime=t.mime}),e._zod.check=i=>{r.has(i.value.type)||i.issues.push({code:"invalid_value",values:t.mime,input:i.value.type,inst:e,continue:!t.abort})}}),o3=av("$ZodCheckOverwrite",(e,t)=>{oz.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});e.s(["$ZodCheck",0,oz,"$ZodCheckBigIntFormat",0,oV,"$ZodCheckEndsWith",0,o2,"$ZodCheckGreaterThan",0,oZ,"$ZodCheckIncludes",0,o1,"$ZodCheckLengthEquals",0,oK,"$ZodCheckLessThan",0,oM,"$ZodCheckLowerCase",0,oQ,"$ZodCheckMaxLength",0,oJ,"$ZodCheckMaxSize",0,oq,"$ZodCheckMimeType",0,o5,"$ZodCheckMinLength",0,oH,"$ZodCheckMinSize",0,oG,"$ZodCheckMultipleOf",0,oF,"$ZodCheckNumberFormat",0,oB,"$ZodCheckOverwrite",0,o3,"$ZodCheckProperty",0,o9,"$ZodCheckRegex",0,oY,"$ZodCheckSizeEquals",0,oW,"$ZodCheckStartsWith",0,o4,"$ZodCheckStringFormat",0,oX,"$ZodCheckUpperCase",0,o0],36608);class o8{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}e.s(["Doc",()=>o8],73911);let o7={major:4,minor:1,patch:13};e.s(["version",0,o7],22824);let le=av("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=o7;let i=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&i.unshift(e),i))for(let r of t._zod.onattach)r(e);if(0===i.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let i,n=ss(e);for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(n)continue;let t=e.issues.length,s=a._zod.check(e);if(s instanceof Promise&&r?.async===!1)throw new ab;if(i||s instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await s,e.issues.length!==t&&(n||(n=ss(e,t)))});else{if(e.issues.length===t)continue;n||(n=ss(e,t))}}return i?i.then(()=>e):e},r=(r,n,a)=>{if(ss(r))return r.aborted=!0,r;let s=t(n,i,a);if(s instanceof Promise){if(!1===a.async)throw new ab;return s.then(t=>e._zod.parse(t,a))}return e._zod.parse(s,a)};e._zod.run=(n,a)=>{if(a.skipChecks)return e._zod.parse(n,a);if("backward"===a.direction){let t=e._zod.parse({value:n.value,issues:[]},{...a,skipChecks:!0});return t instanceof Promise?t.then(e=>r(e,n,a)):r(t,n,a)}let s=e._zod.parse(n,a);if(s instanceof Promise){if(!1===a.async)throw new ab;return s.then(e=>t(e,i,a))}return t(s,i,a)}}e["~standard"]={validate:t=>{try{let r=sP(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return sU(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),lt=av("$ZodString",(e,t)=>{le.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??oy(e._zod.bag),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),lr=av("$ZodStringFormat",(e,t)=>{oX.init(e,t),lt.init(e,t)}),li=av("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=s5),lr.init(e,t)}),ln=av("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=s3(e))}else t.pattern??(t.pattern=s3());lr.init(e,t)}),la=av("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=ot),lr.init(e,t)}),ls=av("$ZodURL",(e,t)=>{lr.init(e,t),e._zod.check=r=>{try{let i=r.value.trim(),n=new URL(i);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=n.href:r.value=i;return}catch(i){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),lo=av("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=oi()),lr.init(e,t)}),ll=av("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=s6),lr.init(e,t)}),lu=av("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=sQ),lr.init(e,t)}),lc=av("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=s0),lr.init(e,t)}),ld=av("$ZodULID",(e,t)=>{t.pattern??(t.pattern=s1),lr.init(e,t)}),lh=av("$ZodXID",(e,t)=>{t.pattern??(t.pattern=s4),lr.init(e,t)}),lp=av("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=s2),lr.init(e,t)}),lm=av("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=og(t)),lr.init(e,t)}),lf=av("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=op),lr.init(e,t)}),lg=av("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=of(t)),lr.init(e,t)}),ly=av("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=s9),lr.init(e,t)}),lv=av("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=on),lr.init(e,t),e._zod.bag.format="ipv4"}),l_=av("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=oa),lr.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),lb=av("$ZodMAC",(e,t)=>{t.pattern??(t.pattern=os(t.delimiter)),lr.init(e,t),e._zod.bag.format="mac"}),lw=av("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=oo),lr.init(e,t)}),l$=av("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=ol),lr.init(e,t),e._zod.check=r=>{let i=r.value.split("/");try{if(2!==i.length)throw Error();let[e,t]=i;if(!t)throw Error();let r=Number(t);if(`${r}`!==t||r<0||r>128)throw Error();new URL(`http://[${e}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function lx(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let lk=av("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=ou),lr.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{lx(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function lI(e){if(!oc.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return lx(t.padEnd(4*Math.ceil(t.length/4),"="))}let lE=av("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=oc),lr.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{lI(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),lS=av("$ZodE164",(e,t)=>{t.pattern??(t.pattern=od),lr.init(e,t)});function lO(e,t=null){try{let r=e.split(".");if(3!==r.length)return!1;let[i]=r;if(!i)return!1;let n=JSON.parse(atob(i));if("typ"in n&&n?.typ!=="JWT"||!n.alg||t&&(!("alg"in n)||n.alg!==t))return!1;return!0}catch{return!1}}let lT=av("$ZodJWT",(e,t)=>{lr.init(e,t),e._zod.check=r=>{lO(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),lA=av("$ZodCustomStringFormat",(e,t)=>{lr.init(e,t),e._zod.check=r=>{t.fn(r.value)||r.issues.push({code:"invalid_format",format:t.format,input:r.value,inst:e,continue:!t.abort})}}),lN=av("$ZodNumber",(e,t)=>{le.init(e,t),e._zod.pattern=e._zod.bag.pattern??ob,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}let n=r.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return r;let a="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...a?{received:a}:{}}),r}}),lC=av("$ZodNumberFormat",(e,t)=>{oB.init(e,t),lN.init(e,t)}),lj=av("$ZodBoolean",(e,t)=>{le.init(e,t),e._zod.pattern=ow,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=!!r.value}catch(e){}let n=r.value;return"boolean"==typeof n||r.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),r}}),lP=av("$ZodBigInt",(e,t)=>{le.init(e,t),e._zod.pattern=ov,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch(e){}return"bigint"==typeof r.value||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:e}),r}}),lR=av("$ZodBigIntFormat",(e,t)=>{oV.init(e,t),lP.init(e,t)}),lU=av("$ZodSymbol",(e,t)=>{le.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return"symbol"==typeof i||t.issues.push({expected:"symbol",code:"invalid_type",input:i,inst:e}),t}}),lL=av("$ZodUndefined",(e,t)=>{le.init(e,t),e._zod.pattern=ox,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(t,r)=>{let i=t.value;return void 0===i||t.issues.push({expected:"undefined",code:"invalid_type",input:i,inst:e}),t}}),lz=av("$ZodNull",(e,t)=>{le.init(e,t),e._zod.pattern=o$,e._zod.values=new Set([null]),e._zod.parse=(t,r)=>{let i=t.value;return null===i||t.issues.push({expected:"null",code:"invalid_type",input:i,inst:e}),t}}),lD=av("$ZodAny",(e,t)=>{le.init(e,t),e._zod.parse=e=>e}),lM=av("$ZodUnknown",(e,t)=>{le.init(e,t),e._zod.parse=e=>e}),lZ=av("$ZodNever",(e,t)=>{le.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),lF=av("$ZodVoid",(e,t)=>{le.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return void 0===i||t.issues.push({expected:"void",code:"invalid_type",input:i,inst:e}),t}}),lB=av("$ZodDate",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=new Date(r.value)}catch(e){}let n=r.value,a=n instanceof Date;return a&&!Number.isNaN(n.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:n,...a?{received:"Invalid Date"}:{},inst:e}),r}});function lV(e,t,r){e.issues.length&&t.issues.push(...so(r,e.issues)),t.value[r]=e.value}let lq=av("$ZodArray",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!Array.isArray(n))return r.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),r;r.value=Array(n.length);let a=[];for(let e=0;e<n.length;e++){let s=n[e],o=t.element._zod.run({value:s,issues:[]},i);o instanceof Promise?a.push(o.then(t=>lV(t,r,e))):lV(o,r,e)}return a.length?Promise.all(a).then(()=>r):r}});function lG(e,t,r,i){e.issues.length&&t.issues.push(...so(r,e.issues)),void 0===e.value?r in i&&(t.value[r]=void 0):t.value[r]=e.value}function lW(e){let t=Object.keys(e.shape);for(let r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${r}": expected a Zod schema`);let r=a5(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function lJ(e,t,r,i,n,a){let s=[],o=n.keySet,l=n.catchall._zod,u=l.def.type;for(let n in t){if(o.has(n))continue;if("never"===u){s.push(n);continue}let a=l.run({value:t[n],issues:[]},i);a instanceof Promise?e.push(a.then(e=>lG(e,r,n,t))):lG(a,r,n,t)}return(s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:a}),e.length)?Promise.all(e).then(()=>r):r}let lH=av("$ZodObject",(e,t)=>{let r;le.init(e,t);let i=Object.getOwnPropertyDescriptor(t,"shape");if(!i?.get){let e=t.shape;Object.defineProperty(t,"shape",{get:()=>{let r={...e};return Object.defineProperty(t,"shape",{value:r}),r}})}let n=aC(()=>lW(t));aL(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let i=e[t]._zod;if(i.values)for(let e of(r[t]??(r[t]=new Set),i.values))r[t].add(e)}return r});let a=t.catchall;e._zod.parse=(t,i)=>{r??(r=n.value);let s=t.value;if(!aJ(s))return t.issues.push({expected:"object",code:"invalid_type",input:s,inst:e}),t;t.value={};let o=[],l=r.shape;for(let e of r.keys){let r=l[e]._zod.run({value:s[e],issues:[]},i);r instanceof Promise?o.push(r.then(r=>lG(r,t,e,s))):lG(r,t,e,s)}return a?lJ(o,s,t,i,n.value,e):o.length?Promise.all(o).then(()=>t):t}}),lK=av("$ZodObjectJIT",(e,t)=>{let r,i;lH.init(e,t);let n=e._zod.parse,a=aC(()=>lW(t)),s=!a$.jitless,o=s&&aH.value,l=t.catchall;e._zod.parse=(u,c)=>{i??(i=a.value);let d=u.value;return aJ(d)?s&&o&&c?.async===!1&&!0!==c.jitless?(r||(r=(e=>{let t=new o8(["shape","payload","ctx"]),r=a.value,i=e=>{let t=aq(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let n=Object.create(null),s=0;for(let e of r.keys)n[e]=`key_${s++}`;for(let e of(t.write("const newResult = {};"),r.keys)){let r=n[e],a=aq(e);t.write(`const ${r} = ${i(e)};`),t.write(`
        if (${r}.issues.length) {
          payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${a}, ...iss.path] : [${a}]
          })));
        }
        
        
        if (${r}.value === undefined) {
          if (${a} in input) {
            newResult[${a}] = undefined;
          }
        } else {
          newResult[${a}] = ${r}.value;
        }
        
      `)}t.write("payload.value = newResult;"),t.write("return payload;");let o=t.compile();return(t,r)=>o(e,t,r)})(t.shape)),u=r(u,c),l)?lJ([],d,u,c,i,e):u:n(u,c):(u.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),u)}});function lX(e,t,r,i){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;let n=e.filter(e=>!ss(e));return 1===n.length?(t.value=n[0].value,n[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>su(e,i,ax())))}),t)}let lY=av("$ZodUnion",(e,t)=>{le.init(e,t),aL(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),aL(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),aL(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),aL(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>aP(e.source)).join("|")})$`)}});let r=1===t.options.length,i=t.options[0]._zod.run;e._zod.parse=(n,a)=>{if(r)return i(n,a);let s=!1,o=[];for(let e of t.options){let t=e._zod.run({value:n.value,issues:[]},a);if(t instanceof Promise)o.push(t),s=!0;else{if(0===t.issues.length)return t;o.push(t)}}return s?Promise.all(o).then(t=>lX(t,n,e,a)):lX(o,n,e,a)}}),lQ=av("$ZodDiscriminatedUnion",(e,t)=>{lY.init(e,t);let r=e._zod.parse;aL(e._zod,"propValues",()=>{let e={};for(let r of t.options){let i=r._zod.propValues;if(!i||0===Object.keys(i).length)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let[t,r]of Object.entries(i))for(let i of(e[t]||(e[t]=new Set),r))e[t].add(i)}return e});let i=aC(()=>{let e=t.options,r=new Map;for(let i of e){let e=i._zod.propValues?.[t.discriminator];if(!e||0===e.size)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(let t of e){if(r.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);r.set(t,i)}}return r});e._zod.parse=(n,a)=>{let s=n.value;if(!aJ(s))return n.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),n;let o=i.value.get(s?.[t.discriminator]);return o?o._zod.run(n,a):t.unionFallback?r(n,a):(n.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:s,path:[t.discriminator],inst:e}),n)}}),l0=av("$ZodIntersection",(e,t)=>{le.init(e,t),e._zod.parse=(e,r)=>{let i=e.value,n=t.left._zod.run({value:i,issues:[]},r),a=t.right._zod.run({value:i,issues:[]},r);return n instanceof Promise||a instanceof Promise?Promise.all([n,a]).then(([t,r])=>l1(e,t,r)):l1(e,n,a)}});function l1(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),ss(e))return e;let i=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(aK(t)&&aK(r)){let i=Object.keys(r),n=Object.keys(t).filter(e=>-1!==i.indexOf(e)),a={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};a[i]=n.data}return{valid:!0,data:a}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let i=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};i.push(a.data)}return{valid:!0,data:i}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!i.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}let l4=av("$ZodTuple",(e,t)=>{le.init(e,t);let r=t.items;e._zod.parse=(i,n)=>{let a=i.value;if(!Array.isArray(a))return i.issues.push({input:a,inst:e,expected:"tuple",code:"invalid_type"}),i;i.value=[];let s=[],o=[...r].reverse().findIndex(e=>"optional"!==e._zod.optin),l=-1===o?0:r.length-o;if(!t.rest){let t=a.length>r.length,n=a.length<l-1;if(t||n)return i.issues.push({...t?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length},input:a,inst:e,origin:"array"}),i}let u=-1;for(let e of r){if(++u>=a.length&&u>=l)continue;let t=e._zod.run({value:a[u],issues:[]},n);t instanceof Promise?s.push(t.then(e=>l2(e,i,u))):l2(t,i,u)}if(t.rest)for(let e of a.slice(r.length)){u++;let r=t.rest._zod.run({value:e,issues:[]},n);r instanceof Promise?s.push(r.then(e=>l2(e,i,u))):l2(r,i,u)}return s.length?Promise.all(s).then(()=>i):i}});function l2(e,t,r){e.issues.length&&t.issues.push(...so(r,e.issues)),t.value[r]=e.value}let l6=av("$ZodRecord",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!aK(n))return r.issues.push({expected:"record",code:"invalid_type",input:n,inst:e}),r;let a=[],s=t.keyType._zod.values;if(s){let o;r.value={};let l=new Set;for(let e of s)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){l.add("number"==typeof e?e.toString():e);let s=t.valueType._zod.run({value:n[e],issues:[]},i);s instanceof Promise?a.push(s.then(t=>{t.issues.length&&r.issues.push(...so(e,t.issues)),r.value[e]=t.value})):(s.issues.length&&r.issues.push(...so(e,s.issues)),r.value[e]=s.value)}for(let e in n)l.has(e)||(o=o??[]).push(e);o&&o.length>0&&r.issues.push({code:"unrecognized_keys",input:n,inst:e,keys:o})}else for(let s of(r.value={},Reflect.ownKeys(n))){if("__proto__"===s)continue;let o=t.keyType._zod.run({value:s,issues:[]},i);if(o instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(o.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:o.issues.map(e=>su(e,i,ax())),input:s,path:[s],inst:e}),r.value[o.value]=o.value;continue}let l=t.valueType._zod.run({value:n[s],issues:[]},i);l instanceof Promise?a.push(l.then(e=>{e.issues.length&&r.issues.push(...so(s,e.issues)),r.value[o.value]=e.value})):(l.issues.length&&r.issues.push(...so(s,l.issues)),r.value[o.value]=l.value)}return a.length?Promise.all(a).then(()=>r):r}}),l9=av("$ZodMap",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:n,inst:e}),r;let a=[];for(let[s,o]of(r.value=new Map,n)){let l=t.keyType._zod.run({value:s,issues:[]},i),u=t.valueType._zod.run({value:o,issues:[]},i);l instanceof Promise||u instanceof Promise?a.push(Promise.all([l,u]).then(([t,a])=>{l5(t,a,r,s,n,e,i)})):l5(l,u,r,s,n,e,i)}return a.length?Promise.all(a).then(()=>r):r}});function l5(e,t,r,i,n,a,s){e.issues.length&&(aQ.has(typeof i)?r.issues.push(...so(i,e.issues)):r.issues.push({code:"invalid_key",origin:"map",input:n,inst:a,issues:e.issues.map(e=>su(e,s,ax()))})),t.issues.length&&(aQ.has(typeof i)?r.issues.push(...so(i,t.issues)):r.issues.push({origin:"map",code:"invalid_element",input:n,inst:a,key:i,issues:t.issues.map(e=>su(e,s,ax()))})),r.value.set(e.value,t.value)}let l3=av("$ZodSet",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Set))return r.issues.push({input:n,inst:e,expected:"set",code:"invalid_type"}),r;let a=[];for(let e of(r.value=new Set,n)){let n=t.valueType._zod.run({value:e,issues:[]},i);n instanceof Promise?a.push(n.then(e=>l8(e,r))):l8(n,r)}return a.length?Promise.all(a).then(()=>r):r}});function l8(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}let l7=av("$ZodEnum",(e,t)=>{le.init(e,t);let r=aT(t.entries),i=new Set(r);e._zod.values=i,e._zod.pattern=RegExp(`^(${r.filter(e=>aQ.has(typeof e)).map(e=>"string"==typeof e?a1(e):e.toString()).join("|")})$`),e._zod.parse=(t,n)=>{let a=t.value;return i.has(a)||t.issues.push({code:"invalid_value",values:r,input:a,inst:e}),t}}),ue=av("$ZodLiteral",(e,t)=>{if(le.init(e,t),0===t.values.length)throw Error("Cannot create literal schema with no valid values");let r=new Set(t.values);e._zod.values=r,e._zod.pattern=RegExp(`^(${t.values.map(e=>"string"==typeof e?a1(e):e?a1(e.toString()):String(e)).join("|")})$`),e._zod.parse=(i,n)=>{let a=i.value;return r.has(a)||i.issues.push({code:"invalid_value",values:t.values,input:a,inst:e}),i}}),ut=av("$ZodFile",(e,t)=>{le.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return i instanceof File||t.issues.push({expected:"file",code:"invalid_type",input:i,inst:e}),t}}),ur=av("$ZodTransform",(e,t)=>{le.init(e,t),e._zod.parse=(r,i)=>{if("backward"===i.direction)throw new aw(e.constructor.name);let n=t.transform(r.value,r);if(i.async)return(n instanceof Promise?n:Promise.resolve(n)).then(e=>(r.value=e,r));if(n instanceof Promise)throw new ab;return r.value=n,r}});function ui(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}let un=av("$ZodOptional",(e,t)=>{le.init(e,t),e._zod.optin="optional",e._zod.optout="optional",aL(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),aL(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${aP(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(t=>ui(t,e.value)):ui(i,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}}),ua=av("$ZodNullable",(e,t)=>{le.init(e,t),aL(e._zod,"optin",()=>t.innerType._zod.optin),aL(e._zod,"optout",()=>t.innerType._zod.optout),aL(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${aP(e.source)}|null)$`):void 0}),aL(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),us=av("$ZodDefault",(e,t)=>{le.init(e,t),e._zod.optin="optional",aL(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);if(void 0===e.value)return e.value=t.defaultValue,e;let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(e=>uo(e,t)):uo(i,t)}});function uo(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let ul=av("$ZodPrefault",(e,t)=>{le.init(e,t),e._zod.optin="optional",aL(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>("backward"===r.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),uu=av("$ZodNonOptional",(e,t)=>{le.init(e,t),aL(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,i)=>{let n=t.innerType._zod.run(r,i);return n instanceof Promise?n.then(t=>uc(t,e)):uc(n,e)}});function uc(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let ud=av("$ZodSuccess",(e,t)=>{le.init(e,t),e._zod.parse=(e,r)=>{if("backward"===r.direction)throw new aw("ZodSuccess");let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(t=>(e.value=0===t.issues.length,e)):(e.value=0===i.issues.length,e)}}),uh=av("$ZodCatch",(e,t)=>{le.init(e,t),aL(e._zod,"optin",()=>t.innerType._zod.optin),aL(e._zod,"optout",()=>t.innerType._zod.optout),aL(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(i=>(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>su(e,r,ax()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>su(e,r,ax()))},input:e.value}),e.issues=[]),e)}}),up=av("$ZodNaN",(e,t)=>{le.init(e,t),e._zod.parse=(t,r)=>("number"==typeof t.value&&Number.isNaN(t.value)||t.issues.push({input:t.value,inst:e,expected:"nan",code:"invalid_type"}),t)}),um=av("$ZodPipe",(e,t)=>{le.init(e,t),aL(e._zod,"values",()=>t.in._zod.values),aL(e._zod,"optin",()=>t.in._zod.optin),aL(e._zod,"optout",()=>t.out._zod.optout),aL(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{if("backward"===r.direction){let i=t.out._zod.run(e,r);return i instanceof Promise?i.then(e=>uf(e,t.in,r)):uf(i,t.in,r)}let i=t.in._zod.run(e,r);return i instanceof Promise?i.then(e=>uf(e,t.out,r)):uf(i,t.out,r)}});function uf(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}let ug=av("$ZodCodec",(e,t)=>{le.init(e,t),aL(e._zod,"values",()=>t.in._zod.values),aL(e._zod,"optin",()=>t.in._zod.optin),aL(e._zod,"optout",()=>t.out._zod.optout),aL(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{if("forward"===(r.direction||"forward")){let i=t.in._zod.run(e,r);return i instanceof Promise?i.then(e=>uy(e,t,r)):uy(i,t,r)}{let i=t.out._zod.run(e,r);return i instanceof Promise?i.then(e=>uy(e,t,r)):uy(i,t,r)}}});function uy(e,t,r){if(e.issues.length)return e.aborted=!0,e;if("forward"===(r.direction||"forward")){let i=t.transform(e.value,e);return i instanceof Promise?i.then(i=>uv(e,i,t.out,r)):uv(e,i,t.out,r)}{let i=t.reverseTransform(e.value,e);return i instanceof Promise?i.then(i=>uv(e,i,t.in,r)):uv(e,i,t.in,r)}}function uv(e,t,r,i){return e.issues.length?(e.aborted=!0,e):r._zod.run({value:t,issues:e.issues},i)}let u_=av("$ZodReadonly",(e,t)=>{le.init(e,t),aL(e._zod,"propValues",()=>t.innerType._zod.propValues),aL(e._zod,"values",()=>t.innerType._zod.values),aL(e._zod,"optin",()=>t.innerType?._zod?.optin),aL(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(ub):ub(i)}});function ub(e){return e.value=Object.freeze(e.value),e}let uw=av("$ZodTemplateLiteral",(e,t)=>{le.init(e,t);let r=[];for(let e of t.parts)if("object"==typeof e&&null!==e){if(!e._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...e._zod.traits].shift()}`);let t=e._zod.pattern instanceof RegExp?e._zod.pattern.source:e._zod.pattern;if(!t)throw Error(`Invalid template literal part: ${e._zod.traits}`);let i=+!!t.startsWith("^"),n=t.endsWith("$")?t.length-1:t.length;r.push(t.slice(i,n))}else if(null===e||a0.has(typeof e))r.push(a1(`${e}`));else throw Error(`Invalid template literal part: ${e}`);e._zod.pattern=RegExp(`^${r.join("")}$`),e._zod.parse=(r,i)=>("string"!=typeof r.value?r.issues.push({input:r.value,inst:e,expected:"template_literal",code:"invalid_type"}):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(r.value)||r.issues.push({input:r.value,inst:e,code:"invalid_format",format:t.format??"template_literal",pattern:e._zod.pattern.source})),r)}),u$=av("$ZodFunction",(e,t)=>(le.init(e,t),e._def=t,e._zod.def=t,e.implement=t=>{if("function"!=typeof t)throw Error("implement() must be called with a function");return function(...r){let i=Reflect.apply(t,this,e._def.input?sA(e._def.input,r):r);return e._def.output?sA(e._def.output,i):i}},e.implementAsync=t=>{if("function"!=typeof t)throw Error("implementAsync() must be called with a function");return async function(...r){let i=e._def.input?await sC(e._def.input,r):r,n=await Reflect.apply(t,this,i);return e._def.output?await sC(e._def.output,n):n}},e._zod.parse=(t,r)=>("function"!=typeof t.value?t.issues.push({code:"invalid_type",expected:"function",input:t.value,inst:e}):e._def.output&&"promise"===e._def.output._zod.def.type?t.value=e.implementAsync(t.value):t.value=e.implement(t.value),t),e.input=(...t)=>{let r=e.constructor;return new r(Array.isArray(t[0])?{type:"function",input:new l4({type:"tuple",items:t[0],rest:t[1]}),output:e._def.output}:{type:"function",input:t[0],output:e._def.output})},e.output=t=>new e.constructor({type:"function",input:e._def.input,output:t}),e)),ux=av("$ZodPromise",(e,t)=>{le.init(e,t),e._zod.parse=(e,r)=>Promise.resolve(e.value).then(e=>t.innerType._zod.run({value:e,issues:[]},r))}),uk=av("$ZodLazy",(e,t)=>{le.init(e,t),aL(e._zod,"innerType",()=>t.getter()),aL(e._zod,"pattern",()=>e._zod.innerType?._zod?.pattern),aL(e._zod,"propValues",()=>e._zod.innerType?._zod?.propValues),aL(e._zod,"optin",()=>e._zod.innerType?._zod?.optin??void 0),aL(e._zod,"optout",()=>e._zod.innerType?._zod?.optout??void 0),e._zod.parse=(t,r)=>e._zod.innerType._zod.run(t,r)}),uI=av("$ZodCustom",(e,t)=>{oz.init(e,t),le.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let i=r.value,n=t.fn(i);if(n instanceof Promise)return n.then(t=>uE(t,r,i,e));uE(n,r,i,e)}});function uE(e,t,r,i){if(!e){let e={code:"custom",input:r,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(e.params=i._zod.def.params),t.issues.push(sh(e))}}function uS(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}function uO(){let e,t;return{localeError:(e={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Invalid input: expected ${r.expected}, received ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${a9(r.values[0])}`;return`Invalid option: expected one of ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Too big: expected ${r.origin??"value"} to have ${t}${r.maximum.toString()} ${i.unit??"elements"}`;return`Too big: expected ${r.origin??"value"} to be ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Too small: expected ${r.origin} to have ${t}${r.minimum.toString()} ${i.unit}`;return`Too small: expected ${r.origin} to be ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Invalid string: must start with "${r.prefix}"`;if("ends_with"===r.format)return`Invalid string: must end with "${r.suffix}"`;if("includes"===r.format)return`Invalid string: must include "${r.includes}"`;if("regex"===r.format)return`Invalid string: must match pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${r.divisor}`;case"unrecognized_keys":return`Unrecognized key${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Invalid key in ${r.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${r.origin}`}})}}function uT(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:" base64",base64url:" base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  ${a9(r.values[0])}`;return`  ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`  ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`  ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  "${r.prefix}"`;if("ends_with"===r.format)return`  "${r.suffix}"`;if("includes"===r.format)return`  "${r.includes}"`;if("regex"===r.format)return`  ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return`  ${r.divisor}`;case"unrecognized_keys":return` ${aA(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":default:return``;case"invalid_element":return` ${r.origin}`}})}}e.s(["$ZodAny",0,lD,"$ZodArray",0,lq,"$ZodBase64",0,lk,"$ZodBase64URL",0,lE,"$ZodBigInt",0,lP,"$ZodBigIntFormat",0,lR,"$ZodBoolean",0,lj,"$ZodCIDRv4",0,lw,"$ZodCIDRv6",0,l$,"$ZodCUID",0,lu,"$ZodCUID2",0,lc,"$ZodCatch",0,uh,"$ZodCodec",0,ug,"$ZodCustom",0,uI,"$ZodCustomStringFormat",0,lA,"$ZodDate",0,lB,"$ZodDefault",0,us,"$ZodDiscriminatedUnion",0,lQ,"$ZodE164",0,lS,"$ZodEmail",0,la,"$ZodEmoji",0,lo,"$ZodEnum",0,l7,"$ZodFile",0,ut,"$ZodFunction",0,u$,"$ZodGUID",0,li,"$ZodIPv4",0,lv,"$ZodIPv6",0,l_,"$ZodISODate",0,lf,"$ZodISODateTime",0,lm,"$ZodISODuration",0,ly,"$ZodISOTime",0,lg,"$ZodIntersection",0,l0,"$ZodJWT",0,lT,"$ZodKSUID",0,lp,"$ZodLazy",0,uk,"$ZodLiteral",0,ue,"$ZodMAC",0,lb,"$ZodMap",0,l9,"$ZodNaN",0,up,"$ZodNanoID",0,ll,"$ZodNever",0,lZ,"$ZodNonOptional",0,uu,"$ZodNull",0,lz,"$ZodNullable",0,ua,"$ZodNumber",0,lN,"$ZodNumberFormat",0,lC,"$ZodObject",0,lH,"$ZodObjectJIT",0,lK,"$ZodOptional",0,un,"$ZodPipe",0,um,"$ZodPrefault",0,ul,"$ZodPromise",0,ux,"$ZodReadonly",0,u_,"$ZodRecord",0,l6,"$ZodSet",0,l3,"$ZodString",0,lt,"$ZodStringFormat",0,lr,"$ZodSuccess",0,ud,"$ZodSymbol",0,lU,"$ZodTemplateLiteral",0,uw,"$ZodTransform",0,ur,"$ZodTuple",0,l4,"$ZodType",0,le,"$ZodULID",0,ld,"$ZodURL",0,ls,"$ZodUUID",0,ln,"$ZodUndefined",0,lL,"$ZodUnion",0,lY,"$ZodUnknown",0,lM,"$ZodVoid",0,lF,"$ZodXID",0,lh,"isValidBase64",()=>lx,"isValidBase64URL",()=>lI,"isValidJWT",()=>lO],39510);let uA=(e,t)=>{switch(e){case"number":return Number.isNaN(t)?"NaN":"skaiius";case"bigint":return"sveikasis skaiius";case"string":return"eilut";case"boolean":return"login reikm";case"undefined":case"void":return"neapibrta reikm";case"function":return"funkcija";case"symbol":return"simbolis";case"object":if(void 0===t)return"neinomas objektas";if(null===t)return"nulin reikm";if(Array.isArray(t))return"masyvas";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name;return"objektas";case"null":return"nulin reikm"}return e},uN=e=>e.charAt(0).toUpperCase()+e.slice(1);function uC(e){let t=Math.abs(e),r=t%10,i=t%100;return i>=11&&i<=19||0===r?"many":1===r?"one":"few"}function uj(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}function uP(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :  ${a9(r.values[0])}`;return` :    ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ,  ${r.origin??""} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??""}`;return` : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ,  ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return` : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}}e.s([],79113);let uR=Symbol("ZodOutput"),uU=Symbol("ZodInput");class uL{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};delete r.id;let i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function uz(){return new uL}(_=globalThis).__zod_globalRegistry??(_.__zod_globalRegistry=uz());let uD=globalThis.__zod_globalRegistry;function uM(e,t){return new e({type:"string",...a2(t)})}function uZ(e,t){return new e({type:"string",coerce:!0,...a2(t)})}function uF(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...a2(t)})}function uB(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...a2(t)})}function uV(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...a2(t)})}function uq(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...a2(t)})}function uG(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...a2(t)})}function uW(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...a2(t)})}function uJ(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...a2(t)})}function uH(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...a2(t)})}function uK(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...a2(t)})}function uX(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...a2(t)})}function uY(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...a2(t)})}function uQ(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...a2(t)})}function u0(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...a2(t)})}function u1(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...a2(t)})}function u4(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...a2(t)})}function u2(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...a2(t)})}function u6(e,t){return new e({type:"string",format:"mac",check:"string_format",abort:!1,...a2(t)})}function u9(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...a2(t)})}function u5(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...a2(t)})}function u3(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...a2(t)})}function u8(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...a2(t)})}function u7(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...a2(t)})}function ce(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...a2(t)})}e.s(["$ZodRegistry",()=>uL,"$input",0,uU,"$output",0,uR,"globalRegistry",0,uD,"registry",()=>uz],52637);let ct={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function cr(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...a2(t)})}function ci(e,t){return new e({type:"string",format:"date",check:"string_format",...a2(t)})}function cn(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...a2(t)})}function ca(e,t){return new e({type:"string",format:"duration",check:"string_format",...a2(t)})}function cs(e,t){return new e({type:"number",checks:[],...a2(t)})}function co(e,t){return new e({type:"number",coerce:!0,checks:[],...a2(t)})}function cl(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...a2(t)})}function cu(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float32",...a2(t)})}function cc(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float64",...a2(t)})}function cd(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"int32",...a2(t)})}function ch(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"uint32",...a2(t)})}function cp(e,t){return new e({type:"boolean",...a2(t)})}function cm(e,t){return new e({type:"boolean",coerce:!0,...a2(t)})}function cf(e,t){return new e({type:"bigint",...a2(t)})}function cg(e,t){return new e({type:"bigint",coerce:!0,...a2(t)})}function cy(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...a2(t)})}function cv(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...a2(t)})}function c_(e,t){return new e({type:"symbol",...a2(t)})}function cb(e,t){return new e({type:"undefined",...a2(t)})}function cw(e,t){return new e({type:"null",...a2(t)})}function c$(e){return new e({type:"any"})}function cx(e){return new e({type:"unknown"})}function ck(e,t){return new e({type:"never",...a2(t)})}function cI(e,t){return new e({type:"void",...a2(t)})}function cE(e,t){return new e({type:"date",...a2(t)})}function cS(e,t){return new e({type:"date",coerce:!0,...a2(t)})}function cO(e,t){return new e({type:"nan",...a2(t)})}function cT(e,t){return new oM({check:"less_than",...a2(t),value:e,inclusive:!1})}function cA(e,t){return new oM({check:"less_than",...a2(t),value:e,inclusive:!0})}function cN(e,t){return new oZ({check:"greater_than",...a2(t),value:e,inclusive:!1})}function cC(e,t){return new oZ({check:"greater_than",...a2(t),value:e,inclusive:!0})}function cj(e){return cN(0,e)}function cP(e){return cT(0,e)}function cR(e){return cA(0,e)}function cU(e){return cC(0,e)}function cL(e,t){return new oF({check:"multiple_of",...a2(t),value:e})}function cz(e,t){return new oq({check:"max_size",...a2(t),maximum:e})}function cD(e,t){return new oG({check:"min_size",...a2(t),minimum:e})}function cM(e,t){return new oW({check:"size_equals",...a2(t),size:e})}function cZ(e,t){return new oJ({check:"max_length",...a2(t),maximum:e})}function cF(e,t){return new oH({check:"min_length",...a2(t),minimum:e})}function cB(e,t){return new oK({check:"length_equals",...a2(t),length:e})}function cV(e,t){return new oY({check:"string_format",format:"regex",...a2(t),pattern:e})}function cq(e){return new oQ({check:"string_format",format:"lowercase",...a2(e)})}function cG(e){return new o0({check:"string_format",format:"uppercase",...a2(e)})}function cW(e,t){return new o1({check:"string_format",format:"includes",...a2(t),includes:e})}function cJ(e,t){return new o4({check:"string_format",format:"starts_with",...a2(t),prefix:e})}function cH(e,t){return new o2({check:"string_format",format:"ends_with",...a2(t),suffix:e})}function cK(e,t,r){return new o9({check:"property",property:e,schema:t,...a2(r)})}function cX(e,t){return new o5({check:"mime_type",mime:e,...a2(t)})}function cY(e){return new o3({check:"overwrite",tx:e})}function cQ(e){return cY(t=>t.normalize(e))}function c0(){return cY(e=>e.trim())}function c1(){return cY(e=>e.toLowerCase())}function c4(){return cY(e=>e.toUpperCase())}function c2(){return cY(e=>aG(e))}function c6(e,t,r){return new e({type:"array",element:t,...a2(r)})}function c9(e,t,r){return new e({type:"union",options:t,...a2(r)})}function c5(e,t,r,i){return new e({type:"union",options:r,discriminator:t,...a2(i)})}function c3(e,t,r){return new e({type:"intersection",left:t,right:r})}function c8(e,t,r,i){let n=r instanceof le,a=n?i:r;return new e({type:"tuple",items:t,rest:n?r:null,...a2(a)})}function c7(e,t,r,i){return new e({type:"record",keyType:t,valueType:r,...a2(i)})}function de(e,t,r,i){return new e({type:"map",keyType:t,valueType:r,...a2(i)})}function dt(e,t,r){return new e({type:"set",valueType:t,...a2(r)})}function dr(e,t,r){return new e({type:"enum",entries:Array.isArray(t)?Object.fromEntries(t.map(e=>[e,e])):t,...a2(r)})}function di(e,t,r){return new e({type:"enum",entries:t,...a2(r)})}function dn(e,t,r){return new e({type:"literal",values:Array.isArray(t)?t:[t],...a2(r)})}function da(e,t){return new e({type:"file",...a2(t)})}function ds(e,t){return new e({type:"transform",transform:t})}function dl(e,t){return new e({type:"optional",innerType:t})}function du(e,t){return new e({type:"nullable",innerType:t})}function dc(e,t,r){return new e({type:"default",innerType:t,get defaultValue(){return"function"==typeof r?r():aX(r)}})}function dd(e,t,r){return new e({type:"nonoptional",innerType:t,...a2(r)})}function dh(e,t){return new e({type:"success",innerType:t})}function dp(e,t,r){return new e({type:"catch",innerType:t,catchValue:"function"==typeof r?r:()=>r})}function dm(e,t,r){return new e({type:"pipe",in:t,out:r})}function df(e,t){return new e({type:"readonly",innerType:t})}function dg(e,t,r){return new e({type:"template_literal",parts:t,...a2(r)})}function dy(e,t){return new e({type:"lazy",getter:t})}function dv(e,t){return new e({type:"promise",innerType:t})}function d_(e,t,r){let i=a2(r);return i.abort??(i.abort=!0),new e({type:"custom",check:"custom",fn:t,...i})}function db(e,t,r){return new e({type:"custom",check:"custom",fn:t,...a2(r)})}function dw(e){let t=d$(r=>(r.addIssue=e=>{"string"==typeof e?r.issues.push(sh(e,r.value,t._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=r.value),e.inst??(e.inst=t),e.continue??(e.continue=!t._zod.def.abort),r.issues.push(sh(e)))},e(r.value,r)));return t}function d$(e,t){let r=new oz({check:"custom",...a2(t)});return r._zod.check=e,r}function dx(e){let t=new oz({check:"describe"});return t._zod.onattach=[t=>{let r=uD.get(t)??{};uD.add(t,{...r,description:e})}],t._zod.check=()=>{},t}function dk(e){let t=new oz({check:"meta"});return t._zod.onattach=[t=>{let r=uD.get(t)??{};uD.add(t,{...r,...e})}],t._zod.check=()=>{},t}function dI(e,t){let r=a2(t),i=r.truthy??["true","1","yes","on","y","enabled"],n=r.falsy??["false","0","no","off","n","disabled"];"sensitive"!==r.case&&(i=i.map(e=>"string"==typeof e?e.toLowerCase():e),n=n.map(e=>"string"==typeof e?e.toLowerCase():e));let a=new Set(i),s=new Set(n),o=e.Codec??ug,l=e.Boolean??lj,u=new o({type:"pipe",in:new(e.String??lt)({type:"string",error:r.error}),out:new l({type:"boolean",error:r.error}),transform:(e,t)=>{let i=e;return"sensitive"!==r.case&&(i=i.toLowerCase()),!!a.has(i)||!s.has(i)&&(t.issues.push({code:"invalid_value",expected:"stringbool",values:[...a,...s],input:t.value,inst:u,continue:!1}),{})},reverseTransform:(e,t)=>!0===e?i[0]||"true":n[0]||"false",error:r.error});return u}function dE(e,t,r,i={}){let n=a2(i),a={...a2(i),check:"string_format",type:"string",format:t,fn:"function"==typeof r?r:e=>r.test(e),...n};return r instanceof RegExp&&(a.pattern=r),new e(a)}e.s(["TimePrecision",0,ct,"_any",()=>c$,"_array",()=>c6,"_base64",()=>u3,"_base64url",()=>u8,"_bigint",()=>cf,"_boolean",()=>cp,"_catch",()=>dp,"_check",()=>d$,"_cidrv4",()=>u9,"_cidrv6",()=>u5,"_coercedBigint",()=>cg,"_coercedBoolean",()=>cm,"_coercedDate",()=>cS,"_coercedNumber",()=>co,"_coercedString",()=>uZ,"_cuid",()=>uX,"_cuid2",()=>uY,"_custom",()=>d_,"_date",()=>cE,"_default",()=>dc,"_discriminatedUnion",()=>c5,"_e164",()=>u7,"_email",()=>uF,"_emoji",()=>uH,"_endsWith",()=>cH,"_enum",()=>dr,"_file",()=>da,"_float32",()=>cu,"_float64",()=>cc,"_gt",()=>cN,"_gte",()=>cC,"_guid",()=>uB,"_includes",()=>cW,"_int",()=>cl,"_int32",()=>cd,"_int64",()=>cy,"_intersection",()=>c3,"_ipv4",()=>u4,"_ipv6",()=>u2,"_isoDate",()=>ci,"_isoDateTime",()=>cr,"_isoDuration",()=>ca,"_isoTime",()=>cn,"_jwt",()=>ce,"_ksuid",()=>u1,"_lazy",()=>dy,"_length",()=>cB,"_literal",()=>dn,"_lowercase",()=>cq,"_lt",()=>cT,"_lte",()=>cA,"_mac",()=>u6,"_map",()=>de,"_max",()=>cA,"_maxLength",()=>cZ,"_maxSize",()=>cz,"_mime",()=>cX,"_min",()=>cC,"_minLength",()=>cF,"_minSize",()=>cD,"_multipleOf",()=>cL,"_nan",()=>cO,"_nanoid",()=>uK,"_nativeEnum",()=>di,"_negative",()=>cP,"_never",()=>ck,"_nonnegative",()=>cU,"_nonoptional",()=>dd,"_nonpositive",()=>cR,"_normalize",()=>cQ,"_null",()=>cw,"_nullable",()=>du,"_number",()=>cs,"_optional",()=>dl,"_overwrite",()=>cY,"_pipe",()=>dm,"_positive",()=>cj,"_promise",()=>dv,"_property",()=>cK,"_readonly",()=>df,"_record",()=>c7,"_refine",()=>db,"_regex",()=>cV,"_set",()=>dt,"_size",()=>cM,"_slugify",()=>c2,"_startsWith",()=>cJ,"_string",()=>uM,"_stringFormat",()=>dE,"_stringbool",()=>dI,"_success",()=>dh,"_superRefine",()=>dw,"_symbol",()=>c_,"_templateLiteral",()=>dg,"_toLowerCase",()=>c1,"_toUpperCase",()=>c4,"_transform",()=>ds,"_trim",()=>c0,"_tuple",()=>c8,"_uint32",()=>ch,"_uint64",()=>cv,"_ulid",()=>uQ,"_undefined",()=>cb,"_union",()=>c9,"_unknown",()=>cx,"_uppercase",()=>cG,"_url",()=>uJ,"_uuid",()=>uV,"_uuidv4",()=>uq,"_uuidv6",()=>uG,"_uuidv7",()=>uW,"_void",()=>cI,"_xid",()=>u0,"describe",()=>dx,"meta",()=>dk],62061);class dS{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??uD,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let i=e._zod.def,n=this.seen.get(e);if(n)return n.count++,t.schemaPath.includes(e)&&(n.cycle=t.path),n.schema;let a={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,a);let s=e._zod.toJSONSchema?.();if(s)a.schema=s;else{let r={...t,schemaPath:[...t.schemaPath,e],path:t.path},n=e._zod.parent;if(n)a.ref=n,this.process(n,r),this.seen.get(n).isParent=!0;else{let t=a.schema;switch(i.type){case"string":{t.type="string";let{minimum:r,maximum:i,format:n,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof i&&(t.maxLength=i),n&&(t.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[n]??n,""===t.format&&delete t.format),o&&(t.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?t.pattern=e[0].source:e.length>1&&(a.schema.allOf=[...e.map(e=>({..."draft-7"===this.target||"draft-4"===this.target||"openapi-3.0"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:i,format:n,multipleOf:a,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof n&&n.includes("int")?t.type="integer":t.type="number","number"==typeof o&&("draft-4"===this.target||"openapi-3.0"===this.target?(t.minimum=o,t.exclusiveMinimum=!0):t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&"draft-4"!==this.target&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&("draft-4"===this.target||"openapi-3.0"===this.target?(t.maximum=s,t.exclusiveMaximum=!0):t.exclusiveMaximum=s),"number"==typeof i&&(t.maximum=i,"number"==typeof s&&"draft-4"!==this.target&&(s<=i?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof a&&(t.multipleOf=a);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"null":"openapi-3.0"===this.target?(t.type="string",t.nullable=!0,t.enum=[null]):t.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"never":t.not={};break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:n,maximum:a}=e._zod.bag;"number"==typeof n&&(t.minItems=n),"number"==typeof a&&(t.maxItems=a),t.type="array",t.items=this.process(i.element,{...r,path:[...r.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=i.shape;for(let i in e)t.properties[i]=this.process(e[i],{...r,path:[...r.path,"properties",i]});let n=new Set([...new Set(Object.keys(e))].filter(e=>{let t=i.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));n.size>0&&(t.required=Array.from(n)),i.catchall?._zod.def.type==="never"?t.additionalProperties=!1:i.catchall?i.catchall&&(t.additionalProperties=this.process(i.catchall,{...r,path:[...r.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":{let e=void 0!==i.discriminator,n=i.options.map((t,i)=>this.process(t,{...r,path:[...r.path,e?"oneOf":"anyOf",i]}));e?t.oneOf=n:t.anyOf=n;break}case"intersection":{let e=this.process(i.left,{...r,path:[...r.path,"allOf",0]}),n=this.process(i.right,{...r,path:[...r.path,"allOf",1]}),a=e=>"allOf"in e&&1===Object.keys(e).length;t.allOf=[...a(e)?e.allOf:[e],...a(n)?n.allOf:[n]];break}case"tuple":{t.type="array";let n="draft-2020-12"===this.target?"prefixItems":"items",a="draft-2020-12"===this.target||"openapi-3.0"===this.target?"items":"additionalItems",s=i.items.map((e,t)=>this.process(e,{...r,path:[...r.path,n,t]})),o=i.rest?this.process(i.rest,{...r,path:[...r.path,a,..."openapi-3.0"===this.target?[i.items.length]:[]]}):null;"draft-2020-12"===this.target?(t.prefixItems=s,o&&(t.items=o)):"openapi-3.0"===this.target?(t.items={anyOf:s},o&&t.items.anyOf.push(o),t.minItems=s.length,o||(t.maxItems=s.length)):(t.items=s,o&&(t.additionalItems=o));let{minimum:l,maximum:u}=e._zod.bag;"number"==typeof l&&(t.minItems=l),"number"==typeof u&&(t.maxItems=u);break}case"record":t.type="object",("draft-7"===this.target||"draft-2020-12"===this.target)&&(t.propertyNames=this.process(i.keyType,{...r,path:[...r.path,"propertyNames"]})),t.additionalProperties=this.process(i.valueType,{...r,path:[...r.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let e=aT(i.entries);e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),t.enum=e;break}case"literal":{let e=[];for(let t of i.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else e.push(Number(t));else e.push(t);if(0===e.length);else if(1===e.length){let r=e[0];t.type=null===r?"null":typeof r,"draft-4"===this.target||"openapi-3.0"===this.target?t.enum=[r]:t.const=r}else e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),e.every(e=>"boolean"==typeof e)&&(t.type="string"),e.every(e=>null===e)&&(t.type="null"),t.enum=e;break}case"file":{let r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:i,maximum:n,mime:a}=e._zod.bag;void 0!==i&&(r.minLength=i),void 0!==n&&(r.maxLength=n),a?1===a.length?(r.contentMediaType=a[0],Object.assign(t,r)):t.anyOf=a.map(e=>({...r,contentMediaType:e})):Object.assign(t,r);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":{let e=this.process(i.innerType,r);"openapi-3.0"===this.target?(a.ref=i.innerType,t.nullable=!0):t.anyOf=[e,{type:"null"}];break}case"nonoptional":case"promise":case"optional":this.process(i.innerType,r),a.ref=i.innerType;break;case"default":this.process(i.innerType,r),a.ref=i.innerType,t.default=JSON.parse(JSON.stringify(i.defaultValue));break;case"prefault":this.process(i.innerType,r),a.ref=i.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break;case"catch":{let e;this.process(i.innerType,r),a.ref=i.innerType;try{e=i.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?"transform"===i.in._zod.def.type?i.out:i.in:i.out;this.process(e,r),a.ref=e;break}case"readonly":this.process(i.innerType,r),a.ref=i.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,r),a.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema");break;case"function":if("throw"===this.unrepresentable)throw Error("Function types cannot be represented in JSON Schema")}}}let o=this.metadataRegistry.get(e);return o&&Object.assign(a.schema,o),"input"===this.io&&function e(t,r){let i=r??{seen:new Set};if(i.seen.has(t))return!1;i.seen.add(t);let n=t._zod.def;if("transform"===n.type)return!0;if("array"===n.type)return e(n.element,i);if("set"===n.type)return e(n.valueType,i);if("lazy"===n.type)return e(n.getter(),i);if("promise"===n.type||"optional"===n.type||"nonoptional"===n.type||"nullable"===n.type||"readonly"===n.type||"default"===n.type||"prefault"===n.type)return e(n.innerType,i);if("intersection"===n.type)return e(n.left,i)||e(n.right,i);if("record"===n.type||"map"===n.type)return e(n.keyType,i)||e(n.valueType,i);if("pipe"===n.type)return e(n.in,i)||e(n.out,i);if("object"===n.type){for(let t in n.shape)if(e(n.shape[t],i))return!0;return!1}if("union"===n.type){for(let t of n.options)if(e(t,i))return!0;return!1}if("tuple"===n.type){for(let t of n.items)if(e(t,i))return!0;if(n.rest&&e(n.rest,i))return!0}return!1}(e)&&(delete a.schema.examples,delete a.schema.default),"input"===this.io&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw Error("Unprocessed schema. This is a bug in Zod.");let n=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let i=r.external.registry.get(e[0])?.id,n=r.external.uri??(e=>e);if(i)return{ref:n(i)};let a=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=a,{defId:a,ref:`${n("__shared")}#/${t}/${a}`}}if(e[1]===i)return{ref:"#"};let n=`#/${t}/`,a=e[1].schema.id??`__schema${this.counter++}`;return{defId:a,ref:n+a}},a=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:i}=n(e);t.def={...t.schema},i&&(t.defId=i);let a=t.schema;for(let e in a)delete a[e];a.$ref=r};if("throw"===r.cycles)for(let e of this.seen.entries()){let t=e[1];if(t.cycle)throw Error(`Cycle detected: #/${t.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let t of this.seen.entries()){let i=t[1];if(e===t[0]){a(t);continue}if(r.external){let i=r.external.registry.get(t[0])?.id;if(e!==t[0]&&i){a(t);continue}}if(this.metadataRegistry.get(t[0])?.id||i.cycle||i.count>1&&"ref"===r.reused){a(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),i=r.def??r.schema,n={...i};if(null===r.ref)return;let a=r.ref;if(r.ref=null,a){s(a,t);let e=this.seen.get(a).schema;e.$ref&&("draft-7"===t.target||"draft-4"===t.target||"openapi-3.0"===t.target)?(i.allOf=i.allOf??[],i.allOf.push(e)):(Object.assign(i,e),Object.assign(i,n))}r.isParent||this.override({zodSchema:e,jsonSchema:i,path:r.path??[]})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};if("draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":"draft-4"===this.target?o.$schema="http://json-schema.org/draft-04/schema#":"openapi-3.0"===this.target||console.warn(`Invalid target: ${this.target}`),r.external?.uri){let t=r.external.registry.get(e)?.id;if(!t)throw Error("Schema is missing an `id` property");o.$id=r.external.uri(t)}Object.assign(o,i.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}r.external||Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}function dO(e,t){if(e instanceof uL){let r=new dS(t),i={};for(let t of e._idmap.entries()){let[e,i]=t;r.process(i)}let n={},a={registry:e,uri:t?.uri,defs:i};for(let i of e._idmap.entries()){let[e,s]=i;n[e]=r.emit(s,{...t,external:a})}return Object.keys(i).length>0&&(n.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:i}),{schemas:n}}let r=new dS(t);return r.process(e),r.emit(e,t)}e.s(["JSONSchemaGenerator",()=>dS,"toJSONSchema",()=>dO],7159),e.s([],33145),e.s([],82811),e.i(39510),e.s(["$ZodAny",0,lD,"$ZodArray",0,lq,"$ZodBase64",0,lk,"$ZodBase64URL",0,lE,"$ZodBigInt",0,lP,"$ZodBigIntFormat",0,lR,"$ZodBoolean",0,lj,"$ZodCIDRv4",0,lw,"$ZodCIDRv6",0,l$,"$ZodCUID",0,lu,"$ZodCUID2",0,lc,"$ZodCatch",0,uh,"$ZodCodec",0,ug,"$ZodCustom",0,uI,"$ZodCustomStringFormat",0,lA,"$ZodDate",0,lB,"$ZodDefault",0,us,"$ZodDiscriminatedUnion",0,lQ,"$ZodE164",0,lS,"$ZodEmail",0,la,"$ZodEmoji",0,lo,"$ZodEnum",0,l7,"$ZodFile",0,ut,"$ZodFunction",0,u$,"$ZodGUID",0,li,"$ZodIPv4",0,lv,"$ZodIPv6",0,l_,"$ZodISODate",0,lf,"$ZodISODateTime",0,lm,"$ZodISODuration",0,ly,"$ZodISOTime",0,lg,"$ZodIntersection",0,l0,"$ZodJWT",0,lT,"$ZodKSUID",0,lp,"$ZodLazy",0,uk,"$ZodLiteral",0,ue,"$ZodMAC",0,lb,"$ZodMap",0,l9,"$ZodNaN",0,up,"$ZodNanoID",0,ll,"$ZodNever",0,lZ,"$ZodNonOptional",0,uu,"$ZodNull",0,lz,"$ZodNullable",0,ua,"$ZodNumber",0,lN,"$ZodNumberFormat",0,lC,"$ZodObject",0,lH,"$ZodObjectJIT",0,lK,"$ZodOptional",0,un,"$ZodPipe",0,um,"$ZodPrefault",0,ul,"$ZodPromise",0,ux,"$ZodReadonly",0,u_,"$ZodRecord",0,l6,"$ZodSet",0,l3,"$ZodString",0,lt,"$ZodStringFormat",0,lr,"$ZodSuccess",0,ud,"$ZodSymbol",0,lU,"$ZodTemplateLiteral",0,uw,"$ZodTransform",0,ur,"$ZodTuple",0,l4,"$ZodType",0,le,"$ZodULID",0,ld,"$ZodURL",0,ls,"$ZodUUID",0,ln,"$ZodUndefined",0,lL,"$ZodUnion",0,lY,"$ZodUnknown",0,lM,"$ZodVoid",0,lF,"$ZodXID",0,lh,"clone",()=>a4,"isValidBase64",()=>lx,"isValidBase64URL",()=>lI,"isValidJWT",()=>lO],62429);var dT=e.i(86618),dT=dT;function dA(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function dN(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}function dC(e){return dA(e)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),dN(e)}function dj(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&!!(dA(e)||dN(e))}function dP(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodLiteral"===e._def.typeName||!1}function dR(e){return!!dA(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"literal"===e._zod.def.type||!1)}function dU(e){return!!(dP(e)||dR(e))}async function dL(e,t){if(dA(e))try{let r=await sC(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(dN(e))return await e.safeParseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function dz(e,t){if(dA(e))return await sC(e,t);if(dN(e))return await e.parseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function dD(e,t){if(dA(e))try{let r=sA(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(dN(e))return e.safeParse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function dM(e,t){if(dA(e))return sA(e,t);if(dN(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function dZ(e){return dA(e)?uD.get(e)?.description:dN(e)||"description"in e&&"string"==typeof e.description?e.description:void 0}function dF(e){if(!dj(e))return!1;if(dN(e)){let t=e._def;if("ZodObject"===t.typeName)return!e.shape||0===Object.keys(e.shape).length;if("ZodRecord"===t.typeName)return!0}if(dA(e)){let t=e._zod.def;if("object"===t.type)return!e.shape||0===Object.keys(e.shape).length;if("record"===t.type)return!0}return"object"==typeof e&&null!==e&&!("shape"in e)}function dB(e){return!!dj(e)&&(dN(e)?"ZodString"===e._def.typeName:!!dA(e)&&"string"===e._zod.def.type)}function dV(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodObject"===e._def.typeName||!1}function dq(e){return!!dA(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type||!1)}function dG(e){return!!dA(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type||!1)}function dW(e){return!!dA(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"optional"===e._zod.def.type||!1)}function dJ(e){return!!dA(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"nullable"===e._zod.def.type||!1)}function dH(e){return!!(dV(e)||dq(e))}function dK(e){if(dN(e))return e.shape;if(dA(e))return e._zod.def.shape;throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function dX(e,t){if(dN(e))return e.extend(t);if(dA(e))return dT.extend(e,t);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function dY(e){if(dN(e))return e.partial();if(dA(e))return dT.partial(un,e,void 0);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function dQ(e,t=!1){if(dN(e))return e.strict();if(dq(e)){let r=e._zod.def.shape;if(t)for(let[i,n]of Object.entries(e._zod.def.shape)){if(dq(n)){let e=dQ(n,t);r[i]=e}else if(dG(n)){let e=n._zod.def.element;dq(e)&&(e=dQ(e,t)),r[i]=a4(n,{...n._zod.def,element:e})}else r[i]=n;let e=uD.get(n);e&&uD.add(r[i],e)}let i=a4(e,{...e._zod.def,shape:r,catchall:ck(lZ)}),n=uD.get(e);return n&&uD.add(i,n),i}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function d0(e){if(dN(e))try{let t=e.parse(void 0);return()=>t}catch{return}if(dA(e))try{let t=sA(e,void 0);return()=>t}catch{}}function d1(e,t=!1){return function e(t,r,i){let n=i.get(t);if(void 0!==n)return n;if(dN(t))return dN(t)&&"typeName"in t._def&&"ZodEffects"===t._def.typeName?e(t._def.schema,r,i):t;if(dA(t)){let n=t;if(dA(t)&&"pipe"===t._zod.def.type&&(n=e(t._zod.def.in,r,i)),r){if(dq(n)){let t=n._zod.def.shape;for(let[a,s]of Object.entries(n._zod.def.shape))t[a]=e(s,r,i);n=a4(n,{...n._zod.def,shape:t})}else if(dG(n)){let t=e(n._zod.def.element,r,i);n=a4(n,{...n._zod.def,element:t})}else if(dW(n)){let t=e(n._zod.def.innerType,r,i);n=a4(n,{...n._zod.def,innerType:t})}else if(dJ(n)){let t=e(n._zod.def.innerType,r,i);n=a4(n,{...n._zod.def,innerType:t})}}let a=uD.get(t);return a&&uD.add(n,a),i.set(t,n),n}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}(e,t,new WeakMap)}function d4(e,t){if(dN(e)){let r=dK(e),i={};for(let[e,n]of Object.entries(r))t(e,n)?i[e]=n.optional():i[e]=n;return e.extend(i)}if(dA(e)){let r=dK(e),i={...e._zod.def.shape};for(let[e,n]of Object.entries(r))t(e,n)&&(i[e]=new un({type:"optional",innerType:n}));let n=a4(e,{...e._zod.def,shape:i}),a=uD.get(e);return a&&uD.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function d2(e){return e instanceof Error&&("ZodError"===e.constructor.name||"$ZodError"===e.constructor.name)}let d6=Symbol("Let zodToJsonSchema decide on which parser to use"),d9={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},d5=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function d3(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?d5(t,e.currentPath):t.join("/")}}function d8(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function d7(e,t,r,i,n){e[t]=r,d8(e,t,i,n)}(h=b||(b={})).assertEqual=e=>{},h.assertIs=function(e){},h.assertNever=function(e){throw Error()},h.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},h.getValidEnumValues=e=>{let t=h.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return h.objectValues(r)},h.objectValues=e=>h.objectKeys(e).map(function(t){return e[t]}),h.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},h.find=(e,t)=>{for(let r of e)if(t(r))return r},h.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,h.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},h.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(w||(w={})).mergeShapes=(e,t)=>({...e,...t});let he=b.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ht=e=>{switch(typeof e){case"undefined":return he.undefined;case"string":return he.string;case"number":return Number.isNaN(e)?he.nan:he.number;case"boolean":return he.boolean;case"function":return he.function;case"bigint":return he.bigint;case"symbol":return he.symbol;case"object":if(Array.isArray(e))return he.array;if(null===e)return he.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return he.promise;if("undefined"!=typeof Map&&e instanceof Map)return he.map;if("undefined"!=typeof Set&&e instanceof Set)return he.set;if("undefined"!=typeof Date&&e instanceof Date)return he.date;return he.object;default:return he.unknown}};e.s(["ZodParsedType",0,he,"getParsedType",0,ht,"objectUtil",()=>w,"util",()=>b],42944);let hr=b.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),hi=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class hn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(i);else if("invalid_return_type"===n.code)i(n.returnTypeError);else if("invalid_arguments"===n.code)i(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof hn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,b.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t=Object.create(null),r=[];for(let i of this.issues)if(i.path.length>0){let r=i.path[0];t[r]=t[r]||[],t[r].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}hn.create=e=>new hn(e),e.s(["ZodError",()=>hn,"ZodIssueCode",0,hr,"quotelessJson",0,hi],15235);let ha=(e,t)=>{let r;switch(e.code){case hr.invalid_type:r=e.received===he.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case hr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,b.jsonStringifyReplacer)}`;break;case hr.unrecognized_keys:r=`Unrecognized key(s) in object: ${b.joinValues(e.keys,", ")}`;break;case hr.invalid_union:r="Invalid input";break;case hr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${b.joinValues(e.options)}`;break;case hr.invalid_enum_value:r=`Invalid enum value. Expected ${b.joinValues(e.options)}, received '${e.received}'`;break;case hr.invalid_arguments:r="Invalid function arguments";break;case hr.invalid_return_type:r="Invalid function return type";break;case hr.invalid_date:r="Invalid date";break;case hr.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:b.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case hr.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case hr.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case hr.custom:r="Invalid input";break;case hr.invalid_intersection_types:r="Intersection results could not be merged";break;case hr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case hr.not_finite:r="Number must be finite";break;default:r=t.defaultError,b.assertNever(e)}return{message:r}},hs=ha;function ho(e){hs=e}function hl(){return hs}e.s(["getErrorMap",()=>hl,"setErrorMap",()=>ho],85676);let hu=e=>{let{data:t,path:r,errorMaps:i,issueData:n}=e,a=[...r,...n.path||[]],s={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...n,path:a,message:o}},hc=[];function hd(e,t){let r=hs,i=hu({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===ha?void 0:ha].filter(e=>!!e)});e.common.issues.push(i)}class hh{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if("aborted"===i.status)return hp;"dirty"===i.status&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return hh.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:t,value:n}=i;if("aborted"===t.status||"aborted"===n.status)return hp;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||i.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let hp=Object.freeze({status:"aborted"}),hm=e=>({status:"dirty",value:e}),hf=e=>({status:"valid",value:e}),hg=e=>"aborted"===e.status,hy=e=>"dirty"===e.status,hv=e=>"valid"===e.status,h_=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,hm,"EMPTY_PATH",0,hc,"INVALID",0,hp,"OK",0,hf,"ParseStatus",()=>hh,"addIssueToContext",()=>hd,"isAborted",0,hg,"isAsync",0,h_,"isDirty",0,hy,"isValid",0,hv,"makeIssue",0,hu],84488),e.s([],91316),(p=$||($={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},p.toString=e=>"string"==typeof e?e:e?.message;class hb{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let hw=(e,t)=>{if(hv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new hn(e.common.issues);return this._error=t,this._error}}};function h$(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:n}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:a}=e;return"invalid_enum_value"===t.code?{message:a??n.defaultError}:void 0===n.data?{message:a??i??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:a??r??n.defaultError}},description:n}}class hx{get description(){return this._def.description}_getType(e){return ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new hh,ctx:{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(h_(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},i=this._parseSync({data:e,path:r.path,parent:r});return hw(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return hv(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>hv(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},i=this._parse({data:e,path:r.path,parent:r});return hw(r,await (h_(i)?i:Promise.resolve(i)))}refine(e,t){return this._refinement((r,i)=>{let n=e(r),a=()=>i.addIssue({code:hr.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new po({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return pl.create(this,this._def)}nullable(){return pu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return h0.create(this)}promise(){return ps.create(this,this._def)}or(e){return h4.create([this,e],this._def)}and(e){return h9.create(this,e,this._def)}transform(e){return new po({...h$(this._def),schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new pc({...h$(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:x.ZodDefault})}brand(){return new pm({typeName:x.ZodBranded,type:this,...h$(this._def)})}catch(e){return new pd({...h$(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:x.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return pf.create(this,e)}readonly(){return pg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let hk=/^c[^\s-]{8,}$/i,hI=/^[0-9a-z]+$/,hE=/^[0-9A-HJKMNP-TV-Z]{26}$/i,hS=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hO=/^[a-z0-9_-]{21}$/i,hT=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,hA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,hN=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,hC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,hj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,hP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,hR=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,hU=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hL=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,hz="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",hD=RegExp(`^${hz}$`);function hM(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function hZ(e){let t=`${hz}T${hM(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class hF extends hx{_parse(e){var t,r,i,n;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==he.string){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.string,received:t.parsedType}),hp}let s=new hh;for(let o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(hd(a=this._getOrReturnCtx(e,a),{code:hr.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if("max"===o.kind)e.data.length>o.value&&(hd(a=this._getOrReturnCtx(e,a),{code:hr.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if("length"===o.kind){let t=e.data.length>o.value,r=e.data.length<o.value;(t||r)&&(a=this._getOrReturnCtx(e,a),t?hd(a,{code:hr.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):r&&hd(a,{code:hr.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),s.dirty())}else if("email"===o.kind)hN.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"email",code:hr.invalid_string,message:o.message}),s.dirty());else if("emoji"===o.kind)u||(u=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),u.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:hr.invalid_string,message:o.message}),s.dirty());else if("uuid"===o.kind)hS.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:hr.invalid_string,message:o.message}),s.dirty());else if("nanoid"===o.kind)hO.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:hr.invalid_string,message:o.message}),s.dirty());else if("cuid"===o.kind)hk.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:hr.invalid_string,message:o.message}),s.dirty());else if("cuid2"===o.kind)hI.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:hr.invalid_string,message:o.message}),s.dirty());else if("ulid"===o.kind)hE.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:hr.invalid_string,message:o.message}),s.dirty());else if("url"===o.kind)try{new URL(e.data)}catch{hd(a=this._getOrReturnCtx(e,a),{validation:"url",code:hr.invalid_string,message:o.message}),s.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"regex",code:hr.invalid_string,message:o.message}),s.dirty())):"trim"===o.kind?e.data=e.data.trim():"includes"===o.kind?e.data.includes(o.value,o.position)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),s.dirty()):"toLowerCase"===o.kind?e.data=e.data.toLowerCase():"toUpperCase"===o.kind?e.data=e.data.toUpperCase():"startsWith"===o.kind?e.data.startsWith(o.value)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:{startsWith:o.value},message:o.message}),s.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:{endsWith:o.value},message:o.message}),s.dirty()):"datetime"===o.kind?hZ(o).test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:"datetime",message:o.message}),s.dirty()):"date"===o.kind?hD.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:"date",message:o.message}),s.dirty()):"time"===o.kind?RegExp(`^${hM(o)}$`).test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{code:hr.invalid_string,validation:"time",message:o.message}),s.dirty()):"duration"===o.kind?hA.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"duration",code:hr.invalid_string,message:o.message}),s.dirty()):"ip"===o.kind?(t=e.data,!(("v4"===(r=o.version)||!r)&&hC.test(t)||("v6"===r||!r)&&hP.test(t))&&1&&(hd(a=this._getOrReturnCtx(e,a),{validation:"ip",code:hr.invalid_string,message:o.message}),s.dirty())):"jwt"===o.kind?!function(e,t){if(!hT.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(i));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,o.alg)&&(hd(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:hr.invalid_string,message:o.message}),s.dirty()):"cidr"===o.kind?(i=e.data,!(("v4"===(n=o.version)||!n)&&hj.test(i)||("v6"===n||!n)&&hR.test(i))&&1&&(hd(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:hr.invalid_string,message:o.message}),s.dirty())):"base64"===o.kind?hU.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"base64",code:hr.invalid_string,message:o.message}),s.dirty()):"base64url"===o.kind?hL.test(e.data)||(hd(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:hr.invalid_string,message:o.message}),s.dirty()):b.assertNever(o);return{status:s.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:hr.invalid_string,...$.errToObj(r)})}_addCheck(e){return new hF({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...$.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...$.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...$.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...$.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...$.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...$.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new hF({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new hF({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new hF({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}hF.create=e=>new hF({checks:[],typeName:x.ZodString,coerce:e?.coerce??!1,...h$(e)});class hB extends hx{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==he.number){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.number,received:t.parsedType}),hp}let r=new hh;for(let i of this._def.checks)"int"===i.kind?b.isInteger(e.data)||(hd(t=this._getOrReturnCtx(e,t),{code:hr.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,i.value)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(hd(t=this._getOrReturnCtx(e,t),{code:hr.not_finite,message:i.message}),r.dirty()):b.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,r,i){return new hB({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:$.toString(i)}]})}_addCheck(e){return new hB({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&b.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}hB.create=e=>new hB({checks:[],typeName:x.ZodNumber,coerce:e?.coerce||!1,...h$(e)});class hV extends hx{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==he.bigint)return this._getInvalidInput(e);let r=new hh;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):b.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.bigint,received:t.parsedType}),hp}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,r,i){return new hV({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:$.toString(i)}]})}_addCheck(e){return new hV({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}hV.create=e=>new hV({checks:[],typeName:x.ZodBigInt,coerce:e?.coerce??!1,...h$(e)});class hq extends hx{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==he.boolean){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.boolean,received:t.parsedType}),hp}return hf(e.data)}}hq.create=e=>new hq({typeName:x.ZodBoolean,coerce:e?.coerce||!1,...h$(e)});class hG extends hx{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==he.date){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.date,received:t.parsedType}),hp}if(Number.isNaN(e.data.getTime()))return hd(this._getOrReturnCtx(e),{code:hr.invalid_date}),hp;let r=new hh;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(hd(t=this._getOrReturnCtx(e,t),{code:hr.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):b.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new hG({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}hG.create=e=>new hG({checks:[],coerce:e?.coerce||!1,typeName:x.ZodDate,...h$(e)});class hW extends hx{_parse(e){if(this._getType(e)!==he.symbol){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.symbol,received:t.parsedType}),hp}return hf(e.data)}}hW.create=e=>new hW({typeName:x.ZodSymbol,...h$(e)});class hJ extends hx{_parse(e){if(this._getType(e)!==he.undefined){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.undefined,received:t.parsedType}),hp}return hf(e.data)}}hJ.create=e=>new hJ({typeName:x.ZodUndefined,...h$(e)});class hH extends hx{_parse(e){if(this._getType(e)!==he.null){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.null,received:t.parsedType}),hp}return hf(e.data)}}hH.create=e=>new hH({typeName:x.ZodNull,...h$(e)});class hK extends hx{constructor(){super(...arguments),this._any=!0}_parse(e){return hf(e.data)}}hK.create=e=>new hK({typeName:x.ZodAny,...h$(e)});class hX extends hx{constructor(){super(...arguments),this._unknown=!0}_parse(e){return hf(e.data)}}hX.create=e=>new hX({typeName:x.ZodUnknown,...h$(e)});class hY extends hx{_parse(e){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.never,received:t.parsedType}),hp}}hY.create=e=>new hY({typeName:x.ZodNever,...h$(e)});class hQ extends hx{_parse(e){if(this._getType(e)!==he.undefined){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.void,received:t.parsedType}),hp}return hf(e.data)}}hQ.create=e=>new hQ({typeName:x.ZodVoid,...h$(e)});class h0 extends hx{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==he.array)return hd(t,{code:hr.invalid_type,expected:he.array,received:t.parsedType}),hp;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,n=t.data.length<i.exactLength.value;(e||n)&&(hd(t,{code:e?hr.too_big:hr.too_small,minimum:n?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(hd(t,{code:hr.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(hd(t,{code:hr.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new hb(t,e,t.path,r)))).then(e=>hh.mergeArray(r,e));let n=[...t.data].map((e,r)=>i.type._parseSync(new hb(t,e,t.path,r)));return hh.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new h0({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new h0({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new h0({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}}h0.create=(e,t)=>new h0({type:e,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray,...h$(t)});class h1 extends hx{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=b.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==he.object){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.object,received:t.parsedType}),hp}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof hY&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||a.push(e);let s=[];for(let e of n){let t=i[e],n=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new hb(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof hY){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&(hd(r,{code:hr.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let i=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new hb(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>hh.mergeObjectSync(t,e)):hh.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new h1({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let i=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:$.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new h1({...this._def,unknownKeys:"strip"})}passthrough(){return new h1({...this._def,unknownKeys:"passthrough"})}extend(e){return new h1({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new h1({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:x.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new h1({...this._def,catchall:e})}pick(e){let t={};for(let r of b.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new h1({...this._def,shape:()=>t})}omit(e){let t={};for(let r of b.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new h1({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof h1){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=pl.create(e(n))}return new h1({...t._def,shape:()=>r})}if(t instanceof h0)return new h0({...t._def,type:e(t.element)});if(t instanceof pl)return pl.create(e(t.unwrap()));if(t instanceof pu)return pu.create(e(t.unwrap()));if(t instanceof h5)return h5.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of b.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new h1({...this._def,shape:()=>t})}required(e){let t={};for(let r of b.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof pl;)e=e._def.innerType;t[r]=e}return new h1({...this._def,shape:()=>t})}keyof(){return pi(b.objectKeys(this.shape))}}h1.create=(e,t)=>new h1({shape:()=>e,unknownKeys:"strip",catchall:hY.create(),typeName:x.ZodObject,...h$(t)}),h1.strictCreate=(e,t)=>new h1({shape:()=>e,unknownKeys:"strict",catchall:hY.create(),typeName:x.ZodObject,...h$(t)}),h1.lazycreate=(e,t)=>new h1({shape:e,unknownKeys:"strip",catchall:hY.create(),typeName:x.ZodObject,...h$(t)});class h4 extends hx{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new hn(e.ctx.common.issues));return hd(t,{code:hr.invalid_union,unionErrors:r}),hp});{let e,i=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=i.map(e=>new hn(e));return hd(t,{code:hr.invalid_union,unionErrors:n}),hp}}get options(){return this._def.options}}h4.create=(e,t)=>new h4({options:e,typeName:x.ZodUnion,...h$(t)});let h2=e=>{if(e instanceof pt)return h2(e.schema);if(e instanceof po)return h2(e.innerType());if(e instanceof pr)return[e.value];if(e instanceof pn)return e.options;if(e instanceof pa)return b.objectValues(e.enum);else if(e instanceof pc)return h2(e._def.innerType);else if(e instanceof hJ)return[void 0];else if(e instanceof hH)return[null];else if(e instanceof pl)return[void 0,...h2(e.unwrap())];else if(e instanceof pu)return[null,...h2(e.unwrap())];else if(e instanceof pm)return h2(e.unwrap());else if(e instanceof pg)return h2(e.unwrap());else if(e instanceof pd)return h2(e._def.innerType);else return[]};class h6 extends hx{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==he.object)return hd(t,{code:hr.invalid_type,expected:he.object,received:t.parsedType}),hp;let r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(hd(t,{code:hr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),hp)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=h2(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(i.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);i.set(n,r)}}return new h6({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...h$(r)})}}class h9 extends hx{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if(hg(e)||hg(i))return hp;let n=function e(t,r){let i=ht(t),n=ht(r);if(t===r)return{valid:!0,data:t};if(i===he.object&&n===he.object){let i=b.objectKeys(r),n=b.objectKeys(t).filter(e=>-1!==i.indexOf(e)),a={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};a[i]=n.data}return{valid:!0,data:a}}if(i===he.array&&n===he.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1};i.push(a.data)}return{valid:!0,data:i}}if(i===he.date&&n===he.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,i.value);return n.valid?((hy(e)||hy(i))&&t.dirty(),{status:t.value,value:n.data}):(hd(r,{code:hr.invalid_intersection_types}),hp)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}h9.create=(e,t,r)=>new h9({left:e,right:t,typeName:x.ZodIntersection,...h$(r)});class h5 extends hx{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.array)return hd(r,{code:hr.invalid_type,expected:he.array,received:r.parsedType}),hp;if(r.data.length<this._def.items.length)return hd(r,{code:hr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),hp;!this._def.rest&&r.data.length>this._def.items.length&&(hd(r,{code:hr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new hb(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>hh.mergeArray(t,e)):hh.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new h5({...this._def,rest:e})}}h5.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new h5({items:e,typeName:x.ZodTuple,rest:null,...h$(t)})};class h3 extends hx{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.object)return hd(r,{code:hr.invalid_type,expected:he.object,received:r.parsedType}),hp;let i=[],n=this._def.keyType,a=this._def.valueType;for(let e in r.data)i.push({key:n._parse(new hb(r,e,r.path,e)),value:a._parse(new hb(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?hh.mergeObjectAsync(t,i):hh.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new h3(t instanceof hx?{keyType:e,valueType:t,typeName:x.ZodRecord,...h$(r)}:{keyType:hF.create(),valueType:e,typeName:x.ZodRecord,...h$(t)})}}class h8 extends hx{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.map)return hd(r,{code:hr.invalid_type,expected:he.map,received:r.parsedType}),hp;let i=this._def.keyType,n=this._def.valueType,a=[...r.data.entries()].map(([e,t],a)=>({key:i._parse(new hb(r,e,r.path,[a,"key"])),value:n._parse(new hb(r,t,r.path,[a,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of a){let i=await r.key,n=await r.value;if("aborted"===i.status||"aborted"===n.status)return hp;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of a){let i=r.key,n=r.value;if("aborted"===i.status||"aborted"===n.status)return hp;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}}}}h8.create=(e,t,r)=>new h8({valueType:t,keyType:e,typeName:x.ZodMap,...h$(r)});class h7 extends hx{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.set)return hd(r,{code:hr.invalid_type,expected:he.set,received:r.parsedType}),hp;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&(hd(r,{code:hr.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&(hd(r,{code:hr.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function a(e){let r=new Set;for(let i of e){if("aborted"===i.status)return hp;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>n._parse(new hb(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>a(e)):a(s)}min(e,t){return new h7({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new h7({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}h7.create=(e,t)=>new h7({valueType:e,minSize:null,maxSize:null,typeName:x.ZodSet,...h$(t)});class pe extends hx{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==he.function)return hd(t,{code:hr.invalid_type,expected:he.function,received:t.parsedType}),hp;function r(e,r){return hu({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,hs,ha].filter(e=>!!e),issueData:{code:hr.invalid_arguments,argumentsError:r}})}function i(e,r){return hu({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,hs,ha].filter(e=>!!e),issueData:{code:hr.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof ps){let e=this;return hf(async function(...t){let s=new hn([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw s.addIssue(r(t,e)),s}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw s.addIssue(i(l,e)),s})})}{let e=this;return hf(function(...t){let s=e._def.args.safeParse(t,n);if(!s.success)throw new hn([r(t,s.error)]);let o=Reflect.apply(a,this,s.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new hn([i(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new pe({...this._def,args:h5.create(e).rest(hX.create())})}returns(e){return new pe({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new pe({args:e||h5.create([]).rest(hX.create()),returns:t||hX.create(),typeName:x.ZodFunction,...h$(r)})}}class pt extends hx{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}pt.create=(e,t)=>new pt({getter:e,typeName:x.ZodLazy,...h$(t)});class pr extends hx{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return hd(t,{received:t.data,code:hr.invalid_literal,expected:this._def.value}),hp}return{status:"valid",value:e.data}}get value(){return this._def.value}}function pi(e,t){return new pn({values:e,typeName:x.ZodEnum,...h$(t)})}pr.create=(e,t)=>new pr({value:e,typeName:x.ZodLiteral,...h$(t)});class pn extends hx{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return hd(t,{expected:b.joinValues(r),received:t.parsedType,code:hr.invalid_type}),hp}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return hd(t,{received:t.data,code:hr.invalid_enum_value,options:r}),hp}return hf(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return pn.create(e,{...this._def,...t})}exclude(e,t=this._def){return pn.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}pn.create=pi;class pa extends hx{_parse(e){let t=b.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==he.string&&r.parsedType!==he.number){let e=b.objectValues(t);return hd(r,{expected:b.joinValues(e),received:r.parsedType,code:hr.invalid_type}),hp}if(this._cache||(this._cache=new Set(b.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=b.objectValues(t);return hd(r,{received:r.data,code:hr.invalid_enum_value,options:e}),hp}return hf(e.data)}get enum(){return this._def.values}}pa.create=(e,t)=>new pa({values:e,typeName:x.ZodNativeEnum,...h$(t)});class ps extends hx{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==he.promise&&!1===t.common.async?(hd(t,{code:hr.invalid_type,expected:he.promise,received:t.parsedType}),hp):hf((t.parsedType===he.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ps.create=(e,t)=>new ps({type:e,typeName:x.ZodPromise,...h$(t)});class po extends hx{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:e=>{hd(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===i.type){let e=i.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return hp;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?hp:"dirty"===i.status||"dirty"===t.value?hm(i.value):i});{if("aborted"===t.value)return hp;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?hp:"dirty"===i.status||"dirty"===t.value?hm(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?hp:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?hp:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>hv(e)?Promise.resolve(i.transform(e.value,n)).then(e=>({status:t.value,value:e})):hp);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!hv(e))return hp;let a=i.transform(e.value,n);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}b.assertNever(i)}}po.create=(e,t,r)=>new po({schema:e,typeName:x.ZodEffects,effect:t,...h$(r)}),po.createWithPreprocess=(e,t,r)=>new po({schema:t,effect:{type:"preprocess",transform:e},typeName:x.ZodEffects,...h$(r)});class pl extends hx{_parse(e){return this._getType(e)===he.undefined?hf(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}pl.create=(e,t)=>new pl({innerType:e,typeName:x.ZodOptional,...h$(t)});class pu extends hx{_parse(e){return this._getType(e)===he.null?hf(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}pu.create=(e,t)=>new pu({innerType:e,typeName:x.ZodNullable,...h$(t)});class pc extends hx{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===he.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}pc.create=(e,t)=>new pc({innerType:e,typeName:x.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...h$(t)});class pd extends hx{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return h_(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new hn(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new hn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}pd.create=(e,t)=>new pd({innerType:e,typeName:x.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...h$(t)});class ph extends hx{_parse(e){if(this._getType(e)!==he.nan){let t=this._getOrReturnCtx(e);return hd(t,{code:hr.invalid_type,expected:he.nan,received:t.parsedType}),hp}return{status:"valid",value:e.data}}}ph.create=e=>new ph({typeName:x.ZodNaN,...h$(e)});let pp=Symbol("zod_brand");class pm extends hx{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class pf extends hx{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?hp:"dirty"===e.status?(t.dirty(),hm(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?hp:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new pf({in:e,out:t,typeName:x.ZodPipeline})}}class pg extends hx{_parse(e){let t=this._def.innerType._parse(e),r=e=>(hv(e)&&(e.value=Object.freeze(e.value)),e);return h_(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function py(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function pv(e,t={},r){return e?hK.create().superRefine((i,n)=>{let a=e(i);if(a instanceof Promise)return a.then(e=>{if(!e){let e=py(t,i),a=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=py(t,i),a=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:a})}}):hK.create()}pg.create=(e,t)=>new pg({innerType:e,typeName:x.ZodReadonly,...h$(t)});let p_={object:h1.lazycreate};(m=x||(x={})).ZodString="ZodString",m.ZodNumber="ZodNumber",m.ZodNaN="ZodNaN",m.ZodBigInt="ZodBigInt",m.ZodBoolean="ZodBoolean",m.ZodDate="ZodDate",m.ZodSymbol="ZodSymbol",m.ZodUndefined="ZodUndefined",m.ZodNull="ZodNull",m.ZodAny="ZodAny",m.ZodUnknown="ZodUnknown",m.ZodNever="ZodNever",m.ZodVoid="ZodVoid",m.ZodArray="ZodArray",m.ZodObject="ZodObject",m.ZodUnion="ZodUnion",m.ZodDiscriminatedUnion="ZodDiscriminatedUnion",m.ZodIntersection="ZodIntersection",m.ZodTuple="ZodTuple",m.ZodRecord="ZodRecord",m.ZodMap="ZodMap",m.ZodSet="ZodSet",m.ZodFunction="ZodFunction",m.ZodLazy="ZodLazy",m.ZodLiteral="ZodLiteral",m.ZodEnum="ZodEnum",m.ZodEffects="ZodEffects",m.ZodNativeEnum="ZodNativeEnum",m.ZodOptional="ZodOptional",m.ZodNullable="ZodNullable",m.ZodDefault="ZodDefault",m.ZodCatch="ZodCatch",m.ZodPromise="ZodPromise",m.ZodBranded="ZodBranded",m.ZodPipeline="ZodPipeline",m.ZodReadonly="ZodReadonly";let pb=(e,t={message:`Input not instance of ${e.name}`})=>pv(t=>t instanceof e,t),pw=hF.create,p$=hB.create,px=ph.create,pk=hV.create,pI=hq.create,pE=hG.create,pS=hW.create,pO=hJ.create,pT=hH.create,pA=hK.create,pN=hX.create,pC=hY.create,pj=hQ.create,pP=h0.create,pR=h1.create,pU=h1.strictCreate,pL=h4.create,pz=h6.create,pD=h9.create,pM=h5.create,pZ=h3.create,pF=h8.create,pB=h7.create,pV=pe.create,pq=pt.create,pG=pr.create,pW=pn.create,pJ=pa.create,pH=ps.create,pK=po.create,pX=pl.create,pY=pu.create,pQ=po.createWithPreprocess,p0=pf.create,p1=()=>pw().optional(),p4=()=>p$().optional(),p2=()=>pI().optional(),p6={string:e=>hF.create({...e,coerce:!0}),number:e=>hB.create({...e,coerce:!0}),boolean:e=>hq.create({...e,coerce:!0}),bigint:e=>hV.create({...e,coerce:!0}),date:e=>hG.create({...e,coerce:!0})};e.s(["BRAND",0,pp,"NEVER",0,hp,"Schema",()=>hx,"ZodAny",()=>hK,"ZodArray",()=>h0,"ZodBigInt",()=>hV,"ZodBoolean",()=>hq,"ZodBranded",()=>pm,"ZodCatch",()=>pd,"ZodDate",()=>hG,"ZodDefault",()=>pc,"ZodDiscriminatedUnion",()=>h6,"ZodEffects",()=>po,"ZodEnum",()=>pn,"ZodFirstPartyTypeKind",()=>x,"ZodFunction",()=>pe,"ZodIntersection",()=>h9,"ZodLazy",()=>pt,"ZodLiteral",()=>pr,"ZodMap",()=>h8,"ZodNaN",()=>ph,"ZodNativeEnum",()=>pa,"ZodNever",()=>hY,"ZodNull",()=>hH,"ZodNullable",()=>pu,"ZodNumber",()=>hB,"ZodObject",()=>h1,"ZodOptional",()=>pl,"ZodPipeline",()=>pf,"ZodPromise",()=>ps,"ZodReadonly",()=>pg,"ZodRecord",()=>h3,"ZodSchema",()=>hx,"ZodSet",()=>h7,"ZodString",()=>hF,"ZodSymbol",()=>hW,"ZodTransformer",()=>po,"ZodTuple",()=>h5,"ZodType",()=>hx,"ZodUndefined",()=>hJ,"ZodUnion",()=>h4,"ZodUnknown",()=>hX,"ZodVoid",()=>hQ,"any",()=>pA,"array",()=>pP,"bigint",()=>pk,"boolean",()=>pI,"coerce",0,p6,"custom",()=>pv,"date",()=>pE,"datetimeRegex",()=>hZ,"discriminatedUnion",()=>pz,"effect",()=>pK,"enum",()=>pW,"function",()=>pV,"instanceof",()=>pb,"intersection",()=>pD,"late",0,p_,"lazy",()=>pq,"literal",()=>pG,"map",()=>pF,"nan",()=>px,"nativeEnum",()=>pJ,"never",()=>pC,"null",()=>pT,"nullable",()=>pY,"number",()=>p$,"object",()=>pR,"oboolean",()=>p2,"onumber",()=>p4,"optional",()=>pX,"ostring",()=>p1,"pipeline",()=>p0,"preprocess",()=>pQ,"promise",()=>pH,"record",()=>pZ,"set",()=>pB,"strictObject",()=>pU,"string",()=>pw,"symbol",()=>pS,"transformer",()=>pK,"tuple",()=>pM,"undefined",()=>pO,"union",()=>pL,"unknown",()=>pN,"void",()=>pj],17958),e.s([],54033),e.i(54033),e.i(85676),e.s(["defaultErrorMap",0,ha,"getErrorMap",()=>hl,"setErrorMap",()=>ho],76733),e.i(76733),e.i(84488),e.i(91316),e.i(42944),e.i(17958),e.i(15235),e.s(["BRAND",0,pp,"DIRTY",0,hm,"EMPTY_PATH",0,hc,"INVALID",0,hp,"NEVER",0,hp,"OK",0,hf,"ParseStatus",()=>hh,"Schema",()=>hx,"ZodAny",()=>hK,"ZodArray",()=>h0,"ZodBigInt",()=>hV,"ZodBoolean",()=>hq,"ZodBranded",()=>pm,"ZodCatch",()=>pd,"ZodDate",()=>hG,"ZodDefault",()=>pc,"ZodDiscriminatedUnion",()=>h6,"ZodEffects",()=>po,"ZodEnum",()=>pn,"ZodError",()=>hn,"ZodFirstPartyTypeKind",()=>x,"ZodFunction",()=>pe,"ZodIntersection",()=>h9,"ZodIssueCode",0,hr,"ZodLazy",()=>pt,"ZodLiteral",()=>pr,"ZodMap",()=>h8,"ZodNaN",()=>ph,"ZodNativeEnum",()=>pa,"ZodNever",()=>hY,"ZodNull",()=>hH,"ZodNullable",()=>pu,"ZodNumber",()=>hB,"ZodObject",()=>h1,"ZodOptional",()=>pl,"ZodParsedType",0,he,"ZodPipeline",()=>pf,"ZodPromise",()=>ps,"ZodReadonly",()=>pg,"ZodRecord",()=>h3,"ZodSchema",()=>hx,"ZodSet",()=>h7,"ZodString",()=>hF,"ZodSymbol",()=>hW,"ZodTransformer",()=>po,"ZodTuple",()=>h5,"ZodType",()=>hx,"ZodUndefined",()=>hJ,"ZodUnion",()=>h4,"ZodUnknown",()=>hX,"ZodVoid",()=>hQ,"addIssueToContext",()=>hd,"any",()=>pA,"array",()=>pP,"bigint",()=>pk,"boolean",()=>pI,"coerce",0,p6,"custom",()=>pv,"date",()=>pE,"datetimeRegex",()=>hZ,"defaultErrorMap",0,ha,"discriminatedUnion",()=>pz,"effect",()=>pK,"enum",()=>pW,"function",()=>pV,"getErrorMap",()=>hl,"getParsedType",0,ht,"instanceof",()=>pb,"intersection",()=>pD,"isAborted",0,hg,"isAsync",0,h_,"isDirty",0,hy,"isValid",0,hv,"late",0,p_,"lazy",()=>pq,"literal",()=>pG,"makeIssue",0,hu,"map",()=>pF,"nan",()=>px,"nativeEnum",()=>pJ,"never",()=>pC,"null",()=>pT,"nullable",()=>pY,"number",()=>p$,"object",()=>pR,"objectUtil",()=>w,"oboolean",()=>p2,"onumber",()=>p4,"optional",()=>pX,"ostring",()=>p1,"pipeline",()=>p0,"preprocess",()=>pQ,"promise",()=>pH,"quotelessJson",0,hi,"record",()=>pZ,"set",()=>pB,"setErrorMap",()=>ho,"strictObject",()=>pU,"string",()=>pw,"symbol",()=>pS,"transformer",()=>pK,"tuple",()=>pM,"undefined",()=>pO,"union",()=>pL,"unknown",()=>pN,"util",()=>b,"void",()=>pj],35907);var p9=e.i(35907);function p5(e,t){return my(e.type._def,t)}let p3=/^[cC][^\s-]{8,}$/,p8=/^[0-9a-z]+$/,p7=/^[0-9A-HJKMNP-TV-Z]{26}$/,me=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,mt=()=>(void 0===c&&(c=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),c),mr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,mi=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mn=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ma=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ms=/^[a-zA-Z0-9_-]{21}$/,mo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function ml(e,t){let r={type:"string"};if(e.checks)for(let i of e.checks)switch(i.kind){case"min":d7(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":d7(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":md(r,"email",i.message,t);break;case"format:idn-email":md(r,"idn-email",i.message,t);break;case"pattern:zod":mh(r,me,i.message,t)}break;case"url":md(r,"uri",i.message,t);break;case"uuid":md(r,"uuid",i.message,t);break;case"regex":mh(r,i.regex,i.message,t);break;case"cuid":mh(r,p3,i.message,t);break;case"cuid2":mh(r,p8,i.message,t);break;case"startsWith":mh(r,RegExp(`^${mu(i.value,t)}`),i.message,t);break;case"endsWith":mh(r,RegExp(`${mu(i.value,t)}$`),i.message,t);break;case"datetime":md(r,"date-time",i.message,t);break;case"date":md(r,"date",i.message,t);break;case"time":md(r,"time",i.message,t);break;case"duration":md(r,"duration",i.message,t);break;case"length":d7(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),d7(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":mh(r,RegExp(mu(i.value,t)),i.message,t);break;case"ip":"v6"!==i.version&&md(r,"ipv4",i.message,t),"v4"!==i.version&&md(r,"ipv6",i.message,t);break;case"base64url":mh(r,ma,i.message,t);break;case"jwt":mh(r,mo,i.message,t);break;case"cidr":"v6"!==i.version&&mh(r,mr,i.message,t),"v4"!==i.version&&mh(r,mi,i.message,t);break;case"emoji":mh(r,mt(),i.message,t);break;case"ulid":mh(r,p7,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":md(r,"binary",i.message,t);break;case"contentEncoding:base64":d7(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":mh(r,mn,i.message,t)}break;case"nanoid":mh(r,ms,i.message,t)}return r}function mu(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)mc.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let mc=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function md(e,t,r,i){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):d7(e,"format",t,r,i)}function mh(e,t,r,i){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:mp(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):d7(e,"pattern",mp(t,i),r,i)}function mp(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,n="",a=!1,s=!1,o=!1;for(let e=0;e<i.length;e++){if(a){n+=i[e],a=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){o?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),o=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],o=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){n+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?a=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function mm(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===x.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:my(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??d3(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:my(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===x.ZodString&&e.keyType._def.checks?.length){let{type:i,...n}=ml(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===x.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===x.ZodBranded&&e.keyType._def.type._def.typeName===x.ZodString&&e.keyType._def.type._def.checks?.length){let{type:i,...n}=p5(e.keyType._def,t);return{...r,propertyNames:n}}return r}let mf={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},mg=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>my(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function my(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==d6)return n}if(i&&!r){let e=mv(i,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=((e,t,r)=>{switch(t){case x.ZodString:return ml(e,r);case x.ZodNumber:let i={type:"number"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"int":i.type="integer",d8(i,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?d7(i,"minimum",t.value,t.message,r):d7(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),d7(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?d7(i,"maximum",t.value,t.message,r):d7(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),d7(i,"maximum",t.value,t.message,r));break;case"multipleOf":d7(i,"multipleOf",t.value,t.message,r)}return i;case x.ZodObject:return function(e,t){let r="openAi"===t.target,i={type:"object",properties:{}},n=[],a=e.shape();for(let e in a){let s=a[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=my(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(i.properties[e]=l,o||n.push(e))}n.length&&(i.required=n);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return my(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(i.additionalProperties=s),i}(e,r);case x.ZodBigInt:let n={type:"integer",format:"int64"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?d7(n,"minimum",t.value,t.message,r):d7(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),d7(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?d7(n,"maximum",t.value,t.message,r):d7(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),d7(n,"maximum",t.value,t.message,r));break;case"multipleOf":d7(n,"multipleOf",t.value,t.message,r)}return n;case x.ZodBoolean:return{type:"boolean"};case x.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(i=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":d7(o,"minimum",e.value,e.message,s);break;case"max":d7(o,"maximum",e.value,e.message,s)}return o}}(e,r);case x.ZodUndefined:return{not:d3(r)};case x.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case x.ZodArray:let a;return a={type:"array"},e.type?._def&&e.type?._def?.typeName!==x.ZodAny&&(a.items=my(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&d7(a,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&d7(a,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(d7(a,"minItems",e.exactLength.value,e.exactLength.message,r),d7(a,"maxItems",e.exactLength.value,e.exactLength.message,r)),a;case x.ZodUnion:case x.ZodDiscriminatedUnion:if("openApi3"===r.target)return mg(e,r);let s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every(e=>e._def.typeName in mf&&(!e._def.checks||!e._def.checks.length))){let e=s.reduce((e,t)=>{let r=mf[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(s.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=s.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];return e;default:return e}},[]);if(e.length===s.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:s.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(s.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:s.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return mg(e,r);case x.ZodIntersection:let o,l,u;return o=[my(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),my(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),l="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,u=[],o.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)u.push(...e.allOf),void 0===e.unevaluatedProperties&&(l=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else l=void 0;u.push(t)}}),u.length?{allOf:u,...l}:void 0;case x.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>my(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:my(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>my(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case x.ZodRecord:return mm(e,r);case x.ZodLiteral:let c;return"bigint"!=(c=typeof e.value)&&"number"!==c&&"boolean"!==c&&"string"!==c?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===c?"integer":c,enum:[e.value]}:{type:"bigint"===c?"integer":c,const:e.value};case x.ZodEnum:return{type:"string",enum:Array.from(e.values)};case x.ZodNativeEnum:let d,h,p;return d=e.values,{type:1===(p=Array.from(new Set((h=Object.keys(e.values).filter(e=>"number"!=typeof d[d[e]]).map(e=>d[e])).map(e=>typeof e)))).length?"string"===p[0]?"string":"number":["string","number"],enum:h};case x.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:mf[e.innerType._def.typeName],nullable:!0}:{type:[mf[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=my(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let m=my(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return m&&{anyOf:[m,{type:"null"}]};case x.ZodOptional:if(r.currentPath.toString()===r.propertyPath?.toString())return my(e.innerType._def,r);let f=my(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return f?{anyOf:[{not:d3(r)},f]}:d3(r);case x.ZodMap:if("record"===r.mapStrategy)return mm(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[my(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||d3(r),my(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||d3(r)],minItems:2,maxItems:2}};case x.ZodSet:let g;return g={type:"array",uniqueItems:!0,items:my(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&d7(g,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&d7(g,"maxItems",e.maxSize.value,e.maxSize.message,r),g;case x.ZodLazy:return()=>e.getter()._def;case x.ZodPromise:return my(e.type._def,r);case x.ZodNaN:case x.ZodNever:return"openAi"===r.target?void 0:{not:d3({...r,currentPath:[...r.currentPath,"not"]})};case x.ZodEffects:return"input"===r.effectStrategy?my(e.schema._def,r):d3(r);case x.ZodAny:case x.ZodUnknown:return d3(r);case x.ZodDefault:return{...my(e.innerType._def,r),default:e.defaultValue()};case x.ZodBranded:return p5(e,r);case x.ZodReadonly:case x.ZodCatch:return my(e.innerType._def,r);case x.ZodPipeline:if("input"===r.pipeStrategy)return my(e.in._def,r);if("output"===r.pipeStrategy)return my(e.out._def,r);let y=my(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),v=my(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",y?"1":"0"]});return{allOf:[y,v].filter(e=>void 0!==e)};case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?my(a(),t):a;if(s&&m_(e,t,s),t.postProcess){let r=t.postProcess(s,e,t);return n.jsonSchema=s,r}return n.jsonSchema=s,s}let mv=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:d5(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),d3(t);return"seen"===t.$refStrategy?d3(t):void 0}},m_=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function mb(e,t){let r=typeof e;if(r!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(!mb(e[i],t[i]))return!1;return!0}if("object"===r){if(!e||!t)return e===t;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let i of r)if(!mb(e[i],t[i]))return!1;return!0}return e===t}function mw(e){return encodeURI(e.replace(/~/g,"~0").replace(/\//g,"~1"))}let m$={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},mx={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},mk={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},mI="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function mE(e,t=Object.create(null),r=mI,i=""){if(e&&"object"==typeof e&&!Array.isArray(e)){let n=e.$id||e.id;if(n){let a=new URL(n,r.href);a.hash.length>1?t[a.href]=e:(a.hash="",""===i?r=a:mE(e,t,r))}}else if(!0!==e&&!1!==e)return t;let n=r.href+(i?"#"+i:"");if(void 0!==t[n])throw Error(`Duplicate schema URI "${n}".`);if(t[n]=e,!0===e||!1===e)return t;if(void 0===e.__absolute_uri__&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&void 0===e.__absolute_ref__){let t=new URL(e.$ref,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:t.href})}if(e.$recursiveRef&&void 0===e.__absolute_recursive_ref__){let t=new URL(e.$recursiveRef,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:t.href})}for(let n in e.$anchor&&(t[new URL("#"+e.$anchor,r.href).href]=e),e){if(mk[n])continue;let a=`${i}/${mw(n)}`,s=e[n];if(Array.isArray(s)){if(m$[n]){let e=s.length;for(let i=0;i<e;i++)mE(s[i],t,r,`${a}/${i}`)}}else if(mx[n])for(let e in s)mE(s[e],t,r,`${a}/${mw(e)}`);else mE(s,t,r,a)}return t}let mS=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,mO=[0,31,28,31,30,31,30,31,31,30,31,30,31],mT=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function mA(e){return e.test.bind(e)}let mN={date:mC,time:mj.bind(void 0,!1),"date-time":function(e){let t=e.split(mP);return 2==t.length&&mC(t[0])&&mj(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return mR.test(e)&&mU.test(e)},"uri-reference":mA(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":mA(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:mA(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...i]=e.split("@");return!(!t||!r||0!==i.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:mA(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:mA(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:mA(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(mL.test(e))return!1;try{return RegExp(e,"u"),!0}catch(e){return!1}},uuid:mA(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":mA(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":mA(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":mA(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function mC(e){var t;let r=e.match(mS);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3];return n>=1&&n<=12&&a>=1&&a<=(2==n&&(t=i)%4==0&&(t%100!=0||t%400==0)?29:mO[n])}function mj(e,t){let r=t.match(mT);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3],s=!!r[5];return(i<=23&&n<=59&&a<=59||23==i&&59==n&&60==a)&&(!e||s)}let mP=/t|\s/i,mR=/\/|:/,mU=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,mL=/[^\\]\\Z/;function mz(e,t,r="2019-09",i=mE(t),n=!0,a=null,s="#",o="#",l=Object.create(null)){let u;if(!0===t)return{valid:!0,errors:[]};if(!1===t)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};let c=typeof e;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":u=null===e?"null":Array.isArray(e)?"array":"object";break;default:throw Error(`Instances of "${c}" type are not supported.`)}let{$ref:d,$recursiveRef:h,$recursiveAnchor:p,type:m,const:f,enum:g,required:y,not:v,anyOf:_,allOf:b,oneOf:w,if:$,then:x,else:k,format:I,properties:E,patternProperties:S,additionalProperties:O,unevaluatedProperties:T,minProperties:A,maxProperties:N,propertyNames:C,dependentRequired:j,dependentSchemas:P,dependencies:R,prefixItems:U,items:L,additionalItems:z,unevaluatedItems:D,contains:M,minContains:Z,maxContains:F,minItems:B,maxItems:V,uniqueItems:q,minimum:G,maximum:W,exclusiveMinimum:J,exclusiveMaximum:H,multipleOf:K,minLength:X,maxLength:Y,pattern:Q,__absolute_ref__:ee,__absolute_recursive_ref__:et}=t,er=[];if(!0===p&&null===a&&(a=t),"#"===h){let u=null===a?i[et]:a,c=`${o}/$recursiveRef`,d=mz(e,null===a?t:a,r,i,n,u,s,c,l);d.valid||er.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:c,error:"A subschema had errors."},...d.errors)}if(void 0!==d){let t=i[ee||d];if(void 0===t){let e=`Unresolved $ref "${d}".`;throw ee&&ee!==d&&(e+=`  Absolute URI "${ee}".`),Error(e+=`
Known schemas:
- ${Object.keys(i).join("\n- ")}`)}let u=`${o}/$ref`,c=mz(e,t,r,i,n,a,s,u,l);if(c.valid||er.push({instanceLocation:s,keyword:"$ref",keywordLocation:u,error:"A subschema had errors."},...c.errors),"4"===r||"7"===r)return{valid:0===er.length,errors:er}}if(Array.isArray(m)){let t=m.length,r=!1;for(let i=0;i<t;i++)if(u===m[i]||"integer"===m[i]&&"number"===u&&e%1==0&&e==e){r=!0;break}r||er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m.join('", "')}".`})}else"integer"===m?("number"!==u||e%1||e!=e)&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`}):void 0!==m&&u!==m&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`});if(void 0!==f&&("object"===u||"array"===u?mb(e,f)||er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(f)}.`}):e!==f&&er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(f)}.`})),void 0!==g&&("object"===u||"array"===u?g.some(t=>mb(e,t))||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(t=>e===t)||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),void 0!==v){let t=`${o}/not`;mz(e,v,r,i,n,a,s,t).valid&&er.push({instanceLocation:s,keyword:"not",keywordLocation:t,error:'Instance matched "not" schema.'})}let ei=[];if(void 0!==_){let t=`${o}/anyOf`,u=er.length,c=!1;for(let o=0;o<_.length;o++){let u=_[o],d=Object.create(l),h=mz(e,u,r,i,n,!0===p?a:null,s,`${t}/${o}`,d);er.push(...h.errors),c=c||h.valid,h.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:t,error:"Instance does not match any subschemas."})}if(void 0!==b){let t=`${o}/allOf`,u=er.length,c=!0;for(let o=0;o<b.length;o++){let u=b[o],d=Object.create(l),h=mz(e,u,r,i,n,!0===p?a:null,s,`${t}/${o}`,d);er.push(...h.errors),c=c&&h.valid,h.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"allOf",keywordLocation:t,error:"Instance does not match every subschema."})}if(void 0!==w){let t=`${o}/oneOf`,u=er.length,c=w.filter((o,u)=>{let c=Object.create(l),d=mz(e,o,r,i,n,!0===p?a:null,s,`${t}/${u}`,c);return er.push(...d.errors),d.valid&&ei.push(c),d.valid}).length;1===c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:t,error:`Instance does not match exactly one subschema (${c} matches).`})}if(("object"===u||"array"===u)&&Object.assign(l,...ei),void 0!==$){let t=`${o}/if`;if(mz(e,$,r,i,n,a,s,t,l).valid){if(void 0!==x){let u=mz(e,x,r,i,n,a,s,`${o}/then`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "then" schema.'},...u.errors)}}else if(void 0!==k){let u=mz(e,k,r,i,n,a,s,`${o}/else`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "else" schema.'},...u.errors)}}if("object"===u){if(void 0!==y)for(let t of y)t in e||er.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${t}".`});let t=Object.keys(e);if(void 0!==A&&t.length<A&&er.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${A} properties.`}),void 0!==N&&t.length>N&&er.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${N} properties.`}),void 0!==C){let t=`${o}/propertyNames`;for(let o in e){let e=`${s}/${mw(o)}`,l=mz(o,C,r,i,n,a,e,t);l.valid||er.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:t,error:`Property name "${o}" does not match schema.`},...l.errors)}}if(void 0!==j){let t=`${o}/dependantRequired`;for(let r in j)if(r in e)for(let i of j[r])i in e||er.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:t,error:`Instance has "${r}" but does not have "${i}".`})}if(void 0!==P)for(let t in P){let u=`${o}/dependentSchemas`;if(t in e){let o=mz(e,P[t],r,i,n,a,s,`${u}/${mw(t)}`,l);o.valid||er.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:u,error:`Instance has "${t}" but does not match dependant schema.`},...o.errors)}}if(void 0!==R){let t=`${o}/dependencies`;for(let o in R)if(o in e){let l=R[o];if(Array.isArray(l))for(let r of l)r in e||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not have "${r}".`});else{let u=mz(e,l,r,i,n,a,s,`${t}/${mw(o)}`);u.valid||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not match dependant schema.`},...u.errors)}}}let u=Object.create(null),c=!1;if(void 0!==E){let t=`${o}/properties`;for(let o in E){if(!(o in e))continue;let d=`${s}/${mw(o)}`,h=mz(e[o],E[o],r,i,n,a,d,`${t}/${mw(o)}`);if(h.valid)l[o]=u[o]=!0;else if(c=n,er.push({instanceLocation:s,keyword:"properties",keywordLocation:t,error:`Property "${o}" does not match schema.`},...h.errors),c)break}}if(!c&&void 0!==S){let t=`${o}/patternProperties`;for(let o in S){let d=RegExp(o,"u"),h=S[o];for(let p in e){if(!d.test(p))continue;let m=`${s}/${mw(p)}`,f=mz(e[p],h,r,i,n,a,m,`${t}/${mw(o)}`);f.valid?l[p]=u[p]=!0:(c=n,er.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:t,error:`Property "${p}" matches pattern "${o}" but does not match associated schema.`},...f.errors))}}}if(c||void 0===O){if(!c&&void 0!==T){let t=`${o}/unevaluatedProperties`;for(let o in e)if(!l[o]){let u=`${s}/${mw(o)}`,c=mz(e[o],T,r,i,n,a,u,t);c.valid?l[o]=!0:er.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:t,error:`Property "${o}" does not match unevaluated properties schema.`},...c.errors)}}}else{let t=`${o}/additionalProperties`;for(let o in e){if(u[o])continue;let d=`${s}/${mw(o)}`,h=mz(e[o],O,r,i,n,a,d,t);h.valid?l[o]=!0:(c=n,er.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:t,error:`Property "${o}" does not match additional properties schema.`},...h.errors))}}}else if("array"===u){void 0!==V&&e.length>V&&er.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${V}).`}),void 0!==B&&e.length<B&&er.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${B}).`});let t=e.length,u=0,c=!1;if(void 0!==U){let d=`${o}/prefixItems`,h=Math.min(U.length,t);for(;u<h;u++){let t=mz(e[u],U[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}if(void 0!==L){let d=`${o}/items`;if(Array.isArray(L)){let o=Math.min(L.length,t);for(;u<o;u++){let t=mz(e[u],L[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}else for(;u<t;u++){let t=mz(e[u],L,r,i,n,a,`${s}/${u}`,d);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}if(!c&&void 0!==z){let d=`${o}/additionalItems`;for(;u<t;u++){let t=mz(e[u],z,r,i,n,a,`${s}/${u}`,d);l[u]=!0,t.valid||(c=n,er.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:d,error:"Items did not match additional items schema."},...t.errors))}}}if(void 0!==M)if(0===t&&void 0===Z)er.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==Z&&t<Z)er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${t}) than minContains (${Z}).`});else{let u=`${o}/contains`,c=er.length,d=0;for(let o=0;o<t;o++){let t=mz(e[o],M,r,i,n,a,`${s}/${o}`,u);t.valid?(l[o]=!0,d++):er.push(...t.errors)}d>=(Z||0)&&(er.length=c),void 0===Z&&void 0===F&&0===d?er.splice(c,0,{instanceLocation:s,keyword:"contains",keywordLocation:u,error:"Array does not contain item matching schema."}):void 0!==Z&&d<Z?er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Z} items matching schema. Only ${d} items were found.`}):void 0!==F&&d>F&&er.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${F} items matching schema. ${d} items were found.`})}if(!c&&void 0!==D){let c=`${o}/unevaluatedItems`;for(;u<t;u++){if(l[u])continue;let t=mz(e[u],D,r,i,n,a,`${s}/${u}`,c);l[u]=!0,t.valid||er.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:c,error:"Items did not match unevaluated items schema."},...t.errors)}}if(q)for(let r=0;r<t;r++){let i=e[r],n="object"==typeof i&&null!==i;for(let a=0;a<t;a++){if(r===a)continue;let t=e[a],l="object"==typeof t&&null!==t;(i===t||n&&l&&mb(i,t))&&(er.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${r} and ${a}.`}),r=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER)}}}else if("number"===u){if("4"===r?(void 0!==G&&(!0===J&&e<=G||e<G)&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${J?"or equal to ":""} ${G}.`}),void 0!==W&&(!0===H&&e>=W||e>W)&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${H?"or equal to ":""} ${W}.`})):(void 0!==G&&e<G&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${G}.`}),void 0!==W&&e>W&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${W}.`}),void 0!==J&&e<=J&&er.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${J}.`}),void 0!==H&&e>=H&&er.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${H}.`})),void 0!==K){let t=e%K;Math.abs(0-t)>=11920929e-14&&Math.abs(K-t)>=11920929e-14&&er.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${K}.`})}}else if("string"===u){let t=void 0===X&&void 0===Y?0:function(e){let t,r=0,i=e.length,n=0;for(;n<i;)r++,(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<i&&(64512&(t=e.charCodeAt(n)))==56320&&n++;return r}(e);void 0!==X&&t<X&&er.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${t} < ${X}).`}),void 0!==Y&&t>Y&&er.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${t} > ${Y}).`}),void 0===Q||RegExp(Q,"u").test(e)||er.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),void 0!==I&&mN[I]&&!mN[I](e)&&er.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${I}".`})}return{valid:0===er.length,errors:er}}(f=k||(k={}))[f.Flag=1]="Flag",f[f.Basic=2]="Basic",f[f.Detailed=4]="Detailed";class mD{schema;draft;shortCircuit;lookup;constructor(e,t="2019-09",r=!0){this.schema=e,this.draft=t,this.shortCircuit=r,this.lookup=mE(e)}validate(e){return mz(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),mE(e,this.lookup)}}var mM={};function mZ(e){if(dA(e)){let t=d1(e,!0);return dq(t)?dO(dQ(t,!0)):dO(e)}return dN(e)?((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...d9,name:t}:{...d9,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,flags:{hasReferencedOpenAiAnyType:!1},currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:my(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??d3(n)}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,o=my(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??d3(n),l="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==l&&(o.title=l),n.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[n.openAiAnyTypeName]||(a[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));let u=void 0===s?a?{...o,[n.definitionPath]:a}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...a,[s]:o}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===n.target||"openAi"===n.target)&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u})(e):e}function mF(e){if(!e||"object"!=typeof e||0===Object.keys(e).length||Array.isArray(e))return!1;if("type"in e)return"string"==typeof e.type?"string"===e.type:!!Array.isArray(e.type)&&e.type.every(e=>"string"===e);if("enum"in e)return Array.isArray(e.enum)&&e.enum.length>0&&e.enum.every(e=>"string"==typeof e);if("const"in e)return"string"==typeof e.const;if("allOf"in e&&Array.isArray(e.allOf))return e.allOf.some(e=>mF(e));if("anyOf"in e&&Array.isArray(e.anyOf)||"oneOf"in e&&Array.isArray(e.oneOf)){let t="anyOf"in e?e.anyOf:e.oneOf;return t.length>0&&t.every(e=>mF(e))}if("not"in e)return!1;if("$ref"in e&&"string"==typeof e.$ref){let t=e.$ref,r=mE(e);if(r[t])return mF(r[t])}return!1}function mB(e){return!!e&&e.lc_runnable}G(mM,{Validator:()=>mD,deepCompareStrict:()=>mb,toJsonSchema:()=>mZ,validatesOnlyStrings:()=>mF});var mV=class{includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;constructor(e){this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,i=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||i.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&i.every(e=>!this.excludeTags?.includes(e))),r}};function mq(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let mG=["*","_","`"];async function mW(e,t){let r=t?.backgroundColor??"white",i=t?.imageType??"png",n=btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let a=`https://mermaid.ink/img/${n}?bgColor=${r}&type=${i}`,s=await fetch(a);if(!s.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${s.status}
Status text: ${s.statusText}`);return await s.blob()}var mJ={};G(mJ,{Graph:()=>mH});var mH=class e{nodes={};edges=[];constructor(e){this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=tX(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...mB(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...mZ(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let i=t??t0(),n={id:i,data:e,name:function(e,t){if(void 0!==e&&!tX(e))return e;if(!mB(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch{return t.getName()}}(t,e),metadata:r};return this.nodes[i]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let n={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(n),n}firstNode(){return mK(this)}lastNode(){return mX(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(tX)&&(r="");let i=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[i(e)]={...t,id:i(e)}});let n=e.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}));this.edges=[...this.edges,...n];let a=e.firstNode(),s=e.lastNode();return[a?{id:i(a.id),data:a.data}:void 0,s?{id:i(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&mK(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&mX(this,[e.id])&&this.removeNode(e)}reid(){let t=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),r=new Map;Object.values(t).forEach(e=>{r.set(e,(r.get(e)||0)+1)});let i=e=>{let i=t[e];return tX(e)&&1===r.get(i)?i:e};return new e({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[i(e),{...t,id:i(e)}])),edges:this.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:n}=e??{},a=this.reid(),s=a.firstNode(),o=a.lastNode();return function(e,t,r){let{firstNode:i,lastNode:n,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[a,s]of(void 0!==i&&(r[i]="{0}([{1}]):::first"),void 0!==n&&(r[n]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",i=mG.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(i+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let n=(r[a]??r[t]).replace("{0}",mq(a)).replace("{1}",i);u+=`	${n}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),i=t.filter((e,t)=>e===r[t]).join(":");c[i]||(c[i]=[]),c[i].push(e)}let d=new Set;function h(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:i,conditional:n}=t,a="";if(void 0!==i){let e=i,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),a=n?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else a=n?" -.-> ":" --> ";u+=`	${mq(e)}${a}${mq(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&h(c[e],e);t&&!r&&(u+="	end\n")}for(let e in h(c[""]??[],""),c)e.includes(":")||""===e||h(c[e],e);return s&&(u+=function(e){let t="";for(let[r,i]of Object.entries(e))t+=`	classDef ${r} ${i};
`;return t}(a??{})),u}(a.nodes,a.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:n})}async drawMermaidPng(e){return mW(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}};function mK(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function mX(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function mY({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let mQ=e=>"event_stream_tracer"===e.name;var m0=class extends ig{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;runInfoMap=new Map;tappedPromises=new Map;transformStream;writer;receiveStream;name="event_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=nC.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let i=this.runInfoMap.get(e);if(void 0===i)return void(yield r.value);function n(e,t){return"llm"===e&&"string"==typeof t?new an({text:t}):t}let a=this.tappedPromises.get(e);if(void 0===a){let s;a=new Promise(e=>{s=e}),this.tappedPromises.set(e,a);try{let a={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};for await(let e of(await this.send({...a,data:{chunk:n(i.runType,r.value)}},i),yield r.value,t))"tool"!==i.runType&&"retriever"!==i.runType&&await this.send({...a,data:{chunk:n(i.runType,e)}},i),yield e}finally{s?.()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=mY(e),r=void 0!==e.inputs.messages?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);let n=`on_${r}_start`;await this.send({event:n,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,t,r){let i,n,a=this.runInfoMap.get(e.id);if(void 0===a)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===a.runType)n="on_chat_model_stream",i=r?.chunk===void 0?new tI({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===a.runType)n="on_llm_stream",i=r?.chunk===void 0?new an({text:t}):r.chunk;else throw Error(`Unexpected run type ${a.runType}`);await this.send({event:n,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){let t,r,i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===i)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let n=e.outputs?.generations;if("chat_model"===i.runType){for(let e of n??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===i.runType)r={generations:n?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${i.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onChainStart(e){let t=mY(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},n={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(n={},i.inputs={}):void 0!==e.inputs.input?(n.input=e.inputs.input,i.inputs=e.inputs.input):(n.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:n,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},n={output:e.outputs?.output??e.outputs,input:i};i.input&&1===Object.keys(i).length&&(n.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:n,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=mY(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=mY(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let i=this.runInfoMap.get(r);if(void 0===i)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}},m1=class extends ig{name="RootListenersTracer";rootId;config;argOnStart;argOnEnd;argOnError;constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function m4(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function m2(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*m6(e,t){for(;;){let{value:r,done:i}=i5.runWithConfig(nO(e),t.next.bind(t),!0);if(i)break;yield r}}async function*m9(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:i,done:n}=await i5.runWithConfig(nO(e),r.next.bind(t),!0);if(n)break;yield i}}var m5=p9;function m3(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}var m8=class extends ec{lc_runnable=!0;name;getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new ft({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new m7({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new fo({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(nE);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,i)=>nE(0===i?e:r))}return Array.from({length:t},()=>nE(e))}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=new ag({maxConcurrency:i[0]?.maxConcurrency??r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,i[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=nE(t),i=new nR({generator:this._streamIterator(e,r),config:r});return await i.setup,nC.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?nE(e):nE({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let i,n=nE(r),a=await nx(n),s=await a?.handleChainStart(this.toJSON(),m3(t,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName());delete n.runId;try{let a=e.call(this,t,n,s);i=await nT(a,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(m3(i,"output")),i}async _batchWithConfig(e,t,r,i){let n,a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(nx)),o=await Promise.all(s.map(async(e,r)=>{let i=await e?.handleChainStart(this.toJSON(),m3(t[r],"input"),a[r].runId,a[r].runType,void 0,void 0,a[r].runName??this.getName());return delete a[r].runId,i}));try{let r=e.call(this,t,a,o,i);n=await nT(r,a?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(m3(n,"output")))),n}_concatOutputChunks(e,t){return nP(e,t)}async *_transformStreamWithConfig(e,t,r){let i,n,a,s=!0,o=!0,l=nE(r),u=await nx(l),c=this;async function*d(){for await(let t of e){if(s)if(void 0===i)i=t;else try{i=c._concatOutputChunks(i,t)}catch{i=void 0,s=!1}yield t}}try{let e=await nU(t.bind(this),d(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,a=e.setup;let i=a?.handlers.find(mQ),s=e.output;void 0!==i&&void 0!==a&&(s=i.tapOutputIterable(a.runId,s));let c=a?.handlers.find(n8);for await(let e of(void 0!==c&&void 0!==a&&(s=c.tapOutputIterable(a.runId,s)),s))if(yield e,o)if(void 0===n)n=e;else try{n=this._concatOutputChunks(n,e)}catch{n=void 0,o=!1}}catch(e){throw await a?.handleChainError(e,void 0,void 0,void 0,{inputs:m3(i,"input")}),e}await a?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:m3(i,"input")})}getGraph(e){let t=new mH,r=t.addNode({name:`${this.getName()}Input`,schema:m5.any()}),i=t.addNode(this),n=t.addNode({name:`${this.getName()}Output`,schema:m5.any()});return t.addEdge(r,i),t.addEdge(i,n),t}pipe(e){return new fr({first:this,last:fl(e)})}pick(e){return this.pipe(new fc(e))}assign(e){return this.pipe(new fu(new fi({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:this._concatOutputChunks(r,t);yield*this._streamIterator(r,nE(t))}async *streamLog(e,t,r){let i=new at({...r,autoClose:!1,_schemaFormat:"original"}),n=nE(t);yield*this._streamLog(e,i,n)}async *_streamLog(e,t,r){let{callbacks:i}=r;if(void 0===i)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{let e=i.copy();e.addHandler(t,!0),r.callbacks=e}let n=this.stream(e,r),a=async function(){try{for await(let e of(await n)){let r=new n5({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await a}}streamEvents(e,t,r){var i;let n,a,s;if("v1"===t.version)n=this._streamEventsV1(e,t,r);else if("v2"===t.version)n=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');if("text/event-stream"!==t.encoding)return nC.fromAsyncGenerator(n);return i=n,a=new TextEncoder,s=new ReadableStream({async start(e){for await(let t of i)e.enqueue(a.encode(`event: data
data: ${JSON.stringify(t)}

`));e.enqueue(a.encode("event: end\n\n")),e.close()}}),nC.fromReadableStream(s)}async *_streamEventsV2(e,t,r){let i,n=new m0({...r,autoClose:!1}),a=nE(t),s=a.runId??t0();a.runId=s;let o=a.callbacks;if(void 0===o)a.callbacks=[n];else if(Array.isArray(o))a.callbacks=o.concat(n);else{let e=o.copy();e.addHandler(n,!0),a.callbacks=e}let l=new AbortController,u=this,c=async function(){let r,i=null;try{t?.signal?"any"in AbortSignal?r=AbortSignal.any([l.signal,t.signal]):(r=t.signal,i=()=>{l.abort()},t.signal.addEventListener("abort",i,{once:!0})):r=l.signal;let o=await u.stream(e,{...a,signal:r});for await(let e of n.tapOutputIterable(s,o))if(l.signal.aborted)break}finally{await n.finish(),r&&i&&r.removeEventListener("abort",i)}}(),d=!1;try{for await(let t of n){if(!d){t.data.input=e,d=!0,i=t.run_id,yield t;continue}t.run_id===i&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{l.abort(),await c}}async *_streamEventsV1(e,t,r){let i,n=!1,a=nE(t),s=a.tags??[],o=a.metadata??{},l=a.runName??this.getName(),u=new at({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new mV({...r});for await(let t of this._streamLog(e,u,a)){if(void 0===(i=i?i.concat(t):n3.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;let t={...i.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}for(let e of[...new Set(t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]))]){let t,r={},n=i.state.logs[e];if("start"==(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end"))void 0!==n.inputs&&(r.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(r.input=n.inputs),r.output=n.final_output;else if("stream"===t){let e=n.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);r={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:r}}let{state:r}=i;if(r.streamed_output.length>0){let e=r.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${r.name}"`);let t={chunk:r.streamed_output[0]};r.streamed_output=[];let i={event:`on_${r.type}_stream`,run_id:r.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(i,r.type)&&(yield i)}}let d=i?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return mB(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new m7({bound:this,config:{},configFactories:[i=>({callbacks:[new m1({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){var t,r;let i,n;return t=this,i=(r=e).name??t.getName(),n=r.description??dZ(r.schema),new fd(dB(r.schema)?{name:i,description:n,schema:m5.object({input:m5.string()}).transform(e=>e.input),bound:t}:{name:i,description:n,schema:r.schema,bound:t})}},m7=class e extends m8{static lc_name(){return"RunnableBinding"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;bound;config;kwargs;configFactories;constructor(e){super(e),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=nk(this.config,...e);return nk(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new ft({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(t,this.kwargs))}async batch(e,t,r){let i=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(nE(e),this.kwargs))):await this._mergeConfig(nE(t),this.kwargs);return this.bound.batch(e,i,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(nE(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(nE(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(nE(t),this.kwargs))}streamEvents(e,t,r){let i=this,n=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(nE(t),i.kwargs),version:t.version},r)};return nC.fromAsyncGenerator(n())}static isRunnableBinding(e){return e.bound&&m8.isRunnable(e.bound)}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[e=>({callbacks:[new m1({config:e,onStart:t,onEnd:r,onError:i})]})]})}},fe=class e extends m8{static lc_name(){return"RunnableEach"}lc_serializable=!0;lc_namespace=["langchain_core","runnables"];bound;constructor(e){super(e),this.bound=e.bound}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,nS(t,{callbacks:r?.getChild()}))}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound.withListeners({onStart:t,onEnd:r,onError:i})})}},ft=class extends m7{static lc_name(){return"RunnableRetry"}lc_namespace=["langchain_core","runnables"];maxAttemptNumber=3;onFailedAttempt=()=>{};constructor(e){super(e),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let i=e>1?`retry:attempt:${e}`:void 0;return nS(t,{callbacks:r?.getChild(i)})}async _invoke(e,t,r){return ah(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:({error:t})=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){let n={};try{await ah(async a=>{let s,o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(a,t?.[e],r?.[e])),c=await super.batch(l,u,{...i,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:({error:e})=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(i?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},fr=class e extends m8{static lc_name(){return"RunnableSequence"}first;middle=[];last;omitSequenceTags=!1;lc_serializable=!0;lc_namespace=["langchain_core","runnables"];constructor(e){super(e),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r,i=nE(t),n=await nx(i),a=await n?.handleChainStart(this.toJSON(),m3(e,"input"),i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let n=e[r].invoke(s,nS(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await nT(n,t?.signal)}if(t?.signal?.aborted)throw nA(t.signal);r=await this.last.invoke(s,nS(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(m3(r,"output")),r}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(nx)),a=await Promise.all(n.map(async(t,r)=>{let n=await t?.handleChainStart(this.toJSON(),m3(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,n})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,a.map((t,r)=>{let n=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return nS(i[r],{callbacks:n})}),r);s=await nT(t,i[0]?.signal)}}catch(e){throw await Promise.all(a.map(t=>t?.handleChainError(e))),e}return await Promise.all(a.map(e=>e?.handleChainEnd(m3(s,"output")))),s}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async *_streamIterator(e,t){let r,i=await nx(t),{runId:n,...a}=t??{},s=await i?.handleChainStart(this.toJSON(),m3(e,"input"),n,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),nS(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,nS(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let i of e)if(t?.signal?.throwIfAborted(),yield i,l)if(void 0===r)r=i;else try{r=this._concatOutputChunks(r,i)}catch{r=void 0,l=!1}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(m3(r,"output"))}getGraph(e){let t=new mH,r=null;return this.steps.forEach((i,n)=>{let a=i.getGraph(e);0!==n&&a.trimFirstNode(),n!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let s=a.firstNode();if(!s)throw Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,s),r=a.lastNode()}),t}pipe(t){return new e(e.isRunnableSequence(t)?{first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}:{first:this.first,middle:[...this.middle,this.last],last:fl(t),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&m8.isRunnable(e)}static from([t,...r],i){let n={};return"string"==typeof i?n.name=i:void 0!==i&&(n=i),new e({...n,first:fl(t),middle:r.slice(0,-1).map(fl),last:fl(r[r.length-1])})}},fi=class e extends m8{static lc_name(){return"RunnableMap"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;steps;getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(const[t,r]of(super(e),this.steps={},Object.entries(e.steps)))this.steps[t]=fl(r)}static from(t){return new e({steps:t})}async invoke(e,t){let r=nE(t),i=await nx(r),n=await i?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let a={};try{let i=Object.entries(this.steps).map(async([t,i])=>{a[t]=await i.invoke(e,nS(r,{callbacks:n?.getChild(`map:key:${t}`)}))});await nT(Promise.all(i),t?.signal)}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(a),a}async *_transform(e,t,r){let i={...this.steps},n=nj(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([e,i],a)=>{let s=i.transform(n[a],nS(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;a.size;){let e=Promise.race(a.values()),{key:t,result:i,gen:n}=await nT(e,r?.signal);a.delete(t),i.done||(yield{[t]:i.value},a.set(t,n.next().then(e=>({key:t,gen:n,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=nE(t),n=new nR({generator:this.transform(r(),i),config:i});return await n.setup,nC.fromAsyncGenerator(n)}},fn=class e extends m8{lc_serializable=!1;lc_namespace=["langchain_core","runnables"];func;constructor(e){if(super(e),!ij(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),i=await nx(r);return nT(this.func(nS(r,{callbacks:i}),e),r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(m2(i)){for await(let e of i)r?.signal?.throwIfAborted(),yield e;return}if(null!=i&&"object"==typeof i&&"next"in i&&"function"==typeof i.next){for(;;){r?.signal?.throwIfAborted();let e=i.next();if(e.done)break;yield e.value}return}yield i}static from(t){return new e({func:t})}},fa=class e extends m8{static lc_name(){return"RunnableLambda"}lc_namespace=["langchain_core","runnables"];func;constructor(e){if(ij(e.func))return fn.from(e.func);if(super(e),ij(e.func))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.");this.func=e.func}static from(t){return new e({func:t})}async _invoke(e,t,r){return new Promise((i,n)=>{let a=nS(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});i5.runWithConfig(nO(a),async()=>{try{let r=await this.func(e,{...a});if(r&&m8.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...a,recursionLimit:(a.recursionLimit??25)-1})}else if(m2(r)){let e;for await(let i of m9(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}else if(m4(r)){let e;for(let i of m6(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}i(r)}catch(e){n(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let i;for await(let t of e)if(void 0===i)i=t;else try{i=this._concatOutputChunks(i,t)}catch{i=t}let n=nS(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??25)-1}),a=await new Promise((e,t)=>{i5.runWithConfig(nO(n),async()=>{try{let t=await this.func(i,{...n,config:n});e(t)}catch(e){t(e)}})});if(a&&m8.isRunnable(a)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await a.stream(i,n)))yield e}else if(m2(a))for await(let e of m9(n,a))r?.signal?.throwIfAborted(),yield e;else if(m4(a))for(let e of m6(n,a))r?.signal?.throwIfAborted(),yield e;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=nE(t),n=new nR({generator:this.transform(r(),i),config:i});return await n.setup,nC.fromAsyncGenerator(n)}},fs=class extends fi{},fo=class extends m8{static lc_name(){return"RunnableWithFallbacks"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnable;fallbacks;constructor(e){super(e),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=nE(t),i=await nx(r),{runId:n,...a}=r,s=await i?.handleChainStart(this.toJSON(),m3(e,"input"),n,void 0,void 0,void 0,a?.runName),o=nS(a,{callbacks:s?.getChild()});return await i5.runWithConfig(o,async()=>{let t;for(let i of this.runnables()){r?.signal?.throwIfAborted();try{let t=await i.invoke(e,o);return await s?.handleChainEnd(m3(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,i,n,a=nE(t),s=await nx(a),{runId:o,...l}=a,u=await s?.handleChainStart(this.toJSON(),m3(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){a?.signal?.throwIfAborted();let n=nS(l,{callbacks:u?.getChild()});try{let r=await t.stream(e,n);i=m9(n,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===i){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of i){yield e;try{n=void 0===n?n:this._concatOutputChunks(n,e)}catch{n=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(m3(n,"output"))}async batch(e,t,r){let i;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),a=await Promise.all(n.map(e=>nx(e))),s=await Promise.all(a.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),m3(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName);return delete n[r].runId,i}));for(let t of this.runnables()){n[0].signal?.throwIfAborted();try{let i=await t.batch(e,s.map((e,t)=>nS(n[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(m3(i[t],"output")))),i}catch(e){void 0===i&&(i=e)}}if(!i)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(i))),i}};function fl(e){if("function"==typeof e)return new fa({func:e});if(m8.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,i]of Object.entries(e))t[r]=fl(i);return new fi({steps:t})}}var fu=class extends m8{static lc_name(){return"RunnableAssign"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;mapper;constructor(e){e instanceof fi&&(e={mapper:e}),super(e),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let i=this.mapper.getStepsKeys(),[n,a]=nj(e),s=this.mapper.transform(a,nS(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of n){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!i.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=nE(t),n=new nR({generator:this.transform(r(),i),config:i});return await n.setup,nC.fromAsyncGenerator(n)}},fc=class extends m8{static lc_name(){return"RunnablePick"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;keys;constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=nE(t),n=new nR({generator:this.transform(r(),i),config:i});return await n.setup,nC.fromAsyncGenerator(n)}},fd=class extends m7{name;description;schema;constructor(e){super({bound:fr.from([fa.from(async e=>{let t;if(e2(e))try{t=await dz(this.schema,e.args)}catch{throw new e6("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};let fh=(e,t)=>{let r=[...new Set(t?.map(e=>{if("string"==typeof e)return e;let t=new e({});if(!("getType"in t)||"function"!=typeof t.getType)throw Error("Invalid type provided.");return t.getType()}))],i=e.getType();return r.some(e=>e===i)};function fp(e,t){return Array.isArray(e)?fm(e,t):fa.from(t=>fm(t,e))}function fm(e,t={}){let{includeNames:r,excludeNames:i,includeTypes:n,excludeTypes:a,includeIds:s,excludeIds:o}=t,l=[];for(let t of e)if(!(i&&t.name&&i.includes(t.name))){if(a&&fh(t,a))continue;if(o&&t.id&&o.includes(t.id))continue;n||s||r?r&&t.name&&r.some(e=>e===t.name)||n&&fh(t,n)?l.push(t):s&&t.id&&s.some(e=>e===t.id)&&l.push(t):l.push(t)}return l}function ff(e){return Array.isArray(e)?fg(e):fa.from(fg)}function fg(e){if(!e.length)return[];let t=[];for(let r of e){let e=t.pop();if(e)if("tool"===r.getType()||r.getType()!==e.getType())t.push(e,r);else{let i=tP(e),n=tP(r),a=i.concat(n);"string"==typeof i.content&&"string"==typeof n.content&&(a.content=`${i.content}
${n.content}`),t.push(function(e){let t,r=e.getType(),i=Object.fromEntries(Object.entries(e).filter(([e])=>!["type","tool_call_chunks"].includes(e)&&!e.startsWith("lc_")));if(r in fw&&(t=f$(r,i)),!t)throw Error(`Unrecognized message chunk class ${r}. Supported classes are ${Object.keys(fw)}`);return t}(a))}else t.push(r)}return t}function fy(e,t){if(!Array.isArray(e))return fa.from(t=>fv(t,e)).withConfig({runName:"trim_messages"});if(!t)throw Error("Options parameter is required when providing messages.");return fv(e,t)}async function fv(e,t){let r,{maxTokens:i,tokenCounter:n,strategy:a="last",allowPartial:s=!1,endOn:o,startOn:l,includeSystem:u=!1,textSplitter:c}=t;if(l&&"first"===a)throw Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&"first"===a)throw Error("`includeSystem` should only be specified if `strategy` is 'last'.");r="getNumTokens"in n?async e=>(await Promise.all(e.map(e=>n.getNumTokens(e.content)))).reduce((e,t)=>e+t,0):async e=>n(e);let d=fx;if(c&&(d="splitText"in c?c.splitText:async e=>c(e)),"first"===a)return f_(e,{maxTokens:i,tokenCounter:r,textSplitter:d,partialStrategy:s?"first":void 0,endOn:o});if("last"===a)return fb(e,{maxTokens:i,tokenCounter:r,textSplitter:d,allowPartial:s,includeSystem:u,startOn:l,endOn:o});throw Error(`Unrecognized strategy: '${a}'. Must be one of 'first' or 'last'.`)}async function f_(e,t){let{maxTokens:r,tokenCounter:i,textSplitter:n,partialStrategy:a,endOn:s}=t,o=[...e],l=0;for(let e=0;e<o.length;e+=1){let t=e>0?o.slice(0,-e):o;if(await i(t)<=r){l=o.length-e;break}}if(l<o.length&&a){let e=!1;if(Array.isArray(o[l].content)){let t=o[l];if("string"==typeof t.content)throw Error("Expected content to be an array.");let n=t.content.length,s="last"===a?[...t.content].reverse():t.content;for(let u=1;u<=n;u+=1){let n="first"===a?s.slice(0,u):s.slice(-u),c=Object.fromEntries(Object.entries(t).filter(([e])=>"type"!==e&&!e.startsWith("lc_"))),d=f$(t.getType(),{...c,content:n}),h=[...o.slice(0,l),d];if(await i(h)<=r)o=h,l+=1,e=!0;else break}e&&"last"===a&&(t.content=[...s].reverse())}if(!e){let e,t=o[l];if(Array.isArray(t.content)&&t.content.some(e=>"string"==typeof e||"text"===e.type)){let r=t.content.find(e=>"text"===e.type&&e.text);e=r?.text}else"string"==typeof t.content&&(e=t.content);if(e){let s=await n(e),u=s.length;"last"===a&&s.reverse();for(let e=0;e<u-1;e+=1)if(s.pop(),t.content=s.join(""),await i([...o.slice(0,l),t])<=r){"last"===a&&(t.content=[...s].reverse().join("")),o=[...o.slice(0,l),t],l+=1;break}}}}if(s){let e=Array.isArray(s)?s:[s];for(;l>0&&!fh(o[l-1],e);)l-=1}return o.slice(0,l)}async function fb(e,t){let{allowPartial:r=!1,includeSystem:i=!1,endOn:n,startOn:a,...s}=t,o=e.map(e=>{let t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e&&!e.startsWith("lc_")));return f$(e.getType(),t,eJ(e))});if(n){let e=Array.isArray(n)?n:[n];for(;o.length>0&&!fh(o[o.length-1],e);)o=o.slice(0,-1)}let l=i&&o[0]?.getType()==="system",u=l?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return(u=await f_(u,{...s,partialStrategy:r?"last":void 0,endOn:a}),l)?[u[0],...u.slice(1).reverse()]:u.reverse()}let fw={human:{message:ta,messageChunk:ts},ai:{message:t$,messageChunk:tI},system:{message:tc,messageChunk:td},developer:{message:tc,messageChunk:td},tool:{message:eX,messageChunk:eY},function:{message:tt,messageChunk:tr},generic:{message:e3,messageChunk:e8},remove:{message:tu,messageChunk:tu}};function f$(e,t,r){let i,n;switch(e){case"human":r?i=new ts(t):n=new ta(t);break;case"ai":if(r){let e={...t};"tool_calls"in e&&(e={...e,tool_call_chunks:e.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),i=new tI(e)}else n=new t$(t);break;case"system":r?i=new td(t):n=new tc(t);break;case"developer":r?i=new td({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):n=new tc({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)r?i=new eY(t):n=new eX(t);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)i=new tr(t);else{if(!t.name)throw Error("FunctionMessage must have a 'name' field");n=new tt(t)}break;case"generic":if("role"in t)r?i=new e8(t):n=new e3(t);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${e}`)}if(r&&i)return i;if(n)return n;throw Error(`Unrecognized message type ${e}`)}function fx(e){let t=e.split("\n");return Promise.resolve([...t.slice(0,-1).map(e=>`${e}
`),t[t.length-1]])}let fk=["text","reasoning","tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result","image","video","audio","text-plain","file"];var fI={};G(fI,{AIMessage:()=>t$,AIMessageChunk:()=>tI,BaseMessage:()=>eM,BaseMessageChunk:()=>eq,ChatMessage:()=>e3,ChatMessageChunk:()=>e8,FunctionMessage:()=>tt,FunctionMessageChunk:()=>tr,HumanMessage:()=>ta,HumanMessageChunk:()=>ts,KNOWN_BLOCK_TYPES:()=>fk,RemoveMessage:()=>tu,SystemMessage:()=>tc,SystemMessageChunk:()=>td,ToolMessage:()=>eX,ToolMessageChunk:()=>eY,_isMessageFieldWithRole:()=>eG,_mergeDicts:()=>eF,_mergeLists:()=>eB,_mergeObj:()=>eV,_mergeStatus:()=>eD,coerceMessageLikeToMessage:()=>tT,collapseToolCallChunks:()=>tR,convertToChunk:()=>tP,convertToOpenAIImageBlock:()=>eg,convertToProviderContentBlock:()=>e_,defaultTextSplitter:()=>fx,defaultToolCallParser:()=>eQ,filterMessages:()=>fp,getBufferString:()=>tA,iife:()=>tE,isAIMessage:()=>tx,isAIMessageChunk:()=>tk,isBase64ContentBlock:()=>ep,isBaseMessage:()=>eW,isBaseMessageChunk:()=>eJ,isChatMessage:()=>e7,isChatMessageChunk:()=>te,isDataContentBlock:()=>ed,isDirectToolOutput:()=>eK,isFunctionMessage:()=>ti,isFunctionMessageChunk:()=>tn,isHumanMessage:()=>to,isHumanMessageChunk:()=>tl,isIDContentBlock:()=>ef,isMessage:()=>eU,isOpenAIToolCallArray:()=>eZ,isPlainTextContentBlock:()=>em,isSystemMessage:()=>th,isSystemMessageChunk:()=>tp,isToolMessage:()=>e0,isToolMessageChunk:()=>e1,isURLContentBlock:()=>eh,mapChatMessagesToStoredMessages:()=>tj,mapStoredMessageToChatMessage:()=>tN,mapStoredMessagesToChatMessages:()=>tC,mergeContent:()=>ez,mergeMessageRuns:()=>ff,mergeResponseMetadata:()=>t_,mergeUsageMetadata:()=>tw,parseBase64DataUrl:()=>ev,parseMimeType:()=>ey,trimMessages:()=>fy});var fE={};G(fE,{BaseChatMessageHistory:()=>fS,BaseListChatMessageHistory:()=>fO,InMemoryChatMessageHistory:()=>fT});var fS=class extends ec{async addMessages(e){for(let t of e)await this.addMessage(t)}},fO=class extends ec{addUserMessage(e){return this.addMessage(new ta(e))}addAIMessage(e){return this.addMessage(new t$(e))}async addMessages(e){for(let t of e)await this.addMessage(t)}clear(){throw Error("Not implemented.")}},fT=class extends fO{lc_namespace=["langchain","stores","message","in_memory"];messages=[];constructor(e){super(...arguments),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}},fA={};G(fA,{Embeddings:()=>fN});var fN=class{caller;constructor(e){this.caller=new ag(e??{})}},fC={},fj={};G(fj,{BaseMemory:()=>fP,getInputValue:()=>fU,getOutputValue:()=>fL,getPromptInputKey:()=>fz});var fP=class{};let fR=(e,t)=>{if(void 0!==t)return e[t];let r=Object.keys(e);if(1===r.length)return e[r[0]]},fU=(e,t)=>{let r=fR(e,t);if(!r){let t=Object.keys(e);throw Error(`input values have ${t.length} keys, you must specify an input key or pass only 1 key as input`)}return r},fL=(e,t)=>{let r=fR(e,t);if(!r&&""!==r){let t=Object.keys(e);throw Error(`output values have ${t.length} keys, you must specify an output key or pass only 1 key as output`)}return r};function fz(e,t){let r=Object.keys(e).filter(e=>!t.includes(e)&&"stop"!==e);if(1!==r.length)throw Error(`One input key expected, but got ${r.length}`);return r[0]}var fD={};G(fD,{BasePromptValue:()=>fM,ChatPromptValue:()=>fF,ImagePromptValue:()=>fB,StringPromptValue:()=>fZ});var fM=class extends ec{},fZ=class extends fM{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(e){super({value:e}),this.value=e}toString(){return this.value}toChatMessages(){return[new ta(this.value)]}},fF=class extends fM{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),this.messages=e.messages}toString(){return tA(this.messages)}toChatMessages(){return this.messages}},fB=class extends fM{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new ta({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},fV={};G(fV,{BaseStore:()=>fq,InMemoryStore:()=>fG});var fq=class extends ec{},fG=class extends fq{lc_namespace=["langchain","storage"];store={};async mget(e){return e.map(e=>this.store[e])}async mset(e){for(let[t,r]of e)this.store[t]=r}async mdelete(e){for(let t of e)delete this.store[t]}async *yieldKeys(e){for(let t of Object.keys(this.store))(void 0===e||t.startsWith(e))&&(yield t)}},fW={};G(fW,{BaseRetriever:()=>fJ});var fJ=class extends m8{callbacks;tags;metadata;verbose;constructor(e){super(e),this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,t){throw Error("Not implemented!")}async invoke(e,t){let r=nE(iJ(t)),i=await i1.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),n=await i?.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName);try{let t=await this._getRelevantDocuments(e,n);return await n?.handleRetrieverEnd(t),t}catch(e){throw await n?.handleRetrieverError(e),e}}},fH={};G(fH,{SaveableVectorStore:()=>fY,VectorStore:()=>fX,VectorStoreRetriever:()=>fK});var fK=class extends fJ{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}vectorStore;k=4;searchType="similarity";searchKwargs;filter;_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,"mmr"===e.searchType&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if("mmr"===this.searchType){if("function"!=typeof this.vectorStore.maxMarginalRelevanceSearch)throw Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t?.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}},fX=class extends ec{lc_namespace=["langchain","vectorstores",this._vectorstoreType()];embeddings;constructor(e,t){super(t),this.embeddings=e}async delete(e){throw Error("Not implemented.")}async similaritySearch(e,t=4,r,i){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(e=>e[0])}async similaritySearchWithScore(e,t=4,r,i){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,i){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,i,n,a){if("number"==typeof e)return new fK({vectorStore:this,k:e,filter:t,tags:[...i??[],this._vectorstoreType()],metadata:n,verbose:a,callbacks:r});{let t={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return new fK(e?.searchType==="mmr"?{...t,searchKwargs:e.searchKwargs}:{...t})}}},fY=class extends fX{static load(e,t){throw Error("Not implemented")}},fQ="0123456789abcdef".split(""),f0=[-0x80000000,8388608,32768,128],f1=[24,16,8,0],f4=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],f2=[];function f6(e,t){t?(f2[0]=f2[16]=f2[1]=f2[2]=f2[3]=f2[4]=f2[5]=f2[6]=f2[7]=f2[8]=f2[9]=f2[10]=f2[11]=f2[12]=f2[13]=f2[14]=f2[15]=0,this.blocks=f2):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}f6.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"===r){if(null===e)throw Error(ERROR);else if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw Error(ERROR)}else throw Error(ERROR);t=!0}for(var i,n,a=0,s=e.length,o=this.blocks;a<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(n=this.start;a<s&&n<64;++a)o[n>>>2]|=e[a]<<f1[3&n++];else for(n=this.start;a<s&&n<64;++a)(i=e.charCodeAt(a))<128?o[n>>>2]|=i<<f1[3&n++]:(i<2048?o[n>>>2]|=(192|i>>>6)<<f1[3&n++]:(i<55296||i>=57344?o[n>>>2]|=(224|i>>>12)<<f1[3&n++]:(i=65536+((1023&i)<<10|1023&e.charCodeAt(++a)),o[n>>>2]|=(240|i>>>18)<<f1[3&n++],o[n>>>2]|=(128|i>>>12&63)<<f1[3&n++]),o[n>>>2]|=(128|i>>>6&63)<<f1[3&n++]),o[n>>>2]|=(128|63&i)<<f1[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=o[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},f6.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=f0[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},f6.prototype.hash=function(){var e,t,r,i,n,a,s,o,l,u,c=this.h0,d=this.h1,h=this.h2,p=this.h3,m=this.h4,f=this.h5,g=this.h6,y=this.h7,v=this.blocks;for(e=16;e<64;++e)t=((n=v[e-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,r=((n=v[e-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,v[e]=v[e-16]+t+v[e-7]+r|0;for(e=0,u=d&h;e<64;e+=4)this.first?(this.is224?(s=300032,y=(n=v[0]-0x543c9a5b)-0x8f1a6c7|0,p=n+0x170e9b5|0):(s=0x2a01a605,y=(n=v[0]-0xc881298)-0x5ab00ac6|0,p=n+0x8909ae5|0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),i=(s=c&d)^c&h^u,n=y+r+(m&f^~m&g)+f4[e]+v[e],a=t+i,y=p+n|0,p=n+a|0),t=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),i=(o=p&c)^p&d^s,n=f+r+(g&y^~g&m)+f4[e+1]+v[e+1],a=t+i,g=h+n|0,t=((h=n+a|0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),i=(l=h&p)^h&c^o,n=m+r+(f&g^~f&y)+f4[e+2]+v[e+2],a=t+i,f=d+n|0,t=((d=n+a|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),i=(u=d&h)^d&p^l,n=m+r+(f&g^~f&y)+f4[e+3]+v[e+3],a=t+i,m=c+n|0,c=n+a|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+d|0,this.h2=this.h2+h|0,this.h3=this.h3+p|0,this.h4=this.h4+m|0,this.h5=this.h5+f|0,this.h6=this.h6+g|0,this.h7=this.h7+y|0},f6.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=fQ[e>>>28&15]+fQ[e>>>24&15]+fQ[e>>>20&15]+fQ[e>>>16&15]+fQ[e>>>12&15]+fQ[e>>>8&15]+fQ[e>>>4&15]+fQ[15&e]+fQ[t>>>28&15]+fQ[t>>>24&15]+fQ[t>>>20&15]+fQ[t>>>16&15]+fQ[t>>>12&15]+fQ[t>>>8&15]+fQ[t>>>4&15]+fQ[15&t]+fQ[r>>>28&15]+fQ[r>>>24&15]+fQ[r>>>20&15]+fQ[r>>>16&15]+fQ[r>>>12&15]+fQ[r>>>8&15]+fQ[r>>>4&15]+fQ[15&r]+fQ[i>>>28&15]+fQ[i>>>24&15]+fQ[i>>>20&15]+fQ[i>>>16&15]+fQ[i>>>12&15]+fQ[i>>>8&15]+fQ[i>>>4&15]+fQ[15&i]+fQ[n>>>28&15]+fQ[n>>>24&15]+fQ[n>>>20&15]+fQ[n>>>16&15]+fQ[n>>>12&15]+fQ[n>>>8&15]+fQ[n>>>4&15]+fQ[15&n]+fQ[a>>>28&15]+fQ[a>>>24&15]+fQ[a>>>20&15]+fQ[a>>>16&15]+fQ[a>>>12&15]+fQ[a>>>8&15]+fQ[a>>>4&15]+fQ[15&a]+fQ[s>>>28&15]+fQ[s>>>24&15]+fQ[s>>>20&15]+fQ[s>>>16&15]+fQ[s>>>12&15]+fQ[s>>>8&15]+fQ[s>>>4&15]+fQ[15&s];return this.is224||(l+=fQ[o>>>28&15]+fQ[o>>>24&15]+fQ[o>>>20&15]+fQ[o>>>16&15]+fQ[o>>>12&15]+fQ[o>>>8&15]+fQ[o>>>4&15]+fQ[15&o]),l},f6.prototype.toString=f6.prototype.hex,f6.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,255&o),l},f6.prototype.array=f6.prototype.digest,f6.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};let f9=(...e)=>new f6(!1,!0).update(e.join("")).hex();var f5={};G(f5,{sha256:()=>f9});var f3={};G(f3,{BaseCache:()=>gt,InMemoryCache:()=>gi,defaultHashKeyEncoder:()=>f8,deserializeStoredGeneration:()=>f7,serializeGeneration:()=>ge});let f8=(...e)=>f9(e.join("_"));function f7(e){return void 0!==e.message?{text:e.text,message:tN(e.message)}:{text:e.text}}function ge(e){let t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t}var gt=class{keyEncoder=f8;makeDefaultKeyEncoder(e){this.keyEncoder=e}};let gr=new Map;var gi=class e extends gt{cache;constructor(e){super(),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new e(gr)}},gn={};G(gn,{BaseDocumentLoader:()=>ga});var ga=class{},gs={};G(gs,{LangSmithLoader:()=>go});var go=class extends ga{datasetId;datasetName;exampleIds;asOf;splits;inlineS3Urls;offset;limit;metadata;filter;contentKey;formatContent;client;constructor(e){if(super(),e.client&&e.clientConfig)throw Error("client and clientConfig cannot both be provided.");this.client=e.client??new r5(e?.clientConfig),this.contentKey=e.contentKey?e.contentKey.split("."):[],this.formatContent=e.formatContent??gl,this.datasetId=e.datasetId,this.datasetName=e.datasetName,this.exampleIds=e.exampleIds,this.asOf=e.asOf,this.splits=e.splits,this.inlineS3Urls=e.inlineS3Urls,this.offset=e.offset,this.limit=e.limit,this.metadata=e.metadata,this.filter=e.filter}async load(){let e=[];for await(let t of this.client.listExamples({datasetId:this.datasetId,datasetName:this.datasetName,exampleIds:this.exampleIds,asOf:this.asOf,splits:this.splits,inlineS3Urls:this.inlineS3Urls,offset:this.offset,limit:this.limit,metadata:this.metadata,filter:this.filter})){let r=t.inputs;for(let e of this.contentKey)r=r[e];let i=this.formatContent(r),n=t;["created_at","modified_at"].forEach(e=>{e in n&&"object"==typeof n[e]&&(n[e]=n[e].toString())}),e.push({pageContent:i,metadata:n})}return e}};function gl(e){if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch{return String(e)}}var gu=class{pageContent;metadata;id;constructor(e){this.pageContent=void 0!==e.pageContent?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}},gc=class extends m8{lc_namespace=["langchain_core","documents","transformers"];invoke(e,t){return this.transformDocuments(e)}},gd=class extends gc{async transformDocuments(e){let t=[];for(let r of e){let e=await this._transformDocument(r);t.push(e)}return t}},gh={};G(gh,{BaseDocumentTransformer:()=>gc,Document:()=>gu,MappingDocumentTransformer:()=>gd});var gp=class extends ec{lc_namespace=["langchain_core","example_selectors","base"]},gm=class{async getPromptAsync(e,t){return this.getPrompt(e).partial(t?.partialVariables??{})}},gf=class extends gm{defaultPrompt;conditionals;constructor(e,t=[]){super(),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(let[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}};function gg(e){return"base_llm"===e._modelType()}function gy(e){return"base_chat_model"===e._modelType()}function gv(e){return e.split(/\n| /).length}var g_=class e extends gp{examples=[];examplePrompt;getTextLength=gv;maxLength=2048;exampleTextLengths=[];constructor(e){super(e),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??gv}async addExample(e){this.examples.push(e);let t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;let{examples:r,examplePrompt:i}=t;return(await Promise.all(r.map(e=>i.format(e)))).map(e=>this.getTextLength(e))}async selectExamples(e){let t=Object.values(e).join(" "),r=this.maxLength-this.getTextLength(t),i=0,n=[];for(;r>0&&i<this.examples.length;){let e=r-this.exampleTextLengths[i];if(e<0)break;n.push(this.examples[i]),r=e,i+=1}return n}static async fromExamples(t,r){let i=new e(r);return await Promise.all(t.map(e=>i.addExample(e))),i}};function gb(e){return Object.keys(e).sort().map(t=>e[t])}var gw=class e extends gp{vectorStoreRetriever;exampleKeys;inputKeys;constructor(e){if(super(e),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,void 0!==e.vectorStore)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else if(e.vectorStoreRetriever)this.vectorStoreRetriever=e.vectorStoreRetriever;else throw Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(e){let t=gb((this.inputKeys??Object.keys(e)).reduce((t,r)=>({...t,[r]:e[r]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new gu({pageContent:t,metadata:e})])}async selectExamples(e){let t=gb((this.inputKeys??Object.keys(e)).reduce((t,r)=>({...t,[r]:e[r]}),{})).join(" "),r=(await this.vectorStoreRetriever.invoke(t)).map(e=>e.metadata);return this.exampleKeys?r.map(e=>this.exampleKeys.reduce((t,r)=>({...t,[r]:e[r]}),{})):r}static async fromExamples(t,r,i,n={}){let a=n.inputKeys??null,s=t.map(e=>gb(a?a.reduce((t,r)=>({...t,[r]:e[r]}),{}):e).join(" "));return new e({vectorStore:await i.fromTexts(s,t,r,n),k:n.k??4,exampleKeys:n.exampleKeys,inputKeys:n.inputKeys})}},g$={};G(g$,{BaseExampleSelector:()=>gp,BasePromptSelector:()=>gm,ConditionalPromptSelector:()=>gf,LengthBasedExampleSelector:()=>g_,SemanticSimilarityExampleSelector:()=>gw,isChatModel:()=>gy,isLLM:()=>gg});let gx="10f90ea3-90a4-4962-bf75-83a0f3c1c62a";var gk=class extends ec{lc_namespace=["langchain","recordmanagers"]},gI=class{uid;hash_;contentHash;metadataHash;pageContent;metadata;keyEncoder=f9;constructor(e){this.uid=e.uid,this.pageContent=e.pageContent,this.metadata=e.metadata}makeDefaultKeyEncoder(e){this.keyEncoder=e}calculateHashes(){let e=["hash_","content_hash","metadata_hash"];for(let t of e)if(t in this.metadata)throw Error(`Metadata cannot contain key ${t} as it is reserved for internal use. Restricted keys: [${e.join(", ")}]`);let t=this._hashStringToUUID(this.pageContent);try{let e=this._hashNestedDictToUUID(this.metadata);this.contentHash=t,this.metadataHash=e}catch(e){throw Error(`Failed to hash metadata: ${e}. Please use a dict that can be serialized using json.`)}this.hash_=this._hashStringToUUID(this.contentHash+this.metadataHash),this.uid||(this.uid=this.hash_)}toDocument(){return new gu({pageContent:this.pageContent,metadata:this.metadata})}static fromDocument(e,t){let r=new this({pageContent:e.pageContent,metadata:e.metadata,uid:t||e.uid});return r.calculateHashes(),r}_hashStringToUUID(e){return ir(this.keyEncoder(e),gx)}_hashNestedDictToUUID(e){let t=JSON.stringify(e,Object.keys(e).sort());return ir(this.keyEncoder(t),gx)}};function gE(e,t){let r=[],i=[];return t.forEach(t=>{i.push(t),i.length>=e&&(r.push(i),i=[])}),i.length>0&&r.push(i),r}function gS(e){let t=new Set,r=[];for(let i of e){if(!i.hash_)throw Error("Hashed document does not have a hash");t.has(i.hash_)||(t.add(i.hash_),r.push(i))}return r}function gO(e){if(null===e)return e=>null;if("string"==typeof e)return t=>t.metadata[e];if("function"==typeof e)return e;throw Error(`sourceIdKey should be null, a string or a function, got ${typeof e}`)}let gT=e=>"load"in e&&"function"==typeof e.load&&"loadAndSplit"in e&&"function"==typeof e.loadAndSplit;async function gA(e){let{docsSource:t,recordManager:r,vectorStore:i,options:n}=e,{batchSize:a=100,cleanup:s,sourceIdKey:o,cleanupBatchSize:l=1e3,forceUpdate:u=!1}=n??{};if("incremental"===s&&!o)throw Error("sourceIdKey is required when cleanup mode is incremental. Please provide through 'options.sourceIdKey'.");let c=gT(t)?await t.load():t,d=gO(o??null),h=await r.getTime(),p=0,m=0,f=0,g=0;for(let e of gE(a??100,c)){let t=gS(e.map(e=>gI.fromDocument(e))),n=t.map(e=>d(e));"incremental"===s&&t.forEach((e,t)=>{if(null===n[t])throw Error("sourceIdKey must be provided when cleanup is incremental")});let a=await r.exists(t.map(e=>e.uid)),o=[],l=[],c=[],y=new Set;if(t.forEach((e,t)=>{if(a[t])if(!u)return void c.push(e.uid);else y.add(e.uid);o.push(e.uid),l.push(e.toDocument())}),c.length>0&&(await r.update(c,{timeAtLeast:h}),g+=c.length),l.length>0&&(await i.addDocuments(l,{ids:o}),p+=l.length-y.size,f+=y.size),await r.update(t.map(e=>e.uid),{timeAtLeast:h,groupIds:n}),"incremental"===s){n.forEach(e=>{if(!e)throw Error("Source id cannot be null")});let e=await r.listKeys({before:h,groupIds:n});e.length>0&&(await i.delete({ids:e}),await r.deleteKeys(e),m+=e.length)}}if("full"===s){let e=await r.listKeys({before:h,limit:l});for(;e.length>0;)await i.delete({ids:e}),await r.deleteKeys(e),m+=e.length,e=await r.listKeys({before:h,limit:l})}return{numAdded:p,numDeleted:m,numUpdated:f,numSkipped:g}}var gN={};G(gN,{RecordManager:()=>gk,UUIDV5_NAMESPACE:()=>gx,_HashedDocument:()=>gI,_batch:()=>gE,_deduplicateInOrder:()=>gS,_getSourceIdAssigner:()=>gO,_isBaseDocumentLoader:()=>gT,index:()=>gA});var gC=e.i(6920),gj=Object.defineProperty,gP=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(const[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,i,...n]=t.split(" "),a=Number.parseInt(i,10);return n.forEach((t,r)=>e[t]=a+r),e},{})))){const e=gC.default.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let i=RegExp(this.patStr,"ug"),n=gP.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=gP.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(i)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){a.push(r);continue}a.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let i=null;for(let n=0;n<r.length-1;n++){let a=e.slice(r[n].start,r[n+1].end),s=t.get(a.join(","));null!=s&&(null==i||s<i[0])&&(i=[s,n])}if(null!=i){let e=i[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];a.push(u),l=t.index+t[0].length}return a}decode(e){let t=[],r=0;for(let i=0;i<e.length;++i){let n=e[i],a=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=a&&(t.push(a),r+=a.length)}let i=new Uint8Array(r),n=0;for(let e of t)i.set(e,n),n+=e.length;return this.textDecoder.decode(i)}};g="specialTokenRegex",y=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),(d="symbol"!=typeof g?g+"":g)in gP?gj(gP,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):gP[d]=y;var gR={};G(gR,{encodingForModel:()=>gD,getEncoding:()=>gz});let gU={},gL=new ag({});async function gz(e){return e in gU||(gU[e]=gL.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new gP(e)).catch(t=>{throw delete gU[e],t})),await gU[e]}async function gD(e){return gz(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw Error("Unknown model")}}(e))}var gM={};G(gM,{BaseLangChain:()=>gG,BaseLanguageModel:()=>gW,calculateMaxTokens:()=>gq,getEmbeddingContextSize:()=>gF,getModelContextSize:()=>gB,getModelNameForTiktoken:()=>gZ,isOpenAITool:()=>gV});let gZ=e=>e.startsWith("gpt-5")?"gpt-5":e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,gF=e=>"text-embedding-ada-002"===e?8191:2046,gB=e=>{switch(gZ(e)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":case"gemini-pro":case"gemini-pro-vision":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":default:return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6}};function gV(e){return"object"==typeof e&&!!e&&("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&!!e.function&&"name"in e.function&&"parameters"in e.function||!1)}let gq=async({prompt:e,modelName:t})=>{let r;try{r=(await gD(gZ(t))).encode(e).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return gB(t)-r};var gG=class extends m8{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},gW=class extends gG{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...n}=r;super({callbacks:e??t,...n}),"object"==typeof i?this.cache=i:i?this.cache=gi.global():this.cache=void 0,this.caller=new ag(r??{})}_encoding;async getNumTokens(e){let t,r=Math.ceil((t="string"==typeof e?e:e.map(e=>"string"==typeof e?e:"text"===e.type&&"text"in e?e.text:"").join("")).length/4);if(!this._encoding)try{this._encoding=await gD("modelName"in this?gZ(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new fZ(e):Array.isArray(e)?new fF(e.map(tT)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}get profile(){return{}}},gJ=class extends m8{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(e){super(e),e&&(this.func=e.func)}async invoke(e,t){let r=nE(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r,i=nE(t),n=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,i))if(yield t,n)if(void 0===r)r=t;else try{r=nP(r,t)}catch{r=void 0,n=!1}this.func&&void 0!==r&&await this.func(r,i)}static assign(e){return new fu(new fi({steps:e}))}};function gH(e){return new e.constructor({...e,content:e.contentBlocks,response_metadata:{...e.response_metadata,output_version:"v1"}})}var gK={};function gX(e){let t=[];for(let r of e){let e=r;if(Array.isArray(r.content))for(let t=0;t<r.content.length;t++){let i=r.content[t];(eh(i)||ep(i))&&e===r&&(e=new r.constructor({...e,content:[...r.content.slice(0,t),eg(i),...r.content.slice(t+1)]}))}t.push(e)}return t}G(gK,{BaseChatModel:()=>gY,SimpleChatModel:()=>gQ});var gY=class e extends gW{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(e){super(e),this.outputVersion=(()=>{let t=e.outputVersion??tV("LC_OUTPUT_VERSION");return t&&["v0","v1"].includes(t)?t:"v0"})()}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,r);else{let i,n,a=e._convertInputToPromptValue(t).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(r),l={...s.metadata,...this.getLsParams(o)},u=await i1.configure(s.callbacks,this.callbacks,s.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this?.invocationParams(o),batch_size:1},d=o.outputVersion??this.outputVersion,h=await u?.handleChatModelStart(this.toJSON(),[gX(a)],s.runId,void 0,c,void 0,void 0,s.runName);try{for await(let e of this._streamResponseChunks(a,o,h?.[0])){if(null==e.message.id){let t=h?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},"v1"===d?yield gH(e.message):yield e.message,i=i?i.concat(e):e,tk(e.message)&&void 0!==e.message.usage_metadata&&(n={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((h??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((h??[]).map(e=>e?.handleLLMEnd({generations:[[i]],llmOutput:n})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(t,r,i,n){let a,s=t.map(e=>e.map(tT));if(void 0!==n&&n.length===s.length)a=n;else{let e={...i.metadata,...this.getLsParams(r)},t=await i1.configure(i.callbacks,this.callbacks,i.tags,this.tags,e,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:1};a=await t?.handleChatModelStart(this.toJSON(),s.map(gX),i.runId,void 0,n,void 0,void 0,i.runName)}let o=r.outputVersion??this.outputVersion,l=[],u=[];if(a?.[0].handlers.find(t2)&&!this.disableStreaming&&1===s.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e,t;for await(let i of(await this._streamResponseChunks(s[0],r,a?.[0]))){if(null==i.message.id){let e=a?.at(0)?.runId;null!=e&&i.message._updateId(`run-${e}`)}e=void 0===e?i:nP(e,i),tk(i.message)&&void 0!==i.message.usage_metadata&&(t={tokenUsage:{promptTokens:i.message.usage_metadata.input_tokens,completionTokens:i.message.usage_metadata.output_tokens,totalTokens:i.message.usage_metadata.total_tokens}})}if(void 0===e)throw Error("Received empty response from chat model call.");l.push([e]),await a?.[0].handleLLMEnd({generations:l,llmOutput:t})}catch(e){throw await a?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(s.map(async(e,t)=>{let i=await this._generate(e,{...r,promptIndex:t},a?.[t]);if("v1"===o)for(let e of i.generations)e.message=gH(e.message);return i}));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await a?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=a?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),l[t]=r.generations,u[t]=r.llmOutput,a?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let c={generations:l,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(c,ai,{value:a?{runIds:a?.map(e=>e.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:t,cache:r,llmStringKey:i,parsedOptions:n,handledOptions:a}){let s=t.map(e=>e.map(tT)),o={...a.metadata,...this.getLsParams(n)},l=await i1.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:n,invocation_params:this?.invocationParams(n),batch_size:1},c=await l?.handleChatModelStart(this.toJSON(),s.map(gX),a.runId,void 0,u,void 0,void 0,a.runName),d=[],h=(await Promise.allSettled(s.map(async(t,n)=>{let a=e._convertInputToPromptValue(t).toString(),s=await r.lookup(a,i);return null==s&&d.push(n),s}))).map((e,t)=>({result:e,runManager:c?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),p=n.outputVersion??this.outputVersion,m=[];await Promise.all(h.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return m[r]=i.map(e=>("message"in e&&eW(e.message)&&tx(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},"v1"===p&&(e.message=gH(e.message))),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let f={generations:m,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(f,ai,{value:c?{runIds:c?.map(e=>e.runId)}:void 0,configurable:!0}),f}async generate(t,r,i){let n;n=Array.isArray(r)?{stop:r}:r;let a=t.map(e=>e.map(tT)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(n);if(s.callbacks=s.callbacks??i,!this.cache)return this._generateUncached(a,o,s);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:s}),p={};if(d.length>0){let t=await this._generateUncached(d.map(e=>a[e]),o,s,void 0!==h?d.map(e=>h?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=d[r];c[i]=t;let n=e._convertInputToPromptValue(a[i]).toString();return l.update(n,u,t)})),p=t.llmOutput??{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){let i=e.map(e=>e.toChatMessages());return this.generate(i,t,r)}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw Error('"strict" mode is not supported for this model by default.');let i=t?.name,n=dZ(e)??"A function available to call.",a=t?.method,s=t?.includeRaw;if("jsonMode"===a)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=i??"extract";dj(e)?r=[{type:"function",function:{name:o,description:n,parameters:mZ(e)}}]:("name"in e&&(o=e.name),r=[{type:"function",function:{name:o,description:n,parameters:e}}]);let l=this.bindTools(r),u=fa.from(e=>{if(!tI.isInstance(e))throw Error("Input is not an AIMessageChunk.");if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===o);if(!t)throw Error(`No tool call found with name ${o}.`);return t.args});if(!s)return l.pipe(u).withConfig({runName:"StructuredOutput"});let c=gJ.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),d=gJ.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return fr.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}},gQ=class extends gY{async _generate(e,t,r){let i=new t$(await this._call(e,t,r));if("string"!=typeof i.content)throw Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}},g0={};G(g0,{BaseLLM:()=>g1,LLM:()=>g4});var g1=class e extends gW{lc_namespace=["langchain","llms",this._llmType()];async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].text}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks)yield this.invoke(t,r);else{let i=e._convertInputToPromptValue(t),[n,a]=this._separateRunnableConfigFromCallOptionsCompat(r),s=await i1.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this?.invocationParams(a),batch_size:1},l=await s?.handleLLMStart(this.toJSON(),[i.toString()],n.runId,void 0,o,void 0,void 0,n.runName),u=new an({text:""});try{for await(let e of this._streamResponseChunks(i.toString(),a,l?.[0]))u=u?u.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((l??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((l??[]).map(e=>e?.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){let i=e.map(e=>e.toString());return this.generate(i,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){let t=[];for(let r=0;r<e.generations.length;r+=1){let i=e.generations[r];if(0===r)t.push({generations:[i],llmOutput:e.llmOutput});else{let r=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[i],llmOutput:r})}}return t}async _generateUncached(t,r,i,n){let a,s;if(void 0!==n&&n.length===t.length)a=n;else{let e=await i1.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:t.length};a=await e?.handleLLMStart(this.toJSON(),t,i.runId,void 0,n,void 0,void 0,i?.runName)}if(a?.[0].handlers.find(t2)&&1===t.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e;for await(let i of(await this._streamResponseChunks(t[0],r,a?.[0])))e=void 0===e?i:nP(e,i);if(void 0===e)throw Error("Received empty response from chat model call.");s={generations:[[e]],llmOutput:{}},await a?.[0].handleLLMEnd(s)}catch(e){throw await a?.[0].handleLLMError(e),e}else{try{s=await this._generate(t,r,a?.[0])}catch(e){throw await Promise.all((a??[]).map(t=>t?.handleLLMError(e))),e}let e=this._flattenLLMResult(s);await Promise.all((a??[]).map((t,r)=>t?.handleLLMEnd(e[r])))}let o=a?.map(e=>e.runId)||void 0;return Object.defineProperty(s,ai,{value:o?{runIds:o}:void 0,configurable:!0}),s}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:n,runId:a}){let s=await i1.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this?.invocationParams(i),batch_size:e.length},l=await s?.handleLLMStart(this.toJSON(),e,a,void 0,o,void 0,void 0,n?.runName),u=[],c=(await Promise.allSettled(e.map(async(e,i)=>{let n=await t.lookup(e,r);return null==n&&u.push(i),n}))).map((e,t)=>({result:e,runManager:l?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),d=[];await Promise.all(c.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return d[r]=i.map(e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let h={generations:d,missingPromptIndices:u,startedRunManagers:l};return Object.defineProperty(h,ai,{value:l?{runIds:l?.map(e=>e.runId)}:void 0,configurable:!0}),h}async generate(e,t,r){let i;if(!Array.isArray(e))throw Error("Argument 'prompts' is expected to be a string[]");i=Array.isArray(t)?{stop:t}:t;let[n,a]=this._separateRunnableConfigFromCallOptionsCompat(i);if(n.callbacks=n.callbacks??r,!this.cache)return this._generateUncached(e,a,n);let{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(a),{generations:l,missingPromptIndices:u,startedRunManagers:c}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:a,handledOptions:n,runId:n.runId}),d={};if(u.length>0){let t=await this._generateUncached(u.map(t=>e[t]),a,n,void 0!==c?u.map(e=>c?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=u[r];return l[i]=t,s.update(e[i],o,t)})),d=t.llmOutput??{}}return{generations:l,llmOutput:d}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},g4=class extends g1{async _generate(e,t,r){return{generations:await Promise.all(e.map((e,i)=>this._call(e,{...t,promptIndex:i},r).then(e=>[{text:e}])))}}},g2={},g6={};G(g6,{BaseDocumentCompressor:()=>g9});var g9=class{static isBaseDocumentCompressor(e){return e?.compressDocuments!==void 0}},g5=class extends m8{lc_serializable=!0;lc_namespace=["langchain_core","prompts",this._getPromptType()];get lc_attributes(){return{partialVariables:void 0}}inputVariables;outputParser;partialVariables;metadata;tags;constructor(e){super(e);const{inputVariables:t}=e;if(t.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[e,i]of Object.entries(t))"string"==typeof i?r[e]=i:r[e]=await i();return{...r,...e}}async invoke(e,t){let r={...this.metadata,...t?.metadata},i=[...this.tags??[],...t?.tags??[]];return this._callWithConfig(e=>this.formatPromptValue(e),e,{...t,tags:i,metadata:r,runType:"prompt"})}},g3=class extends g5{async formatPromptValue(e){return new fZ(await this.format(e))}},g8=Object.prototype.toString,g7=Array.isArray||function(e){return"[object Array]"===g8.call(e)};function ye(e){return"function"==typeof e}function yt(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function yr(e,t){return null!=e&&"object"==typeof e&&t in e}var yi=RegExp.prototype.test,yn=/\S/,ya={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},ys=/\s*/,yo=/\s+/,yl=/\s*=/,yu=/\s*\}/,yc=/#|\^|\/|>|\{|&|=|!/;function yd(e){this.string=e,this.tail=e,this.pos=0}function yh(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function yp(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}yd.prototype.eos=function(){return""===this.tail},yd.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},yd.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case -1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},yh.prototype.push=function(e){return new yh(e,this)},yh.prototype.lookup=function(e){var t=this.cache;if(t.hasOwnProperty(e))n=t[e];else{for(var r,i,n,a,s,o,l=this,u=!1;l;){if(e.indexOf(".")>0)for(a=l.view,s=e.split("."),o=0;null!=a&&o<s.length;)o===s.length-1&&(u=yr(a,s[o])||(r=a,i=s[o],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(i))),a=a[s[o++]];else a=l.view[e],u=yr(l.view,e);if(u){n=a;break}l=l.parent}t[e]=n}return ye(n)&&(n=n.call(this.view)),n},yp.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},yp.prototype.parse=function(e,t){var r=this.templateCache,i=e+":"+(t||ym.tags).join(":"),n=void 0!==r,a=n?r.get(i):void 0;return void 0==a&&(a=function(e,t){if(!e)return[];var r,i,n,a,s,o,l,u,c,d=!1,h=[],p=[],m=[],f=!1,g=!1,y="",v=0;function _(){if(f&&!g)for(;m.length;)delete p[m.pop()];else m=[];f=!1,g=!1}function b(e){if("string"==typeof e&&(e=e.split(yo,2)),!g7(e)||2!==e.length)throw Error("Invalid tags: "+e);r=RegExp(yt(e[0])+"\\s*"),i=RegExp("\\s*"+yt(e[1])),n=RegExp("\\s*"+yt("}"+e[1]))}b(t||ym.tags);for(var w=new yd(e);!w.eos();){if(a=w.pos,o=w.scanUntil(r))for(var $=0,x=o.length;$<x;++$)!function(e){return!yi.call(yn,e)}(l=o.charAt($))?(g=!0,d=!0,y+=" "):(m.push(p.length),y+=l),p.push(["text",l,a,a+1]),a+=1,"\n"===l&&(_(),y="",v=0,d=!1);if(!w.scan(r))break;if(f=!0,s=w.scan(yc)||"name",w.scan(ys),"="===s?(o=w.scanUntil(yl),w.scan(yl),w.scanUntil(i)):"{"===s?(o=w.scanUntil(n),w.scan(yu),w.scanUntil(i),s="&"):o=w.scanUntil(i),!w.scan(i))throw Error("Unclosed tag at "+w.pos);if(u=">"==s?[s,o,a,w.pos,y,v,d]:[s,o,a,w.pos],v++,p.push(u),"#"===s||"^"===s)h.push(u);else if("/"===s){if(!(c=h.pop()))throw Error('Unopened section "'+o+'" at '+a);if(c[1]!==o)throw Error('Unclosed section "'+c[1]+'" at '+a)}else"name"===s||"{"===s||"&"===s?g=!0:"="===s&&b(o)}if(_(),c=h.pop())throw Error('Unclosed section "'+c[1]+'" at '+w.pos);return function(e){for(var t,r=[],i=r,n=[],a=0,s=e.length;a<s;++a)switch((t=e[a])[0]){case"#":case"^":i.push(t),n.push(t),i=t[4]=[];break;case"/":n.pop()[5]=t[2],i=n.length>0?n[n.length-1][4]:r;break;default:i.push(t)}return r}(function(e){for(var t,r,i=[],n=0,a=e.length;n<a;++n)(t=e[n])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(i.push(t),r=t));return i}(p))}(e,t),n&&r.set(i,a)),a},yp.prototype.render=function(e,t,r,i){var n=this.getConfigTags(i),a=this.parse(e,n),s=t instanceof yh?t:new yh(t,void 0);return this.renderTokens(a,s,r,e,i)},yp.prototype.renderTokens=function(e,t,r,i,n){for(var a,s,o,l="",u=0,c=e.length;u<c;++u)o=void 0,"#"===(s=(a=e[u])[0])?o=this.renderSection(a,t,r,i,n):"^"===s?o=this.renderInverted(a,t,r,i,n):">"===s?o=this.renderPartial(a,t,r,n):"&"===s?o=this.unescapedValue(a,t):"name"===s?o=this.escapedValue(a,t,n):"text"===s&&(o=this.rawValue(a)),void 0!==o&&(l+=o);return l},yp.prototype.renderSection=function(e,t,r,i,n){var a=this,s="",o=t.lookup(e[1]);if(o){if(g7(o))for(var l=0,u=o.length;l<u;++l)s+=this.renderTokens(e[4],t.push(o[l]),r,i,n);else if("object"==typeof o||"string"==typeof o||"number"==typeof o)s+=this.renderTokens(e[4],t.push(o),r,i,n);else if(ye(o)){if("string"!=typeof i)throw Error("Cannot use higher-order sections without the original template");null!=(o=o.call(t.view,i.slice(e[3],e[5]),function(e){return a.render(e,t,r,n)}))&&(s+=o)}else s+=this.renderTokens(e[4],t,r,i,n);return s}},yp.prototype.renderInverted=function(e,t,r,i,n){var a=t.lookup(e[1]);if(!a||g7(a)&&0===a.length)return this.renderTokens(e[4],t,r,i,n)},yp.prototype.indentPartial=function(e,t,r){for(var i=t.replace(/[^ \t]/g,""),n=e.split("\n"),a=0;a<n.length;a++)n[a].length&&(a>0||!r)&&(n[a]=i+n[a]);return n.join("\n")},yp.prototype.renderPartial=function(e,t,r,i){if(r){var n=this.getConfigTags(i),a=ye(r)?r(e[1]):r[e[1]];if(null!=a){var s=e[6],o=e[5],l=e[4],u=a;0==o&&l&&(u=this.indentPartial(a,l,s));var c=this.parse(u,n);return this.renderTokens(c,t,r,u,i)}}},yp.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},yp.prototype.escapedValue=function(e,t,r){var i=this.getConfigEscape(r)||ym.escape,n=t.lookup(e[1]);if(null!=n)return"number"==typeof n&&i===ym.escape?String(n):i(n)},yp.prototype.rawValue=function(e){return e[1]},yp.prototype.getConfigTags=function(e){return g7(e)?e:e&&"object"==typeof e?e.tags:void 0},yp.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!g7(e)?e.escape:void 0};var ym={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(cache){yf.templateCache=cache},get templateCache(){return yf.templateCache}},yf=new yp;function yg(){ym.escape=e=>e}ym.clearCache=function(){return yf.clearCache()},ym.parse=function(e,t){return yf.parse(e,t)},ym.render=function(e,t,r,i){if("string"!=typeof e)throw TypeError('Invalid template! Template should be a "string" but "'+(g7(e)?"array":typeof e)+'" was given as the first argument for mustache#render(template, view, partials)');return yf.render(e,t,r,i)},ym.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return ya[e]})},ym.Scanner=yd,ym.Context=yh,ym.Writer=yp;let yy=e=>{let t=e.split(""),r=[],i=(e,r)=>{for(let i=r;i<t.length;i+=1)if(e.includes(t[i]))return i;return -1},n=0;for(;n<t.length;)if("{"===t[n]&&n+1<t.length&&"{"===t[n+1])r.push({type:"literal",text:"{"}),n+=2;else if("}"===t[n]&&n+1<t.length&&"}"===t[n+1])r.push({type:"literal",text:"}"}),n+=2;else if("{"===t[n]){let e=i("}",n);if(e<0)throw Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(n+1,e).join("")}),n=e+1}else if("}"===t[n])throw Error("Single '}' in template.");else{let e=i("{}",n),a=(e<0?t.slice(n):t.slice(n,e)).join("");r.push({type:"literal",text:a}),n=e<0?t.length:e}return r},yv=(e,t=[])=>{let r=[];for(let i of e)if("name"===i[0]){let e=i[1].includes(".")?i[1].split(".")[0]:i[1];r.push({type:"variable",name:e})}else if(["#","&","^",">"].includes(i[0])){if(r.push({type:"variable",name:i[1]}),"#"===i[0]&&i.length>4&&Array.isArray(i[4])){let e=[...t,i[1]],n=yv(i[4],e);r.push(...n)}}else r.push({type:"literal",text:i[1]});return r},y_=e=>(yg(),yv(ym.parse(e))),yb=(e,t)=>yy(e).reduce((e,r)=>{if("variable"===r.type){if(r.name in t)return e+("string"==typeof t[r.name]?t[r.name]:JSON.stringify(t[r.name]));throw Error(`(f-string) Missing value for input ${r.name}`)}return e+r.text},""),yw=(e,t)=>(yg(),ym.render(e,t)),y$={"f-string":yb,mustache:yw},yx={"f-string":yy,mustache:y_},yk=(e,t,r)=>{try{return y$[t](e,r)}catch(e){throw e4(e,"INVALID_PROMPT_INPUT")}},yI=(e,t)=>yx[t](e),yE=(e,t,r)=>{if(!(t in y$)){let e=Object.keys(y$);throw Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${e}`)}try{let i=r.reduce((e,t)=>(e[t]="foo",e),{});Array.isArray(e)?e.forEach(e=>{if("text"===e.type&&"text"in e&&"string"==typeof e.text)yk(e.text,t,i);else if("image_url"===e.type){if("string"==typeof e.image_url)yk(e.image_url,t,i);else if("object"==typeof e.image_url&&null!==e.image_url&&"url"in e.image_url&&"string"==typeof e.image_url.url){let r=e.image_url.url;yk(r,t,i)}}else throw Error(`Invalid message template received. ${JSON.stringify(e,null,2)}`)}):yk(e,t,i)}catch(e){throw Error(`Invalid prompt schema: ${e.message}`)}};var yS=class e extends g3{static lc_name(){return"PromptTemplate"}template;templateFormat="f-string";validateTemplate=!0;additionalContentFields;constructor(e){if(super(e),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if("mustache"===this.templateFormat)throw Error("Mustache templates cannot be validated.");let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),yE(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return yk(this.template,this.templateFormat,t)}static fromExamples(t,r,i,n="\n\n",a=""){return new e({inputVariables:i,template:[a,...t,r].join(n)})}static fromTemplate(t,r){let{templateFormat:i="f-string",...n}=r??{},a=new Set;return yI(t,i).forEach(e=>{"variable"===e.type&&a.add(e.name)}),new e({inputVariables:[...a],templateFormat:i,template:t,...n})}async partial(t){let r=this.inputVariables.filter(e=>!(e in t)),i={...this.partialVariables??{},...t};return new e({...this,inputVariables:r,partialVariables:i})}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(t){if(!t.template)throw Error("Prompt template must have a template");return new e({inputVariables:t.input_variables,template:t.template,templateFormat:t.template_format})}},yO=class e extends g5{static lc_name(){return"ImagePromptTemplate"}lc_namespace=["langchain_core","prompts","image"];template;templateFormat="f-string";validateTemplate=!0;additionalContentFields;constructor(e){if(super(e),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),yE([{type:"image_url",image_url:this.template}],this.templateFormat,e)}}_getPromptType(){return"prompt"}async partial(t){let r=this.inputVariables.filter(e=>!(e in t)),i={...this.partialVariables??{},...t};return new e({...this,inputVariables:r,partialVariables:i})}async format(e){let t={};for(let[r,i]of Object.entries(this.template))"string"==typeof i?t[r]=yk(i,this.templateFormat,e):t[r]=i;let r=e.url||t.url,i=e.detail||t.detail;if(!r)throw Error("Must provide either an image URL.");if("string"!=typeof r)throw Error("url must be a string.");let n={url:r};return i&&(n.detail=i),n}async formatPromptValue(e){return new fB(await this.format(e))}},yT=class extends m8{lc_namespace=["langchain_core","prompts","dict"];lc_serializable=!0;template;templateFormat;inputVariables;static lc_name(){return"DictPromptTemplate"}constructor(e){const t=e.templateFormat??"f-string",r=function e(t,r){let i=[];for(let n of Object.values(t))if("string"==typeof n)yI(n,r).forEach(e=>{"variable"===e.type&&i.push(e.name)});else if(Array.isArray(n))for(let t of n)"string"==typeof t?yI(t,r).forEach(e=>{"variable"===e.type&&i.push(e.name)}):"object"==typeof t&&i.push(...e(t,r));else"object"==typeof n&&null!==n&&i.push(...e(n,r));return Array.from(new Set(i))}(e.template,t);super({inputVariables:r,...e}),this.template=e.template,this.templateFormat=t,this.inputVariables=r}async format(e){return function e(t,r,i){let n={};for(let[a,s]of Object.entries(t))if("string"==typeof s)n[a]=yk(s,i,r);else if(Array.isArray(s)){let t=[];for(let n of s)"string"==typeof n?t.push(yk(n,i,r)):"object"==typeof n&&t.push(e(n,r,i));n[a]=t}else"object"==typeof s&&null!==s?n[a]=e(s,r,i):n[a]=s;return n}(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}},yA=class extends m8{lc_namespace=["langchain_core","prompts","chat"];lc_serializable=!0;async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}},yN=class extends yA{static lc_name(){return"MessagesPlaceholder"}variableName;optional;constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t,r=e[this.variableName];if(this.optional&&!r)return[];if(!r){let e=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw e.name="InputFormatError",e}try{t=Array.isArray(r)?r.map(tT):[tT(r)]}catch(i){let e="string"==typeof r?r:JSON.stringify(r,null,2),t=Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.

Received value: ${e}

Additional message: ${i.message}`);throw t.name="InputFormatError",t.lc_error_code=i.lc_error_code,t}return t}},yC=class extends yA{prompt;constructor(e){"prompt"in e||(e={prompt:e}),super(e),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},yj=class extends g5{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){return new fF(await this.formatMessages(e))}},yP=class extends yC{static lc_name(){return"ChatMessagePromptTemplate"}role;constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),this.role=e.role}async format(e){return new e3(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(yS.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}},yR=class extends yA{lc_namespace=["langchain_core","prompts","chat"];lc_serializable=!0;inputVariables=[];additionalOptions={};prompt;messageClass;static _messageClass(){throw Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}chatMessageClass;constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),this.prompt=e.prompt,Array.isArray(this.prompt)){let e=[];this.prompt.forEach(t=>{"inputVariables"in t&&(e=e.concat(t.inputVariables))}),this.inputVariables=e}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass())return new(t._messageClass())({content:e});if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}throw Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw Error("Invalid message class name")}}static fromTemplate(e,t){if("string"==typeof e)return new this(yS.fromTemplate(e,t));let r=[];for(let i of e)if("string"==typeof i)r.push(yS.fromTemplate(i,t));else if(null===i);else if(!(null===i||"object"!=typeof i||Array.isArray(i))&&1===Object.keys(i).length&&"text"in i&&"string"==typeof i.text){let e="";"string"==typeof i.text&&(e=i.text??"");let n={...t,additionalContentFields:i};r.push(yS.fromTemplate(e,n))}else if(!(null===i||"object"!=typeof i||Array.isArray(i))&&"image_url"in i&&("string"==typeof i.image_url||"object"==typeof i.image_url&&null!==i.image_url&&"url"in i.image_url&&"string"==typeof i.image_url.url)){let e,n=i.image_url??"",a=[];if("string"==typeof n){let r=(t?.templateFormat==="mustache"?y_(n):yy(n)).flatMap(e=>"variable"===e.type?[e.name]:[]);if((r?.length??0)>0){if(r.length>1)throw Error(`Only one format variable allowed per image template.
Got: ${r}
From: ${n}`);a=[r[0]]}else a=[];e=new yO({template:n={url:n},inputVariables:a,templateFormat:t?.templateFormat,additionalContentFields:i})}else if("object"==typeof n){if("url"in n)a=(t?.templateFormat==="mustache"?y_(n.url):yy(n.url)).flatMap(e=>"variable"===e.type?[e.name]:[]);else a=[];e=new yO({template:n,inputVariables:a,templateFormat:t?.templateFormat,additionalContentFields:i})}else throw Error("Invalid image template");r.push(e)}else"object"==typeof i&&r.push(new yT({template:i,templateFormat:t?.templateFormat}));return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof g3){let t=await this.prompt.format(e);return this.createMessage(t)}{let t=[];for(let r of this.prompt){let i={};if(!("inputVariables"in r))throw Error(`Prompt ${r} does not have inputVariables defined.`);for(let t of r.inputVariables)i={...i,[t]:e[t]};if(r instanceof g3){let e,n=await r.format(i);"additionalContentFields"in r&&(e=r.additionalContentFields),""!==n&&t.push({...e,type:"text",text:n})}else if(r instanceof yO){let e,n=await r.format(i);"additionalContentFields"in r&&(e=r.additionalContentFields),t.push({...e,type:"image_url",image_url:n})}else if(r instanceof yT){let e,n=await r.format(i);"additionalContentFields"in r&&(e=r.additionalContentFields),t.push({...e,...n})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},yU=class extends yR{static _messageClass(){return ta}static lc_name(){return"HumanMessagePromptTemplate"}},yL=class extends yR{static _messageClass(){return t$}static lc_name(){return"AIMessagePromptTemplate"}},yz=class extends yR{static _messageClass(){return tc}static lc_name(){return"SystemMessagePromptTemplate"}},yD=class e extends yj{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}promptMessages;validateTemplate=!0;templateFormat="f-string";constructor(e){if(super(e),"mustache"===e.templateFormat&&void 0===e.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof eM))for(const r of t.inputVariables)e.add(r);const t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),i=new Set([...r].filter(t=>!e.has(t)));if(i.size>0)throw Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const n=new Set([...e].filter(e=>!r.has(e)));if(n.size>0)throw Error(`Input variables \`${[...n]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let r=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type)return e;let r="";"string"==typeof e.image_url?r=e.image_url:"object"==typeof e.image_url&&null!==e.image_url&&"url"in e.image_url&&"string"==typeof e.image_url.url&&(r=e.image_url.url);let i=yS.fromTemplate(r,{templateFormat:this.templateFormat}),n=await i.format(t);return"object"==typeof e.image_url&&null!==e.image_url&&"url"in e.image_url?e.image_url.url=n:e.image_url=n,e}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let e of this.promptMessages)if(e instanceof eM)r.push(await this._parseImagePrompts(e,t));else{let i;i="mustache"===this.templateFormat?{...t}:e.inputVariables.reduce((r,i)=>{if(!(i in t)&&!("MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw e4(Error(`Missing value for input variable \`${i.toString()}\``),"INVALID_PROMPT_INPUT");return r[i]=t[i],r},{});let n=await e.formatMessages(i);r=r.concat(n)}return r}async partial(t){let r=this.inputVariables.filter(e=>!(e in t)),i={...this.partialVariables??{},...t};return new e({...this,inputVariables:r,partialVariables:i})}static fromTemplate(e,t){let r=new yU({prompt:yS.fromTemplate(e,t)});return this.fromMessages([r])}static fromMessages(t,r){let i=t.reduce((t,i)=>t.concat(i instanceof e?i.promptMessages:[function(e,t){let r;if("function"==typeof e.formatMessages||eW(e))return e;if(Array.isArray(e)&&"placeholder"===e[0]){let r=e[1];if(t?.templateFormat==="mustache"&&"string"==typeof r&&"{{"===r.slice(0,2)&&"}}"===r.slice(-2))return new yN({variableName:r.slice(2,-2),optional:!0});if("string"==typeof r&&"{"===r[0]&&"}"===r[r.length-1])return new yN({variableName:r.slice(1,-1),optional:!0});throw Error(`Invalid placeholder template for format ${t?.templateFormat??'"f-string"'}: "${e[1]}". Expected a variable name surrounded by ${t?.templateFormat==="mustache"?"double":"single"} curly braces.`)}let i=tT(e);if(r="string"==typeof i.content?i.content:i.content.map(e=>"text"in e?{...e,text:e.text}:"image_url"in e?{...e,image_url:e.image_url}:e),"human"===i._getType())return yU.fromTemplate(r,t);if("ai"===i._getType())return yL.fromTemplate(r,t);if("system"===i._getType())return yz.fromTemplate(r,t);if(e3.isInstance(i))return yP.fromTemplate(i.content,i.role,t);throw Error(`Could not coerce message prompt template from input. Received message type: "${i._getType()}".`)}(i,r)]),[]),n=t.reduce((t,r)=>r instanceof e?Object.assign(t,r.partialVariables):t,Object.create(null)),a=new Set;for(let e of i)if(!(e instanceof eM))for(let t of e.inputVariables)t in n||a.add(t);return new this({...r,inputVariables:[...a],promptMessages:i,partialVariables:n,templateFormat:r?.templateFormat})}},yM=class e extends g3{lc_serializable=!1;examples;exampleSelector;examplePrompt;suffix="";exampleSeparator="\n\n";prefix="";templateFormat="f-string";validateTemplate=!0;constructor(e){if(super(e),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),yE(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(t){let r=this.inputVariables.filter(e=>!(e in t)),i={...this.partialVariables??{},...t};return new e({...this,inputVariables:r,partialVariables:i})}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),i=await Promise.all(r.map(e=>this.examplePrompt.format(e)));return yk([this.prefix,...i,this.suffix].join(this.exampleSeparator),this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(t){let r,{example_prompt:i}=t;if(!i)throw Error("Missing example prompt");let n=await yS.deserialize(i);if(Array.isArray(t.examples))r=t.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new e({inputVariables:t.input_variables,examplePrompt:n,examples:r,exampleSeparator:t.example_separator,prefix:t.prefix,suffix:t.suffix,templateFormat:t.template_format})}},yZ=class e extends yj{lc_serializable=!0;examples;exampleSelector;examplePrompt;suffix="";exampleSeparator="\n\n";prefix="";templateFormat="f-string";validateTemplate=!0;_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),yE(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(e=>{let t={};return this.examplePrompt.inputVariables.forEach(r=>{t[r]=e[r]}),t});let i=[];for(let e of r){let t=await this.examplePrompt.formatMessages(e);i.push(...t)}return i}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),i=(await Promise.all(r.map(e=>this.examplePrompt.formatMessages(e)))).flat().map(e=>e.content);return yk([this.prefix,...i,this.suffix].join(this.exampleSeparator),this.templateFormat,t)}async partial(t){let r=this.inputVariables.filter(e=>!(e in t)),i={...this.partialVariables??{},...t};return new e({...this,inputVariables:r,partialVariables:i})}},yF=class e extends g5{static lc_name(){return"PipelinePromptTemplate"}pipelinePrompts;finalPrompt;constructor(e){super({...e,inputVariables:[]}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){let e=this.pipelinePrompts.map(e=>e.name);return[...new Set(this.pipelinePrompts.map(t=>t.prompt.inputVariables.filter(t=>!e.includes(t))).flat())]}static extractRequiredInputValues(e,t){return t.reduce((t,r)=>(t[r]=e[r],t),{})}async formatPipelinePrompts(t){let r=await this.mergePartialAndUserVariables(t);for(let{name:t,prompt:i}of this.pipelinePrompts){let n=e.extractRequiredInputValues(r,i.inputVariables);i instanceof yD?r[t]=await i.formatMessages(n):r[t]=await i.format(n)}return e.extractRequiredInputValues(r,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(t){let r={...this};return r.inputVariables=this.inputVariables.filter(e=>!(e in t)),r.partialVariables={...this.partialVariables??{},...t},new e(r)}serialize(){throw Error("Not implemented.")}_getPromptType(){return"pipeline"}};function yB(e){return"object"==typeof e&&null!=e&&"withStructuredOutput"in e&&"function"==typeof e.withStructuredOutput}var yV=class e extends yD{schema;method;lc_namespace=["langchain_core","prompts","structured"];get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}constructor(e){super(e),this.schema=e.schema,this.method=e.method}pipe(e){if(yB(e))return super.pipe(e.withStructuredOutput(this.schema));if("object"==typeof e&&null!=e&&"lc_id"in e&&Array.isArray(e.lc_id)&&"langchain_core/runnables/RunnableBinding"===e.lc_id.join("/")&&yB(e.bound))return super.pipe(new m7({bound:e.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:e.kwargs??{},config:e.config,configFactories:e.configFactories}));throw Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(t,r,i){return e.fromMessages(t,{schema:r,method:i})}},yq={};G(yq,{AIMessagePromptTemplate:()=>yL,BaseChatPromptTemplate:()=>yj,BaseMessagePromptTemplate:()=>yA,BaseMessageStringPromptTemplate:()=>yC,BasePromptTemplate:()=>g5,BaseStringPromptTemplate:()=>g3,ChatMessagePromptTemplate:()=>yP,ChatPromptTemplate:()=>yD,DEFAULT_FORMATTER_MAPPING:()=>y$,DEFAULT_PARSER_MAPPING:()=>yx,DictPromptTemplate:()=>yT,FewShotChatMessagePromptTemplate:()=>yZ,FewShotPromptTemplate:()=>yM,HumanMessagePromptTemplate:()=>yU,ImagePromptTemplate:()=>yO,MessagesPlaceholder:()=>yN,PipelinePromptTemplate:()=>yF,PromptTemplate:()=>yS,StructuredPrompt:()=>yV,SystemMessagePromptTemplate:()=>yz,checkValidTemplate:()=>yE,interpolateFString:()=>yb,interpolateMustache:()=>yw,parseFString:()=>yy,parseMustache:()=>y_,parseTemplate:()=>yI,renderTemplate:()=>yk});var yG=class extends m8{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(e){super(e),this.runnables=e.runnables}async invoke(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.invoke(i,nE(t))}async batch(e,t,r){let i=e.map(e=>e.key),n=e.map(e=>e.input);if(void 0!==i.find(e=>void 0===this.runnables[e]))throw Error("One or more keys do not have a corresponding runnable.");let a=i.map(e=>this.runnables[e]),s=this._getOptionsList(t??{},e.length),o=s[0]?.maxConcurrency??r?.maxConcurrency,l=o&&o>0?o:e.length,u=[];for(let e=0;e<n.length;e+=l){let t=n.slice(e,e+l).map((e,t)=>a[t].invoke(e,s[t])),r=await Promise.all(t);u.push(r)}return u.flat()}async stream(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.stream(i,t)}},yW=class extends m8{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(e){super(e),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw Error("RunnableBranch requires at least one branch");return new this({branches:e.slice(0,-1).map(([e,t])=>[fl(e),fl(t)]),default:fl(e[e.length-1])})}async _invoke(e,t,r){let i;for(let n=0;n<this.branches.length;n+=1){let[a,s]=this.branches[n];if(await a.invoke(e,nS(t,{callbacks:r?.getChild(`condition:${n+1}`)}))){i=await s.invoke(e,nS(t,{callbacks:r?.getChild(`branch:${n+1}`)}));break}}return i||(i=await this.default.invoke(e,nS(t,{callbacks:r?.getChild("branch:default")}))),i}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async *_streamIterator(e,t){let r,i,n=await nx(t),a=await n?.handleChainStart(this.toJSON(),m3(e,"input"),t?.runId,void 0,void 0,void 0,t?.runName),s=!0;try{for(let n=0;n<this.branches.length;n+=1){let[o,l]=this.branches[n];if(await o.invoke(e,nS(t,{callbacks:a?.getChild(`condition:${n+1}`)}))){for await(let o of i=await l.stream(e,nS(t,{callbacks:a?.getChild(`branch:${n+1}`)})))if(yield o,s)if(void 0===r)r=o;else try{r=nP(r,o)}catch{r=void 0,s=!1}break}}if(void 0===i){for await(let n of i=await this.default.stream(e,nS(t,{callbacks:a?.getChild("branch:default")})))if(yield n,s)if(void 0===r)r=n;else try{r=nP(r,n)}catch{r=void 0,s=!1}}}catch(e){throw await a?.handleChainError(e),e}await a?.handleChainEnd(r??{})}},yJ=class extends m7{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(e){let t=fa.from((e,t)=>this._enterHistory(e,t??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=gJ.assign({[r]:t}).withConfig({runName:"insertHistory"})),super({...e,config:e.config??{},bound:t.pipe(e.runnable.withListeners({onEnd:(e,t)=>this._exitHistory(e,t??{})})).withConfig({runName:"RunnableWithMessageHistory"})}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if("object"!=typeof e||Array.isArray(e)||eW(e))t=e;else{let r;r=this.inputMessagesKey?this.inputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"input",t=Array.isArray(e[r])&&Array.isArray(e[r][0])?e[r][0]:e[r]}if("string"==typeof t)return[new ta(t)];if(Array.isArray(t))return t;if(eW(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(Array.isArray(e)||eW(e)||"string"==typeof e)t=e;else{let r;r=void 0!==this.outputMessagesKey?this.outputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"output",t=void 0!==e.generations?e.generations[0][0].message:e[r]}if("string"==typeof t)return[new t$(t)];if(Array.isArray(t))return t;if(eW(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let r=t?.configurable?.messageHistory,i=await r.getMessages();return void 0===this.historyMessagesKey?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,t){let r,i=t.configurable?.messageHistory;r=Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?e.inputs[0]:e.inputs;let n=this._getInputMessages(r);if(void 0===this.historyMessagesKey){let e=await i.getMessages();n=n.slice(e.length)}let a=e.outputs;if(!a)throw Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let s=this._getOutputMessages(a);await i.addMessages([...n,...s])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let e={[this.inputMessagesKey??"input"]:"foo"};throw Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(e)}, ${JSON.stringify({configurable:{sessionId:"123"}})})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}},yH={};G(yH,{RouterRunnable:()=>yG,Runnable:()=>m8,RunnableAssign:()=>fu,RunnableBinding:()=>m7,RunnableBranch:()=>yW,RunnableEach:()=>fe,RunnableLambda:()=>fa,RunnableMap:()=>fi,RunnableParallel:()=>fs,RunnablePassthrough:()=>gJ,RunnablePick:()=>fc,RunnableRetry:()=>ft,RunnableSequence:()=>fr,RunnableToolLike:()=>fd,RunnableWithFallbacks:()=>fo,RunnableWithMessageHistory:()=>yJ,_coerceToRunnable:()=>fl,ensureConfig:()=>nE,getCallbackManagerForConfig:()=>nx,mergeConfigs:()=>nk,patchConfig:()=>nS,pickRunnableConfigKeys:()=>nO,raceWithSignal:()=>nT});var yK={};G(yK,{applyPatch:()=>nQ,compare:()=>n6});var yX=class extends m8{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}},yY=class extends yX{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}},yQ=class extends Error{llmOutput;observation;sendToLLM;constructor(e,t,r,i=!1){if(super(e),this.llmOutput=t,this.observation=r,this.sendToLLM=i,i&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");e4(this,"OUTPUT_PARSING_FAILURE")}},y0=class extends yY{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},y1=class extends y0{diff=!1;constructor(e){super(e),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let i of e){let e;if("string"!=typeof i&&"string"!=typeof i.content)throw Error("Cannot handle non-string output.");if(eJ(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new aa({message:i,text:i.content})}else if(eW(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new aa({message:tP(i),text:i.content})}else e=new an({text:i});r=void 0===r?e:r.concat(e);let n=await this.parsePartialResult([r]);null==n||mb(n,t)||(this.diff?yield this._diff(t,n):yield n,t=n)}}getFormatInstructions(){return""}},y4=class extends y1{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?n6(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return e9(e[0].text)}async parse(e){return e9(e,JSON.parse)}getFormatInstructions(){return""}};function y2(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=e5(e.function.arguments??"{}")}catch{return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new yQ([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"\nare not valid JSON.",`Error: ${t.message}`].join("\n"))}let i={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(i.id=e.id),i}function y6(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function y9(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}var y5=class extends y1{static lc_name(){return"JsonOutputToolsParser"}returnId=!1;lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;constructor(e){super(e),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r,i=e[0].message;if(tx(i)&&i.tool_calls?.length?r=i.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==i.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(i.additional_kwargs.tool_calls)).map(e=>y2(e,{returnId:this.returnId,partial:t}))),!r)return[];let n=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};n.push(t)}return n}},y3=class extends y5{static lc_name(){return"JsonOutputKeyToolsParser"}lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;returnId=!1;keyName;returnSingle=!1;zodSchema;constructor(e){super(e),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await dL(this.zodSchema,e);if(t.success)return t.data;throw new yQ(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;if(t.length)return(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}},y8={};G(y8,{JsonOutputKeyToolsParser:()=>y3,JsonOutputToolsParser:()=>y5,convertLangChainToolCallToOpenAI:()=>y6,makeInvalidToolCall:()=>y9,parseToolCall:()=>y2});var y7={},ve={};G(ve,{RunCollectorCallbackHandler:()=>vt});var vt=class extends ig{name="run_collector";exampleId;tracedRuns;constructor({exampleId:e}={}){super({_awaitHandler:!0}),this.exampleId=e,this.tracedRuns=[]}async persistRun(e){let t={...e};t.reference_example_id=this.exampleId,this.tracedRuns.push(t)}},vr=class extends yX{static lc_name(){return"OutputFunctionsParser"}lc_namespace=["langchain","output_parsers","openai_functions"];lc_serializable=!0;argsOnly=!0;constructor(e){super(),this.argsOnly=e?.argsOnly??this.argsOnly}async parseResult(e){if("message"in e[0]){let t=e[0].message.additional_kwargs.function_call;if(!t)throw Error(`No function_call in message ${JSON.stringify(e)}`);if(!t.arguments)throw Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?t.arguments:JSON.stringify(t)}throw Error(`No message in generations ${JSON.stringify(e)}`)}},vi=class extends y1{static lc_name(){return"JsonOutputFunctionsParser"}lc_namespace=["langchain","output_parsers","openai_functions"];lc_serializable=!0;outputParser;argsOnly=!0;constructor(e){super(e),this.argsOnly=e?.argsOnly??this.argsOnly,this.outputParser=new vr(e)}_diff(e,t){if(t)return n6(e??{},t)}async parsePartialResult(e){let t=e[0];if(!t.message)return;let{message:r}=t,i=r.additional_kwargs.function_call;if(i)return this.argsOnly?e5(i.arguments):{...i,arguments:e5(i.arguments)}}async parseResult(e){let t=await this.outputParser.parseResult(e);if(!t)throw Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(t)}async parse(e){let t=JSON.parse(e);return this.argsOnly||(t.arguments=JSON.parse(t.arguments)),t}getFormatInstructions(){return""}},vn=class extends yX{static lc_name(){return"JsonKeyOutputFunctionsParser"}lc_namespace=["langchain","output_parsers","openai_functions"];lc_serializable=!0;outputParser=new vi;attrName;get lc_aliases(){return{attrName:"key_name"}}constructor(e){super(e),this.attrName=e.attrName}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}},va={};G(va,{JsonKeyOutputFunctionsParser:()=>vn,JsonOutputFunctionsParser:()=>vi,OutputFunctionsParser:()=>vr});var vs={};G(vs,{chunkArray:()=>vo});let vo=(e,t)=>e.reduce((e,r,i)=>{let n=Math.floor(i/t),a=e[n]||[];return e[n]=a.concat([r]),e},[]);function vl(e){return void 0!==e&&Array.isArray(e.lc_namespace)}function vu(e){return void 0!==e&&m8.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()}function vc(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&(dj(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))}function vd(e){return vc(e)||vu(e)||vl(e)}var vh={};function vp(e,t){let r="number"==typeof t?void 0:t;return{name:e.name,description:e.description,parameters:mZ(e.schema),...r?.strict!==void 0?{strict:r.strict}:{}}}function vm(e,t){let r,i="number"==typeof t?void 0:t;return r=vd(e)?{type:"function",function:vp(e)}:e,i?.strict!==void 0&&(r.function.strict=i.strict),r}G(vh,{convertToOpenAIFunction:()=>vp,convertToOpenAITool:()=>vm,isLangChainTool:()=>vd,isRunnableToolLike:()=>vu,isStructuredTool:()=>vl,isStructuredToolParams:()=>vc});let vf={and:"and",or:"or",not:"not"},vg={eq:"eq",ne:"ne",lt:"lt",gt:"gt",lte:"lte",gte:"gte"};var vy=class{},vv=class{accept(e){if("Operation"===this.exprName)return e.visitOperation(this);if("Comparison"===this.exprName)return e.visitComparison(this);if("StructuredQuery"===this.exprName)return e.visitStructuredQuery(this);throw Error("Unknown Expression type")}},v_=class extends vv{},vb=class extends v_{exprName="Comparison";constructor(e,t,r){super(),this.comparator=e,this.attribute=t,this.value=r}},vw=class extends v_{exprName="Operation";constructor(e,t){super(),this.operator=e,this.args=t}},v$=class extends vv{exprName="StructuredQuery";constructor(e,t){super(),this.query=e,this.filter=t}};function vx(e){return e&&"object"==typeof e&&!Array.isArray(e)}function vk(e){return!e||("string"!=typeof e||!(e.length>0))&&"function"!=typeof e&&vx(e)&&0===Object.keys(e).length}function vI(e){if("number"==typeof e)return e%1==0;if("string"==typeof e){let t=parseInt(e,10);return!Number.isNaN(t)&&t%1==0&&t.toString()===e}return!1}function vE(e){if("number"==typeof e)return e%1!=0;if("string"==typeof e){let t=parseFloat(e);return!Number.isNaN(t)&&t%1!=0&&t.toString()===e}return!1}function vS(e){return"string"==typeof e&&(Number.isNaN(parseFloat(e))||parseFloat(e).toString()!==e)}function vO(e){return"boolean"==typeof e}function vT(e){let t;if(vS(e))t=e;else if(vI(e))t=parseInt(e,10);else if(vE(e))t=parseFloat(e);else if(vO(e))t=!!e;else throw Error("Unsupported value type");return t}var vA=class extends vy{},vN=class extends vA{allowedOperators;allowedComparators;constructor(e){super(),this.allowedOperators=e?.allowedOperators??[vf.and,vf.or],this.allowedComparators=e?.allowedComparators??[vg.eq,vg.ne,vg.gt,vg.gte,vg.lt,vg.lte]}formatFunction(e){if(e in vg){if(this.allowedComparators.length>0&&-1===this.allowedComparators.indexOf(e))throw Error(`Comparator ${e} not allowed. Allowed comparators: ${this.allowedComparators.join(", ")}`)}else if(e in vf){if(this.allowedOperators.length>0&&-1===this.allowedOperators.indexOf(e))throw Error(`Operator ${e} not allowed. Allowed operators: ${this.allowedOperators.join(", ")}`)}else throw Error("Unknown comparator or operator");return`$${e}`}visitOperation(e){let t=e.args?.map(e=>e.accept(this));return{[this.formatFunction(e.operator)]:t}}visitComparison(e){return{[e.attribute]:{[this.formatFunction(e.comparator)]:vT(e.value)}}}visitStructuredQuery(e){let t={};return e.filter&&(t={filter:e.filter.accept(this)}),t}mergeFilters(e,t,r="and",i=!1){if(!(vk(e)&&vk(t))){if(vk(e)||"replace"===r){if(vk(t))return;return t}if(vk(t)){if(i)return e;if("and"===r)return;return e}if("and"===r)return{$and:[e,t]};if("or"===r)return{$or:[e,t]};throw Error("Unknown merge type")}}},vC=class extends vA{allowedOperators=[vf.and,vf.or];allowedComparators=[vg.eq,vg.ne,vg.gt,vg.gte,vg.lt,vg.lte];formatFunction(){throw Error("Not implemented")}getAllowedComparatorsForType(e){switch(e){case"string":case"number":return[vg.eq,vg.ne,vg.gt,vg.gte,vg.lt,vg.lte];case"boolean":return[vg.eq,vg.ne];default:throw Error(`Unsupported data type: ${e}`)}}getComparatorFunction(e){switch(e){case vg.eq:return(e,t)=>e===t;case vg.ne:return(e,t)=>e!==t;case vg.gt:return(e,t)=>e>t;case vg.gte:return(e,t)=>e>=t;case vg.lt:return(e,t)=>e<t;case vg.lte:return(e,t)=>e<=t;default:throw Error("Unknown comparator")}}getOperatorFunction(e){switch(e){case vf.and:return(e,t)=>e&&t;case vf.or:return(e,t)=>e||t;default:throw Error("Unknown operator")}}visitOperation(e){let{operator:t,args:r}=e;if(this.allowedOperators.includes(t)){let e=this.getOperatorFunction(t);return t=>!r||r.reduce((r,i)=>{let n=i.accept(this);if("function"==typeof n)return e(r,n(t));throw Error("Filter is not a function")},!0)}throw Error("Operator not allowed")}visitComparison(e){let{comparator:t,attribute:r,value:i}=e,n=[vg.ne];if(this.allowedComparators.includes(t)){if(!this.getAllowedComparatorsForType(typeof i).includes(t))throw Error(`'${t}' comparator not allowed to be used with ${typeof i}`);let e=this.getComparatorFunction(t);return a=>{let s=a.metadata[r];return void 0===s?!!n.includes(t):e(s,vT(i))}}throw Error("Comparator not allowed")}visitStructuredQuery(e){if(!e.filter)return{};let t=e.filter?.accept(this);if("function"!=typeof t)throw Error("Structured query filter is not a function");return{filter:t}}mergeFilters(e,t,r="and"){if(!(vk(e)&&vk(t))){if(vk(e)||"replace"===r){if(vk(t))return;return t}if(vk(t)){if("and"===r)return;return e}if("and"===r)return r=>e(r)&&t(r);if("or"===r)return r=>e(r)||t(r);throw Error("Unknown merge type")}}},vj={};G(vj,{BaseTranslator:()=>vA,BasicTranslator:()=>vN,Comparators:()=>vg,Comparison:()=>vb,Expression:()=>vv,FilterDirective:()=>v_,FunctionalTranslator:()=>vC,Operation:()=>vw,Operators:()=>vf,StructuredQuery:()=>v$,Visitor:()=>vy,castValue:()=>vT,isBoolean:()=>vO,isFilterEmpty:()=>vk,isFloat:()=>vE,isInt:()=>vI,isObject:()=>vx,isString:()=>vS});var m5=p9;e.s(["ZodAny",()=>ba,"ZodArray",()=>bf,"ZodBase64",()=>_R,"ZodBase64URL",()=>_L,"ZodBigInt",()=>_6,"ZodBigIntFormat",()=>_5,"ZodBoolean",()=>_4,"ZodCIDRv4",()=>_N,"ZodCIDRv6",()=>_j,"ZodCUID",()=>_f,"ZodCUID2",()=>_y,"ZodCatch",()=>b9,"ZodCodec",()=>wt,"ZodCustom",()=>wp,"ZodCustomStringFormat",()=>_B,"ZodDate",()=>bp,"ZodDefault",()=>bX,"ZodDiscriminatedUnion",()=>bk,"ZodE164",()=>_D,"ZodEmail",()=>v7,"ZodEmoji",()=>_d,"ZodEnum",()=>bL,"ZodFile",()=>bF,"ZodFunction",()=>wd,"ZodGUID",()=>_t,"ZodIPv4",()=>_I,"ZodIPv6",()=>_T,"ZodIntersection",()=>bE,"ZodJWT",()=>_Z,"ZodKSUID",()=>_x,"ZodLazy",()=>wo,"ZodLiteral",()=>bM,"ZodMAC",()=>_S,"ZodMap",()=>bj,"ZodNaN",()=>b3,"ZodNanoID",()=>_p,"ZodNever",()=>bu,"ZodNonOptional",()=>b1,"ZodNull",()=>bi,"ZodNullable",()=>bJ,"ZodNumber",()=>_J,"ZodNumberFormat",()=>_K,"ZodObject",()=>bv,"ZodOptional",()=>bG,"ZodPipe",()=>b7,"ZodPrefault",()=>bQ,"ZodPromise",()=>wu,"ZodReadonly",()=>wi,"ZodRecord",()=>bA,"ZodSet",()=>bR,"ZodString",()=>v5,"ZodStringFormat",()=>v8,"ZodSuccess",()=>b2,"ZodSymbol",()=>_7,"ZodTemplateLiteral",()=>wa,"ZodTransform",()=>bV,"ZodTuple",()=>bO,"ZodType",()=>v6,"ZodULID",()=>__,"ZodURL",()=>_l,"ZodUUID",()=>_i,"ZodUndefined",()=>bt,"ZodUnion",()=>b$,"ZodUnknown",()=>bo,"ZodVoid",()=>bd,"ZodXID",()=>_w,"_ZodString",()=>v9,"_default",()=>bY,"_function",()=>wh,"any",()=>bs,"array",()=>bg,"base64",()=>_U,"base64url",()=>_z,"bigint",()=>_9,"boolean",()=>_2,"catch",()=>b5,"check",()=>wm,"cidrv4",()=>_C,"cidrv6",()=>_P,"codec",()=>wr,"cuid",()=>_g,"cuid2",()=>_v,"custom",()=>wf,"date",()=>bm,"describe",()=>wv,"discriminatedUnion",()=>bI,"e164",()=>_M,"email",()=>_e,"emoji",()=>_h,"enum",()=>bz,"file",()=>bB,"float32",()=>_Y,"float64",()=>_Q,"function",()=>wh,"guid",()=>_r,"hash",()=>_W,"hex",()=>_G,"hostname",()=>_q,"httpUrl",()=>_c,"instanceof",()=>wb,"int",()=>_X,"int32",()=>_0,"int64",()=>_3,"intersection",()=>bS,"ipv4",()=>_E,"ipv6",()=>_A,"json",()=>w$,"jwt",()=>_F,"keyof",()=>by,"ksuid",()=>_k,"lazy",()=>wl,"literal",()=>bZ,"looseObject",()=>bw,"mac",()=>_O,"map",()=>bP,"meta",()=>w_,"nan",()=>b8,"nanoid",()=>_m,"nativeEnum",()=>bD,"never",()=>bc,"nonoptional",()=>b4,"null",()=>bn,"nullable",()=>bH,"nullish",()=>bK,"number",()=>_H,"object",()=>b_,"optional",()=>bW,"partialRecord",()=>bC,"pipe",()=>we,"prefault",()=>b0,"preprocess",()=>wx,"promise",()=>wc,"readonly",()=>wn,"record",()=>bN,"refine",()=>wg,"set",()=>bU,"strictObject",()=>bb,"string",()=>v3,"stringFormat",()=>_V,"stringbool",()=>ww,"success",()=>b6,"superRefine",()=>wy,"symbol",()=>be,"templateLiteral",()=>ws,"transform",()=>bq,"tuple",()=>bT,"uint32",()=>_1,"uint64",()=>_8,"ulid",()=>_b,"undefined",()=>br,"union",()=>bx,"unknown",()=>bl,"url",()=>_u,"uuid",()=>_n,"uuidv4",()=>_a,"uuidv6",()=>_s,"uuidv7",()=>_o,"void",()=>bh,"xid",()=>_$],7855);var vP=e.i(21131),vP=vP,dT=dT;e.s([],64328),e.s(["ZodISODate",()=>vL,"ZodISODateTime",()=>vR,"ZodISODuration",()=>vZ,"ZodISOTime",()=>vD,"date",()=>vz,"datetime",()=>vU,"duration",()=>vF,"time",()=>vM],51047);let vR=av("ZodISODateTime",(e,t)=>{lm.init(e,t),v8.init(e,t)});function vU(e){return cr(vR,e)}let vL=av("ZodISODate",(e,t)=>{lf.init(e,t),v8.init(e,t)});function vz(e){return ci(vL,e)}let vD=av("ZodISOTime",(e,t)=>{lg.init(e,t),v8.init(e,t)});function vM(e){return cn(vD,e)}let vZ=av("ZodISODuration",(e,t)=>{ly.init(e,t),v8.init(e,t)});function vF(e){return ca(vZ,e)}let vB=(e,t)=>{s$.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>sI(e,t)},flatten:{value:t=>sk(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,aN,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,aN,2)}},isEmpty:{get:()=>0===e.issues.length}})},vV=av("ZodError",vB),vq=av("ZodError",vB,{Parent:Error});e.s(["ZodError",0,vV,"ZodRealError",0,vq],15874);let vG=sT(vq),vW=sN(vq),vJ=sj(vq),vH=sR(vq),vK=sL(vq),vX=sD(vq),vY=sZ(vq),vQ=sB(vq),v0=sq(vq),v1=sW(vq),v4=sH(vq),v2=sX(vq);e.s(["decode",0,vX,"decodeAsync",0,vQ,"encode",0,vK,"encodeAsync",0,vY,"parse",0,vG,"parseAsync",0,vW,"safeDecode",0,v1,"safeDecodeAsync",0,v2,"safeEncode",0,v0,"safeEncodeAsync",0,v4,"safeParse",0,vJ,"safeParseAsync",0,vH],48804);let v6=av("ZodType",(e,t)=>(le.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(dT.mergeDefs(t,{checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]})),e.clone=(t,r)=>a4(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>vG(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>vJ(e,t,r),e.parseAsync=async(t,r)=>vW(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>vH(e,t,r),e.spa=e.safeParseAsync,e.encode=(t,r)=>vK(e,t,r),e.decode=(t,r)=>vX(e,t,r),e.encodeAsync=async(t,r)=>vY(e,t,r),e.decodeAsync=async(t,r)=>vQ(e,t,r),e.safeEncode=(t,r)=>v0(e,t,r),e.safeDecode=(t,r)=>v1(e,t,r),e.safeEncodeAsync=async(t,r)=>v4(e,t,r),e.safeDecodeAsync=async(t,r)=>v2(e,t,r),e.refine=(t,r)=>e.check(wg(t,r)),e.superRefine=t=>e.check(dw(t)),e.overwrite=t=>e.check(cY(t)),e.optional=()=>bW(e),e.nullable=()=>bH(e),e.nullish=()=>bW(bH(e)),e.nonoptional=t=>b4(e,t),e.array=()=>bg(e),e.or=t=>bx([e,t]),e.and=t=>bS(e,t),e.transform=t=>we(e,bq(t)),e.default=t=>bY(e,t),e.prefault=t=>b0(e,t),e.catch=t=>b5(e,t),e.pipe=t=>we(e,t),e.readonly=()=>wn(e),e.describe=t=>{let r=e.clone();return uD.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>uD.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return uD.get(e);let r=e.clone();return uD.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),v9=av("_ZodString",(e,t)=>{lt.init(e,t),v6.init(e,t);let r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(cV(...t)),e.includes=(...t)=>e.check(cW(...t)),e.startsWith=(...t)=>e.check(cJ(...t)),e.endsWith=(...t)=>e.check(cH(...t)),e.min=(...t)=>e.check(cF(...t)),e.max=(...t)=>e.check(cZ(...t)),e.length=(...t)=>e.check(cB(...t)),e.nonempty=(...t)=>e.check(cF(1,...t)),e.lowercase=t=>e.check(cq(t)),e.uppercase=t=>e.check(cG(t)),e.trim=()=>e.check(c0()),e.normalize=(...t)=>e.check(cQ(...t)),e.toLowerCase=()=>e.check(c1()),e.toUpperCase=()=>e.check(c4()),e.slugify=()=>e.check(c2())}),v5=av("ZodString",(e,t)=>{lt.init(e,t),v9.init(e,t),e.email=t=>e.check(uF(v7,t)),e.url=t=>e.check(uJ(_l,t)),e.jwt=t=>e.check(ce(_Z,t)),e.emoji=t=>e.check(uH(_d,t)),e.guid=t=>e.check(uB(_t,t)),e.uuid=t=>e.check(uV(_i,t)),e.uuidv4=t=>e.check(uq(_i,t)),e.uuidv6=t=>e.check(uG(_i,t)),e.uuidv7=t=>e.check(uW(_i,t)),e.nanoid=t=>e.check(uK(_p,t)),e.guid=t=>e.check(uB(_t,t)),e.cuid=t=>e.check(uX(_f,t)),e.cuid2=t=>e.check(uY(_y,t)),e.ulid=t=>e.check(uQ(__,t)),e.base64=t=>e.check(u3(_R,t)),e.base64url=t=>e.check(u8(_L,t)),e.xid=t=>e.check(u0(_w,t)),e.ksuid=t=>e.check(u1(_x,t)),e.ipv4=t=>e.check(u4(_I,t)),e.ipv6=t=>e.check(u2(_T,t)),e.cidrv4=t=>e.check(u9(_N,t)),e.cidrv6=t=>e.check(u5(_j,t)),e.e164=t=>e.check(u7(_D,t)),e.datetime=t=>e.check(vU(t)),e.date=t=>e.check(vz(t)),e.time=t=>e.check(vM(t)),e.duration=t=>e.check(vF(t))});function v3(e){return uM(v5,e)}let v8=av("ZodStringFormat",(e,t)=>{lr.init(e,t),v9.init(e,t)}),v7=av("ZodEmail",(e,t)=>{la.init(e,t),v8.init(e,t)});function _e(e){return uF(v7,e)}let _t=av("ZodGUID",(e,t)=>{li.init(e,t),v8.init(e,t)});function _r(e){return uB(_t,e)}let _i=av("ZodUUID",(e,t)=>{ln.init(e,t),v8.init(e,t)});function _n(e){return uV(_i,e)}function _a(e){return uq(_i,e)}function _s(e){return uG(_i,e)}function _o(e){return uW(_i,e)}let _l=av("ZodURL",(e,t)=>{ls.init(e,t),v8.init(e,t)});function _u(e){return uJ(_l,e)}function _c(e){return uJ(_l,{protocol:/^https?$/,hostname:vP.domain,...dT.normalizeParams(e)})}let _d=av("ZodEmoji",(e,t)=>{lo.init(e,t),v8.init(e,t)});function _h(e){return uH(_d,e)}let _p=av("ZodNanoID",(e,t)=>{ll.init(e,t),v8.init(e,t)});function _m(e){return uK(_p,e)}let _f=av("ZodCUID",(e,t)=>{lu.init(e,t),v8.init(e,t)});function _g(e){return uX(_f,e)}let _y=av("ZodCUID2",(e,t)=>{lc.init(e,t),v8.init(e,t)});function _v(e){return uY(_y,e)}let __=av("ZodULID",(e,t)=>{ld.init(e,t),v8.init(e,t)});function _b(e){return uQ(__,e)}let _w=av("ZodXID",(e,t)=>{lh.init(e,t),v8.init(e,t)});function _$(e){return u0(_w,e)}let _x=av("ZodKSUID",(e,t)=>{lp.init(e,t),v8.init(e,t)});function _k(e){return u1(_x,e)}let _I=av("ZodIPv4",(e,t)=>{lv.init(e,t),v8.init(e,t)});function _E(e){return u4(_I,e)}let _S=av("ZodMAC",(e,t)=>{lb.init(e,t),v8.init(e,t)});function _O(e){return u6(_S,e)}let _T=av("ZodIPv6",(e,t)=>{l_.init(e,t),v8.init(e,t)});function _A(e){return u2(_T,e)}let _N=av("ZodCIDRv4",(e,t)=>{lw.init(e,t),v8.init(e,t)});function _C(e){return u9(_N,e)}let _j=av("ZodCIDRv6",(e,t)=>{l$.init(e,t),v8.init(e,t)});function _P(e){return u5(_j,e)}let _R=av("ZodBase64",(e,t)=>{lk.init(e,t),v8.init(e,t)});function _U(e){return u3(_R,e)}let _L=av("ZodBase64URL",(e,t)=>{lE.init(e,t),v8.init(e,t)});function _z(e){return u8(_L,e)}let _D=av("ZodE164",(e,t)=>{lS.init(e,t),v8.init(e,t)});function _M(e){return u7(_D,e)}let _Z=av("ZodJWT",(e,t)=>{lT.init(e,t),v8.init(e,t)});function _F(e){return ce(_Z,e)}let _B=av("ZodCustomStringFormat",(e,t)=>{lA.init(e,t),v8.init(e,t)});function _V(e,t,r={}){return dE(_B,e,t,r)}function _q(e){return dE(_B,"hostname",vP.hostname,e)}function _G(e){return dE(_B,"hex",vP.hex,e)}function _W(e,t){let r=t?.enc??"hex",i=`${e}_${r}`,n=vP[i];if(!n)throw Error(`Unrecognized hash format: ${i}`);return dE(_B,i,n,t)}let _J=av("ZodNumber",(e,t)=>{lN.init(e,t),v6.init(e,t),e.gt=(t,r)=>e.check(cN(t,r)),e.gte=(t,r)=>e.check(cC(t,r)),e.min=(t,r)=>e.check(cC(t,r)),e.lt=(t,r)=>e.check(cT(t,r)),e.lte=(t,r)=>e.check(cA(t,r)),e.max=(t,r)=>e.check(cA(t,r)),e.int=t=>e.check(_X(t)),e.safe=t=>e.check(_X(t)),e.positive=t=>e.check(cN(0,t)),e.nonnegative=t=>e.check(cC(0,t)),e.negative=t=>e.check(cT(0,t)),e.nonpositive=t=>e.check(cA(0,t)),e.multipleOf=(t,r)=>e.check(cL(t,r)),e.step=(t,r)=>e.check(cL(t,r)),e.finite=()=>e;let r=e._zod.bag;e.minValue=Math.max(r.minimum??-1/0,r.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(r.maximum??1/0,r.exclusiveMaximum??1/0)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function _H(e){return cs(_J,e)}let _K=av("ZodNumberFormat",(e,t)=>{lC.init(e,t),_J.init(e,t)});function _X(e){return cl(_K,e)}function _Y(e){return cu(_K,e)}function _Q(e){return cc(_K,e)}function _0(e){return cd(_K,e)}function _1(e){return ch(_K,e)}let _4=av("ZodBoolean",(e,t)=>{lj.init(e,t),v6.init(e,t)});function _2(e){return cp(_4,e)}let _6=av("ZodBigInt",(e,t)=>{lP.init(e,t),v6.init(e,t),e.gte=(t,r)=>e.check(cC(t,r)),e.min=(t,r)=>e.check(cC(t,r)),e.gt=(t,r)=>e.check(cN(t,r)),e.gte=(t,r)=>e.check(cC(t,r)),e.min=(t,r)=>e.check(cC(t,r)),e.lt=(t,r)=>e.check(cT(t,r)),e.lte=(t,r)=>e.check(cA(t,r)),e.max=(t,r)=>e.check(cA(t,r)),e.positive=t=>e.check(cN(BigInt(0),t)),e.negative=t=>e.check(cT(BigInt(0),t)),e.nonpositive=t=>e.check(cA(BigInt(0),t)),e.nonnegative=t=>e.check(cC(BigInt(0),t)),e.multipleOf=(t,r)=>e.check(cL(t,r));let r=e._zod.bag;e.minValue=r.minimum??null,e.maxValue=r.maximum??null,e.format=r.format??null});function _9(e){return cf(_6,e)}let _5=av("ZodBigIntFormat",(e,t)=>{lR.init(e,t),_6.init(e,t)});function _3(e){return cy(_5,e)}function _8(e){return cv(_5,e)}let _7=av("ZodSymbol",(e,t)=>{lU.init(e,t),v6.init(e,t)});function be(e){return c_(_7,e)}let bt=av("ZodUndefined",(e,t)=>{lL.init(e,t),v6.init(e,t)});function br(e){return cb(bt,e)}let bi=av("ZodNull",(e,t)=>{lz.init(e,t),v6.init(e,t)});function bn(e){return cw(bi,e)}let ba=av("ZodAny",(e,t)=>{lD.init(e,t),v6.init(e,t)});function bs(){return c$(ba)}let bo=av("ZodUnknown",(e,t)=>{lM.init(e,t),v6.init(e,t)});function bl(){return cx(bo)}let bu=av("ZodNever",(e,t)=>{lZ.init(e,t),v6.init(e,t)});function bc(e){return ck(bu,e)}let bd=av("ZodVoid",(e,t)=>{lF.init(e,t),v6.init(e,t)});function bh(e){return cI(bd,e)}let bp=av("ZodDate",(e,t)=>{lB.init(e,t),v6.init(e,t),e.min=(t,r)=>e.check(cC(t,r)),e.max=(t,r)=>e.check(cA(t,r));let r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function bm(e){return cE(bp,e)}let bf=av("ZodArray",(e,t)=>{lq.init(e,t),v6.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(cF(t,r)),e.nonempty=t=>e.check(cF(1,t)),e.max=(t,r)=>e.check(cZ(t,r)),e.length=(t,r)=>e.check(cB(t,r)),e.unwrap=()=>e.element});function bg(e,t){return c6(bf,e,t)}function by(e){return bz(Object.keys(e._zod.def.shape))}let bv=av("ZodObject",(e,t)=>{lK.init(e,t),v6.init(e,t),dT.defineLazy(e,"shape",()=>t.shape),e.keyof=()=>bz(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:bl()}),e.loose=()=>e.clone({...e._zod.def,catchall:bl()}),e.strict=()=>e.clone({...e._zod.def,catchall:bc()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>dT.extend(e,t),e.safeExtend=t=>dT.safeExtend(e,t),e.merge=t=>dT.merge(e,t),e.pick=t=>dT.pick(e,t),e.omit=t=>dT.omit(e,t),e.partial=(...t)=>dT.partial(bG,e,t[0]),e.required=(...t)=>dT.required(b1,e,t[0])});function b_(e,t){return new bv({type:"object",shape:e??{},...dT.normalizeParams(t)})}function bb(e,t){return new bv({type:"object",shape:e,catchall:bc(),...dT.normalizeParams(t)})}function bw(e,t){return new bv({type:"object",shape:e,catchall:bl(),...dT.normalizeParams(t)})}let b$=av("ZodUnion",(e,t)=>{lY.init(e,t),v6.init(e,t),e.options=t.options});function bx(e,t){return new b$({type:"union",options:e,...dT.normalizeParams(t)})}let bk=av("ZodDiscriminatedUnion",(e,t)=>{b$.init(e,t),lQ.init(e,t)});function bI(e,t,r){return new bk({type:"union",options:t,discriminator:e,...dT.normalizeParams(r)})}let bE=av("ZodIntersection",(e,t)=>{l0.init(e,t),v6.init(e,t)});function bS(e,t){return new bE({type:"intersection",left:e,right:t})}let bO=av("ZodTuple",(e,t)=>{l4.init(e,t),v6.init(e,t),e.rest=t=>e.clone({...e._zod.def,rest:t})});function bT(e,t,r){let i=t instanceof le,n=i?r:t;return new bO({type:"tuple",items:e,rest:i?t:null,...dT.normalizeParams(n)})}let bA=av("ZodRecord",(e,t)=>{l6.init(e,t),v6.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function bN(e,t,r){return new bA({type:"record",keyType:e,valueType:t,...dT.normalizeParams(r)})}function bC(e,t,r){let i=a4(e);return i._zod.values=void 0,new bA({type:"record",keyType:i,valueType:t,...dT.normalizeParams(r)})}let bj=av("ZodMap",(e,t)=>{l9.init(e,t),v6.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function bP(e,t,r){return new bj({type:"map",keyType:e,valueType:t,...dT.normalizeParams(r)})}let bR=av("ZodSet",(e,t)=>{l3.init(e,t),v6.init(e,t),e.min=(...t)=>e.check(cD(...t)),e.nonempty=t=>e.check(cD(1,t)),e.max=(...t)=>e.check(cz(...t)),e.size=(...t)=>e.check(cM(...t))});function bU(e,t){return new bR({type:"set",valueType:e,...dT.normalizeParams(t)})}let bL=av("ZodEnum",(e,t)=>{l7.init(e,t),v6.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,i)=>{let n={};for(let i of e)if(r.has(i))n[i]=t.entries[i];else throw Error(`Key ${i} not found in enum`);return new bL({...t,checks:[],...dT.normalizeParams(i),entries:n})},e.exclude=(e,i)=>{let n={...t.entries};for(let t of e)if(r.has(t))delete n[t];else throw Error(`Key ${t} not found in enum`);return new bL({...t,checks:[],...dT.normalizeParams(i),entries:n})}});function bz(e,t){return new bL({type:"enum",entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...dT.normalizeParams(t)})}function bD(e,t){return new bL({type:"enum",entries:e,...dT.normalizeParams(t)})}let bM=av("ZodLiteral",(e,t)=>{ue.init(e,t),v6.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function bZ(e,t){return new bM({type:"literal",values:Array.isArray(e)?e:[e],...dT.normalizeParams(t)})}let bF=av("ZodFile",(e,t)=>{ut.init(e,t),v6.init(e,t),e.min=(t,r)=>e.check(cD(t,r)),e.max=(t,r)=>e.check(cz(t,r)),e.mime=(t,r)=>e.check(cX(Array.isArray(t)?t:[t],r))});function bB(e){return da(bF,e)}let bV=av("ZodTransform",(e,t)=>{ur.init(e,t),v6.init(e,t),e._zod.parse=(r,i)=>{if("backward"===i.direction)throw new aw(e.constructor.name);r.addIssue=i=>{"string"==typeof i?r.issues.push(dT.issue(i,r.value,t)):(i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(dT.issue(i)))};let n=t.transform(r.value,r);return n instanceof Promise?n.then(e=>(r.value=e,r)):(r.value=n,r)}});function bq(e){return new bV({type:"transform",transform:e})}let bG=av("ZodOptional",(e,t)=>{un.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function bW(e){return new bG({type:"optional",innerType:e})}let bJ=av("ZodNullable",(e,t)=>{ua.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function bH(e){return new bJ({type:"nullable",innerType:e})}function bK(e){return bW(bH(e))}let bX=av("ZodDefault",(e,t)=>{us.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function bY(e,t){return new bX({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():dT.shallowClone(t)}})}let bQ=av("ZodPrefault",(e,t)=>{ul.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function b0(e,t){return new bQ({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():dT.shallowClone(t)}})}let b1=av("ZodNonOptional",(e,t)=>{uu.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function b4(e,t){return new b1({type:"nonoptional",innerType:e,...dT.normalizeParams(t)})}let b2=av("ZodSuccess",(e,t)=>{ud.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function b6(e){return new b2({type:"success",innerType:e})}let b9=av("ZodCatch",(e,t)=>{uh.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function b5(e,t){return new b9({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}let b3=av("ZodNaN",(e,t)=>{up.init(e,t),v6.init(e,t)});function b8(e){return cO(b3,e)}let b7=av("ZodPipe",(e,t)=>{um.init(e,t),v6.init(e,t),e.in=t.in,e.out=t.out});function we(e,t){return new b7({type:"pipe",in:e,out:t})}let wt=av("ZodCodec",(e,t)=>{b7.init(e,t),ug.init(e,t)});function wr(e,t,r){return new wt({type:"pipe",in:e,out:t,transform:r.decode,reverseTransform:r.encode})}let wi=av("ZodReadonly",(e,t)=>{u_.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wn(e){return new wi({type:"readonly",innerType:e})}let wa=av("ZodTemplateLiteral",(e,t)=>{uw.init(e,t),v6.init(e,t)});function ws(e,t){return new wa({type:"template_literal",parts:e,...dT.normalizeParams(t)})}let wo=av("ZodLazy",(e,t)=>{uk.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.getter()});function wl(e){return new wo({type:"lazy",getter:e})}let wu=av("ZodPromise",(e,t)=>{ux.init(e,t),v6.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wc(e){return new wu({type:"promise",innerType:e})}let wd=av("ZodFunction",(e,t)=>{u$.init(e,t),v6.init(e,t)});function wh(e){return new wd({type:"function",input:Array.isArray(e?.input)?bT(e?.input):e?.input??bg(bl()),output:e?.output??bl()})}let wp=av("ZodCustom",(e,t)=>{uI.init(e,t),v6.init(e,t)});function wm(e){let t=new oz({check:"custom"});return t._zod.check=e,t}function wf(e,t){return d_(wp,e??(()=>!0),t)}function wg(e,t={}){return db(wp,e,t)}function wy(e){return dw(e)}let wv=dx,w_=dk;function wb(e,t={error:`Input not instance of ${e.name}`}){let r=new wp({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...dT.normalizeParams(t)});return r._zod.bag.Class=e,r}let ww=(...e)=>dI({Codec:wt,Boolean:_4,String:v5},...e);function w$(e){let t=wl(()=>bx([v3(e),_H(),_2(),bn(),bg(t),bN(v3(),t)]));return t}function wx(e,t){return we(bq(e),t)}let wk={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function wI(e){ax({customError:e})}function wE(){return ax().customError}function wS(e){return uZ(v5,e)}function wO(e){return co(_J,e)}function wT(e){return cm(_4,e)}function wA(e){return cg(_6,e)}function wN(e){return cS(bp,e)}I||(I={}),e.s(["ZodFirstPartyTypeKind",()=>I,"ZodIssueCode",0,wk,"getErrorMap",()=>wE,"setErrorMap",()=>wI],33137),e.s(["bigint",()=>wA,"boolean",()=>wT,"date",()=>wN,"number",()=>wO,"string",()=>wS],34512),ax(uO()),e.s([],54048),e.i(54048),e.i(82811),e.i(27438),e.i(15143),e.i(67021),e.i(62429),e.i(36608),e.i(22824);var wC=dT,wj=vP;e.i(79113),e.s(["ar",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  :   ${r.expected}    ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :   ${a9(r.values[0])}`;return`  :     : ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`   :    ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  :    ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  :   ${r.origin}   ${t} ${r.minimum.toString()} ${i.unit}`;return`  :   ${r.origin}   ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  :     "${r.prefix}"`;if("ends_with"===r.format)return`  :     "${r.suffix}"`;if("includes"===r.format)return`  :    "${r.includes}"`;if("regex"===r.format)return`  :     ${r.pattern}`;return`${t[r.format]??r.format}  `;case"not_multiple_of":return`  :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${aA(r.keys," ")}`;case"invalid_key":return`    ${r.origin}`;case"invalid_union":default:return"  ";case"invalid_element":return`    ${r.origin}`}})}},"az",0,function(){let e,t;return{localeError:(e={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Yanl dyr: g\xf6zlniln ${r.expected}, daxil olan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Yanl dyr: g\xf6zlniln ${a9(r.values[0])}`;return`Yanl se\xe7im: aadaklardan biri olmaldr: ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Yanl mtn: "${r.prefix}" il balamaldr`;if("ends_with"===r.format)return`Yanl mtn: "${r.suffix}" il bitmlidir`;if("includes"===r.format)return`Yanl mtn: "${r.includes}" daxil olmaldr`;if("regex"===r.format)return`Yanl mtn: ${r.pattern} ablonuna uyun olmaldr`;return`Yanl ${t[r.format]??r.format}`;case"not_multiple_of":return`Yanl dd: ${r.divisor} il b\xf6l\xfcn biln olmaldr`;case"unrecognized_keys":return`Tannmayan a\xe7ar${r.keys.length>1?"lar":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`${r.origin} daxilind yanl a\xe7ar`;case"invalid_union":return"Yanl dyr";case"invalid_element":return`${r.origin} daxilind yanl dyr`;default:return`Yanl dyr`}})}},"be",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}`;return` :    ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=uS(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin??""}  ${i.verb} ${t}${r.maximum.toString()} ${e}`}return` : ,  ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=uS(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin}  ${i.verb} ${t}${r.minimum.toString()} ${e}`}return` : ,  ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"bg",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}`;return` :    ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :   ${r.origin??""}   ${t}${r.maximum.toString()} ${i.unit??""}`;return` :   ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :   ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` :   ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":{if("starts_with"===r.format)return` :     "${r.prefix}"`;if("ends_with"===r.format)return` :     "${r.suffix}"`;if("includes"===r.format)return` :    "${r.includes}"`;if("regex"===r.format)return` :     ${r.pattern}`;let e="";return"emoji"===r.format&&(e=""),"datetime"===r.format&&(e=""),"date"===r.format&&(e=""),"time"===r.format&&(e=""),"duration"===r.format&&(e=""),`${e} ${t[r.format]??r.format}`}case"not_multiple_of":return` :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ca",0,function(){let e,t;return{localeError:(e={string:{unit:"carcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}},t={regex:"entrada",email:"adrea electrnica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adrea IPv4",ipv6:"adrea IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipus inv\xe0lid: s'esperava ${r.expected}, s'ha rebut ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Valor inv\xe0lid: s'esperava ${a9(r.values[0])}`;return`Opci\xf3 inv\xe0lida: s'esperava una de ${aA(r.values," o ")}`;case"too_big":{let t=r.inclusive?"com a mxim":"menys de",i=e[r.origin]??null;if(i)return`Massa gran: s'esperava que ${r.origin??"el valor"} contingu\xe9s ${t} ${r.maximum.toString()} ${i.unit??"elements"}`;return`Massa gran: s'esperava que ${r.origin??"el valor"} fos ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"com a mnim":"ms de",i=e[r.origin]??null;if(i)return`Massa petit: s'esperava que ${r.origin} contingu\xe9s ${t} ${r.minimum.toString()} ${i.unit}`;return`Massa petit: s'esperava que ${r.origin} fos ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Format inv\xe0lid: ha de comen\xe7ar amb "${r.prefix}"`;if("ends_with"===r.format)return`Format inv\xe0lid: ha d'acabar amb "${r.suffix}"`;if("includes"===r.format)return`Format inv\xe0lid: ha d'incloure "${r.includes}"`;if("regex"===r.format)return`Format inv\xe0lid: ha de coincidir amb el patr\xf3 ${r.pattern}`;return`Format inv\xe0lid per a ${t[r.format]??r.format}`;case"not_multiple_of":return`N\xfamero inv\xe0lid: ha de ser m\xfaltiple de ${r.divisor}`;case"unrecognized_keys":return`Clau${r.keys.length>1?"s":""} no reconeguda${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Clau inv\xe0lida a ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Element inv\xe0lid a ${r.origin}`;default:return`Entrada inv\xe0lida`}})}},"cs",0,function(){let e,t;return{localeError:(e={string:{unit:"znak",verb:"mt"},file:{unit:"bajt",verb:"mt"},array:{unit:"prvk",verb:"mt"},set:{unit:"prvk",verb:"mt"}},t={regex:"regulrn vraz",email:"e-mailov adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve formtu ISO",date:"datum ve formtu ISO",time:"as ve formtu ISO",duration:"doba trvn ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zakdovan ve formtu base64",base64url:"etzec zakdovan ve formtu base64url",json_string:"etzec ve formtu JSON",e164:"slo E.164",jwt:"JWT",template_literal:"vstup"},r=>{switch(r.code){case"invalid_type":return`Neplatn\xfd vstup: oek\xe1v\xe1no ${r.expected}, obdreno ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"slo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":if(Array.isArray(e))return"pole";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neplatn\xfd vstup: oek\xe1v\xe1no ${a9(r.values[0])}`;return`Neplatn\xe1 monost: oek\xe1v\xe1na jedna z hodnot ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.maximum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.minimum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neplatn\xfd etzec: mus\xed za\xednat na "${r.prefix}"`;if("ends_with"===r.format)return`Neplatn\xfd etzec: mus\xed konit na "${r.suffix}"`;if("includes"===r.format)return`Neplatn\xfd etzec: mus\xed obsahovat "${r.includes}"`;if("regex"===r.format)return`Neplatn\xfd etzec: mus\xed odpov\xeddat vzoru ${r.pattern}`;return`Neplatn\xfd form\xe1t ${t[r.format]??r.format}`;case"not_multiple_of":return`Neplatn\xe9 \xedslo: mus\xed b\xfdt n\xe1sobkem ${r.divisor}`;case"unrecognized_keys":return`Nezn\xe1m\xe9 kl\xede: ${aA(r.keys,", ")}`;case"invalid_key":return`Neplatn\xfd kl\xed v ${r.origin}`;case"invalid_union":return"Neplatn vstup";case"invalid_element":return`Neplatn\xe1 hodnota v ${r.origin}`;default:return`Neplatn\xfd vstup`}})}},"da",0,function(){let e,t,r;return{localeError:(e={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}},t={string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"st",file:"fil"},r={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslt",date:"ISO-dato",time:"ISO-klokkeslt",duration:"ISO-varighed",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},i=>{var n,a,s,o;switch(i.code){case"invalid_type":return`Ugyldigt input: forventede ${t[n=i.expected]??n}, fik ${t[a=(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tal";case"object":if(Array.isArray(e))return"liste";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name;return"objekt"}return t})(i.input)]??a}`;case"invalid_value":if(1===i.values.length)return`Ugyldig v\xe6rdi: forventede ${a9(i.values[0])}`;return`Ugyldigt valg: forventede en af f\xf8lgende ${aA(i.values,"|")}`;case"too_big":{let r=i.inclusive?"<=":"<",n=e[i.origin]??null,a=t[s=i.origin]??s;if(n)return`For stor: forventede ${a??"value"} ${n.verb} ${r} ${i.maximum.toString()} ${n.unit??"elementer"}`;return`For stor: forventede ${a??"value"} havde ${r} ${i.maximum.toString()}`}case"too_small":{let r=i.inclusive?">=":">",n=e[i.origin]??null,a=t[o=i.origin]??o;if(n)return`For lille: forventede ${a} ${n.verb} ${r} ${i.minimum.toString()} ${n.unit}`;return`For lille: forventede ${a} havde ${r} ${i.minimum.toString()}`}case"invalid_format":if("starts_with"===i.format)return`Ugyldig streng: skal starte med "${i.prefix}"`;if("ends_with"===i.format)return`Ugyldig streng: skal ende med "${i.suffix}"`;if("includes"===i.format)return`Ugyldig streng: skal indeholde "${i.includes}"`;if("regex"===i.format)return`Ugyldig streng: skal matche m\xf8nsteret ${i.pattern}`;return`Ugyldig ${r[i.format]??i.format}`;case"not_multiple_of":return`Ugyldigt tal: skal v\xe6re deleligt med ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Ukendte ngler":"Ukendt ngle"}: ${aA(i.keys,", ")}`;case"invalid_key":return`Ugyldig n\xf8gle i ${i.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig v\xe6rdi i ${i.origin}`;default:return"Ugyldigt input"}})}},"de",0,function(){let e,t;return{localeError:(e={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}},t={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},r=>{switch(r.code){case"invalid_type":return`Ung\xfcltige Eingabe: erwartet ${r.expected}, erhalten ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"Zahl";case"object":if(Array.isArray(e))return"Array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ung\xfcltige Eingabe: erwartet ${a9(r.values[0])}`;return`Ung\xfcltige Option: erwartet eine von ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ${i.unit??"Elemente"} hat`;return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ist`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ${i.unit} hat`;return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ist`}case"invalid_format":if("starts_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.suffix}" enden`;if("includes"===r.format)return`Ung\xfcltiger String: muss "${r.includes}" enthalten`;if("regex"===r.format)return`Ung\xfcltiger String: muss dem Muster ${r.pattern} entsprechen`;return`Ung\xfcltig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ung\xfcltige Zahl: muss ein Vielfaches von ${r.divisor} sein`;case"unrecognized_keys":return`${r.keys.length>1?"Unbekannte Schlssel":"Unbekannter Schlssel"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Ung\xfcltiger Schl\xfcssel in ${r.origin}`;case"invalid_union":return"Ungltige Eingabe";case"invalid_element":return`Ung\xfcltiger Wert in ${r.origin}`;default:return`Ung\xfcltige Eingabe`}})}},"en",0,uO,"eo",0,function(){let e,t;return{localeError:(e={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}},t={regex:"enigo",email:"retadreso",url:"URL",emoji:"emoio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-daro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"},r=>{switch(r.code){case"invalid_type":return`Nevalida enigo: atendiis ${r.expected}, riceviis ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombro";case"object":if(Array.isArray(e))return"tabelo";if(null===e)return"senvalora";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Nevalida enigo: atendiis ${a9(r.values[0])}`;return`Nevalida opcio: atendiis unu el ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Tro granda: atendiis ke ${r.origin??"valoro"} havu ${t}${r.maximum.toString()} ${i.unit??"elementojn"}`;return`Tro granda: atendiis ke ${r.origin??"valoro"} havu ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Tro malgranda: atendiis ke ${r.origin} havu ${t}${r.minimum.toString()} ${i.unit}`;return`Tro malgranda: atendiis ke ${r.origin} estu ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Nevalida karaktraro: devas komencii per "${r.prefix}"`;if("ends_with"===r.format)return`Nevalida karaktraro: devas finii per "${r.suffix}"`;if("includes"===r.format)return`Nevalida karaktraro: devas inkluzivi "${r.includes}"`;if("regex"===r.format)return`Nevalida karaktraro: devas kongrui kun la modelo ${r.pattern}`;return`Nevalida ${t[r.format]??r.format}`;case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${r.divisor}`;case"unrecognized_keys":return`Nekonata${r.keys.length>1?"j":""} losilo${r.keys.length>1?"j":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Nevalida losilo en ${r.origin}`;case"invalid_union":default:return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${r.origin}`}})}},"es",0,function(){return{localeError:(()=>{let e={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},t={string:"texto",number:"nmero",boolean:"booleano",array:"arreglo",object:"objeto",set:"conjunto",file:"archivo",date:"fecha",bigint:"nmero grande",symbol:"smbolo",undefined:"indefinido",null:"nulo",function:"funcin",map:"mapa",record:"registro",tuple:"tupla",enum:"enumeracin",union:"unin",literal:"literal",promise:"promesa",void:"vaco",never:"nunca",unknown:"desconocido",any:"cualquiera"};function r(e){return t[e]??e}let i={regex:"entrada",email:"direccin de correo electrnico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duracin ISO",ipv4:"direccin IPv4",ipv6:"direccin IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"};return t=>{switch(t.code){case"invalid_type":return`Entrada inv\xe1lida: se esperaba ${r(t.expected)}, recibido ${r((e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype)return e.constructor.name;return"object"}return t})(t.input))}`;case"invalid_value":if(1===t.values.length)return`Entrada inv\xe1lida: se esperaba ${a9(t.values[0])}`;return`Opci\xf3n inv\xe1lida: se esperaba una de ${aA(t.values,"|")}`;case"too_big":{let i=t.inclusive?"<=":"<",n=e[t.origin]??null,a=r(t.origin);if(n)return`Demasiado grande: se esperaba que ${a??"valor"} tuviera ${i}${t.maximum.toString()} ${n.unit??"elementos"}`;return`Demasiado grande: se esperaba que ${a??"valor"} fuera ${i}${t.maximum.toString()}`}case"too_small":{let i=t.inclusive?">=":">",n=e[t.origin]??null,a=r(t.origin);if(n)return`Demasiado peque\xf1o: se esperaba que ${a} tuviera ${i}${t.minimum.toString()} ${n.unit}`;return`Demasiado peque\xf1o: se esperaba que ${a} fuera ${i}${t.minimum.toString()}`}case"invalid_format":if("starts_with"===t.format)return`Cadena inv\xe1lida: debe comenzar con "${t.prefix}"`;if("ends_with"===t.format)return`Cadena inv\xe1lida: debe terminar en "${t.suffix}"`;if("includes"===t.format)return`Cadena inv\xe1lida: debe incluir "${t.includes}"`;if("regex"===t.format)return`Cadena inv\xe1lida: debe coincidir con el patr\xf3n ${t.pattern}`;return`Inv\xe1lido ${i[t.format]??t.format}`;case"not_multiple_of":return`N\xfamero inv\xe1lido: debe ser m\xfaltiplo de ${t.divisor}`;case"unrecognized_keys":return`Llave${t.keys.length>1?"s":""} desconocida${t.keys.length>1?"s":""}: ${aA(t.keys,", ")}`;case"invalid_key":return`Llave inv\xe1lida en ${r(t.origin)}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido en ${r(t.origin)}`;default:return`Entrada inv\xe1lida`}}})()}},"fa",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])} `;return` :    ${aA(r.values,"|")} `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"  `;if("ends_with"===r.format)return` :   "${r.suffix}"  `;if("includes"===r.format)return` :   "${r.includes}" `;if("regex"===r.format)return` :    ${r.pattern}   `;return`${t[r.format]??r.format} `;case"not_multiple_of":return` :   ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""} : ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin}`}})}},"fi",0,function(){let e,t;return{localeError:(e={string:{unit:"merkki",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pivmrn"}},t={regex:"snnllinen lauseke",email:"shkpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pivmr",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},r=>{switch(r.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${r.expected}, oli ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Virheellinen sy\xf6te: t\xe4ytyy olla ${a9(r.values[0])}`;return`Virheellinen valinta: t\xe4ytyy olla yksi seuraavista: ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Liian suuri: ${i.subject} t\xe4ytyy olla ${t}${r.maximum.toString()} ${i.unit}`.trim();return`Liian suuri: arvon t\xe4ytyy olla ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Liian pieni: ${i.subject} t\xe4ytyy olla ${t}${r.minimum.toString()} ${i.unit}`.trim();return`Liian pieni: arvon t\xe4ytyy olla ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy alkaa "${r.prefix}"`;if("ends_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy loppua "${r.suffix}"`;if("includes"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy sis\xe4lt\xe4\xe4 "${r.includes}"`;if("regex"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy vastata s\xe4\xe4nn\xf6llist\xe4 lauseketta ${r.pattern}`;return`Virheellinen ${t[r.format]??r.format}`;case"not_multiple_of":return`Virheellinen luku: t\xe4ytyy olla luvun ${r.divisor} monikerta`;case"unrecognized_keys":return`${r.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${aA(r.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return`Virheellinen sy\xf6te`}})}},"fr",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : ${r.expected} attendu, ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombre";case"object":if(Array.isArray(e))return"tableau";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)} re\xe7u`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : ${a9(r.values[0])} attendu`;return`Option invalide : une valeur parmi ${aA(r.values,"|")} attendue`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Trop grand : ${r.origin??"valeur"} doit ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"lment(s)"}`;return`Trop grand : ${r.origin??"valeur"} doit \xeatre ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Trop petit : ${r.origin} doit ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : ${r.origin} doit \xeatre ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au mod\xe8le ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${aA(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"frCA",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : attendu ${r.expected}, re\xe7u ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : attendu ${a9(r.values[0])}`;return`Option invalide : attendu l'une des valeurs suivantes ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"<",i=e[r.origin]??null;if(i)return`Trop grand : attendu que ${r.origin??"la valeur"} ait ${t}${r.maximum.toString()} ${i.unit}`;return`Trop grand : attendu que ${r.origin??"la valeur"} soit ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":">",i=e[r.origin]??null;if(i)return`Trop petit : attendu que ${r.origin} ait ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : attendu que ${r.origin} soit ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au motif ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${aA(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"he",0,function(){let e,t,r,i,n,a,s,o;return{localeError:(e={string:{label:"",gender:"f"},number:{label:"",gender:"m"},boolean:{label:" ",gender:"m"},bigint:{label:"BigInt",gender:"m"},date:{label:"",gender:"m"},array:{label:"",gender:"m"},object:{label:"",gender:"m"},null:{label:"  (null)",gender:"m"},undefined:{label:"   (undefined)",gender:"m"},symbol:{label:" (Symbol)",gender:"m"},function:{label:"",gender:"f"},map:{label:" (Map)",gender:"f"},set:{label:" (Set)",gender:"f"},file:{label:"",gender:"m"},promise:{label:"Promise",gender:"m"},NaN:{label:"NaN",gender:"m"},unknown:{label:"  ",gender:"m"},value:{label:"",gender:"m"}},t={string:{unit:"",shortLabel:"",longLabel:""},file:{unit:"",shortLabel:"",longLabel:""},array:{unit:"",shortLabel:"",longLabel:""},set:{unit:"",shortLabel:"",longLabel:""},number:{unit:"",shortLabel:"",longLabel:""}},r=t=>t?e[t]:void 0,i=t=>{let i=r(t);return i?i.label:t??e.unknown.label},n=e=>`${i(e)}`,a=e=>{let t=r(e);return"f"===(t?.gender??"m")?" ":" "},s=e=>e?t[e]??null:null,o={regex:{label:"",gender:"m"},email:{label:" ",gender:"f"},url:{label:" ",gender:"f"},emoji:{label:"'",gender:"m"},uuid:{label:"UUID",gender:"m"},nanoid:{label:"nanoid",gender:"m"},guid:{label:"GUID",gender:"m"},cuid:{label:"cuid",gender:"m"},cuid2:{label:"cuid2",gender:"m"},ulid:{label:"ULID",gender:"m"},xid:{label:"XID",gender:"m"},ksuid:{label:"KSUID",gender:"m"},datetime:{label:"  ISO",gender:"m"},date:{label:" ISO",gender:"m"},time:{label:" ISO",gender:"m"},duration:{label:"  ISO",gender:"m"},ipv4:{label:" IPv4",gender:"f"},ipv6:{label:" IPv6",gender:"f"},cidrv4:{label:" IPv4",gender:"m"},cidrv6:{label:" IPv6",gender:"m"},base64:{label:"  64",gender:"f"},base64url:{label:"  64  ",gender:"f"},json_string:{label:" JSON",gender:"f"},e164:{label:" E.164",gender:"m"},jwt:{label:"JWT",gender:"m"},ends_with:{label:"",gender:"m"},includes:{label:"",gender:"m"},lowercase:{label:"",gender:"m"},starts_with:{label:"",gender:"m"},uppercase:{label:"",gender:"m"}},t=>{switch(t.code){case"invalid_type":{let r=i(t.expected),n=(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name;return"object";default:return t}})(t.input),a=e[n]?.label??n;return`  :   ${r},  ${a}`}case"invalid_value":{if(1===t.values.length)return`  :    ${a9(t.values[0])}`;let e=t.values.map(e=>a9(e));if(2===t.values.length)return`  :    ${e[0]}  ${e[1]}`;let r=e[e.length-1],i=e.slice(0,-1).join(", ");return`  :    ${i}  ${r}`}case"too_big":{let e=s(t.origin),r=n(t.origin??"value");if("string"===t.origin)return`${e?.longLabel??""} : ${r}   ${t.maximum.toString()} ${e?.unit??""} ${t.inclusive?" ":" "}`.trim();if("number"===t.origin){let e=t.inclusive?`   -${t.maximum}`:` -${t.maximum}`;return` : ${r}   ${e}`}if("array"===t.origin||"set"===t.origin){let i="set"===t.origin?"":"",n=t.inclusive?`${t.maximum} ${e?.unit??""}  `:` -${t.maximum} ${e?.unit??""}`;return` : ${r} ${i}  ${n}`.trim()}let i=t.inclusive?"<=":"<",o=a(t.origin??"value");if(e?.unit)return`${e.longLabel} : ${r} ${o} ${i}${t.maximum.toString()} ${e.unit}`;return`${e?.longLabel??""} : ${r} ${o} ${i}${t.maximum.toString()}`}case"too_small":{let e=s(t.origin),r=n(t.origin??"value");if("string"===t.origin)return`${e?.shortLabel??""} : ${r}   ${t.minimum.toString()} ${e?.unit??""} ${t.inclusive?" ":""}`.trim();if("number"===t.origin){let e=t.inclusive?`   -${t.minimum}`:` -${t.minimum}`;return` : ${r}   ${e}`}if("array"===t.origin||"set"===t.origin){let i="set"===t.origin?"":"";if(1===t.minimum&&t.inclusive){let e=(t.origin,"  ");return` : ${r} ${i}  ${e}`}let n=t.inclusive?`${t.minimum} ${e?.unit??""}  `:` -${t.minimum} ${e?.unit??""}`;return` : ${r} ${i}  ${n}`.trim()}let i=t.inclusive?">=":">",o=a(t.origin??"value");if(e?.unit)return`${e.shortLabel} : ${r} ${o} ${i}${t.minimum.toString()} ${e.unit}`;return`${e?.shortLabel??""} : ${r} ${o} ${i}${t.minimum.toString()}`}case"invalid_format":{if("starts_with"===t.format)return`    "${t.prefix}"`;if("ends_with"===t.format)return`    "${t.suffix}"`;if("includes"===t.format)return`   "${t.includes}"`;if("regex"===t.format)return`    ${t.pattern}`;let e=o[t.format],r=e?.label??t.format,i=e?.gender??"m";return`${r}  ${"f"===i?"":""}`}case"not_multiple_of":return`  :     ${t.divisor}`;case"unrecognized_keys":return`${t.keys.length>1?"":""}  ${t.keys.length>1?"":""}: ${aA(t.keys,", ")}`;case"invalid_key":return`   `;case"invalid_union":return"  ";case"invalid_element":{let e=n(t.origin??"array");return`   ${e}`}default:return`  `}})}},"hu",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}},t={regex:"bemenet",email:"email cm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idblyeg",date:"ISO dtum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 cm",ipv6:"IPv6 cm",cidrv4:"IPv4 tartomny",cidrv6:"IPv6 tartomny",base64:"base64-kdolt string",base64url:"base64url-kdolt string",json_string:"JSON string",e164:"E.164 szm",jwt:"JWT",template_literal:"bemenet"},r=>{switch(r.code){case"invalid_type":return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${r.expected}, a kapott \xe9rt\xe9k ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"szm";case"object":if(Array.isArray(e))return"tmb";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${a9(r.values[0])}`;return`\xc9rv\xe9nytelen opci\xf3: valamelyik \xe9rt\xe9k v\xe1rt ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`T\xfal nagy: ${r.origin??"rtk"} m\xe9rete t\xfal nagy ${t}${r.maximum.toString()} ${i.unit??"elem"}`;return`T\xfal nagy: a bemeneti \xe9rt\xe9k ${r.origin??"rtk"} t\xfal nagy: ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} m\xe9rete t\xfal kicsi ${t}${r.minimum.toString()} ${i.unit}`;return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} t\xfal kicsi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.prefix}" \xe9rt\xe9kkel kell kezddnie`;if("ends_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.suffix}" \xe9rt\xe9kkel kell v\xe9gzdnie`;if("includes"===r.format)return`\xc9rv\xe9nytelen string: "${r.includes}" \xe9rt\xe9ket kell tartalmaznia`;if("regex"===r.format)return`\xc9rv\xe9nytelen string: ${r.pattern} mint\xe1nak kell megfelelnie`;return`\xc9rv\xe9nytelen ${t[r.format]??r.format}`;case"not_multiple_of":return`\xc9rv\xe9nytelen sz\xe1m: ${r.divisor} t\xf6bbsz\xf6r\xf6s\xe9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`\xc9rv\xe9nytelen kulcs ${r.origin}`;case"invalid_union":return"rvnytelen bemenet";case"invalid_element":return`\xc9rv\xe9nytelen \xe9rt\xe9k: ${r.origin}`;default:return`\xc9rv\xe9nytelen bemenet`}})}},"id",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}},t={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak valid: diharapkan ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak valid: diharapkan ${a9(r.values[0])}`;return`Pilihan tidak valid: diharapkan salah satu dari ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: diharapkan ${r.origin??"value"} memiliki ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: diharapkan ${r.origin??"value"} menjadi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: diharapkan ${r.origin} memiliki ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: diharapkan ${r.origin} menjadi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak valid: harus dimulai dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak valid: harus berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak valid: harus menyertakan "${r.includes}"`;if("regex"===r.format)return`String tidak valid: harus sesuai pola ${r.pattern}`;return`${t[r.format]??r.format} tidak valid`;case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${r.origin}`;case"invalid_union":default:return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${r.origin}`}})}},"is",0,function(){let e,t;return{localeError:(e={string:{unit:"stafi",verb:"a hafa"},file:{unit:"bti",verb:"a hafa"},array:{unit:"hluti",verb:"a hafa"},set:{unit:"hluti",verb:"a hafa"}},t={regex:"gildi",email:"netfang",url:"vefsl",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og tmi",date:"ISO dagsetning",time:"ISO tmi",duration:"ISO tmalengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 tlugildi",jwt:"JWT",template_literal:"gildi"},r=>{switch(r.code){case"invalid_type":return`Rangt gildi: \xde\xfa sl\xf3st inn ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmer";case"object":if(Array.isArray(e))return"fylki";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)} \xfear sem \xe1 a\xf0 vera ${r.expected}`;case"invalid_value":if(1===r.values.length)return`Rangt gildi: gert r\xe1\xf0 fyrir ${a9(r.values[0])}`;return`\xd3gilt val: m\xe1 vera eitt af eftirfarandi ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Of st\xf3rt: gert er r\xe1\xf0 fyrir a\xf0 ${r.origin??"gildi"} hafi ${t}${r.maximum.toString()} ${i.unit??"hluti"}`;return`Of st\xf3rt: gert er r\xe1\xf0 fyrir a\xf0 ${r.origin??"gildi"} s\xe9 ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Of l\xedti\xf0: gert er r\xe1\xf0 fyrir a\xf0 ${r.origin} hafi ${t}${r.minimum.toString()} ${i.unit}`;return`Of l\xedti\xf0: gert er r\xe1\xf0 fyrir a\xf0 ${r.origin} s\xe9 ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`\xd3gildur strengur: ver\xf0ur a\xf0 byrja \xe1 "${r.prefix}"`;if("ends_with"===r.format)return`\xd3gildur strengur: ver\xf0ur a\xf0 enda \xe1 "${r.suffix}"`;if("includes"===r.format)return`\xd3gildur strengur: ver\xf0ur a\xf0 innihalda "${r.includes}"`;if("regex"===r.format)return`\xd3gildur strengur: ver\xf0ur a\xf0 fylgja mynstri ${r.pattern}`;return`Rangt ${t[r.format]??r.format}`;case"not_multiple_of":return`R\xf6ng tala: ver\xf0ur a\xf0 vera margfeldi af ${r.divisor}`;case"unrecognized_keys":return`\xd3\xfeekkt ${r.keys.length>1?"ir lyklar":"ur lykill"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Rangur lykill \xed ${r.origin}`;case"invalid_union":default:return"Rangt gildi";case"invalid_element":return`Rangt gildi \xed ${r.origin}`}})}},"it",0,function(){let e,t;return{localeError:(e={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}},t={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input non valido: atteso ${r.expected}, ricevuto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numero";case"object":if(Array.isArray(e))return"vettore";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input non valido: atteso ${a9(r.values[0])}`;return`Opzione non valida: atteso uno tra ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Troppo grande: ${r.origin??"valore"} deve avere ${t}${r.maximum.toString()} ${i.unit??"elementi"}`;return`Troppo grande: ${r.origin??"valore"} deve essere ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Troppo piccolo: ${r.origin} deve avere ${t}${r.minimum.toString()} ${i.unit}`;return`Troppo piccolo: ${r.origin} deve essere ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Stringa non valida: deve iniziare con "${r.prefix}"`;if("ends_with"===r.format)return`Stringa non valida: deve terminare con "${r.suffix}"`;if("includes"===r.format)return`Stringa non valida: deve includere "${r.includes}"`;if("regex"===r.format)return`Stringa non valida: deve corrispondere al pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${r.divisor}`;case"unrecognized_keys":return`Chiav${r.keys.length>1?"i":"e"} non riconosciut${r.keys.length>1?"e":"a"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${r.origin}`;case"invalid_union":default:return"Input non valido";case"invalid_element":return`Valore non valido in ${r.origin}`}})}},"ja",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`: ${r.expected}${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`: ${a9(r.values[0])}`;return`: ${aA(r.values,"")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""}${r.maximum.toString()}${i.unit??""}${t}`;return`: ${r.origin??""}${r.maximum.toString()}${t}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin}${r.minimum.toString()}${i.unit}${t}`;return`: ${r.origin}${r.minimum.toString()}${t}`}case"invalid_format":if("starts_with"===r.format)return`: "${r.prefix}"`;if("ends_with"===r.format)return`: "${r.suffix}"`;if("includes"===r.format)return`: "${r.includes}"`;if("regex"===r.format)return`: ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return`: ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""}: ${aA(r.keys,"")}`;case"invalid_key":return`${r.origin}`;case"invalid_union":return"";case"invalid_element":return`${r.origin}`;default:return``}})}},"ka",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:"- ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"-",date:"",time:"",duration:"",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return({string:"",boolean:"",undefined:"undefined",bigint:"bigint",symbol:"symbol",function:""})[t]??t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}`;return` :  - ${aA(r.values,"|")}-`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :  ${r.origin??""} ${i.verb} ${t}${r.maximum.toString()} ${i.unit}`;return` :  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :  ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return` :  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"-`;if("ends_with"===r.format)return` :   "${r.suffix}"-`;if("includes"===r.format)return` :   "${r.includes}"-`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :   ${r.divisor}- `;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`  ${r.origin}-`;case"invalid_union":return" ";case"invalid_element":return`  ${r.origin}-`;default:return` `}})}},"kh",0,function(){return uT()},"km",0,uT,"ko",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}  `;return` : ${aA(r.values," ")}   `;case"too_big":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.maximum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.maximum.toString()} ${t}${i}`}case"too_small":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.minimum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.minimum.toString()} ${t}${i}`}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"()  `;if("ends_with"===r.format)return` : "${r.suffix}"()  `;if("includes"===r.format)return` : "${r.includes}"()  `;if("regex"===r.format)return` :  ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}  `;case"unrecognized_keys":return`   : ${aA(r.keys,", ")}`;case"invalid_key":return` : ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return` : ${r.origin}`}})}},"lt",0,function(){return{localeError:(()=>{let e={string:{unit:{one:"simbolis",few:"simboliai",many:"simboli"},verb:{smaller:{inclusive:"turi bti ne ilgesn kaip",notInclusive:"turi bti trumpesn kaip"},bigger:{inclusive:"turi bti ne trumpesn kaip",notInclusive:"turi bti ilgesn kaip"}}},file:{unit:{one:"baitas",few:"baitai",many:"bait"},verb:{smaller:{inclusive:"turi bti ne didesnis kaip",notInclusive:"turi bti maesnis kaip"},bigger:{inclusive:"turi bti ne maesnis kaip",notInclusive:"turi bti didesnis kaip"}}},array:{unit:{one:"element",few:"elementus",many:"element"},verb:{smaller:{inclusive:"turi turti ne daugiau kaip",notInclusive:"turi turti maiau kaip"},bigger:{inclusive:"turi turti ne maiau kaip",notInclusive:"turi turti daugiau kaip"}}},set:{unit:{one:"element",few:"elementus",many:"element"},verb:{smaller:{inclusive:"turi turti ne daugiau kaip",notInclusive:"turi turti maiau kaip"},bigger:{inclusive:"turi turti ne maiau kaip",notInclusive:"turi turti daugiau kaip"}}}};function t(t,r,i,n){let a=e[t]??null;return null===a?a:{unit:a.unit[r],verb:a.verb[n][i?"inclusive":"notInclusive"]}}let r={regex:"vestis",email:"el. pato adresas",url:"URL",emoji:"jaustukas",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO data ir laikas",date:"ISO data",time:"ISO laikas",duration:"ISO trukm",ipv4:"IPv4 adresas",ipv6:"IPv6 adresas",cidrv4:"IPv4 tinklo prefiksas (CIDR)",cidrv6:"IPv6 tinklo prefiksas (CIDR)",base64:"base64 ukoduota eilut",base64url:"base64url ukoduota eilut",json_string:"JSON eilut",e164:"E.164 numeris",jwt:"JWT",template_literal:"vestis"};return e=>{switch(e.code){case"invalid_type":var i;return`Gautas tipas ${uA(typeof(i=e.input),i)}, o tiktasi - ${uA(e.expected)}`;case"invalid_value":if(1===e.values.length)return`Privalo bti ${a9(e.values[0])}`;return`Privalo bti vienas i ${aA(e.values,"|")} pasirinkim`;case"too_big":{let r=uA(e.origin),i=t(e.origin,uC(Number(e.maximum)),e.inclusive??!1,"smaller");if(i?.verb)return`${uN(r??e.origin??"reikm")} ${i.verb} ${e.maximum.toString()} ${i.unit??"element"}`;let n=e.inclusive?"ne didesnis kaip":"maesnis kaip";return`${uN(r??e.origin??"reikm")} turi bti ${n} ${e.maximum.toString()} ${i?.unit}`}case"too_small":{let r=uA(e.origin),i=t(e.origin,uC(Number(e.minimum)),e.inclusive??!1,"bigger");if(i?.verb)return`${uN(r??e.origin??"reikm")} ${i.verb} ${e.minimum.toString()} ${i.unit??"element"}`;let n=e.inclusive?"ne maesnis kaip":"didesnis kaip";return`${uN(r??e.origin??"reikm")} turi bti ${n} ${e.minimum.toString()} ${i?.unit}`}case"invalid_format":if("starts_with"===e.format)return`Eilut privalo prasidti "${e.prefix}"`;if("ends_with"===e.format)return`Eilut privalo pasibaigti "${e.suffix}"`;if("includes"===e.format)return`Eilut privalo traukti "${e.includes}"`;if("regex"===e.format)return`Eilut privalo atitikti ${e.pattern}`;return`Neteisingas ${r[e.format]??e.format}`;case"not_multiple_of":return`Skaiius privalo bti ${e.divisor} kartotinis.`;case"unrecognized_keys":return`Neatpaint${e.keys.length>1?"i":"as"} rakt${e.keys.length>1?"ai":"as"}: ${aA(e.keys,", ")}`;case"invalid_key":return"Rastas klaidingas raktas";case"invalid_union":default:return"Klaidinga vestis";case"invalid_element":{let t=uA(e.origin);return`${uN(t??e.origin??"reikm")} turi klaiding vest`}}}})()}},"mk",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${a9(r.values[0])}`;return` :    ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :   ${r.origin??""}   ${t}${r.maximum.toString()} ${i.unit??""}`;return` :   ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :   ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` :   ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :     "${r.prefix}"`;if("ends_with"===r.format)return` :     "${r.suffix}"`;if("includes"===r.format)return` :    "${r.includes}"`;if("regex"===r.format)return` :      ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return` :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?" ":" "}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ms",0,function(){let e,t;return{localeError:(e={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}},t={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak sah: dijangka ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombor";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak sah: dijangka ${a9(r.values[0])}`;return`Pilihan tidak sah: dijangka salah satu daripada ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: dijangka ${r.origin??"nilai"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: dijangka ${r.origin??"nilai"} adalah ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: dijangka ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: dijangka ${r.origin} adalah ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak sah: mesti bermula dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak sah: mesti berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak sah: mesti mengandungi "${r.includes}"`;if("regex"===r.format)return`String tidak sah: mesti sepadan dengan corak ${r.pattern}`;return`${t[r.format]??r.format} tidak sah`;case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${aA(r.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${r.origin}`;case"invalid_union":default:return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${r.origin}`}})}},"nl",0,function(){let e,t;return{localeError:(e={string:{unit:"tekens",verb:"te hebben"},file:{unit:"bytes",verb:"te hebben"},array:{unit:"elementen",verb:"te hebben"},set:{unit:"elementen",verb:"te hebben"}},t={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},r=>{switch(r.code){case"invalid_type":return`Ongeldige invoer: verwacht ${r.expected}, ontving ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"getal";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ongeldige invoer: verwacht ${a9(r.values[0])}`;return`Ongeldige optie: verwacht \xe9\xe9n van ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Te groot: verwacht dat ${r.origin??"waarde"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"elementen"}`;return`Te groot: verwacht dat ${r.origin??"waarde"} ${t}${r.maximum.toString()} is`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Te klein: verwacht dat ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Te klein: verwacht dat ${r.origin} ${t}${r.minimum.toString()} is`}case"invalid_format":if("starts_with"===r.format)return`Ongeldige tekst: moet met "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ongeldige tekst: moet op "${r.suffix}" eindigen`;if("includes"===r.format)return`Ongeldige tekst: moet "${r.includes}" bevatten`;if("regex"===r.format)return`Ongeldige tekst: moet overeenkomen met patroon ${r.pattern}`;return`Ongeldig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${r.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${r.origin}`;case"invalid_union":default:return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${r.origin}`}})}},"no",0,function(){let e,t;return{localeError:(e={string:{unit:"tegn",verb:" ha"},file:{unit:"bytes",verb:" ha"},array:{unit:"elementer",verb:" inneholde"},set:{unit:"elementer",verb:" inneholde"}},t={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Ugyldig input: forventet ${r.expected}, fikk ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tall";case"object":if(Array.isArray(e))return"liste";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ugyldig verdi: forventet ${a9(r.values[0])}`;return`Ugyldig valg: forventet en av ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()} ${i.unit??"elementer"}`;return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()} ${i.unit}`;return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ugyldig streng: m\xe5 starte med "${r.prefix}"`;if("ends_with"===r.format)return`Ugyldig streng: m\xe5 ende med "${r.suffix}"`;if("includes"===r.format)return`Ugyldig streng: m\xe5 inneholde "${r.includes}"`;if("regex"===r.format)return`Ugyldig streng: m\xe5 matche m\xf8nsteret ${r.pattern}`;return`Ugyldig ${t[r.format]??r.format}`;case"not_multiple_of":return`Ugyldig tall: m\xe5 v\xe6re et multiplum av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Ukjente nkler":"Ukjent nkkel"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Ugyldig n\xf8kkel i ${r.origin}`;case"invalid_union":default:return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${r.origin}`}})}},"ota",0,function(){let e,t;return{localeError:(e={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}},t={regex:"giren",email:"epostagh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengm",date:"ISO tarihi",time:"ISO zaman",duration:"ISO mddeti",ipv4:"IPv4 nin",ipv6:"IPv6 nin",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},r=>{switch(r.code){case"invalid_type":return`F\xe2sit giren: umulan ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numara";case"object":if(Array.isArray(e))return"saf";if(null===e)return"gayb";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`F\xe2sit giren: umulan ${a9(r.values[0])}`;return`F\xe2sit tercih: m\xfbteberler ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} ${i.unit??"elements"} sahip olmalyd.`;return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} olmalyd.`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} ${i.unit} sahip olmalyd.`;return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} olmalyd.`}case"invalid_format":if("starts_with"===r.format)return`F\xe2sit metin: "${r.prefix}" ile balamal.`;if("ends_with"===r.format)return`F\xe2sit metin: "${r.suffix}" ile bitmeli.`;if("includes"===r.format)return`F\xe2sit metin: "${r.includes}" ihtiv\xe2 etmeli.`;if("regex"===r.format)return`F\xe2sit metin: ${r.pattern} nakna uymal.`;return`F\xe2sit ${t[r.format]??r.format}`;case"not_multiple_of":return`F\xe2sit say: ${r.divisor} kat olmalyd.`;case"unrecognized_keys":return`Tannmayan anahtar ${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7in tannmayan anahtar var.`;case"invalid_union":return"Giren tannamad.";case"invalid_element":return`${r.origin} i\xe7in tannmayan kymet var.`;default:return`Kymet tannamad.`}})}},"pl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakw",verb:"mie"},file:{unit:"bajtw",verb:"mie"},array:{unit:"elementw",verb:"mie"},set:{unit:"elementw",verb:"mie"}},t={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znakw zakodowany w formacie base64",base64url:"cig znakw zakodowany w formacie base64url",json_string:"cig znakw w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},r=>{switch(r.code){case"invalid_type":return`Nieprawidowe dane wejciowe: oczekiwano ${r.expected}, otrzymano ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"liczba";case"object":if(Array.isArray(e))return"tablica";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Nieprawidowe dane wejciowe: oczekiwano ${a9(r.values[0])}`;return`Nieprawidowa opcja: oczekiwano jednej z wartoci ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Za dua warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.maximum.toString()} ${i.unit??"elementw"}`;return`Zbyt du(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Za maa warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.minimum.toString()} ${i.unit??"elementw"}`;return`Zbyt ma(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi zaczyna si od "${r.prefix}"`;if("ends_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi koczy si na "${r.suffix}"`;if("includes"===r.format)return`Nieprawidowy cig znak\xf3w: musi zawiera "${r.includes}"`;if("regex"===r.format)return`Nieprawidowy cig znak\xf3w: musi odpowiada wzorcowi ${r.pattern}`;return`Nieprawidow(y/a/e) ${t[r.format]??r.format}`;case"not_multiple_of":return`Nieprawidowa liczba: musi by wielokrotnoci ${r.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Nieprawidowy klucz w ${r.origin}`;case"invalid_union":return"Nieprawidowe dane wejciowe";case"invalid_element":return`Nieprawidowa warto w ${r.origin}`;default:return`Nieprawidowe dane wejciowe`}})}},"ps",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"  ",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ",date:"",time:"",duration:"",ipv4:" IPv4 ",ipv6:" IPv6 ",cidrv4:" IPv4 ",cidrv6:" IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:" E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected} ,  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])} `;return` :    ${aA(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"   `;if("ends_with"===r.format)return` :   "${r.suffix}"    `;if("includes"===r.format)return` :  "${r.includes}" `;if("regex"===r.format)return` :   ${r.pattern}   `;return`${t[r.format]??r.format}  `;case"not_multiple_of":return` :   ${r.divisor}  `;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin} `;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin} `}})}},"pt",0,function(){let e,t;return{localeError:(e={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}},t={regex:"padro",email:"endereo de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"durao ISO",ipv4:"endereo IPv4",ipv6:"endereo IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipo inv\xe1lido: esperado ${r.expected}, recebido ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":if(Array.isArray(e))return"array";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entrada inv\xe1lida: esperado ${a9(r.values[0])}`;return`Op\xe7\xe3o inv\xe1lida: esperada uma das ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Muito grande: esperado que ${r.origin??"valor"} tivesse ${t}${r.maximum.toString()} ${i.unit??"elementos"}`;return`Muito grande: esperado que ${r.origin??"valor"} fosse ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Muito pequeno: esperado que ${r.origin} tivesse ${t}${r.minimum.toString()} ${i.unit}`;return`Muito pequeno: esperado que ${r.origin} fosse ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Texto inv\xe1lido: deve come\xe7ar com "${r.prefix}"`;if("ends_with"===r.format)return`Texto inv\xe1lido: deve terminar com "${r.suffix}"`;if("includes"===r.format)return`Texto inv\xe1lido: deve incluir "${r.includes}"`;if("regex"===r.format)return`Texto inv\xe1lido: deve corresponder ao padr\xe3o ${r.pattern}`;return`${t[r.format]??r.format} inv\xe1lido`;case"not_multiple_of":return`N\xfamero inv\xe1lido: deve ser m\xfaltiplo de ${r.divisor}`;case"unrecognized_keys":return`Chave${r.keys.length>1?"s":""} desconhecida${r.keys.length>1?"s":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`Chave inv\xe1lida em ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido em ${r.origin}`;default:return`Campo inv\xe1lido`}})}},"ru",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}`;return` :    ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=uj(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin??""}   ${t}${r.maximum.toString()} ${e}`}return`  : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=uj(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin}   ${t}${r.minimum.toString()} ${e}`}return`  : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"sl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}},t={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},r=>{switch(r.code){case"invalid_type":return`Neveljaven vnos: priakovano ${r.expected}, prejeto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tevilo";case"object":if(Array.isArray(e))return"tabela";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neveljaven vnos: priakovano ${a9(r.values[0])}`;return`Neveljavna monost: priakovano eno izmed ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} imelo ${t}${r.maximum.toString()} ${i.unit??"elementov"}`;return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Premajhno: priakovano, da bo ${r.origin} imelo ${t}${r.minimum.toString()} ${i.unit}`;return`Premajhno: priakovano, da bo ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neveljaven niz: mora se zaeti z "${r.prefix}"`;if("ends_with"===r.format)return`Neveljaven niz: mora se konati z "${r.suffix}"`;if("includes"===r.format)return`Neveljaven niz: mora vsebovati "${r.includes}"`;if("regex"===r.format)return`Neveljaven niz: mora ustrezati vzorcu ${r.pattern}`;return`Neveljaven ${t[r.format]??r.format}`;case"not_multiple_of":return`Neveljavno tevilo: mora biti vekratnik ${r.divisor}`;case"unrecognized_keys":return`Neprepoznan${r.keys.length>1?"i kljui":" klju"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Neveljaven klju v ${r.origin}`;case"invalid_union":default:return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${r.origin}`}})}},"sv",0,function(){let e,t;return{localeError:(e={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehlla"},set:{unit:"objekt",verb:"att innehlla"}},t={regex:"reguljrt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strng",base64url:"base64url-kodad strng",json_string:"JSON-strng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},r=>{switch(r.code){case"invalid_type":return`Ogiltig inmatning: f\xf6rv\xe4ntat ${r.expected}, fick ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"antal";case"object":if(Array.isArray(e))return"lista";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ogiltig inmatning: f\xf6rv\xe4ntat ${a9(r.values[0])}`;return`Ogiltigt val: f\xf6rv\xe4ntade en av ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`F\xf6r stor(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`F\xf6r stor(t): f\xf6rv\xe4ntat ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()} ${i.unit}`;return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste b\xf6rja med "${r.prefix}"`;if("ends_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste sluta med "${r.suffix}"`;if("includes"===r.format)return`Ogiltig str\xe4ng: m\xe5ste inneh\xe5lla "${r.includes}"`;if("regex"===r.format)return`Ogiltig str\xe4ng: m\xe5ste matcha m\xf6nstret "${r.pattern}"`;return`Ogiltig(t) ${t[r.format]??r.format}`;case"not_multiple_of":return`Ogiltigt tal: m\xe5ste vara en multipel av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Oknda nycklar":"Oknd nyckel"}: ${aA(r.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${r.origin??"vrdet"}`;case"invalid_union":default:return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xe4rde i ${r.origin??"vrdet"}`}})}},"ta",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" ":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${a9(r.values[0])}`;return` :  ${aA(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :  ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}   `;return` :  ${r.origin??""} ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :  ${r.origin} ${t}${r.minimum.toString()} ${i.unit}   `;return` :  ${r.origin} ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"   `;if("ends_with"===r.format)return` : "${r.suffix}"   `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` : ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`  ${r.keys.length>1?"":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return" ";case"invalid_element":return`${r.origin}   `;default:return` `}})}},"th",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`:  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`:  ${a9(r.values[0])}`;return`:  ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`: ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`: ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`:  "${r.prefix}"`;if("ends_with"===r.format)return`:  "${r.suffix}"`;if("includes"===r.format)return`:  "${r.includes}" `;if("regex"===r.format)return`:  ${r.pattern}`;return`: ${t[r.format]??r.format}`;case"not_multiple_of":return`:  ${r.divisor} `;case"unrecognized_keys":return`: ${aA(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":return": ";case"invalid_element":return` ${r.origin}`;default:return``}})}},"tr",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"e",verb:"olmal"},set:{unit:"e",verb:"olmal"}},t={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},r=>{switch(r.code){case"invalid_type":return`Ge\xe7ersiz deer: beklenen ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ge\xe7ersiz deer: beklenen ${a9(r.values[0])}`;return`Ge\xe7ersiz se\xe7enek: aadakilerden biri olmal: ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()} ${i.unit??"e"}`;return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ge\xe7ersiz metin: "${r.prefix}" ile balamal`;if("ends_with"===r.format)return`Ge\xe7ersiz metin: "${r.suffix}" ile bitmeli`;if("includes"===r.format)return`Ge\xe7ersiz metin: "${r.includes}" i\xe7ermeli`;if("regex"===r.format)return`Ge\xe7ersiz metin: ${r.pattern} desenine uymal`;return`Ge\xe7ersiz ${t[r.format]??r.format}`;case"not_multiple_of":return`Ge\xe7ersiz say: ${r.divisor} ile tam b\xf6l\xfcnebilmeli`;case"unrecognized_keys":return`Tannmayan anahtar${r.keys.length>1?"lar":""}: ${aA(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7inde ge\xe7ersiz anahtar`;case"invalid_union":return"Geersiz deer";case"invalid_element":return`${r.origin} i\xe7inde ge\xe7ersiz deer`;default:return`Ge\xe7ersiz deer`}})}},"ua",0,function(){return uP()},"uk",0,uP,"ur",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  : ${r.expected}   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return`  : ${a9(r.values[0])}  `;return` : ${aA(r.values,"|")}     `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}   `;return` : ${r.origin??""}  ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}   `;return` : ${r.origin}  ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"    `;if("ends_with"===r.format)return` : "${r.suffix}"    `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` :  ${r.pattern}    `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`   ${r.keys.length>1?"":""}: ${aA(r.keys," ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return"  ";case"invalid_element":return`${r.origin}   `;default:return`  `}})}},"vi",0,function(){let e,t;return{localeError:(e={string:{unit:"k t",verb:"c"},file:{unit:"byte",verb:"c"},array:{unit:"phn t",verb:"c"},set:{unit:"phn t",verb:"c"}},t={regex:"u vo",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngy gi ISO",date:"ngy ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m ha base64",base64url:"chui m ha base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u vo"},r=>{switch(r.code){case"invalid_type":return`u v\xe0o kh\xf4ng hp l: mong i ${r.expected}, nhn c ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"s";case"object":if(Array.isArray(e))return"mng";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`u v\xe0o kh\xf4ng hp l: mong i ${a9(r.values[0])}`;return`T\xf9y chn kh\xf4ng hp l: mong i mt trong c\xe1c gi\xe1 tr ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"phn t"}`;return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Qu\xe1 nh: mong i ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Qu\xe1 nh: mong i ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Chui kh\xf4ng hp l: phi bt u bng "${r.prefix}"`;if("ends_with"===r.format)return`Chui kh\xf4ng hp l: phi kt th\xfac bng "${r.suffix}"`;if("includes"===r.format)return`Chui kh\xf4ng hp l: phi bao gm "${r.includes}"`;if("regex"===r.format)return`Chui kh\xf4ng hp l: phi khp vi mu ${r.pattern}`;return`${t[r.format]??r.format} kh\xf4ng hp l`;case"not_multiple_of":return`S kh\xf4ng hp l: phi l\xe0 bi s ca ${r.divisor}`;case"unrecognized_keys":return`Kh\xf3a kh\xf4ng c nhn dng: ${aA(r.keys,", ")}`;case"invalid_key":return`Kh\xf3a kh\xf4ng hp l trong ${r.origin}`;case"invalid_union":return"u vo khng hp l";case"invalid_element":return`Gi\xe1 tr kh\xf4ng hp l trong ${r.origin}`;default:return`u v\xe0o kh\xf4ng hp l`}})}},"yo",0,function(){let e,t;return{localeError:(e={string:{unit:"mi",verb:"n"},file:{unit:"bytes",verb:"n"},array:{unit:"nkan",verb:"n"},set:{unit:"nkan",verb:"n"}},t={regex:"r bwl",email:"drs ml",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"kk ISO",date:"j ISO",time:"kk ISO",duration:"kk t p ISO",ipv4:"drs IPv4",ipv6:"drs IPv6",cidrv4:"gbgb IPv4",cidrv6:"gbgb IPv6",base64:"r t a k n base64",base64url:"r base64url",json_string:"r JSON",e164:"nmb E.164",jwt:"JWT",template_literal:"r bwl"},r=>{switch(r.code){case"invalid_type":return`\xccb\xe1wl\xe9 a\xece: a n\xed l\xe1ti fi ${r.expected}, \xe0m a r\xed ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmb";case"object":if(Array.isArray(e))return"akop";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`\xccb\xe1wl\xe9 a\xece: a n\xed l\xe1ti fi ${a9(r.values[0])}`;return`\xc0\xe0y\xe0n a\xece: yan kan l\xe1ra ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`T\xf3 p j\xf9: a n\xed l\xe1ti j p\xe9 ${r.origin??"iye"} ${i.verb} ${t}${r.maximum} ${i.unit}`;return`T\xf3 p j\xf9: a n\xed l\xe1ti j ${t}${r.maximum}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`K\xe9r\xe9 ju: a n\xed l\xe1ti j p\xe9 ${r.origin} ${i.verb} ${t}${r.minimum} ${i.unit}`;return`K\xe9r\xe9 ju: a n\xed l\xe1ti j ${t}${r.minimum}`}case"invalid_format":if("starts_with"===r.format)return`r a\xece: gbd br pl\xfa "${r.prefix}"`;if("ends_with"===r.format)return`r a\xece: gbd par\xed pl\xfa "${r.suffix}"`;if("includes"===r.format)return`r a\xece: gbd n\xed "${r.includes}"`;if("regex"===r.format)return`r a\xece: gbd b\xe1 \xe0pr mu ${r.pattern}`;return`A\xece: ${t[r.format]??r.format}`;case"not_multiple_of":return`Nmb\xe0 a\xece: gbd j \xe8y\xe0 p\xedp\xedn ti ${r.divisor}`;case"unrecognized_keys":return`Bt\xecn\xec \xe0\xecm: ${aA(r.keys,", ")}`;case"invalid_key":return`Bt\xecn\xec a\xece n\xedn\xfa ${r.origin}`;case"invalid_union":default:return"bwl ae";case"invalid_element":return`Iye a\xece n\xedn\xfa ${r.origin}`}})}},"zhCN",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"(NaN)":"";case"object":if(Array.isArray(e))return"";if(null===e)return"(null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${a9(r.values[0])}`;return` ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`(key): ${aA(r.keys,", ")}`;case"invalid_key":return`${r.origin} (key)`;case"invalid_union":return"";case"invalid_element":return`${r.origin} (value)`;default:return``}})}},"zhTW",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${a9(r.values[0])}`;return` ${aA(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""}${aA(r.keys,"")}`;case"invalid_key":return`${r.origin} `;case"invalid_union":return"";case"invalid_element":return`${r.origin} `;default:return``}})}}],60544);var wP=e.i(60544);e.i(52637),e.i(73911),e.i(62061),e.i(7159);var wR=e.i(33145);e.s(["$ZodAny",0,lD,"$ZodArray",0,lq,"$ZodAsyncError",()=>ab,"$ZodBase64",0,lk,"$ZodBase64URL",0,lE,"$ZodBigInt",0,lP,"$ZodBigIntFormat",0,lR,"$ZodBoolean",0,lj,"$ZodCIDRv4",0,lw,"$ZodCIDRv6",0,l$,"$ZodCUID",0,lu,"$ZodCUID2",0,lc,"$ZodCatch",0,uh,"$ZodCheck",0,oz,"$ZodCheckBigIntFormat",0,oV,"$ZodCheckEndsWith",0,o2,"$ZodCheckGreaterThan",0,oZ,"$ZodCheckIncludes",0,o1,"$ZodCheckLengthEquals",0,oK,"$ZodCheckLessThan",0,oM,"$ZodCheckLowerCase",0,oQ,"$ZodCheckMaxLength",0,oJ,"$ZodCheckMaxSize",0,oq,"$ZodCheckMimeType",0,o5,"$ZodCheckMinLength",0,oH,"$ZodCheckMinSize",0,oG,"$ZodCheckMultipleOf",0,oF,"$ZodCheckNumberFormat",0,oB,"$ZodCheckOverwrite",0,o3,"$ZodCheckProperty",0,o9,"$ZodCheckRegex",0,oY,"$ZodCheckSizeEquals",0,oW,"$ZodCheckStartsWith",0,o4,"$ZodCheckStringFormat",0,oX,"$ZodCheckUpperCase",0,o0,"$ZodCodec",0,ug,"$ZodCustom",0,uI,"$ZodCustomStringFormat",0,lA,"$ZodDate",0,lB,"$ZodDefault",0,us,"$ZodDiscriminatedUnion",0,lQ,"$ZodE164",0,lS,"$ZodEmail",0,la,"$ZodEmoji",0,lo,"$ZodEncodeError",()=>aw,"$ZodEnum",0,l7,"$ZodError",0,s$,"$ZodFile",0,ut,"$ZodFunction",0,u$,"$ZodGUID",0,li,"$ZodIPv4",0,lv,"$ZodIPv6",0,l_,"$ZodISODate",0,lf,"$ZodISODateTime",0,lm,"$ZodISODuration",0,ly,"$ZodISOTime",0,lg,"$ZodIntersection",0,l0,"$ZodJWT",0,lT,"$ZodKSUID",0,lp,"$ZodLazy",0,uk,"$ZodLiteral",0,ue,"$ZodMAC",0,lb,"$ZodMap",0,l9,"$ZodNaN",0,up,"$ZodNanoID",0,ll,"$ZodNever",0,lZ,"$ZodNonOptional",0,uu,"$ZodNull",0,lz,"$ZodNullable",0,ua,"$ZodNumber",0,lN,"$ZodNumberFormat",0,lC,"$ZodObject",0,lH,"$ZodObjectJIT",0,lK,"$ZodOptional",0,un,"$ZodPipe",0,um,"$ZodPrefault",0,ul,"$ZodPromise",0,ux,"$ZodReadonly",0,u_,"$ZodRealError",0,sx,"$ZodRecord",0,l6,"$ZodRegistry",()=>uL,"$ZodSet",0,l3,"$ZodString",0,lt,"$ZodStringFormat",0,lr,"$ZodSuccess",0,ud,"$ZodSymbol",0,lU,"$ZodTemplateLiteral",0,uw,"$ZodTransform",0,ur,"$ZodTuple",0,l4,"$ZodType",0,le,"$ZodULID",0,ld,"$ZodURL",0,ls,"$ZodUUID",0,ln,"$ZodUndefined",0,lL,"$ZodUnion",0,lY,"$ZodUnknown",0,lM,"$ZodVoid",0,lF,"$ZodXID",0,lh,"$brand",0,a_,"$constructor",()=>av,"$input",0,uU,"$output",0,uR,"Doc",()=>o8,"JSONSchema",0,wR,"JSONSchemaGenerator",()=>dS,"NEVER",0,ay,"TimePrecision",0,ct,"_any",()=>c$,"_array",()=>c6,"_base64",()=>u3,"_base64url",()=>u8,"_bigint",()=>cf,"_boolean",()=>cp,"_catch",()=>dp,"_check",()=>d$,"_cidrv4",()=>u9,"_cidrv6",()=>u5,"_coercedBigint",()=>cg,"_coercedBoolean",()=>cm,"_coercedDate",()=>cS,"_coercedNumber",()=>co,"_coercedString",()=>uZ,"_cuid",()=>uX,"_cuid2",()=>uY,"_custom",()=>d_,"_date",()=>cE,"_decode",0,sD,"_decodeAsync",0,sB,"_default",()=>dc,"_discriminatedUnion",()=>c5,"_e164",()=>u7,"_email",()=>uF,"_emoji",()=>uH,"_encode",0,sL,"_encodeAsync",0,sZ,"_endsWith",()=>cH,"_enum",()=>dr,"_file",()=>da,"_float32",()=>cu,"_float64",()=>cc,"_gt",()=>cN,"_gte",()=>cC,"_guid",()=>uB,"_includes",()=>cW,"_int",()=>cl,"_int32",()=>cd,"_int64",()=>cy,"_intersection",()=>c3,"_ipv4",()=>u4,"_ipv6",()=>u2,"_isoDate",()=>ci,"_isoDateTime",()=>cr,"_isoDuration",()=>ca,"_isoTime",()=>cn,"_jwt",()=>ce,"_ksuid",()=>u1,"_lazy",()=>dy,"_length",()=>cB,"_literal",()=>dn,"_lowercase",()=>cq,"_lt",()=>cT,"_lte",()=>cA,"_mac",()=>u6,"_map",()=>de,"_max",()=>cA,"_maxLength",()=>cZ,"_maxSize",()=>cz,"_mime",()=>cX,"_min",()=>cC,"_minLength",()=>cF,"_minSize",()=>cD,"_multipleOf",()=>cL,"_nan",()=>cO,"_nanoid",()=>uK,"_nativeEnum",()=>di,"_negative",()=>cP,"_never",()=>ck,"_nonnegative",()=>cU,"_nonoptional",()=>dd,"_nonpositive",()=>cR,"_normalize",()=>cQ,"_null",()=>cw,"_nullable",()=>du,"_number",()=>cs,"_optional",()=>dl,"_overwrite",()=>cY,"_parse",0,sT,"_parseAsync",0,sN,"_pipe",()=>dm,"_positive",()=>cj,"_promise",()=>dv,"_property",()=>cK,"_readonly",()=>df,"_record",()=>c7,"_refine",()=>db,"_regex",()=>cV,"_safeDecode",0,sW,"_safeDecodeAsync",0,sX,"_safeEncode",0,sq,"_safeEncodeAsync",0,sH,"_safeParse",0,sj,"_safeParseAsync",0,sR,"_set",()=>dt,"_size",()=>cM,"_slugify",()=>c2,"_startsWith",()=>cJ,"_string",()=>uM,"_stringFormat",()=>dE,"_stringbool",()=>dI,"_success",()=>dh,"_superRefine",()=>dw,"_symbol",()=>c_,"_templateLiteral",()=>dg,"_toLowerCase",()=>c1,"_toUpperCase",()=>c4,"_transform",()=>ds,"_trim",()=>c0,"_tuple",()=>c8,"_uint32",()=>ch,"_uint64",()=>cv,"_ulid",()=>uQ,"_undefined",()=>cb,"_union",()=>c9,"_unknown",()=>cx,"_uppercase",()=>cG,"_url",()=>uJ,"_uuid",()=>uV,"_uuidv4",()=>uq,"_uuidv6",()=>uG,"_uuidv7",()=>uW,"_void",()=>cI,"_xid",()=>u0,"clone",()=>a4,"config",()=>ax,"decode",0,sM,"decodeAsync",0,sV,"describe",()=>dx,"encode",0,sz,"encodeAsync",0,sF,"flattenError",()=>sk,"formatError",()=>sI,"globalConfig",0,a$,"globalRegistry",0,uD,"isValidBase64",()=>lx,"isValidBase64URL",()=>lI,"isValidJWT",()=>lO,"locales",0,wP,"meta",()=>dk,"parse",0,sA,"parseAsync",0,sC,"prettifyError",()=>sO,"regexes",0,wj,"registry",()=>uz,"safeDecode",0,sJ,"safeDecodeAsync",0,sY,"safeEncode",0,sG,"safeEncodeAsync",0,sK,"safeParse",0,sP,"safeParseAsync",0,sU,"toDotPath",()=>sS,"toJSONSchema",()=>dO,"treeifyError",()=>sE,"util",0,wC,"version",0,o7],13007);var wU=e.i(13007);e.i(7855),e.i(64328),e.s(["endsWith",()=>cH,"gt",()=>cN,"gte",()=>cC,"includes",()=>cW,"length",()=>cB,"lowercase",()=>cq,"lt",()=>cT,"lte",()=>cA,"maxLength",()=>cZ,"maxSize",()=>cz,"mime",()=>cX,"minLength",()=>cF,"minSize",()=>cD,"multipleOf",()=>cL,"negative",()=>cP,"nonnegative",()=>cU,"nonpositive",()=>cR,"normalize",()=>cQ,"overwrite",()=>cY,"positive",()=>cj,"property",()=>cK,"regex",()=>cV,"size",()=>cM,"slugify",()=>c2,"startsWith",()=>cJ,"toLowerCase",()=>c1,"toUpperCase",()=>c4,"trim",()=>c0,"uppercase",()=>cG],85648),e.i(85648),e.i(15874),e.i(48804),e.i(33137),e.s(["$brand",0,a_,"ZodFirstPartyTypeKind",()=>I,"ZodIssueCode",0,wk,"config",()=>ax,"getErrorMap",()=>wE,"setErrorMap",()=>wI],63203),e.i(63203);var vP=vP,dT=dT,wL=e.i(51047),wz=e.i(34512);e.s(["$brand",0,a_,"$input",0,uU,"$output",0,uR,"NEVER",0,ay,"TimePrecision",0,ct,"ZodAny",0,ba,"ZodArray",0,bf,"ZodBase64",0,_R,"ZodBase64URL",0,_L,"ZodBigInt",0,_6,"ZodBigIntFormat",0,_5,"ZodBoolean",0,_4,"ZodCIDRv4",0,_N,"ZodCIDRv6",0,_j,"ZodCUID",0,_f,"ZodCUID2",0,_y,"ZodCatch",0,b9,"ZodCodec",0,wt,"ZodCustom",0,wp,"ZodCustomStringFormat",0,_B,"ZodDate",0,bp,"ZodDefault",0,bX,"ZodDiscriminatedUnion",0,bk,"ZodE164",0,_D,"ZodEmail",0,v7,"ZodEmoji",0,_d,"ZodEnum",0,bL,"ZodError",0,vV,"ZodFile",0,bF,"ZodFirstPartyTypeKind",()=>I,"ZodFunction",0,wd,"ZodGUID",0,_t,"ZodIPv4",0,_I,"ZodIPv6",0,_T,"ZodISODate",0,vL,"ZodISODateTime",0,vR,"ZodISODuration",0,vZ,"ZodISOTime",0,vD,"ZodIntersection",0,bE,"ZodIssueCode",0,wk,"ZodJWT",0,_Z,"ZodKSUID",0,_x,"ZodLazy",0,wo,"ZodLiteral",0,bM,"ZodMAC",0,_S,"ZodMap",0,bj,"ZodNaN",0,b3,"ZodNanoID",0,_p,"ZodNever",0,bu,"ZodNonOptional",0,b1,"ZodNull",0,bi,"ZodNullable",0,bJ,"ZodNumber",0,_J,"ZodNumberFormat",0,_K,"ZodObject",0,bv,"ZodOptional",0,bG,"ZodPipe",0,b7,"ZodPrefault",0,bQ,"ZodPromise",0,wu,"ZodReadonly",0,wi,"ZodRealError",0,vq,"ZodRecord",0,bA,"ZodSet",0,bR,"ZodString",0,v5,"ZodStringFormat",0,v8,"ZodSuccess",0,b2,"ZodSymbol",0,_7,"ZodTemplateLiteral",0,wa,"ZodTransform",0,bV,"ZodTuple",0,bO,"ZodType",0,v6,"ZodULID",0,__,"ZodURL",0,_l,"ZodUUID",0,_i,"ZodUndefined",0,bt,"ZodUnion",0,b$,"ZodUnknown",0,bo,"ZodVoid",0,bd,"ZodXID",0,_w,"_ZodString",0,v9,"_default",()=>bY,"_function",()=>wh,"any",()=>bs,"array",()=>bg,"base64",()=>_U,"base64url",()=>_z,"bigint",()=>_9,"boolean",()=>_2,"catch",()=>b5,"check",()=>wm,"cidrv4",()=>_C,"cidrv6",()=>_P,"clone",()=>a4,"codec",()=>wr,"coerce",0,wz,"config",()=>ax,"core",0,wU,"cuid",()=>_g,"cuid2",()=>_v,"custom",()=>wf,"date",()=>bm,"decode",0,vX,"decodeAsync",0,vQ,"describe",0,wv,"discriminatedUnion",()=>bI,"e164",()=>_M,"email",()=>_e,"emoji",()=>_h,"encode",0,vK,"encodeAsync",0,vY,"endsWith",()=>cH,"enum",()=>bz,"file",()=>bB,"flattenError",()=>sk,"float32",()=>_Y,"float64",()=>_Q,"formatError",()=>sI,"function",()=>wh,"getErrorMap",()=>wE,"globalRegistry",0,uD,"gt",()=>cN,"gte",()=>cC,"guid",()=>_r,"hash",()=>_W,"hex",()=>_G,"hostname",()=>_q,"httpUrl",()=>_c,"includes",()=>cW,"instanceof",()=>wb,"int",()=>_X,"int32",()=>_0,"int64",()=>_3,"intersection",()=>bS,"ipv4",()=>_E,"ipv6",()=>_A,"iso",0,wL,"json",()=>w$,"jwt",()=>_F,"keyof",()=>by,"ksuid",()=>_k,"lazy",()=>wl,"length",()=>cB,"literal",()=>bZ,"locales",0,wP,"looseObject",()=>bw,"lowercase",()=>cq,"lt",()=>cT,"lte",()=>cA,"mac",()=>_O,"map",()=>bP,"maxLength",()=>cZ,"maxSize",()=>cz,"meta",0,w_,"mime",()=>cX,"minLength",()=>cF,"minSize",()=>cD,"multipleOf",()=>cL,"nan",()=>b8,"nanoid",()=>_m,"nativeEnum",()=>bD,"negative",()=>cP,"never",()=>bc,"nonnegative",()=>cU,"nonoptional",()=>b4,"nonpositive",()=>cR,"normalize",()=>cQ,"null",()=>bn,"nullable",()=>bH,"nullish",()=>bK,"number",()=>_H,"object",()=>b_,"optional",()=>bW,"overwrite",()=>cY,"parse",0,vG,"parseAsync",0,vW,"partialRecord",()=>bC,"pipe",()=>we,"positive",()=>cj,"prefault",()=>b0,"preprocess",()=>wx,"prettifyError",()=>sO,"promise",()=>wc,"property",()=>cK,"readonly",()=>wn,"record",()=>bN,"refine",()=>wg,"regex",()=>cV,"regexes",()=>vP,"registry",()=>uz,"safeDecode",0,v1,"safeDecodeAsync",0,v2,"safeEncode",0,v0,"safeEncodeAsync",0,v4,"safeParse",0,vJ,"safeParseAsync",0,vH,"set",()=>bU,"setErrorMap",()=>wI,"size",()=>cM,"slugify",()=>c2,"startsWith",()=>cJ,"strictObject",()=>bb,"string",()=>v3,"stringFormat",()=>_V,"stringbool",0,ww,"success",()=>b6,"superRefine",()=>wy,"symbol",()=>be,"templateLiteral",()=>ws,"toJSONSchema",()=>dO,"toLowerCase",()=>c1,"toUpperCase",()=>c4,"transform",()=>bq,"treeifyError",()=>sE,"trim",()=>c0,"tuple",()=>bT,"uint32",()=>_1,"uint64",()=>_8,"ulid",()=>_b,"undefined",()=>br,"union",()=>bx,"unknown",()=>bl,"uppercase",()=>cG,"url",()=>_u,"util",()=>dT,"uuid",()=>_n,"uuidv4",()=>_a,"uuidv6",()=>_s,"uuidv7",()=>_o,"void",()=>bh,"xid",()=>_$],62810);var wD=e.i(62810);e.s(["default",0,wD],80420),e.i(80420);var wM=wD,wZ={};G(wZ,{BaseToolkit:()=>wG,DynamicStructuredTool:()=>wq,DynamicTool:()=>wV,StructuredTool:()=>wF,Tool:()=>wB,ToolInputParsingException:()=>e6,isLangChainTool:()=>vd,isRunnableToolLike:()=>vu,isStructuredTool:()=>vl,isStructuredToolParams:()=>vc,tool:()=>wW});var wF=class extends gG{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(e){super(e??{}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata,this.extras=e?.extras??this.extras}async invoke(e,t){let r,i=nE(nk(this.defaultConfig,t));return e2(e)?(r=e.args,i={...i,toolCall:e}):r=e,this.call(r,i)}async call(e,t,r){let i,n,a,s,o,l=e2(e)?e.args:e;if(dj(this.schema))try{i=await dz(this.schema,l)}catch(r){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}
Details: ${r.message}`),d2(r)&&(t=`${t}

${wM.prettifyError(r)}`),new e6(t,JSON.stringify(e))}else{let t=mz(l,this.schema);if(!t.valid){let r="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(r=`${r}
Details: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new e6(r,JSON.stringify(e))}i=l}let u=iJ(t),c=i1.configure(u.callbacks,this.callbacks,u.tags||r,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d=await c?.handleToolStart(this.toJSON(),"string"==typeof e?e:JSON.stringify(e),u.runId,void 0,void 0,void 0,u.runName);delete u.runId;try{n=await this._call(i,d,u)}catch(e){throw await d?.handleToolError(e),e}if("content_and_artifact"===this.responseFormat)if(Array.isArray(n)&&2===n.length)[a,s]=n;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(n)}`);else a=n;e2(e)&&(o=e.id),!o&&u&&"object"==typeof u&&"toolCall"in u&&null!=u.toolCall&&"object"==typeof u.toolCall&&"id"in u.toolCall&&"string"==typeof u.toolCall.id&&(o=u.toolCall.id);let h=function(e){let{content:t,artifact:r,toolCallId:i,metadata:n}=e;return!i||eK(t)?t:new eX("string"==typeof t||Array.isArray(t)&&t.every(e=>"object"==typeof e)?{status:"success",content:t,artifact:r,tool_call_id:i,name:e.name,metadata:n}:{status:"success",content:function(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}(t),artifact:r,tool_call_id:i,name:e.name,metadata:n})}({content:a,artifact:s,toolCallId:o,name:this.name,metadata:this.metadata});return await d?.handleToolEnd(h),h}},wB=class extends wF{schema=m5.object({input:m5.string().optional()}).transform(e=>e.input);constructor(e){super(e)}call(e,t){return super.call("string"==typeof e||null==e?{input:e}:e,t)}},wV=class extends wB{static lc_name(){return"DynamicTool"}name;description;func;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){let r=iJ(t);return void 0===r.runName&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}},wq=class extends wF{static lc_name(){return"DynamicStructuredTool"}name;description;func;schema;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){let i=iJ(t);return void 0===i.runName&&(i.runName=this.name),super.call(e,i,r)}_call(e,t,r){return this.func(e,t,r)}},wG=class{getTools(){return this.tools}};function wW(e,t){let r=dB(t.schema),i=mF(t.schema);if(!t.schema||r||i)return new wV({...t,description:t.description??t.schema?.description??`${t.name} tool`,func:async(t,r,i)=>new Promise((n,a)=>{let s=nS(i,{callbacks:r?.getChild()});i5.runWithConfig(nO(s),async()=>{try{n(e(t,s))}catch(e){a(e)}})})});let n=t.schema,a=t.description??t.schema.description??`${t.name} tool`;return new wq({...t,description:a,schema:n,func:async(t,r,i)=>new Promise((n,a)=>{let s,o=()=>{i?.signal&&s&&i.signal.removeEventListener("abort",s)};i?.signal&&(s=()=>{o(),a(nA(i.signal))},i.signal.addEventListener("abort",s));let l=nS(i,{callbacks:r?.getChild()});i5.runWithConfig(nO(l),async()=>{try{let r=await e(t,l);if(i?.signal?.aborted)return void o();o(),n(r)}catch(e){o(),a(e)}})})})}var wJ=class extends gY{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(e,t,r){if(t?.stop?.length)return{generations:[{message:new t$(t.stop[0]),text:t.stop[0]}]};let i=e.map(e=>"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)).join("\n");return await r?.handleLLMNewToken(i),{generations:[{message:new t$(i),text:i}],llmOutput:{}}}},wH=class e extends gY{sleep=50;responses=[];chunks=[];toolStyle="openai";thrownErrorString;tools=[];constructor({sleep:e=50,responses:t=[],chunks:r=[],toolStyle:i="openai",thrownErrorString:n,...a}){super(a),this.sleep=e,this.responses=t,this.chunks=r,this.toolStyle=i,this.thrownErrorString=n}_llmType(){return"fake"}bindTools(t){let r=[...this.tools,...t],i=r.map(e=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:e.name,description:e.description,parameters:mZ(e.schema)}};case"anthropic":return{name:e.name,description:e.description,input_schema:mZ(e.schema)};case"bedrock":return{toolSpec:{name:e.name,description:e.description,inputSchema:mZ(e.schema)}};case"google":return{name:e.name,description:e.description,parameters:mZ(e.schema)};default:throw Error(`Unsupported tool style: ${this.toolStyle}`)}}),n="google"===this.toolStyle?[{functionDeclarations:i}]:i,a=new e({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return a.tools=r,a.withConfig({tools:n})}async _generate(e,t,r){if(this.thrownErrorString)throw Error(this.thrownErrorString);return{generations:[{text:"",message:new t$({content:this.responses?.[0]?.content??e[0].content??"",tool_calls:this.chunks?.[0]?.tool_calls})}]}}async *_streamResponseChunks(e,t,r){if(this.thrownErrorString)throw Error(this.thrownErrorString);if(this.chunks?.length){for(let e of this.chunks){let t=new aa({message:new tI({content:e.content,tool_calls:e.tool_calls,additional_kwargs:e.additional_kwargs??{}}),text:e.content?.toString()??""});yield t,await r?.handleLLMNewToken(e.content,void 0,void 0,void 0,void 0,{chunk:t})}return}let i=this.responses?.[0]??new t$("string"==typeof e[0].content?e[0].content:"");for(let e of"string"==typeof i.content?i.content:""){await new Promise(e=>setTimeout(e,this.sleep));let t=new aa({message:new tI({content:e}),text:e});yield t,await r?.handleLLMNewToken(e,void 0,void 0,void 0,void 0,{chunk:t})}}},wK=class extends gY{static lc_name(){return"FakeListChatModel"}lc_serializable=!0;responses;i=0;sleep;emitCustomEvent=!1;constructor(e){super(e);const{responses:t,sleep:r,emitCustomEvent:i}=e;this.responses=t,this.sleep=r,this.emitCustomEvent=i??this.emitCustomEvent}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(e,t,r){if(await this._sleepIfRequested(),t?.thrownErrorString)throw Error(t.thrownErrorString);if(this.emitCustomEvent&&await r?.handleCustomEvent("some_test_event",{someval:!0}),t?.stop?.length)return{generations:[this._formatGeneration(t.stop[0])]};{let e=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(e)],llmOutput:{}}}}_formatGeneration(e){return{message:new t$(e),text:e}}async *_streamResponseChunks(e,t,r){let i=this._currentResponse();for await(let e of(this._incrementResponse(),this.emitCustomEvent&&await r?.handleCustomEvent("some_test_event",{someval:!0}),i)){if(await this._sleepIfRequested(),t?.thrownErrorString)throw Error(t.thrownErrorString);let i=this._createResponseChunk(e);yield i,r?.handleLLMNewToken(e)}}async _sleepIfRequested(){void 0!==this.sleep&&await this._sleep()}async _sleep(){return new Promise(e=>{setTimeout(()=>e(),this.sleep)})}_createResponseChunk(e){return new aa({message:new tI({content:e}),text:e})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}withStructuredOutput(e,t){return fa.from(async e=>{let t=await this.invoke(e);if(t.tool_calls?.[0]?.args)return t.tool_calls[0].args;if("string"==typeof t.content)return JSON.parse(t.content);throw Error("No structured output found")})}},wX=class extends fN{vectorSize;constructor(e){super(e??{}),this.vectorSize=e?.vectorSize??4}async embedDocuments(e){return Promise.all(e.map(e=>this.embedQuery(e)))}async embedQuery(e){let t=e,r=(t=t.toLowerCase().replaceAll(/[^a-z ]/g,"")).length%this.vectorSize,i=0===r?0:this.vectorSize-r,n=t.length+i,a=(t=t.padEnd(n," ")).length/this.vectorSize,s=[];for(let e=0;e<t.length;e+=a)s.push(t.slice(e,e+a));return s.map(e=>{let t=0;for(let r=0;r<e.length;r+=1)t+=" "===e?0:e.charCodeAt(r);return t%26/26})}},wY=class extends fN{constructor(e){super(e??{})}embedDocuments(e){return Promise.resolve(e.map(()=>[.1,.2,.3,.4]))}embedQuery(e){return Promise.resolve([.1,.2,.3,.4])}},wQ=class extends g4{response;thrownErrorString;constructor(e){super(e),this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,t,r){if(this.thrownErrorString)throw Error(this.thrownErrorString);let i=this.response??e;return await r?.handleLLMNewToken(i),i}},w0=class extends g4{sleep=50;responses;thrownErrorString;constructor(e){super(e),this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){if(this.thrownErrorString)throw Error(this.thrownErrorString);let t=this.responses?.[0];return this.responses=this.responses?.slice(1),t??e}async *_streamResponseChunks(e,t,r){if(this.thrownErrorString)throw Error(this.thrownErrorString);let i=this.responses?.[0];for(let t of(this.responses=this.responses?.slice(1),i??e))await new Promise(e=>setTimeout(e,this.sleep)),yield{text:t,generationInfo:{}},await r?.handleLLMNewToken(t)}},w1=class extends fS{lc_namespace=["langchain_core","message","fake"];messages=[];constructor(){super()}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new ta(e))}async addAIMessage(e){this.messages.push(new t$(e))}async clear(){this.messages=[]}},w4=class extends fO{lc_namespace=["langchain_core","message","fake"];messages=[];constructor(){super()}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}},w2=class extends ig{name="fake_tracer";runs=[];constructor(){super()}persistRun(e){return this.runs.push(e),Promise.resolve()}},w6=class extends yY{lc_namespace=["tests","fake"];getFormatInstructions(){return""}async parse(e){return e.split(",").map(e=>e.trim())}},w9=class extends fJ{lc_namespace=["test","fake"];output=[new gu({pageContent:"foo"}),new gu({pageContent:"bar"})];constructor(e){super(),this.output=e?.output??this.output}async _getRelevantDocuments(e){return this.output}},w5=class extends m8{lc_namespace=["tests","fake"];returnOptions;constructor(e){super(e),this.returnOptions=e.returnOptions}async invoke(e,t){return this.returnOptions?t??{}:{input:e}}},w3=class extends wF{name;description;schema;constructor(e){super(e),this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,t){return JSON.stringify(e)}},w8=class extends ig{runPromiseResolver;runPromise;name="single_run_extractor";constructor(){super(),this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}};function w7(e,t){let r=0,i=0,n=0;for(let a=0;a<e.length;a++)r+=e[a]*t[a],i+=e[a]*e[a],n+=t[a]*t[a];return r/(Math.sqrt(i)*Math.sqrt(n))}var $e=class e extends fX{memoryVectors=[];similarity;_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),this.similarity=t??w7}async addDocuments(e){let t=e.map(({pageContent:e})=>e);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){let r=e.map((e,r)=>({content:t[r].pageContent,embedding:e,metadata:t[r].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){let i=this.memoryVectors.filter(e=>!r||r(new gu({metadata:e.metadata,pageContent:e.content})));return i.map((t,r)=>({similarity:this.similarity(e,t.embedding),index:r})).sort((e,t)=>e.similarity>t.similarity?-1:0).slice(0,t).map(e=>[new gu({metadata:i[e.index].metadata,pageContent:i[e.index].content}),e.similarity])}static async fromTexts(t,r,i,n){let a=[];for(let e=0;e<t.length;e+=1){let i=Array.isArray(r)?r[e]:r,n=new gu({pageContent:t[e],metadata:i});a.push(n)}return e.fromDocuments(a,i,n)}static async fromDocuments(e,t,r){let i=new this(t,r);return await i.addDocuments(e),i}static async fromExistingIndex(e,t){return new this(e,t)}},$t={};G($t,{FakeChatMessageHistory:()=>w1,FakeChatModel:()=>wJ,FakeEmbeddings:()=>wY,FakeLLM:()=>wQ,FakeListChatMessageHistory:()=>w4,FakeListChatModel:()=>wK,FakeRetriever:()=>w9,FakeRunnable:()=>w5,FakeSplitIntoListParser:()=>w6,FakeStreamingChatModel:()=>wH,FakeStreamingLLM:()=>w0,FakeTool:()=>w3,FakeTracer:()=>w2,FakeVectorStore:()=>$e,SingleRunExtractor:()=>w8,SyntheticEmbeddings:()=>wX});var $r={};G($r,{extendInteropZodObject:()=>dX,getInteropZodDefaultGetter:()=>d0,getInteropZodObjectShape:()=>dK,getSchemaDescription:()=>dZ,interopParse:()=>dM,interopParseAsync:()=>dz,interopSafeParse:()=>dD,interopSafeParseAsync:()=>dL,interopZodObjectMakeFieldsOptional:()=>d4,interopZodObjectPartial:()=>dY,interopZodObjectPassthrough:()=>function e(t,r=!1){if(dV(t))return t.passthrough();if(dq(t)){let i=t._zod.def.shape;if(r)for(let[n,a]of Object.entries(t._zod.def.shape)){if(dq(a)){let t=e(a,r);i[n]=t}else if(dG(a)){let t=a._zod.def.element;dq(t)&&(t=e(t,r)),i[n]=a4(a,{...a._zod.def,element:t})}else i[n]=a;let t=uD.get(a);t&&uD.add(i[n],t)}let n=a4(t,{...t._zod.def,shape:i,catchall:cx(lM)}),a=uD.get(t);return a&&uD.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")},interopZodObjectStrict:()=>dQ,interopZodTransformInputSchema:()=>d1,isInteropZodError:()=>d2,isInteropZodLiteral:()=>dU,isInteropZodObject:()=>dH,isInteropZodSchema:()=>dj,isShapelessZodSchema:()=>dF,isSimpleStringZodSchema:()=>dB,isZodArrayV4:()=>dG,isZodLiteralV3:()=>dP,isZodLiteralV4:()=>dR,isZodNullableV4:()=>dJ,isZodObjectV3:()=>dV,isZodObjectV4:()=>dq,isZodOptionalV4:()=>dW,isZodSchema:()=>dC,isZodSchemaV3:()=>dN,isZodSchemaV4:()=>dA});var $i={};G($i,{EventStreamContentType:()=>$n,convertEventStreamToIterableReadableDataStream:()=>$c,getBytes:()=>$a,getLines:()=>$o,getMessages:()=>$l});let $n="text/event-stream";async function $a(e,t){if(e instanceof ReadableStream){let r=e.getReader();for(;;){let e=await r.read();if(e.done){t(new Uint8Array,!0);break}t(e.value)}}else try{for await(let r of e)t(new Uint8Array(r));t(new Uint8Array,!0)}catch(e){throw Error(`Parsing event source stream failed.
Ensure your implementation of fetch returns a web or Node readable stream.
Error: ${e.message}`)}}var $s=((v=$s||{})[v.NewLine=10]="NewLine",v[v.CarriageReturn=13]="CarriageReturn",v[v.Space=32]="Space",v[v.Colon=58]="Colon",v);function $o(e){let t,r,i,n=!1;return function(a,s){var o,l;let u;if(s)return void e(a,0,!0);void 0===t?(t=a,r=0,i=-1):(o=t,l=a,(u=new Uint8Array(o.length+l.length)).set(o),u.set(l,o.length),t=u);let c=t.length,d=0;for(;r<c;){n&&(t[r]===$s.NewLine&&(d=++r),n=!1);let a=-1;for(;r<c&&-1===a;++r)switch(t[r]){case $s.Colon:-1===i&&(i=r-d);break;case $s.CarriageReturn:n=!0;case $s.NewLine:a=r}if(-1===a)break;e(t.subarray(d,a),i),d=r,i=-1}d===c?t=void 0:0!==d&&(t=t.subarray(d),r-=d)}}function $l(e,t,r){let i=$u(),n=new TextDecoder;return function(a,s,o){if(o){var l;(""!==(l=i).data||""!==l.event||""!==l.id||void 0!==l.retry)&&(e?.(i),i=$u());return}if(0===a.length)e?.(i),i=$u();else if(s>0){let e=n.decode(a.subarray(0,s)),o=s+(a[s+1]===$s.Space?2:1),l=n.decode(a.subarray(o));switch(e){case"data":i.data=i.data?i.data+"\n"+l:l;break;case"event":i.event=l;break;case"id":t?.(i.id=l);break;case"retry":{let e=parseInt(l,10);Number.isNaN(e)||r?.(i.retry=e)}}}}}function $u(){return{data:"",event:"",id:"",retry:void 0}}function $c(e,t){let r=new ReadableStream({async start(r){let i=$l(e=>{if("error"===e.event)throw Error(e.data??"Unspecified event streaming error.");"metadata"===e.event?t?.(e):e.data&&r.enqueue(e.data)});await $a(e,$o((e,t,n)=>{i(e,t,n),n&&r.close()}))}});return nC.fromReadableStream(r)}var $d=class extends y0{static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},$h=class extends y0{re;async *_transform(e){let t="";for await(let r of e)if("string"==typeof r?t+=r:t+=r.content,this.re){let e=[...t.matchAll(this.re)];if(e.length>1){let r=0;for(let t of e.slice(0,-1))yield[t[1]],r+=(t.index??0)+t[0].length;t=t.slice(r)}}else{let e=await this.parse(t);if(e.length>1){for(let t of e.slice(0,-1))yield[t];t=e[e.length-1]}}for(let e of(await this.parse(t)))yield[e]}},$p=class extends $h{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(e){try{return e.trim().split(",").map(e=>e.trim())}catch{throw new yQ(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},$m=class extends $h{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:e,separator:t}){super(...arguments),this.length=e,this.separator=t||","}async parse(e){try{let t=e.trim().split(this.separator).map(e=>e.trim());if(void 0!==this.length&&t.length!==this.length)throw new yQ(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){if(Object.getPrototypeOf(t)===yQ.prototype)throw t;throw new yQ(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},$f=class extends $h{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},$g=class extends $h{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},$y=class extends y0{static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw Error(`Cannot coerce "${e.type}" message part into a string.`)}throw Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((e,t)=>e+this._messageContentToString(t),"")}},m5=p9,$v=class extends yY{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),this.schema=e}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(m5.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,m5.string().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(mZ(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.trim(),r=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await dz(this.schema,JSON.parse(r))}catch(t){throw new yQ(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}},$_=class extends $v{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){let t=e?.interpolationDepth??1;if(t<1)throw Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(mZ(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){if("type"in e){let r,i=!1;if(Array.isArray(e.type)){let t=e.type.findIndex(e=>"null"===e);-1!==t&&(i=!0,e.type.splice(t,1)),r=e.type.join(" | ")}else r=e.type;if("object"===e.type&&e.properties){let r=e.description?` // ${e.description}`:"",i=Object.entries(e.properties).map(([r,i])=>{let n=e.required?.includes(r)?"":" (optional)";return`${" ".repeat(t)}"${r}": ${this._schemaToInstruction(i,t+2)}${n}`}).join("\n");return`{
${i}
${" ".repeat(t-2)}}${r}`}if("array"===e.type&&e.items){let r=e.description?` // ${e.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(e.items,t+2)}
${" ".repeat(t-2)}] ${r}`}let n=i?" (nullable)":"",a=e.description?` // ${e.description}`:"";return`${r}${a}${n}`}if("anyOf"in e)return e.anyOf.map(e=>this._schemaToInstruction(e,t)).join(`
${" ".repeat(t-2)}`);throw Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(m5.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,m5.string().describe(t)]))))}},$b=class extends yY{structuredInputParser;constructor({inputSchema:e}){super(...arguments),this.structuredInputParser=new $_(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(t){throw new yQ(`Failed to parse. Text: "${e}". Error: ${t}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};let $w=function(){let e={};e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=l,e.createStream=function(e,t){return new l(e,t)},e.MAX_BUFFER_LENGTH=65536;let t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(i,n){if(!(this instanceof r))return new r(i,n);(function(e){for(var r=0,i=t.length;r<i;r++)e[t[r]]=""})(this),this.q=this.c="",this.bufferCheckPosition=e.MAX_BUFFER_LENGTH,this.opt=n||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!i,this.noscript=!!(i||this.opt.noscript),this.state=_.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(d)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),w(this,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),r.prototype={end:function(){E(this)},write:function(r){if(this.error)throw this.error;if(this.closed)return I(this,"Cannot write after close. Assign an onready handler.");if(null===r)return E(this);"object"==typeof r&&(r=r.toString());for(var i=0,n="";n=P(r,i++),this.c=n,n;)switch(this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++),this.state){case _.BEGIN:if(this.state=_.BEGIN_WHITESPACE,"\uFEFF"===n)continue;j(this,n);continue;case _.BEGIN_WHITESPACE:j(this,n);continue;case _.TEXT:if(this.sawRoot&&!this.closedRoot){for(var a=i-1;n&&"<"!==n&&"&"!==n;)(n=P(r,i++))&&this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++);this.textNode+=r.substring(a,i-1)}"<"!==n||this.sawRoot&&this.closedRoot&&!this.strict?(g(n)||this.sawRoot&&!this.closedRoot||S(this,"Text data outside of root node."),"&"===n?this.state=_.TEXT_ENTITY:this.textNode+=n):(this.state=_.OPEN_WAKA,this.startTagPosition=this.position);continue;case _.SCRIPT:"<"===n?this.state=_.SCRIPT_ENDING:this.script+=n;continue;case _.SCRIPT_ENDING:"/"===n?this.state=_.CLOSE_TAG:(this.script+="<"+n,this.state=_.SCRIPT);continue;case _.OPEN_WAKA:"!"===n?(this.state=_.SGML_DECL,this.sgmlDecl=""):g(n)||(v(h,n)?(this.state=_.OPEN_TAG,this.tagName=n):"/"===n?(this.state=_.CLOSE_TAG,this.tagName=""):"?"===n?(this.state=_.PROC_INST,this.procInstName=this.procInstBody=""):(S(this,"Unencoded <"),this.startTagPosition+1<this.position&&(n=Array(this.position-this.startTagPosition).join(" ")+n),this.textNode+="<"+n,this.state=_.TEXT));continue;case _.SGML_DECL:"[CDATA["===(this.sgmlDecl+n).toUpperCase()?($(this,"onopencdata"),this.state=_.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+n==="--"?(this.state=_.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+n).toUpperCase()?(this.state=_.DOCTYPE,(this.doctype||this.sawRoot)&&S(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===n?($(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=_.TEXT):(y(n)&&(this.state=_.SGML_DECL_QUOTED),this.sgmlDecl+=n);continue;case _.SGML_DECL_QUOTED:n===this.q&&(this.state=_.SGML_DECL,this.q=""),this.sgmlDecl+=n;continue;case _.DOCTYPE:">"===n?(this.state=_.TEXT,$(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=n,"["===n?this.state=_.DOCTYPE_DTD:y(n)&&(this.state=_.DOCTYPE_QUOTED,this.q=n));continue;case _.DOCTYPE_QUOTED:this.doctype+=n,n===this.q&&(this.q="",this.state=_.DOCTYPE);continue;case _.DOCTYPE_DTD:this.doctype+=n,"]"===n?this.state=_.DOCTYPE:y(n)&&(this.state=_.DOCTYPE_DTD_QUOTED,this.q=n);continue;case _.DOCTYPE_DTD_QUOTED:this.doctype+=n,n===this.q&&(this.state=_.DOCTYPE_DTD,this.q="");continue;case _.COMMENT:"-"===n?this.state=_.COMMENT_ENDING:this.comment+=n;continue;case _.COMMENT_ENDING:"-"===n?(this.state=_.COMMENT_ENDED,this.comment=k(this.opt,this.comment),this.comment&&$(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+n,this.state=_.COMMENT);continue;case _.COMMENT_ENDED:">"!==n?(S(this,"Malformed comment"),this.comment+="--"+n,this.state=_.COMMENT):this.state=_.TEXT;continue;case _.CDATA:"]"===n?this.state=_.CDATA_ENDING:this.cdata+=n;continue;case _.CDATA_ENDING:"]"===n?this.state=_.CDATA_ENDING_2:(this.cdata+="]"+n,this.state=_.CDATA);continue;case _.CDATA_ENDING_2:">"===n?(this.cdata&&$(this,"oncdata",this.cdata),$(this,"onclosecdata"),this.cdata="",this.state=_.TEXT):"]"===n?this.cdata+="]":(this.cdata+="]]"+n,this.state=_.CDATA);continue;case _.PROC_INST:"?"===n?this.state=_.PROC_INST_ENDING:g(n)?this.state=_.PROC_INST_BODY:this.procInstName+=n;continue;case _.PROC_INST_BODY:!this.procInstBody&&g(n)||("?"===n?this.state=_.PROC_INST_ENDING:this.procInstBody+=n);continue;case _.PROC_INST_ENDING:">"===n?($(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=_.TEXT):(this.procInstBody+="?"+n,this.state=_.PROC_INST_BODY);continue;case _.OPEN_TAG:v(p,n)?this.tagName+=n:(!function(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,$(e,"onopentagstart",r)}(this),">"===n?A(this):"/"===n?this.state=_.OPEN_TAG_SLASH:(g(n)||S(this,"Invalid character in tag name"),this.state=_.ATTRIB));continue;case _.OPEN_TAG_SLASH:">"===n?(A(this,!0),N(this)):(S(this,"Forward-slash in opening tag not followed by >"),this.state=_.ATTRIB);continue;case _.ATTRIB:g(n)||(">"===n?A(this):"/"===n?this.state=_.OPEN_TAG_SLASH:v(h,n)?(this.attribName=n,this.attribValue="",this.state=_.ATTRIB_NAME):S(this,"Invalid attribute name"));continue;case _.ATTRIB_NAME:"="===n?this.state=_.ATTRIB_VALUE:">"===n?(S(this,"Attribute without value"),this.attribValue=this.attribName,T(this),A(this)):g(n)?this.state=_.ATTRIB_NAME_SAW_WHITE:v(p,n)?this.attribName+=n:S(this,"Invalid attribute name");continue;case _.ATTRIB_NAME_SAW_WHITE:if("="===n)this.state=_.ATTRIB_VALUE;else{if(g(n))continue;S(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",$(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===n?A(this):v(h,n)?(this.attribName=n,this.state=_.ATTRIB_NAME):(S(this,"Invalid attribute name"),this.state=_.ATTRIB)}continue;case _.ATTRIB_VALUE:g(n)||(y(n)?(this.q=n,this.state=_.ATTRIB_VALUE_QUOTED):(S(this,"Unquoted attribute value"),this.state=_.ATTRIB_VALUE_UNQUOTED,this.attribValue=n));continue;case _.ATTRIB_VALUE_QUOTED:if(n!==this.q){"&"===n?this.state=_.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=n;continue}T(this),this.q="",this.state=_.ATTRIB_VALUE_CLOSED;continue;case _.ATTRIB_VALUE_CLOSED:g(n)?this.state=_.ATTRIB:">"===n?A(this):"/"===n?this.state=_.OPEN_TAG_SLASH:v(h,n)?(S(this,"No whitespace between attributes"),this.attribName=n,this.attribValue="",this.state=_.ATTRIB_NAME):S(this,"Invalid attribute name");continue;case _.ATTRIB_VALUE_UNQUOTED:if(!(">"===(s=n)||g(s))){"&"===n?this.state=_.ATTRIB_VALUE_ENTITY_U:this.attribValue+=n;continue}T(this),">"===n?A(this):this.state=_.ATTRIB;continue;case _.CLOSE_TAG:this.tagName?">"===n?N(this):v(p,n)?this.tagName+=n:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=_.SCRIPT):(g(n)||S(this,"Invalid tagname in closing tag"),this.state=_.CLOSE_TAG_SAW_WHITE):g(n)||(v(h,n)?this.tagName=n:this.script?(this.script+="</"+n,this.state=_.SCRIPT):S(this,"Invalid tagname in closing tag."));continue;case _.CLOSE_TAG_SAW_WHITE:if(g(n))continue;">"===n?N(this):S(this,"Invalid characters in closing tag");continue;case _.TEXT_ENTITY:case _.ATTRIB_VALUE_ENTITY_Q:case _.ATTRIB_VALUE_ENTITY_U:switch(this.state){case _.TEXT_ENTITY:o=_.TEXT,l="textNode";break;case _.ATTRIB_VALUE_ENTITY_Q:o=_.ATTRIB_VALUE_QUOTED,l="attribValue";break;case _.ATTRIB_VALUE_ENTITY_U:o=_.ATTRIB_VALUE_UNQUOTED,l="attribValue"}if(";"===n)if(this.opt.unparsedEntities){var s,o,l,u=C(this);this.entity="",this.state=o,this.write(u)}else this[l]+=C(this),this.entity="",this.state=o;else v(this.entity.length?f:m,n)?this.entity+=n:(S(this,"Invalid character in entity name"),this[l]+="&"+this.entity+n,this.entity="",this.state=o);continue;default:throw Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(r){for(var i=Math.max(e.MAX_BUFFER_LENGTH,10),n=0,a=0,s=t.length;a<s;a++){var o=r[t[a]].length;if(o>i)switch(t[a]){case"textNode":x(r);break;case"cdata":$(r,"oncdata",r.cdata),r.cdata="";break;case"script":$(r,"onscript",r.script),r.script="";break;default:I(r,"Max buffer length exceeded: "+t[a])}n=Math.max(n,o)}r.bufferCheckPosition=e.MAX_BUFFER_LENGTH-n+r.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){x(this),""!==this.cdata&&($(this,"oncdata",this.cdata),this.cdata=""),""!==this.script&&($(this,"onscript",this.script),this.script="")}};var i,n,a,s=ReadableStream;s||(s=function(){});var o=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function l(e,t){if(!(this instanceof l))return new l(e,t);s.apply(this),this._parser=new r(e,t),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,o.forEach(function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(s.prototype,{constructor:{value:l}}),l.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var r=this;return r._parser["on"+e]||-1===o.indexOf(e)||(r._parser["on"+e]=function(){var t=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),s.prototype.on.call(r,e,t)};var u="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",d={xml:u,xmlns:c},h=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function g(e){return" "===e||"\n"===e||"\r"===e||"	"===e}function y(e){return'"'===e||"'"===e}function v(e,t){return e.test(t)}var _=0;for(var b in e.STATE={BEGIN:_++,BEGIN_WHITESPACE:_++,TEXT:_++,TEXT_ENTITY:_++,OPEN_WAKA:_++,SGML_DECL:_++,SGML_DECL_QUOTED:_++,DOCTYPE:_++,DOCTYPE_QUOTED:_++,DOCTYPE_DTD:_++,DOCTYPE_DTD_QUOTED:_++,COMMENT_STARTING:_++,COMMENT:_++,COMMENT_ENDING:_++,COMMENT_ENDED:_++,CDATA:_++,CDATA_ENDING:_++,CDATA_ENDING_2:_++,PROC_INST:_++,PROC_INST_BODY:_++,PROC_INST_ENDING:_++,OPEN_TAG:_++,OPEN_TAG_SLASH:_++,ATTRIB:_++,ATTRIB_NAME:_++,ATTRIB_NAME_SAW_WHITE:_++,ATTRIB_VALUE:_++,ATTRIB_VALUE_QUOTED:_++,ATTRIB_VALUE_CLOSED:_++,ATTRIB_VALUE_UNQUOTED:_++,ATTRIB_VALUE_ENTITY_Q:_++,ATTRIB_VALUE_ENTITY_U:_++,CLOSE_TAG:_++,CLOSE_TAG_SAW_WHITE:_++,SCRIPT:_++,SCRIPT_ENDING:_++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var r=e.ENTITIES[t],i="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=i}),e.STATE)e.STATE[e.STATE[b]]=b;function w(e,t,r){e[t]&&e[t](r)}function $(e,t,r){e.textNode&&x(e),w(e,t,r)}function x(e){e.textNode=k(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function k(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function I(e,t){return x(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),e.error=t=Error(t),w(e,"onerror",t),e}function E(e){return e.sawRoot&&!e.closedRoot&&S(e,"Unclosed root tag"),e.state!==_.BEGIN&&e.state!==_.BEGIN_WHITESPACE&&e.state!==_.TEXT&&I(e,"Unexpected end"),x(e),e.c="",e.closed=!0,w(e,"onend"),r.call(e,e.strict,e.opt),e}function S(e,t){if("object"!=typeof e||!(e instanceof r))throw Error("bad call to strictFail");e.strict&&I(e,t)}function O(e,t){var r=0>e.indexOf(":")?["",e]:e.split(":"),i=r[0],n=r[1];return t&&"xmlns"===e&&(i="xmlns",n=""),{prefix:i,local:n}}function T(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName)){e.attribName=e.attribValue="";return}if(e.opt.xmlns){var t=O(e.attribName,!0),r=t.prefix,i=t.local;if("xmlns"===r)if("xml"===i&&e.attribValue!==u)S(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==c)S(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var n=e.tag,a=e.tags[e.tags.length-1]||e;n.ns===a.ns&&(n.ns=Object.create(a.ns)),n.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,$(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function A(e,t){if(e.opt.xmlns){var r=e.tag,i=O(e.tagName);r.prefix=i.prefix,r.local=i.local,r.uri=r.ns[i.prefix]||"",r.prefix&&!r.uri&&(S(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=i.prefix);var n=e.tags[e.tags.length-1]||e;r.ns&&n.ns!==r.ns&&Object.keys(r.ns).forEach(function(t){$(e,"onopennamespace",{prefix:t,uri:r.ns[t]})});for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],c=O(l,!0),d=c.prefix,h=c.local,p=""===d?"":r.ns[d]||"",m={name:l,value:u,prefix:d,local:h,uri:p};d&&"xmlns"!==d&&!p&&(S(e,"Unbound namespace prefix: "+JSON.stringify(d)),m.uri=d),e.tag.attributes[l]=m,$(e,"onattribute",m)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),$(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=_.TEXT:e.state=_.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function N(e){if(!e.tagName){S(e,"Weird empty close tag."),e.textNode+="</>",e.state=_.TEXT;return}if(e.script){if("script"!==e.tagName){e.script+="</"+e.tagName+">",e.tagName="",e.state=_.SCRIPT;return}$(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var i=r;t--;)if(e.tags[t].name!==i)S(e,"Unexpected close tag");else break;if(t<0){S(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=_.TEXT;return}e.tagName=r;for(var n=e.tags.length;n-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,$(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(t){var r=a.ns[t];$(e,"onclosenamespace",{prefix:t,uri:r})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=_.TEXT}function C(e){var t,r=e.entity,i=r.toLowerCase(),n="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(r=i).charAt(0)&&(n="x"===r.charAt(1)?(t=parseInt(r=r.slice(2),16)).toString(16):(t=parseInt(r=r.slice(1),10)).toString(10)),r=r.replace(/^0+/,""),isNaN(t)||n.toLowerCase()!==r)?(S(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t)}function j(e,t){"<"===t?(e.state=_.OPEN_WAKA,e.startTagPosition=e.position):g(t)||(S(e,"Non-whitespace before first tag."),e.textNode=t,e.state=_.TEXT)}function P(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}return _=e.STATE,String.fromCodePoint||(i=String.fromCharCode,n=Math.floor,a=function(){var e,t,r=[],a=-1,s=arguments.length;if(!s)return"";for(var o="";++a<s;){var l=Number(arguments[a]);if(!isFinite(l)||l<0||l>1114111||n(l)!==l)throw RangeError("Invalid code point: "+l);l<=65535?r.push(l):(l-=65536,e=(l>>10)+55296,t=l%1024+56320,r.push(e,t)),(a+1===s||r.length>16384)&&(o+=i.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:a,configurable:!0,writable:!0}):String.fromCodePoint=a),e}(),$$=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var $x=class extends y1{tags;constructor(e){super(e),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(e,t){if(t)return e?n6(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return $I(e[0].text)}async parse(e){return $I(e)}getFormatInstructions(){return this.tags&&this.tags.length>0?$$.replace("{tags}",this.tags?.join(", ")??""):$$}};let $k=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map($k):t[e.name]=e.text??void 0,t};function $I(e){let t=e.split("\n").map(e=>e.replace(/^\s+/,"")).join("\n").trim(),r=$w.parser(!0),i={},n=[];r.onopentag=e=>{let t={name:e.name,attributes:e.attributes,children:[],text:"",isSelfClosing:e.isSelfClosing};n.length>0?n[n.length-1].children.push(t):i=t,e.isSelfClosing||n.push(t)},r.onclosetag=()=>{if(n.length>0){let e=n.pop();0===n.length&&e&&(i=e)}},r.ontext=e=>{if(n.length>0){let t=n[n.length-1];t.text+=e}},r.onattribute=e=>{n.length>0&&(n[n.length-1].attributes[e.name]=e.value)};let a=/```(xml)?(.*)```/s.exec(t),s=a?a[2]:t;return r.write(s).close(),i&&"?xml"===i.name&&(i=i.children[0]),$k(i)}var $E={};G($E,{AsymmetricStructuredOutputParser:()=>$b,BaseCumulativeTransformOutputParser:()=>y1,BaseLLMOutputParser:()=>yX,BaseOutputParser:()=>yY,BaseTransformOutputParser:()=>y0,BytesOutputParser:()=>$d,CommaSeparatedListOutputParser:()=>$p,CustomListOutputParser:()=>$m,JsonMarkdownStructuredOutputParser:()=>$_,JsonOutputParser:()=>y4,ListOutputParser:()=>$h,MarkdownListOutputParser:()=>$g,NumberedListOutputParser:()=>$f,OutputParserException:()=>yQ,StringOutputParser:()=>$y,StructuredOutputParser:()=>$v,XMLOutputParser:()=>$x,XML_FORMAT_INSTRUCTIONS:()=>$$,parseJsonMarkdown:()=>e9,parsePartialJson:()=>e5,parseXMLMarkdown:()=>$I});var $S={};function $O(e,t){let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r}function $T(e,t){return Math.sqrt(function(e,t){let r=0;for(let i=0;i<e.length;i++)r+=(e[i]-t[i])*(e[i]-t[i]);return r}(e,t))}var $A={};function $N(e,t,r){if(0===e.length||0===e[0].length||0===t.length||0===t[0].length)return[[]];if(e[0].length!==t[0].length)throw Error(`Number of columns in X and Y must be the same. X has shape ${[e.length,e[0].length]} and Y has shape ${[t.length,t[0].length]}.`);return e.map(e=>t.map(t=>r(e,t)).map(e=>Number.isNaN(e)?0:e))}function $C(e,t=!1){let r=e.reduce((e,t)=>Math.max(e,$L(t).maxValue),0);return e.map(e=>e.map(e=>t?1-e/r:e/r))}function $j(e,t){return $N(e,t,w7)}function $P(e,t){return $N(e,t,$O)}function $R(e,t){return $N(e,t,$T)}function $U(e,t,r=.5,i=4){if(0>=Math.min(i,t.length))return[];let n=$j(Array.isArray(e[0])?e:[e],t)[0],a=$L(n).maxIndex,s=[t[a]],o=[a];for(;o.length<Math.min(i,t.length);){let e=-1/0,i=-1,a=$j(t,s);n.forEach((t,n)=>{if(o.includes(n))return;let s=r*t-(1-r)*Math.max(...a[n]);s>e&&(e=s,i=n)}),s.push(t[i]),o.push(i)}return o}function $L(e){if(0===e.length)return{maxIndex:-1,maxValue:NaN};let t=e[0],r=0;for(let i=1;i<e.length;i+=1)e[i]>t&&(r=i,t=e[i]);return{maxIndex:r,maxValue:t}}G($A,{cosineSimilarity:()=>$j,euclideanDistance:()=>$R,innerProduct:()=>$P,matrixFunc:()=>$N,maximalMarginalRelevance:()=>$U,normalize:()=>$C});var $z={};async function $D(e){let{optionalImportsMap:t={},optionalImportEntrypoints:r=[],importMap:i={},secretsMap:n={},path:a=["$"]}=this,s=a.join(".");if("object"==typeof e&&null!==e&&!Array.isArray(e)&&"lc"in e&&"type"in e&&"id"in e&&1===e.lc&&"secret"===e.type){let[t]=e.id;if(t in n)return n[t];{let e=tV(t);if(e)return e;throw Error(`Missing key "${t}" for ${s} in load(secretsMap={})`)}}if("object"==typeof e&&null!==e&&!Array.isArray(e)&&"lc"in e&&"type"in e&&"id"in e&&1===e.lc&&"not_implemented"===e.type){let t=JSON.stringify(e);throw Error(`Trying to load an object that doesn't implement serialization: ${s} -> ${t}`)}if("object"==typeof e&&null!==e&&!Array.isArray(e)&&"lc"in e&&"type"in e&&"id"in e&&"kwargs"in e&&1===e.lc){let n=JSON.stringify(e),[o,...l]=e.id.slice().reverse(),u=l.reverse(),c=null,d=[u.join("/")];"langchain_community"===u[0]&&d.push(["langchain",...u.slice(1)].join("/"));let h=d.find(e=>e in t);if(nw.concat(r).includes(u.join("/"))||h)if(void 0!==h)c=await t[h];else throw Error(`Missing key "${u.join("/")}" for ${s} in load(optionalImportsMap={})`);else{let e,t;if("langchain"===u[0]||"langchain_core"===u[0])e=({langchain_core:$z,langchain:i})[u[0]],u.shift();else throw Error(`Invalid namespace: ${s} -> ${n}`);if(0===u.length)throw Error(`Invalid namespace: ${s} -> ${n}`);do{if((t=u.join("__"))in e)break;u.pop()}while(u.length>0)t in e&&(c=e[t])}if("object"!=typeof c||null===c)throw Error(`Invalid namespace: ${s} -> ${n}`);let p=c[o]??Object.values(c).find(e=>"function"==typeof e&&eu(e)===o);if("function"!=typeof p)throw Error(`Invalid identifer: ${s} -> ${n}`);let m=await $D.call({...this,path:[...a,"kwargs"]},e.kwargs);if("constructor"===e.type){let e=new p(es(m,ea,function(e){let t={};for(let r=e;r&&r.prototype;r=Object.getPrototypeOf(r))Object.assign(t,Reflect.get(r.prototype,"lc_aliases"));return Object.entries(t).reduce((e,[t,r])=>(e[r]=t,e),{})}(p)));return Object.defineProperty(e.constructor,"name",{value:o}),e}throw Error(`Invalid type: ${s} -> ${n}`)}if("object"==typeof e&&null!==e)if(Array.isArray(e))return Promise.all(e.map((e,t)=>$D.call({...this,path:[...a,`${t}`]},e)));else return Object.fromEntries(await Promise.all(Object.entries(e).map(async([e,t])=>[e,await $D.call({...this,path:[...a,e]},t)])));return e}async function $M(e,t){let r=JSON.parse(e);return $D.call({...t},r)}async function $Z(e){if(e&&"object"==typeof e)if(Array.isArray(e))return await Promise.all(e.map(e=>$Z(e)));else{let t={};for(let[r,i]of Object.entries(e))t[r]=await $Z(i);if(2===t.lc&&"undefined"===t.type)return;if(2===t.lc&&"constructor"===t.type&&Array.isArray(t.id))try{let e;switch(t.id[t.id.length-1]){case"Set":e=Set;break;case"Map":e=Map;break;case"RegExp":e=RegExp;break;case"Error":e=Error;break;default:return t}if(t.method)return e[t.method](...t.args||[]);return new e(...t.args||[])}catch(e){}else if(null!==t&&1===t.lc&&"constructor"===t.type&&Array.isArray(t.id))return $M(JSON.stringify(t));return t}return e}function $F(e,t,r,i){return{lc:2,type:"constructor",id:[e.name],method:t??null,args:r??[],kwargs:i??{}}}G($z,{agents:()=>n$,caches:()=>f3,callbacks__base:()=>t1,callbacks__manager:()=>iW,callbacks__promises:()=>iV,chat_history:()=>fE,document_loaders__base:()=>gn,document_loaders__langsmith:()=>gs,documents:()=>gh,embeddings:()=>fA,example_selectors:()=>g$,index:()=>fC,indexing:()=>gN,language_models__base:()=>gM,language_models__chat_models:()=>gK,language_models__llms:()=>g0,language_models__profile:()=>g2,load__serializable:()=>eo,memory:()=>fj,messages:()=>fI,messages__tool:()=>eH,output_parsers:()=>$E,output_parsers__openai_functions:()=>va,output_parsers__openai_tools:()=>y8,outputs:()=>ar,prompt_values:()=>fD,prompts:()=>yq,retrievers:()=>fW,retrievers__document_compressors:()=>g6,runnables:()=>yH,runnables__graph:()=>mJ,singletons:()=>i3,stores:()=>fV,structured_query:()=>vj,tools:()=>wZ,tracers__base:()=>ih,tracers__console:()=>i$,tracers__log_stream:()=>n9,tracers__run_collector:()=>ve,tracers__tracer_langchain:()=>iP,types__stream:()=>y7,utils__async_caller:()=>ap,utils__chunk_array:()=>vs,utils__env:()=>tU,utils__event_source_parse:()=>$i,utils__format:()=>$S,utils__function_calling:()=>vh,utils__hash:()=>f5,utils__json_patch:()=>yK,utils__json_schema:()=>mM,utils__math:()=>$A,utils__stream:()=>nN,utils__testing:()=>$t,utils__tiktoken:()=>gR,utils__types:()=>$r,vectorstores:()=>fH});var $B=class{_dumps(e){return new TextEncoder().encode(function(e,t,r,i){void 0===i&&(i={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,i,n,a,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<n.length;l++)if(n[l]===t)return void nb("[Circular]",t,r,a);if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit)return void nb("[...]",t,r,a);if(n.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,n,t,s,o);else{var l,u=Object.keys(t);for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,n,t,s,o)}}n.pop()}}(e,"",0,[],void 0,0,i);try{var n;a=0===n_.length?JSON.stringify(e,t,void 0):JSON.stringify(e,(n=t,n=void 0!==n?n:function(e,t){return t},function(e,t){if(n_.length>0)for(var r=0;r<n_.length;r++){var i=n_[r];if(i[1]===e&&i[0]===t){t=i[2],n_.splice(r,1);break}}return n.call(this,e,t)}),void 0)}catch(e){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==nv.length;){var a,s=nv.pop();4===s.length?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return a}(e,(e,t)=>(function(e){if(void 0===e)return{lc:2,type:"undefined"};if(e instanceof Set||e instanceof Map)return $F(e.constructor,void 0,[Array.from(e)]);if(e instanceof RegExp)return $F(RegExp,void 0,[e.source,e.flags]);if(e instanceof Error)return $F(e.constructor,void 0,[e.message]);if(e?.lg_name==="Send")return{node:e.node,args:e.args};else return e})(t)))}async dumpsTyped(e){return e instanceof Uint8Array?["bytes",e]:["json",this._dumps(e)]}async _loads(e){return $Z(JSON.parse(e))}async loadsTyped(e,t){if("bytes"===e)return"string"==typeof t?new TextEncoder().encode(t):t;if("json"===e)return this._loads("string"==typeof t?t:new TextDecoder().decode(t));throw Error(`Unknown serialization type: ${e}`)}};function $V(){return{v:4,id:nf(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{}}}function $q(e){return{v:e.v,id:e.id,ts:e.ts,channel_values:{...e.channel_values},channel_versions:{...e.channel_versions},versions_seen:function e(t){if("object"!=typeof t||null===t)return t;let r=Array.isArray(t)?[]:{};for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e(t[i]));return r}(e.versions_seen)}}function $G(e,t){return"number"==typeof e&&"number"==typeof t?Math.sign(e-t):String(e).localeCompare(String(t))}let $W={__error__:-1,[ny]:-2,__interrupt__:-3,__resume__:-4};var $J=class extends Error{constructor(e){super(e),this.name="InvalidNamespaceError"}},$H=class{async get(e,t){return(await this.batch([{namespace:e,key:t}]))[0]}async search(e,t={}){let{filter:r,limit:i=10,offset:n=0,query:a}=t;return(await this.batch([{namespacePrefix:e,filter:r,limit:i,offset:n,query:a}]))[0]}async put(e,t,r,i){if(0===e.length)throw new $J("Namespace cannot be empty.");for(let t of e){if("string"!=typeof t)throw new $J(`Invalid namespace label '${t}' found in ${e}. Namespace labels must be strings, but got ${typeof t}.`);if(t.includes("."))throw new $J(`Invalid namespace label '${t}' found in ${e}. Namespace labels cannot contain periods ('.').`);if(""===t)throw new $J(`Namespace labels cannot be empty strings. Got ${t} in ${e}`)}if("langgraph"===e[0])throw new $J(`Root label for namespace cannot be "langgraph". Got: ${e}`);await this.batch([{namespace:e,key:t,value:r,index:i}])}async delete(e,t){await this.batch([{namespace:e,key:t,value:null}])}async listNamespaces(e={}){let{prefix:t,suffix:r,maxDepth:i,limit:n=100,offset:a=0}=e,s=[];return t&&s.push({matchType:"prefix",path:t}),r&&s.push({matchType:"suffix",path:r}),(await this.batch([{matchConditions:s.length?s:void 0,maxDepth:i,limit:n,offset:a}]))[0]}start(){}stop(){}},$K=class extends $H{lg_name="AsyncBatchedStore";store;queue=new Map;nextKey=0;running=!1;processingTask=null;constructor(e){super(),this.store=(e=>"lg_name"in e&&"AsyncBatchedStore"===e.lg_name?e.store:e)(e)}get isRunning(){return this.running}async batch(e){throw Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,t){return this.enqueueOperation({namespace:e,key:t})}async search(e,t){let{filter:r,limit:i=10,offset:n=0,query:a}=t||{};return this.enqueueOperation({namespacePrefix:e,filter:r,limit:i,offset:n,query:a})}async put(e,t,r){return this.enqueueOperation({namespace:e,key:t,value:r})}async delete(e,t){return this.enqueueOperation({namespace:e,key:t,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((t,r)=>{let i=this.nextKey;this.nextKey+=1,this.queue.set(i,{operation:e,resolve:t,reject:r})})}async processBatchQueue(){for(;this.running;){if(await new Promise(e=>{setTimeout(e,0)}),0===this.queue.size)continue;let e=new Map(this.queue);this.queue.clear();try{let t=Array.from(e.values()).map(({operation:e})=>e),r=await this.store.batch(t);e.forEach(({resolve:t},i)=>{let n=Array.from(e.keys()).indexOf(i);t(r[n])})}catch(t){e.forEach(({reject:e})=>{e(t)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}},$X=class{serde=new $B;constructor(e){this.serde=e||this.serde}};function $Y(e){return null!=e&&!0===e.lg_is_channel}var $Q=class{ValueType;UpdateType;lg_is_channel=!0;consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(e){if(e.name===nu.unminifiable_name)return!1;throw e}}};let $0=Symbol.for("LG_IS_ONLY_BASE_CHANNEL");function $1(e){if(!0===e[$0])return e;let t={};for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;let i=e[r];$Y(i)&&(t[r]=i)}return Object.assign(t,{[$0]:!0}),t}function $4(e,t){let r=$1(e),i={};for(let e in r){if(!Object.prototype.hasOwnProperty.call(r,e))continue;let n=t.channel_values[e];i[e]=r[e].fromCheckpoint(n)}return Object.assign(i,{[$0]:!0}),i}function $2(e,t,r,i){let n;if(void 0===t)n=e.channel_values;else for(let e in n={},t)if(Object.prototype.hasOwnProperty.call(t,e))try{n[e]=t[e].checkpoint()}catch(e){if(e.name===nu.unminifiable_name);else throw e}return{v:4,id:i?.id??nf(r),ts:new Date().toISOString(),channel_values:n,channel_versions:e.channel_versions,versions_seen:e.versions_seen}}var $6=class e extends $Q{lc_graph_name="BinaryOperatorAggregate";value;operator;initialValueFactory;constructor(e,t){super(),this.operator=e,this.initialValueFactory=t,this.value=t?.()}fromCheckpoint(t){let r=new e(this.operator,this.initialValueFactory);return void 0!==t&&(r.value=t),r}update(e){let t=e;if(!t.length)return!1;for(let e of(void 0===this.value&&([this.value]=t,t=t.slice(1)),t))void 0!==this.value&&(this.value=this.operator(this.value,e));return!0}get(){if(void 0===this.value)throw new nu;return this.value}checkpoint(){if(void 0===this.value)throw new nu;return this.value}isAvailable(){return void 0!==this.value}},$9=class e extends $Q{lc_graph_name="LastValue";value=[];fromCheckpoint(t){let r=new e;return void 0!==t&&(r.value=[t]),r}update(e){if(0===e.length)return!1;if(1!==e.length)throw new nc("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[e[e.length-1]],!0}get(){if(0===this.value.length)throw new nu;return this.value[0]}checkpoint(){if(0===this.value.length)throw new nu;return this.value[0]}isAvailable(){return 0!==this.value.length}},$5=class e extends $Q{lc_graph_name="LastValueAfterFinish";value=[];finished=!1;fromCheckpoint(t){let r=new e;if(void 0!==t){let[e,i]=t;r.value=[e],r.finished=i}return r}update(e){return 0!==e.length&&(this.finished=!1,this.value=[e[e.length-1]],!0)}get(){if(0===this.value.length||!this.finished)throw new nu;return this.value[0]}checkpoint(){if(0!==this.value.length)return[this.value[0],this.finished]}consume(){return!!this.finished&&(this.finished=!1,this.value=[],!0)}finish(){return!this.finished&&this.value.length>0&&(this.finished=!0,!0)}isAvailable(){return 0!==this.value.length&&this.finished}},$3=class{lc_graph_name="AnnotationRoot";spec;constructor(e){this.spec=e}};let $8=function(e){return e?$7(e):new $9};function $7(e){return"object"==typeof e&&e&&"reducer"in e&&e.reducer?new $6(e.reducer,e.default):"object"==typeof e&&e&&"value"in e&&e.value?new $6(e.value,e.default):new $9}$8.Root=e=>new $3(e);let xe="__start__",xt="__end__",xr="__input__",xi="__error__",xn="__pregel_ns_writes",xa="__pregel_send",xs="__pregel_call",xo="__pregel_read",xl="__pregel_checkpointer",xu="__pregel_resuming",xc="__pregel_task_id",xd="__pregel_stream",xh="__pregel_resume_map",xp="__pregel_scratchpad",xm="__pregel_previous",xf="__pregel_durability",xg="checkpoint_id",xy="checkpoint_ns",xv="checkpoint_map",x_="__pregel_abort_signals",xb="__interrupt__",xw="__resume__",x$="__no_writes__",xx="__return__",xk="__previous__",xI="langsmith:hidden",xE="__self__",xS="__pregel_tasks",xO="__pregel_push",xT="__pregel_pull",xA="00000000-0000-0000-0000-000000000000",xN=[xI,xr,xb,xw,xi,x$,xa,xo,xl,xf,xd,xu,xc,xs,"__pregel_resume_value",xp,xm,xv,xy,xg],xC=Symbol.for("langgraph.command");var xj=class{[xC];constructor(e){this[xC]=e}};function xP(e){return null!=e&&"string"==typeof e.node&&void 0!==e.args}var xR=class{lg_name="Send";node;args;constructor(e,t){this.node=e,this.args=xM(t)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}};function xU(e){return e instanceof xR}function xL(e){return!!e&&"object"==typeof e&&xb in e&&Array.isArray(e[xb])}var xz=class extends xj{lg_name="Command";lc_direct_tool_output=!0;graph;update;resume;goto=[];static PARENT="__parent__";constructor(e){super(e),this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?xM(e.goto):[xM(e.goto)])}_updateAsTuples(){return this.update&&"object"==typeof this.update&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&2===e.length&&"string"==typeof e[0])?this.update:[["__root__",this.update]]}toJSON(){let e;return e="string"==typeof this.goto?this.goto:xU(this.goto)?this.goto.toJSON():this.goto?.map(e=>"string"==typeof e?e:e.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}};function xD(e){return"object"==typeof e&&null!=e&&"lg_name"in e&&"Command"===e.lg_name}function xM(e,t=new Map){if(null!=e&&"object"==typeof e){let r;if(t.has(e))return t.get(e);if(Array.isArray(e))r=[],t.set(e,r),e.forEach((e,i)=>{r[i]=xM(e,t)});else if(!xD(e)||e instanceof xz)if(!xP(e)||e instanceof xR)if(xD(e)||xU(e))r=e,t.set(e,r);else if("lc_serializable"in e&&e.lc_serializable)r=e,t.set(e,r);else for(let[i,n]of(r={},t.set(e,r),Object.entries(e)))r[i]=xM(n,t);else r=new xR(e.node,e.args),t.set(e,r);else r=new xz(e),t.set(e,r);return r}return e}let xZ=["tags","metadata","callbacks","configurable"],xF=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interrupt","context","interruptBefore","interruptAfter","checkpointDuring","durability","signal"];function xB(...e){let t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,configurable:{}},r=i5.getRunnableConfig();if(void 0!==r){for(let[e,i]of Object.entries(r))if(void 0!==i)if(xZ.includes(e)){let r;r=Array.isArray(i)?[...i]:"object"==typeof i?"callbacks"===e&&"copy"in i&&"function"==typeof i.copy?i.copy():{...i}:i,t[e]=r}else t[e]=i}for(let r of e)if(void 0!==r)for(let[e,i]of Object.entries(r))void 0!==i&&xF.includes(e)&&(t[e]=i);for(let[e,r]of Object.entries(t.configurable))t.metadata=t.metadata??{},e.startsWith("__")||"string"!=typeof r&&"number"!=typeof r&&"boolean"!=typeof r||e in t.metadata||(t.metadata[e]=r);return t}function xV(e){return e.split("|").filter(e=>!e.match(/^\d+$/)).map(e=>e.split(":")[0]).join("|")}let xq=e=>BigInt(e),xG=(e,t=0)=>new DataView(e.buffer,e.byteOffset+t,e.byteLength-t),xW=xq("0x9E3779B1"),xJ=xq("0x85EBCA77"),xH=xq("0xC2B2AE3D"),xK=xq("0x9E3779B185EBCA87"),xX=xq("0xC2B2AE3D27D4EB4F"),xY=xq("0x165667B19E3779F9"),xQ=xq("0x85EBCA77C2B2AE63"),x0=xq("0x27D4EB2F165667C5"),x1=xq("0x165667919E3779F9"),x4=xq("0x9FB21C651E98DF25"),x2=(e=>{let t=e.length;if(t%2!=0)throw Error("String should have an even number of characters");let r=t/2,i=new Uint8Array(r),n=0,a=0;for(;a<r;){let t=e.slice(n,n+=2);i[a]=Number.parseInt(t,16),a+=1}return xG(i)})("b8fe6c3923a44bbe7c01812cf721ad1cded46de9839097db7240a4a4b7b3671fcb79e64eccc0e578825ad07dccff7221b8084674f743248ee03590e6813a264c3c2852bb91c300cb88d0658b1b532ea371644897a20df94e3819ef46a9deacd8a8fa763fe39c343ff9dcbbc7c70b4f1d8a51e04bcdb45931c89f7ec9d9787364eac5ac8334d3ebc3c581a0fffa1363eb170ddd51b7f0da49d316552629d4689e2b16be587d47a1fc8ff8b8d17ad031ce45cb3a8f95160428afd7fbcabb4b407e"),x6=(xq(1)<<xq(128))-xq(1),x9=(xq(1)<<xq(64))-xq(1),x5=(xq(1)<<xq(32))-xq(1);function x3(e){if(!e)throw Error("Assert failed")}function x8(e,t,r){for(let i=0;i<8;i+=1){let n=t.getBigUint64(8*i,!0),a=n^r.getBigUint64(8*i,!0);e[1^i]+=n,e[i]+=(a&x5)*(a>>xq(32)&x5)&x9}return e}function x7(e,t,r,i){for(let n=0;n<i;n+=1)x8(e,xG(t,64*n),xG(r,8*n));return e}function ke(e,t){for(let i=0;i<8;i+=1){var r;let n=t.getBigUint64(8*i,!0),a=e[i];a=((r=a)^r>>xq(47)^n)*xW,e[i]=a&x9}return e}function kt(e,t){return ki(e[0]^t.getBigUint64(0,!0),e[1]^t.getBigUint64(8,!0))}function kr(e,t,r){let i=r;return i+=kt(e.slice(0),xG(t,0)),i+=kt(e.slice(2),xG(t,16)),i+=kt(e.slice(4),xG(t,32)),ks((i+=kt(e.slice(6),xG(t,48)))&x9)}function ki(e,t){let r=e*t&x6;return r&x9^r>>xq(64)}function kn(e,t,r){return ki((e.getBigUint64(0,!0)^t.getBigUint64(0,!0)+r)&x9,(e.getBigUint64(8,!0)^t.getBigUint64(8,!0)-r)&x9)}function ka(e,t,r,i,n){let a=e&x9,s=e>>xq(64)&x9;return a+=kn(t,i,n),a^=r.getBigUint64(0,!0)+r.getBigUint64(8,!0),a&=x9,s+=kn(r,xG(i,16),n),s^=t.getBigUint64(0,!0)+t.getBigUint64(8,!0),(s&=x9)<<xq(64)|a}function ks(e){let t=e;return t^=t>>xq(37),t*=x1,t&=x9,t^=t>>xq(32)}function ko(e){let t=e;return t^=t>>xq(33),t*=xX,t&=x9,t^=t>>xq(29),t*=xY,t&=x9,t^=t>>xq(32)}function kl(e){return~e+xq(1)&x9}function ku(e,t=xq(0)){let r,i,n=new TextEncoder,a=xG("string"==typeof e?n.encode(e):e),s=a.byteLength,o=e=>e.toString(16).padStart(32,"0");return s<=16?o(function(e,t){var r,i,n,a,s,o,l,u;let c,d,h,p,m,f=e.byteLength;if(x3(f<=16),f>8){let i,n,a,s,o,l,u,c;return x3((i=e.byteLength)>=9&&i<=16),n=(x2.getBigUint64(32,!0)^x2.getBigUint64(40,!0))+t&x9,a=(x2.getBigUint64(48,!0)^x2.getBigUint64(56,!0))-t&x9,l=((o=(e.getBigUint64(0,!0)^(s=e.getBigUint64(i-8,!0))^n)*xK)&x9)+(xq(i-1)<<xq(54)),o=o&(x6^x9)|l,s^=a,o+=s+(s&x5)*(xJ-xq(1))<<xq(64),o&=x6,o^=(r=o>>xq(64),(u=new DataView(new ArrayBuffer(8))).setBigUint64(0,r,!0),u.getBigUint64(0,!1)),ks((c=(o&x9)*xX+((o>>xq(64))*xX<<xq(64))&x6)&x9)|ks(c>>xq(64))<<xq(64)}if(f>=4){let r,a,s,o,l;return x3((r=e.byteLength)>=4&&r<=8),a=e.getUint32(0,!0),s=e.getUint32(r-4,!0),o=xq(a)|xq(s)<<xq(32),l=(o^(x2.getBigUint64(16,!0)^x2.getBigUint64(24,!0))+t&x9)*(xK+(xq(r)<<xq(2)))&x6,l+=(l&x9)<<xq(65),l&=x6,l^=l>>xq(67),(n=((i=l&x9)^i>>xq(35))*x4&x9)^n>>xq(28)|ks(l>>xq(64))<<xq(64)}return f>0?(a=e,s=x2,o=t,x3((d=a.byteLength)>0&&d<=3),p=((h=xq(a.getUint8(d-1))|xq(d<<8)|xq(a.getUint8(0)<<16)|xq(a.getUint8(d>>1)<<24))^(xq(s.getUint32(0,!0))^xq(s.getUint32(4,!0)))+o)&x9,m=(xq(s.getUint32(8,!0))^xq(s.getUint32(12,!0)))-o,(ko((((l=c=((c=((c=h)&xq(65535))<<xq(16)|(c&xq(0xffff0000))>>xq(16))&xq(0xff00ff))<<xq(8)|(c&xq(0xff00ff00))>>xq(8))<<(u=xq(13))|l>>xq(32)-u)&x5^m)&x9)&x9)<<xq(64)|ko(p)):ko(t^x2.getBigUint64(64,!0)^x2.getBigUint64(72,!0))|ko(t^x2.getBigUint64(80,!0)^x2.getBigUint64(88,!0))<<xq(64)}(a,t)):s<=128?o(function(e,t,r){let i=xq(e.byteLength)*xK&x9,n=xq(e.byteLength-1)/xq(32);for(;n>=0;){let a=Number(n);i=ka(i,xG(e,16*a),xG(e,e.byteLength-16*(a+1)),xG(t,32*a),r),n-=xq(1)}let a=i+(i>>xq(64))&x9;a=ks(a);let s=(i&x9)*xK+(i>>xq(64))*xQ+(xq(e.byteLength)-r&x9)*xX;return s&=x9,a|(s=kl(ks(s)))<<xq(64)}(a,x2,t)):s<=240?o(function(e,t,r){let i=xq(e.byteLength)*xK&x9;for(let n=32;n<160;n+=32)i=ka(i,xG(e,n-32),xG(e,n-16),xG(t,n-32),r);i=ks(i&x9)|ks(i>>xq(64))<<xq(64);for(let n=160;n<=e.byteLength;n+=32)i=ka(i,xG(e,n-32),xG(e,n-16),xG(t,3+n-160),r);let n=(i=ka(i,xG(e,e.byteLength-16),xG(e,e.byteLength-32),xG(t,103),kl(r)))+(i>>xq(64))&x9;n=ks(n);let a=(i&x9)*xK+(i>>xq(64))*xQ+(xq(e.byteLength)-r&x9)*xX;return a&=x9,n|(a=kl(ks(a)))<<xq(64)}(a,x2,t)):o((r=new BigUint64Array([xH,xK,xX,xY,xQ,xJ,x0,xW]),x3(a.byteLength>128),x3(8*(r=function(e,t,r,i,n){let a=e,s=Math.floor((r.byteLength-64)/8),o=64*s,l=Math.floor((t.byteLength-1)/o);for(let e=0;e<l;e+=1)a=n(a=x7(a,xG(t,e*o),r,s),xG(r,r.byteLength-64));{let e=Math.floor((t.byteLength-1-o*l)/64);a=i(a=x7(a,xG(t,l*o),r,e),xG(t,t.byteLength-64),xG(r,r.byteLength-64-7))}return a}(r,a,x2,x8,ke)).length==64),i=kr(r,xG(x2,11),xq(a.byteLength)*xK&x9),kr(r,xG(x2,x2.byteLength-64-11),~(xq(a.byteLength)*xX)&x9)<<xq(64)|i))}function kc(e){return/^[0-9a-f]{32}$/.test(e)}function kd(e){let t=i5.getRunnableConfig();if(!t)throw Error("Called interrupt() outside the context of a graph.");let r=t.configurable;if(!r)throw Error("No configurable found in config");if(!r[xl])throw new nr("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let i=r[xp];i.interruptCounter+=1;let n=i.interruptCounter;if(i.resume.length>0&&n<i.resume.length)return r[xa]?.([[xw,i.resume]]),i.resume[n];if(void 0!==i.nullResume){if(i.resume.length!==n)throw Error(`Resume length mismatch: ${i.resume.length} !== ${n}`);let e=i.consumeNullResume();return i.resume.push(e),r[xa]?.([[xw,i.resume]]),e}let a=r[xy]?.split("|");throw new ni([{id:a?ku(a.join("|")):void 0,value:e}])}var kh=class extends m8{lc_namespace=["langgraph"];func;tags;config;trace=!0;recurse=!0;constructor(e){super(),this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,t,r){return new Promise((i,n)=>{let a=nS(t,{callbacks:r?.getChild()});i5.runWithConfig(a,async()=>{try{let t=await this.func(e,a);i(t)}catch(e){n(e)}})})}async invoke(e,t){let r,i=xB(t),n=nk(this.config,i);return(r=this.trace?await this._callWithConfig(this._tracedInvoke,e,n):await i5.runWithConfig(n,async()=>this.func(e,n)),m8.isRunnable(r)&&this.recurse)?await i5.runWithConfig(n,async()=>r.invoke(e,n)):r}};function*kp(e,t){if(void 0===t)yield*e;else for(let r of e)yield[t,r]}async function km(e){let t=[];for await(let r of(await e))t.push(r);return t}function kf(e){let t=[];for(let r of e)t.push(r);return t}function kg(e,t){return e?"configurable"in e?{...e,configurable:{...e.configurable,...t}}:{...e,configurable:t}:{configurable:t}}Symbol.for("LG_SKIP_WRITE");let ky={[Symbol.for("LG_PASSTHROUGH")]:!0};function kv(e){return"object"==typeof e&&e?.[Symbol.for("LG_PASSTHROUGH")]!==void 0}let k_=Symbol("IS_WRITER");var kb=class e extends kh{writes;constructor(e,t){super({writes:e,name:`ChannelWrite<${e.map(e=>xU(e)?e.node:"channel"in e?e.channel:"...").join(",")}>`,tags:t,func:async(e,t)=>this._write(e,t??{})}),this.writes=e}async _write(t,r){let i=this.writes.map(e=>k$(e)&&kv(e.value)?{mapper:e.mapper,value:t}:kw(e)&&kv(e.value)?{channel:e.channel,value:t,skipNone:e.skipNone,mapper:e.mapper}:e);return await e.doWrite(r,i),t}static async doWrite(e,t){for(let e of t){if(kw(e)){if(e.channel===xS)throw new nc("Cannot write to the reserved channel TASKS");if(kv(e.value))throw new nc("PASSTHROUGH value must be replaced")}if(k$(e)&&kv(e.value))throw new nc("PASSTHROUGH value must be replaced")}let r=[];for(let i of t)if(xU(i))r.push([xS,i]);else if(k$(i)){let t=await i.mapper.invoke(i.value,e);null!=t&&t.length>0&&r.push(...t)}else if(kw(i)){let t=void 0!==i.mapper?await i.mapper.invoke(i.value,e):i.value;if("object"==typeof t&&t?.[Symbol.for("LG_SKIP_WRITE")]!==void 0||i.skipNone&&void 0===t)continue;r.push([i.channel,t])}else throw Error(`Invalid write entry: ${JSON.stringify(i)}`);(e.configurable?.[xa])(r)}static isWriter(t){return t instanceof e||k_ in t&&!!t[k_]}static registerWriter(e){return Object.defineProperty(e,k_,{value:!0})}};function kw(e){return void 0!==e&&"string"==typeof e.channel}function k$(e){return void 0!==e&&!kw(e)&&m8.isRunnable(e.mapper)}var kx=class e extends kh{lc_graph_name="ChannelRead";channel;fresh=!1;mapper;constructor(t,r,i=!1){super({func:(t,r)=>e.doRead(r,this.channel,this.fresh,this.mapper)}),this.fresh=i,this.mapper=r,this.channel=t,this.name=Array.isArray(t)?`ChannelRead<${t.join(",")}>`:`ChannelRead<${t}>`}static doRead(e,t,r,i){let n=e.configurable?.[xo];if(!n)throw Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return i?i(n(t,r)):n(t,r)}};let kk=new gJ;var kI=class e extends m7{lc_graph_name="PregelNode";channels;triggers=[];mapper;writers=[];bound=kk;kwargs={};metadata={};tags=[];retryPolicy;cachePolicy;subgraphs;ends;constructor(e){const{channels:t,triggers:r,mapper:i,writers:n,bound:a,kwargs:s,metadata:o,retryPolicy:l,cachePolicy:u,tags:c,subgraphs:d,ends:h}=e,p=[...e.config?.tags?e.config.tags:[],...c??[]];super({...e,bound:e.bound??kk,config:{...e.config?e.config:{},tags:p}}),this.channels=t,this.triggers=r,this.mapper=i,this.writers=n??this.writers,this.bound=a??this.bound,this.kwargs=s??this.kwargs,this.metadata=o??this.metadata,this.tags=p,this.retryPolicy=l,this.cachePolicy=u,this.subgraphs=d,this.ends=h}getWriters(){let e=[...this.writers];for(;e.length>1&&e[e.length-1]instanceof kb&&e[e.length-2]instanceof kb;){let t=e.slice(-2),r=t[0].writes.concat(t[1].writes);e[e.length-2]=new kb(r,t[0].config?.tags),e.pop()}return e}getNode(){let e=this.getWriters();if(this.bound!==kk||0!==e.length)return this.bound===kk&&1===e.length?e[0]:this.bound===kk?new fr({first:e[0],middle:e.slice(1,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):e.length>0?new fr({first:this.bound,middle:e.slice(0,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):this.bound}join(t){if(!Array.isArray(t))throw Error("channels must be a list");if("object"!=typeof this.channels)throw Error("all channels must be named when using .join()");return new e({channels:{...this.channels,...Object.fromEntries(t.map(e=>[e,e]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(t){return new e(kb.isWriter(t)?{channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,t],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}:this.bound===kk?{channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:fl(t),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}:{channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(t),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}};function kE(e){return"lg_is_pregel"in e&&!0===e.lg_is_pregel}function kS(e){let t=[e];for(let e of t)if(kE(e))return e;else"steps"in e&&Array.isArray(e.steps)&&t.push(...e.steps)}function kO(e,t,r=!0,i=!1){try{return e[t].get()}catch(e){if(e.name===nu.unminifiable_name){if(i)return e;else if(r)return null}throw e}}function kT(e,t,r=!0){if(!Array.isArray(t))return kO(e,t);{let i={};for(let n of t)try{i[n]=kO(e,n,!r)}catch(e){if(e.name===nu.unminifiable_name)continue}return i}}function*kA(e,t){if(null!=t)if(Array.isArray(e)&&"object"==typeof t&&!Array.isArray(t))for(let r in t)e.includes(r)&&(yield[r,t[r]]);else if(Array.isArray(e))throw Error('Input chunk must be an object when "inputChannels" is an array');else yield[e,t]}function*kN(e,t,r){Array.isArray(e)?(!0===t||t.find(([t,r])=>e.includes(t)))&&(yield kT(r,e)):(!0===t||t.some(([t,r])=>t===e))&&(yield kO(r,e))}function kC(e){let t=typeof e[xe];if("number"===t)return 0;if("string"===t)return"";for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;let r=typeof e[t];if("number"===r)return 0;if("string"===r)return"";break}}function kj(e,t){if(!(Object.keys(e).length>0))return t;{let r=kC(t);return Object.fromEntries(Object.entries(t).filter(([t,i])=>i>(e[t]??r)))}}function kP(e,t){return null===e?{configurable:t}:e?.configurable===void 0?{...e,configurable:t}:{...e,configurable:{...e.configurable,...t}}}function kR(e,t){let r=t?.parents??{};return Object.keys(r).length>0?kP(e,{[xv]:{...r,[e.configurable?.checkpoint_ns??""]:e.configurable?.checkpoint_id}}):e}function kU(...e){let t=[...new Set(e.filter(Boolean))];if(0===t.length)return{signal:void 0,dispose:void 0};if(1===t.length)return{signal:t[0],dispose:void 0};let r=new AbortController,i=()=>{let e=t.find(e=>e.aborted)?.reason;r.abort(e),t.forEach(e=>e.removeEventListener("abort",i))};t.forEach(e=>e.addEventListener("abort",i,{once:!0}));let n=t.find(e=>e.aborted);return n&&r.abort(n.reason),{signal:r.signal,dispose:()=>{t.forEach(e=>e.removeEventListener("abort",i))}}}var kL=class{func;name;input;retry;cache;callbacks;__lg_type="call";constructor({func:e,name:t,input:r,retry:i,cache:n,callbacks:a}){this.func=e,this.name=t,this.input=r,this.retry=i,this.cache=n,this.callbacks=a}};let kz=e=>void 0!==e?e+1:1;function kD(e,t,r){let i=kC(e.channel_versions),n=e.versions_seen[xb]??{},a=!1;if((e.channel_versions[xe]??i)>(n[xe]??i))a=!0;else for(let t in e.channel_versions)if(Object.prototype.hasOwnProperty.call(e.channel_versions,t)&&e.channel_versions[t]>(n[t]??i)){a=!0;break}let s=r.some(e=>"*"===t?!e.config?.tags?.includes(xI):t.includes(e.name));return a&&s}function kM(e,t,r,i,n=!1){let a,s=new Set;if(Array.isArray(i))s=new Set(i.filter(e=>r.writes.some(([t,r])=>t===e)));else{for(let[e]of r.writes)if(e===i){s=new Set([e]);break}s=s||new Set}if(n&&s.size>0){let n=Object.fromEntries(Object.entries(t).filter(([e,t])=>s.has(e))),o=$2(e,n,-1),l=$4(n,o);kB($q(o),l,[r],void 0,void 0),a=kT({...t,...l},i)}else a=kT(t,i);return a}function kZ(e,t,r){for(let[e,i]of r)if([xO,xS].includes(e)&&null!=i){if(!xU(i))throw new nc(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(i)}`);if(!(i.node in t))throw new nc(`Invalid node name "${i.node}" in Send packet`)}e(r)}let kF=new Set([x$,xO,xw,xb,xx,xi]);function kB(e,t,r,i,n){r.sort((e,t)=>{let r=e.path?.slice(0,3)||[],i=t.path?.slice(0,3)||[];for(let e=0;e<Math.min(r.length,i.length);e+=1){if(r[e]<i[e])return -1;if(r[e]>i[e])return 1}return r.length-i.length});let a=r.some(e=>e.triggers.length>0),s=$1(t);for(let t of r)for(let r of(e.versions_seen[t.name]??={},t.triggers))r in e.channel_versions&&(e.versions_seen[t.name][r]=e.channel_versions[r]);let o=function(e){let t;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t=null==t?e[r]:function(...e){return e.reduce((e,t,r)=>0===r?t:$G(e,t)>=0?e:t)}(t,e[r]));return t}(e.channel_versions),l=new Set(r.flatMap(e=>e.triggers).filter(e=>!xN.includes(e))),u=!1;for(let t of l)t in s&&s[t].consume()&&void 0!==i&&(e.channel_versions[t]=i(o),u=!0);let c={};for(let e of r)for(let[t,r]of e.writes)kF.has(t)||t in s&&(c[t]??=[],c[t].push(r));null!=o&&null!=i&&(o=u?i(o):o);let d=new Set;for(let[t,r]of Object.entries(c))if(t in s){let n,a=s[t];try{n=a.update(r)}catch(e){if(e.name===nc.unminifiable_name){let i=new nc(`Invalid update for channel "${t}" with values ${JSON.stringify(r)}: ${e.message}`);throw i.lc_error_code=e.lc_error_code,i}throw e}n&&void 0!==i&&(e.channel_versions[t]=i(o),a.isAvailable()&&d.add(t))}if(a)for(let t in s){if(!Object.prototype.hasOwnProperty.call(s,t))continue;let r=s[t];r.isAvailable()&&!d.has(t)&&r.update([])&&void 0!==i&&(e.channel_versions[t]=i(o),r.isAvailable()&&d.add(t))}if(a&&!function(e,t){if(null==t)return!1;for(let r of e)if(t[r])return!0;return!1}(d,n))for(let t in s){if(!Object.prototype.hasOwnProperty.call(s,t))continue;let r=s[t];r.finish()&&void 0!==i&&(e.channel_versions[t]=i(o),r.isAvailable()&&d.add(t))}return d}function kV(e,t,r,i,n,a,s){let o={},l=i[xS];if(l?.isAvailable()){let u=l.get().length;for(let l=0;l<u;l+=1){let u=kq([xO,l],e,t,r,i,n,a,s);void 0!==u&&(o[u.id]=u)}}for(let l of function*(e,t,r){if(null!=r.updatedChannels&&null!=r.triggerToNodes){let e=new Set;for(let t of r.updatedChannels)for(let i of r.triggerToNodes[t]??[])e.add(i);yield*[...e].sort();return}if(!(()=>{for(let t in e.channel_versions)if(null!==e.channel_versions[t])return!1;return!0})())for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(yield e)}(e,r,s)){let u=kq([xT,l],e,t,r,i,n,a,s);void 0!==u&&(o[u.id]=u)}return o}function kq(e,t,r,i,n,a,s,o){var l,u,c;let{step:d,checkpointer:h,manager:p}=o,m=a.configurable??{},f=m.checkpoint_ns??"";if(e[0]===xO&&"object"==typeof(l=e[e.length-1])&&null!==l&&"__lg_type"in l&&"call"===l.__lg_type){let l,g=e[e.length-1],y=(u=g.name,c=g.func,l=new kh({func:e=>c(...e),name:u,trace:!1,recurse:!1}),new fr({name:u,first:l,last:new kb([{channel:xx,value:ky}],[xI])})),v=[xO],_=""===f?g.name:`${f}|${g.name}`,b=ng(JSON.stringify([_,d.toString(),g.name,xO,e[1],e[2]]),t.id),w=`${_}:${b}`,$=[...e.slice(0,3),!0],x={langgraph_step:d,langgraph_node:g.name,langgraph_triggers:v,langgraph_path:$,langgraph_checkpoint_ns:w};if(!s)return{id:b,name:g.name,interrupts:[],path:$};{let e=[];return{name:g.name,input:g.input,proc:y,writes:e,config:nS(nk(a,{metadata:x,store:o.store??a.store}),{runName:g.name,callbacks:p?.getChild(`graph:step:${d}`),configurable:{[xc]:b,[xa]:t=>kZ(t=>e.push(...t),i,t),[xo]:(r,i=!1)=>kM(t,n,{name:g.name,writes:e,triggers:v,path:$},r,i),[xl]:h??m[xl],[xv]:{...m[xv],[f]:t.id},[xp]:kG({pendingWrites:r??[],taskId:b,currentTaskInput:g.input,resumeMap:a.configurable?.[xh],namespaceHash:ku(w)}),[xm]:t.channel_values[xk],checkpoint_id:void 0,checkpoint_ns:w}}),triggers:v,retry_policy:g.retry,cache_key:g.cache?{key:ku((g.cache.keyFunc??JSON.stringify)([g.input])),ns:[xn,g.name??"__dynamic__"],ttl:g.cache.ttl}:void 0,id:b,path:$,writers:[]}}}if(e[0]===xO){let l="number"==typeof e[1]?e[1]:parseInt(e[1],10);if(!n[xS]?.isAvailable())return;let u=n[xS].get();if(l<0||l>=u.length)return;let c=xP(u[l])&&!xU(u[l])?new xR(u[l].node,u[l].args):u[l];if(!xP(c))return void console.warn(`Ignoring invalid packet ${JSON.stringify(c)} in pending sends.`);if(!(c.node in i))return void console.warn(`Ignoring unknown node name ${c.node} in pending sends.`);let g=[xO],y=""===f?c.node:`${f}|${c.node}`,v=ng(JSON.stringify([y,d.toString(),c.node,xO,l.toString()]),t.id),_=`${y}:${v}`,b={langgraph_step:d,langgraph_node:c.node,langgraph_triggers:g,langgraph_path:e.slice(0,3),langgraph_checkpoint_ns:_};if(!s)return{id:v,name:c.node,interrupts:[],path:e};{let s=i[c.node],l=s.getNode();if(void 0!==l){void 0!==s.metadata&&(b={...b,...s.metadata});let u=[];return{name:c.node,input:c.args,proc:l,subgraphs:s.subgraphs,writes:u,config:nS(nk(a,{metadata:b,tags:s.tags,store:o.store??a.store}),{runName:c.node,callbacks:p?.getChild(`graph:step:${d}`),configurable:{[xc]:v,[xa]:e=>kZ(e=>u.push(...e),i,e),[xo]:(r,i=!1)=>kM(t,n,{name:c.node,writes:u,triggers:g,path:e},r,i),[xl]:h??m[xl],[xv]:{...m[xv],[f]:t.id},[xp]:kG({pendingWrites:r??[],taskId:v,currentTaskInput:c.args,resumeMap:a.configurable?.[xh],namespaceHash:ku(_)}),[xm]:t.channel_values[xk],checkpoint_id:void 0,checkpoint_ns:_}}),triggers:g,retry_policy:s.retryPolicy,cache_key:s.cachePolicy?{key:ku((s.cachePolicy.keyFunc??JSON.stringify)([c.args])),ns:[xn,s.name??"__dynamic__",c.node],ttl:s.cachePolicy.ttl}:void 0,id:v,path:e,writers:s.getWriters()}}}}else if(e[0]===xT){let l=e[1].toString(),u=i[l];if(void 0===u)return;if(r?.length){let e=ng(JSON.stringify([""===f?l:`${f}|${l}`,d.toString(),l,xT,l]),t.id);if(r.some(t=>t[0]===e&&t[1]!==xi))return}let c=kC(t.channel_versions);if(void 0===c)return;let g=t.versions_seen[l]??{},y=u.triggers.find(e=>!!n[e].isAvailable()&&(t.channel_versions[e]??c)>(g[e]??c));if(void 0!==y){let c=function(e,t,r){let i;if("object"!=typeof e.channels||Array.isArray(e.channels))if(Array.isArray(e.channels)){let r=!1;for(let n of e.channels)try{i=kO(t,n,!1),r=!0;break}catch(e){if(e.name===nu.unminifiable_name)continue;throw e}if(!r)return}else throw Error(`Invalid channels type, expected list or dict, got ${e.channels}`);else for(let[r,n]of(i={},Object.entries(e.channels)))if(e.triggers.includes(n))try{i[r]=kO(t,n,!1)}catch(e){if(e.name===nu.unminifiable_name)return;throw e}else if(n in t)try{i[r]=kO(t,n,!1)}catch(e){if(e.name===nu.unminifiable_name)continue;throw e}return r&&void 0!==e.mapper&&(i=e.mapper(i)),i}(u,n,s);if(void 0===c)return;let g=""===f?l:`${f}|${l}`,v=ng(JSON.stringify([g,d.toString(),l,xT,[y]]),t.id),_=`${g}:${v}`,b={langgraph_step:d,langgraph_node:l,langgraph_triggers:[y],langgraph_path:e,langgraph_checkpoint_ns:_};if(!s)return{id:v,name:l,interrupts:[],path:e};{let s=u.getNode();if(void 0!==s){void 0!==u.metadata&&(b={...b,...u.metadata});let g=[];return{name:l,input:c,proc:s,subgraphs:u.subgraphs,writes:g,config:nS(nk(a,{metadata:b,tags:u.tags,store:o.store??a.store}),{runName:l,callbacks:p?.getChild(`graph:step:${d}`),configurable:{[xc]:v,[xa]:e=>kZ(e=>{g.push(...e)},i,e),[xo]:(r,i=!1)=>kM(t,n,{name:l,writes:g,triggers:[y],path:e},r,i),[xl]:h??m[xl],[xv]:{...m[xv],[f]:t.id},[xp]:kG({pendingWrites:r??[],taskId:v,currentTaskInput:c,resumeMap:a.configurable?.[xh],namespaceHash:ku(_)}),[xm]:t.channel_values[xk],checkpoint_id:void 0,checkpoint_ns:_}}),triggers:[y],retry_policy:u.retryPolicy,cache_key:u.cachePolicy?{key:ku((u.cachePolicy.keyFunc??JSON.stringify)([c])),ns:[xn,u.name??"__dynamic__",l],ttl:u.cachePolicy.ttl}:void 0,id:v,path:e,writers:u.getWriters()}}}}}}function kG({pendingWrites:e,taskId:t,currentTaskInput:r,resumeMap:i,namespaceHash:n}){let a=e.find(([e,t])=>e===xA&&t===xw)?.[2],s={callCounter:0,interruptCounter:-1,resume:(()=>{let r=e.filter(([e,r])=>e===t&&r===xw).flatMap(([e,t,r])=>r);if(null!=i&&n in i){let e=i[n];r.push(e)}return r})(),nullResume:a,subgraphCounter:0,currentTaskInput:r,consumeNullResume:()=>{if(s.nullResume)return delete s.nullResume,e.splice(e.findIndex(([e,t])=>e===xA&&t===xw),1),a}};return s}let kW={start:"\x1b[34m",end:"\x1b[0m"},kJ={start:"\x1b[32m",end:"\x1b[0m"},kH={start:"\x1b[33;1m",end:"\x1b[0m"},kK=(e,t)=>`${e.start}${t}${e.end}`;function*kX(e){for(let{id:t,name:r,input:i,config:n,triggers:a,writes:s}of e){if(n?.tags?.includes(xI))continue;let e=s.filter(([e,r])=>e===t&&r===xb).map(([,e])=>e);yield{id:t,name:r,input:i,triggers:a,interrupts:e}}}function kY(e){let t={};for(let[i,n]of e){let e=String(i);if(e in t){var r;let i="object"==typeof(r=t[e])&&null!==r&&"$writes"in r&&Array.isArray(r.$writes)?t[e].$writes:[t[e]];i.push(n),t[e]={$writes:i}}else t[e]=n}return t}function kQ(e,t,r,i){return e.map(e=>{let n=t.find(([t,r])=>t===e.id&&r===xi)?.[2],a=t.filter(([t,r])=>t===e.id&&r===xb).map(([,,e])=>e),s=(()=>{if(n||a.length||!t.length)return;let r=t.findIndex(([t,r])=>t===e.id&&r===xx);if(r>=0)return t[r][2];if("string"==typeof i)return t.find(([t,r])=>t===e.id&&r===i)?.[2];if(Array.isArray(i)){let r=t.filter(([t,r])=>t===e.id&&i.includes(r)).map(([,e,t])=>[e,t]);if(!r.length)return;return kY(r)}})();if(n)return{id:e.id,name:e.name,path:e.path,error:n,interrupts:a,result:s};let o=r?.[e.id];return{id:e.id,name:e.name,path:e.path,interrupts:a,...void 0!==o?{state:o}:{},result:s}})}function k0(e,t){let r=t.length;console.log([`${kK(kW,`[${e}:tasks]`)}`,`\x1b[1m Starting step ${e} with ${r} task${1===r?"":"s"}:\x1b[0m
`,t.map(e=>`- ${kK(kJ,String(e.name))} -> ${JSON.stringify(e.input,null,2)}`).join("\n")].join(""))}var k1=class extends nC{_abortController;_innerReader;constructor(e,t){const r=e.getReader(),i=t??new AbortController;super({start:e=>(function t(){return r.read().then(({done:r,value:i})=>r?void e.close():(e.enqueue(i),t()))})()}),this._abortController=i,this._innerReader=r}async cancel(e){this._abortController.abort(e),this._innerReader.releaseLock()}get signal(){return this._abortController.signal}},k4=class extends nC{modes;controller;passthroughFn;_closed=!1;get closed(){return this._closed}constructor(e){let t;const r=new Promise(e=>{t=e});super({start:e=>{t(e)}}),r.then(e=>{this.controller=e}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}push(e){this.passthroughFn?.(e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch(e){}finally{this._closed=!0}}error(e){this.controller.error(e)}};function k2(e){return"object"==typeof e&&null!=e&&"configurable"in e&&"object"==typeof e.configurable&&null!=e.configurable}function k6(e){return k2(e)&&e.configurable.thread_id?{thread_id:e.configurable.thread_id,checkpoint_ns:e.configurable.checkpoint_ns||"",checkpoint_id:e.configurable.checkpoint_id||null,checkpoint_map:e.configurable.checkpoint_map||null}:null}function k9(e){if(k2(e)){let t=Object.fromEntries(Object.entries(e.configurable).filter(([e])=>!e.startsWith("__"))),r={...e,configurable:t};return delete r.callbacks,r}return e}function k5(e){let t={...e,checkpoint:k6(e.config),parent_checkpoint:k6(e.parentConfig),config:k9(e.config),parent_config:k9(e.parentConfig),tasks:e.tasks.map(e=>{if(k2(e.state)){let t=k6(e.state);if(null!=t){let r={...e,checkpoint:t};return delete r.state,r}}return e})};return delete t.parentConfig,t}let k3=Symbol.for("INPUT_DONE"),k8=Symbol.for("INPUT_RESUMING");var k7=class extends $X{cache;queue=Promise.resolve();constructor(e){super(),this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...t){let r=this.queue.then(()=>this.cache[e](...t));return this.queue=r.then(()=>void 0,()=>void 0),r}},Ie=class e{input;output;config;checkpointer;checkpointerGetNextVersion;channels;checkpoint;checkpointIdSaved;checkpointConfig;checkpointMetadata;checkpointNamespace;checkpointPendingWrites=[];checkpointPreviousVersions;step;stop;durability;outputKeys;streamKeys;nodes;skipDoneTasks;prevCheckpointConfig;updatedChannels;status="pending";tasks={};stream;checkpointerPromises=[];isNested;_checkpointerChainedPromise=Promise.resolve();store;cache;manager;interruptAfter;interruptBefore;toInterrupt=[];debug=!1;triggerToNodes;get isResuming(){let e=!1;if(xe in this.checkpoint.channel_versions)e=!0;else for(let t in this.checkpoint.channel_versions)if(Object.prototype.hasOwnProperty.call(this.checkpoint.channel_versions,t)){e=!0;break}let t=this.config.configurable?.[xu]!==void 0&&this.config.configurable?.[xu],r=null===this.input||void 0===this.input,i=xD(this.input)&&null!=this.input.resume,n=this.input===k8,a=!this.isNested&&this.config.metadata?.run_id!==void 0&&this.checkpointMetadata?.run_id!==void 0&&this.config.metadata.run_id===this.checkpointMetadata?.run_id;return e&&(t||r||i||n||a)}constructor(e){this.input=e.input,this.checkpointer=e.checkpointer,void 0!==this.checkpointer?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=kz,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new k7(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.durability=e.durability,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}static async initialize(t){let{config:r,stream:i}=t;void 0!==i&&r.configurable?.[xd]!==void 0&&(i=function(...e){return new k4({passthroughFn:t=>{for(let r of e)r.modes.has(t[1])&&r.push(t)},modes:new Set(e.flatMap(e=>Array.from(e.modes)))})}(i,r.configurable[xd]));let n=!r.configurable||!("checkpoint_id"in r.configurable),a=r.configurable?.[xp];r.configurable&&a&&(a.subgraphCounter>0&&(r=kP(r,{[xy]:[r.configurable[xy],a.subgraphCounter.toString()].join("|")})),a.subgraphCounter+=1);let s=xo in(r.configurable??{});s||r.configurable?.checkpoint_ns===void 0||r.configurable?.checkpoint_ns===""||(r=kP(r,{checkpoint_ns:"",checkpoint_id:void 0}));let o=r;r.configurable?.[xv]!==void 0&&r.configurable?.[xv]?.[r.configurable?.checkpoint_ns]&&(o=kP(r,{checkpoint_id:r.configurable[xv][r.configurable?.checkpoint_ns]}));let l=r.configurable?.checkpoint_ns?.split("|")??[],u=await t.checkpointer?.getTuple(o)??{config:r,checkpoint:$V(),metadata:{source:"input",step:-2,parents:{}},pendingWrites:[]};o={...r,...u.config,configurable:{checkpoint_ns:"",...r.configurable,...u.config.configurable}};let c=u.parentConfig,d=$q(u.checkpoint),h={...u.metadata},p=u.pendingWrites??[],m=$4(t.channelSpecs,d),f=(h.step??0)+1,g=f+(r.recursionLimit??25)+1,y={...d.channel_versions},v=t.store?new $K(t.store):void 0;return v&&await v.start(),new e({input:t.input,config:r,checkpointer:t.checkpointer,checkpoint:d,checkpointMetadata:h,checkpointConfig:o,prevCheckpointConfig:c,checkpointNamespace:l,channels:m,isNested:s,manager:t.manager,skipDoneTasks:n,step:f,stop:g,checkpointPreviousVersions:y,checkpointPendingWrites:p,outputKeys:t.outputKeys??[],streamKeys:t.streamKeys??[],nodes:t.nodes,stream:i,store:v,cache:t.cache,interruptAfter:t.interruptAfter,interruptBefore:t.interruptBefore,durability:t.durability,debug:t.debug,triggerToNodes:t.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>this.checkpointer?.put(e.config,e.checkpoint,e.metadata,e.newVersions)),this.checkpointerPromises.push(this._checkpointerChainedPromise)}putWrites(e,t){let r=t;if(0===r.length)return;for(let[t,i]of(r.every(([e])=>e in $W)&&(r=Array.from(new Map(r.map(e=>[e[0],e])).values())),this.checkpointPendingWrites=this.checkpointPendingWrites.filter(t=>t[0]!==e),r))this.checkpointPendingWrites.push([e,t,i]);let i=kP(this.checkpointConfig,{[xy]:this.config.configurable?.checkpoint_ns??"",[xg]:this.checkpoint.id});if("exit"!==this.durability&&null!=this.checkpointer&&this.checkpointerPromises.push(this.checkpointer.putWrites(i,r,e)),this.tasks&&this._outputWrites(e,r),!t.length||!this.cache||!this.tasks)return;let n=this.tasks[e];null==n||null==n.cache_key||t[0][0]!==xi&&t[0][0]!==xb&&this.cache.set([{key:[n.cache_key.ns,n.cache_key.key],value:n.writes,ttl:n.cache_key.ttl}])}_outputWrites(e,t,r=!1){let i=this.tasks[e];if(void 0!==i){if(void 0!==i.config&&(i.config.tags??[]).includes(xI))return;if(t.length>0)if(t[0][0]===xb){if(i.path?.[0]===xO&&i.path?.at(-1)===!0)return;let e=t.filter(e=>e[0]===xb).flatMap(e=>e[1]);this._emit([["updates",{[xb]:e}],["values",{[xb]:e}]])}else t[0][0]!==xi&&this._emit(kf(kp(function*(e,t,r){let i,n=t.filter(([e,t])=>(void 0===e.config||!e.config.tags?.includes(xI))&&t[0][0]!==xi&&t[0][0]!==xb);if(!n.length)return;i=n.some(([e])=>e.writes.some(([e,t])=>e===xx))?n.flatMap(([e])=>e.writes.filter(([e,t])=>e===xx).map(([t,r])=>[e.name,r])):Array.isArray(e)?n.flatMap(([t])=>{let{writes:r}=t,i={};for(let[t]of r)e.includes(t)&&(i[t]=(i[t]||0)+1);return Object.values(i).some(e=>e>1)?r.filter(([t])=>e.includes(t)).map(([e,r])=>[t.name,{[e]:r}]):[[t.name,Object.fromEntries(r.filter(([t])=>e.includes(t)))]]}):n.flatMap(([t])=>t.writes.filter(([t,r])=>t===e).map(([e,r])=>[t.name,r]));let a={};for(let[e,t]of i)e in a||(a[e]=[]),a[e].push(t);let s={};for(let e in a)if(1===a[e].length){let[t]=a[e];s[e]=t}else s[e]=a[e];r&&(s.__metadata__={cached:r}),yield s}(this.outputKeys,[[i,t]],r),"updates")));r||this._emit(kf(kp(function*(e,t){for(let[{id:r,name:i,config:n},a]of e)n?.tags?.includes(xI)||(yield{id:r,name:i,result:kY(a.filter(([e])=>Array.isArray(t)?t.includes(e):e===t)),interrupts:a.filter(e=>e[0]===xb).map(e=>e[1])})}([[i,t]],this.streamKeys),"tasks")))}}async _matchCachedWrites(){if(!this.cache)return[];let e=[],t=([e,t])=>`ns:${e.join(",")}|key:${t}`,r=[],i={};for(let e of Object.values(this.tasks))null==e.cache_key||e.writes.length||(r.push([e.cache_key.ns,e.cache_key.key]),i[t([e.cache_key.ns,e.cache_key.key])]=e);if(0===r.length)return[];for(let{key:n,value:a}of(await this.cache.get(r))){let r=i[t(n)];null!=r&&(r.writes.push(...a),e.push({task:r,result:a}))}return e}async tick(e){this.store&&!this.store.isRunning&&await this.store?.start();let{inputKeys:t=[]}=e;if("pending"!==this.status)throw Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if([k3,k8].includes(this.input))if(this.toInterrupt.length>0)throw this.status="interrupt_before",new ni;else{if(!Object.values(this.tasks).every(e=>e.writes.length>0))return!1;let e=Object.values(this.tasks).flatMap(e=>e.writes);this.updatedChannels=kB(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);let t=await km(kp(kN(this.outputKeys,e,this.channels),"values"));if(this._emit(t),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop"}),kD(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new ni;this.config.configurable?.[xu]!==void 0&&delete this.config.configurable?.[xu]}else await this._first(t);if(this.step>this.stop)return this.status="out_of_steps",!1;let r=kV(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream,triggerToNodes:this.triggerToNodes,updatedChannels:this.updatedChannels});if(this.tasks=r,this.checkpointer&&this._emit(await km(kp(function*(e,t,r,i,n,a,s,o){function l(e){let t={};return null!=e.callbacks&&(t.callbacks=e.callbacks),null!=e.configurable&&(t.configurable=e.configurable),null!=e.maxConcurrency&&(t.max_concurrency=e.maxConcurrency),null!=e.metadata&&(t.metadata=e.metadata),null!=e.recursionLimit&&(t.recursion_limit=e.recursionLimit),null!=e.runId&&(t.run_id=e.runId),null!=e.runName&&(t.run_name=e.runName),null!=e.tags&&(t.tags=e.tags),t}let u=e.configurable?.checkpoint_ns,c={};for(let t of n){if(!(t.subgraphs?.length?t.subgraphs:[t.proc]).find(kS))continue;let r=`${t.name}:${t.id}`;u&&(r=`${u}|${r}`),c[t.id]={configurable:{thread_id:e.configurable?.thread_id,checkpoint_ns:r}}}yield{config:l(e),values:kT(t,r),metadata:i,next:n.map(e=>e.name),tasks:kQ(n,a,c,o),parentConfig:s?l(s):void 0}}(this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"checkpoints"))),0===Object.values(this.tasks).length)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(let[e,t,r]of this.checkpointPendingWrites){if(t===xi||t===xb||t===xw)continue;let i=Object.values(this.tasks).find(t=>t.id===e);i&&i.writes.push([t,r])}for(let e of Object.values(this.tasks))e.writes.length>0&&this._outputWrites(e.id,e.writes,!0)}if(Object.values(this.tasks).every(e=>e.writes.length>0))return this.tick({inputKeys:t});if(kD(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new ni;let i=await km(kp(kX(Object.values(this.tasks)),"tasks"));return this._emit(i),!0}async finishAndHandleError(e){"exit"===this.durability&&(!this.isNested||void 0!==e||this.checkpointNamespace.every(e=>!e.includes(":")))&&(this._putCheckpoint(this.checkpointMetadata),this._flushPendingWrites());let t=this._suppressInterrupt(e);return(t||void 0===e)&&(this.output=kT(this.channels,this.outputKeys)),t&&(void 0!==this.tasks&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(e=>e.writes.length>0)&&(this.updatedChannels=kB(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes),this._emit(kf(kp(kN(this.outputKeys,Object.values(this.tasks).flatMap(e=>e.writes),this.channels),"values")))),no(e)&&!e.interrupts.length&&this._emit([["updates",{[xb]:[]}],["values",{[xb]:[]}]])),t}async acceptPush(e,t,r){if(this.interruptAfter?.length>0&&kD(this.checkpoint,this.interruptAfter,[e]))return void this.toInterrupt.push(e);let i=kq([xO,e.path??[],t,e.id,r],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(i){if(this.interruptBefore?.length>0&&kD(this.checkpoint,this.interruptBefore,[i]))return void this.toInterrupt.push(i);for(let{task:e}of(this._emit(kf(kp(kX([i]),"tasks"))),this.debug&&k0(this.step,[i]),this.tasks[i.id]=i,this.skipDoneTasks&&this._matchWrites({[i.id]:i}),await this._matchCachedWrites()))this._outputWrites(e.id,e.writes,!0);return i}}_suppressInterrupt(e){return no(e)&&!this.isNested}async _first(e){let{configurable:t}=this.config,r=t?.[xp];if(r&&void 0!==r.nullResume&&this.putWrites(xA,[[xw,r.nullResume]]),xD(this.input)){let e=null!=this.input.resume;if(null!=this.input.resume&&"object"==typeof this.input.resume&&Object.keys(this.input.resume).every(kc)&&(this.config.configurable??={},this.config.configurable[xh]=this.input.resume),e&&null==this.checkpointer)throw Error("Cannot use Command(resume=...) without checkpointer");let t={};for(let[e,r,i]of function*(e,t){if(e.graph===xz.PARENT)throw new nc("There is no parent graph.");if(e.goto){for(let t of Array.isArray(e.goto)?e.goto:[e.goto])if(xU(t))yield[xA,xS,t];else if("string"==typeof t)yield[xA,`branch:to:${t}`,"__start__"];else throw Error(`In Command.send, expected Send or string, got ${typeof t}`)}if(e.resume)if("object"==typeof e.resume&&Object.keys(e.resume).length&&Object.keys(e.resume).every(kc))for(let[r,i]of Object.entries(e.resume)){let e=t.filter(e=>e[0]===r&&e[1]===xw).map(e=>e[2]).slice(0,1)??[];e.push(i),yield[r,xw,e]}else yield[xA,xw,e.resume];if(e.update){if("object"!=typeof e.update||!e.update)throw Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(e.update))for(let[t,r]of e.update)yield[xA,t,r];else for(let[t,r]of Object.entries(e.update))yield[xA,t,r]}}(this.input,this.checkpointPendingWrites))t[e]??=[],t[e].push([r,i]);if(0===Object.keys(t).length)throw new nl("Received empty Command input");for(let[e,r]of Object.entries(t))this.putWrites(e,r)}let i=(this.checkpointPendingWrites??[]).filter(e=>e[0]===xA).map(e=>e.slice(1));i.length>0&&kB(this.checkpoint,this.channels,[{name:xr,writes:i,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);let n=xD(this.input)&&i.length>0;if(this.isResuming||n){for(let e in this.channels)if(Object.prototype.hasOwnProperty.call(this.channels,e)&&void 0!==this.checkpoint.channel_versions[e]){let t=this.checkpoint.channel_versions[e];this.checkpoint.versions_seen[xb]={...this.checkpoint.versions_seen[xb],[e]:t}}let e=await km(kp(kN(this.outputKeys,!0,this.channels),"values"));this._emit(e)}if(this.isResuming)this.input=k8;else if(n)await this._putCheckpoint({source:"input"}),this.input=k3;else{let t=await km(kA(e,this.input));if(t.length>0){let e=kV(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step});this.updatedChannels=kB(this.checkpoint,this.channels,Object.values(e).concat([{name:xr,writes:t,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input"}),this.input=k3}else if(xu in(this.config.configurable??{}))this.input=k3;else throw new nl(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=kP(this.config,{[xu]:this.isResuming}))}_emit(e){for(let[t,r]of e)if(this.stream.modes.has(t)&&this.stream.push([this.checkpointNamespace,t,r]),("checkpoints"===t||"tasks"===t)&&this.stream.modes.has("debug")){let e="checkpoints"===t?this.step-1:this.step,i=new Date().toISOString(),n="checkpoints"===t?"checkpoint":"object"==typeof r&&null!=r&&"result"in r?"task_result":"task";this.stream.push([this.checkpointNamespace,"debug",{step:e,type:n,timestamp:i,payload:r}])}}_putCheckpoint(e){let t=this.checkpointMetadata===e,r=null!=this.checkpointer&&("exit"!==this.durability||t),i=e=>{this.prevCheckpointConfig=this.checkpointConfig?.configurable?.checkpoint_id?this.checkpointConfig:void 0,this.checkpointConfig=kP(this.checkpointConfig,{[xy]:this.config.configurable?.checkpoint_ns??""});let t={...this.checkpoint.channel_versions},r=kj(this.checkpointPreviousVersions,t);this.checkpointPreviousVersions=t,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:$q(e),metadata:{...this.checkpointMetadata},newVersions:r}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}};t||(this.checkpointMetadata={...e,step:this.step,parents:this.config.configurable?.[xv]??{}}),this.checkpoint=$2(this.checkpoint,r?this.channels:void 0,this.step,t?{id:this.checkpoint.id}:void 0),r&&i(this.checkpoint),t||(this.step+=1)}_flushPendingWrites(){if(null==this.checkpointer||0===this.checkpointPendingWrites.length)return;let e=kP(this.checkpointConfig,{[xy]:this.config.configurable?.checkpoint_ns??"",[xg]:this.checkpoint.id}),t={};for(let[e,r,i]of this.checkpointPendingWrites)t[e]??=[],t[e].push([r,i]);for(let[r,i]of Object.entries(t))this.checkpointerPromises.push(this.checkpointer.putWrites(e,i,r))}_matchWrites(e){for(let[t,r,i]of this.checkpointPendingWrites){if(r===xi||r===xb||r===xw)continue;let n=Object.values(e).find(e=>e.id===t);n&&n.writes.push([r,i])}for(let t of Object.values(e))t.writes.length>0&&this._outputWrites(t.id,t.writes,!0)}},It=class extends t6{name="StreamMessagesHandler";streamFn;metadatas={};seen={};emittedChatModelRunIds={};stableMessageIdMap={};lc_prefer_streaming=!0;constructor(e){super(),this.streamFn=e}_emit(e,t,r,i=!1){if(i&&void 0!==t.id&&void 0!==this.seen[t.id])return;let n=t.id;null!=r&&(e0(t)?n??=`run-${r}-tool-${t.tool_call_id}`:((null==n||n===`run-${r}`)&&(n=this.stableMessageIdMap[r]??n??`run-${r}`),this.stableMessageIdMap[r]??=n)),n!==t.id&&(t.id=n,t.lc_kwargs.id=n),null!=t.id&&(this.seen[t.id]=t),this.streamFn([e[0],"messages",[t,e[1]]])}handleChatModelStart(e,t,r,i,n,a,s,o){!s||a&&(a.includes("langsmith:nostream")||a.includes("nostream"))||(this.metadatas[r]=[s.langgraph_checkpoint_ns.split("|"),{tags:a,name:o,...s}])}handleLLMNewToken(e,t,r,i,n,a){let s=a?.chunk;(this.emittedChatModelRunIds[r]=!0,void 0!==this.metadatas[r])&&(eW(s?.message)?this._emit(this.metadatas[r],s.message,r):this._emit(this.metadatas[r],new tI({content:e}),r))}handleLLMEnd(e,t){if(void 0!==this.metadatas[t]){if(!this.emittedChatModelRunIds[t]){let r=e.generations?.[0]?.[0];eW(r?.message)&&this._emit(this.metadatas[t],r?.message,t,!0),delete this.emittedChatModelRunIds[t]}delete this.metadatas[t],delete this.stableMessageIdMap[t]}}handleLLMError(e,t){delete this.metadatas[t]}handleChainStart(e,t,r,i,n,a,s,o){if(void 0!==a&&o===a.langgraph_node&&(void 0===n||!n.includes(xI))&&(this.metadatas[r]=[a.langgraph_checkpoint_ns.split("|"),{tags:n,name:o,...a}],"object"==typeof t)){for(let e of Object.values(t))if((eW(e)||eJ(e))&&void 0!==e.id)this.seen[e.id]=e;else if(Array.isArray(e))for(let t of e)(eW(t)||eJ(t))&&void 0!==t.id&&(this.seen[t.id]=t)}}handleChainEnd(e,t){let r=this.metadatas[t];if(delete this.metadatas[t],void 0!==r){if(eW(e))this._emit(r,e,t,!0);else if(Array.isArray(e))for(let i of e)eW(i)&&this._emit(r,i,t,!0);else if(null!=e&&"object"==typeof e){for(let i of Object.values(e))if(eW(i))this._emit(r,i,t,!0);else if(Array.isArray(i))for(let e of i)eW(e)&&this._emit(r,e,t,!0)}}}handleChainError(e,t){delete this.metadatas[t]}};let Ir=[400,401,402,403,404,405,406,407,409],Ii=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||"GraphValueError"===e.name||e?.code==="ECONNABORTED")return!1;let t=e?.response?.status??e?.status;return!(t&&Ir.includes(+t))&&e?.error?.code!=="insufficient_quota"};async function In(e,t,r,i){let n,a,s=e.retry_policy??t,o=void 0!==s?s.initialInterval??500:0,l=0,{config:u}=e;for(r&&(u=kP(u,r)),u={...u,signal:i};!i?.aborted;){e.writes.splice(0,e.writes.length),n=void 0;try{a=await e.proc.invoke(e.input,u);break}catch(i){var c;if((n=i).pregelTaskId=e.id,void 0!==(c=n)&&c.name===na.unminifiable_name){let t=u?.configurable?.checkpoint_ns,r=n.command;if(r.graph===t){for(let t of e.writers)await t.invoke(r,u);n=void 0;break}if(r.graph===xz.PARENT){let e=function(e){let t=e.split("|");for(;t.length>1&&t[t.length-1].match(/^\d+$/);)t.pop();return t.slice(0,-1).join("|")}(t);n.command=new xz({...n.command,graph:e})}}if(ns(n)||void 0===s||(l+=1)>=(s.maxAttempts??3)||!(s.retryOn??Ii)(n))break;o=Math.min(s.maxInterval??128e3,o*(s.backoffFactor??2));let t=s.jitter?Math.floor(o+1e3*Math.random()):o;await new Promise(e=>setTimeout(e,t));let r=n.name??n.constructor.unminifiable_name??n.constructor.name;(s?.logWarning??!0)&&console.log(`Retrying task "${String(e.name)}" after ${o.toFixed(2)}ms (attempt ${l}) after ${r}: ${n}`),u=kP(u,{[xu]:!0})}}return{task:e,result:a,error:n,signalAborted:i?.aborted}}let Ia=Symbol.for("promiseAdded");var Is=class{nodeFinished;loop;constructor({loop:e,nodeFinished:t}){this.loop=e,this.nodeFinished=t}async tick(e={}){let t,{timeout:r,retryPolicy:i,onStepWrite:n,maxConcurrency:a}=e,s=new Set,o=new AbortController,l=o.signal,u=r?AbortSignal.timeout(r):void 0,c=Object.values(this.loop.tasks).filter(e=>0===e.writes.length),{signals:d,disposeCombinedSignal:h}=this._initializeAbortSignals({exceptionSignal:l,stepTimeoutSignal:u,signal:e.signal});for await(let{task:e,error:r,signalAborted:n}of this._executeTasksWithRetry(c,{signals:d,retryPolicy:i,maxConcurrency:a}))this._commit(e,r),no(r)||ns(r)&&!no(t)?t=r:r&&(0===s.size||!n)&&(o.abort(),s.add(r));if(h?.(),n?.(this.loop.step,Object.values(this.loop.tasks).map(e=>e.writes).flat()),1===s.size)throw Array.from(s)[0];if(s.size>1)throw AggregateError(Array.from(s),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(no(t)||ns(t)&&this.loop.isNested)throw t}_initializeAbortSignals({exceptionSignal:e,stepTimeoutSignal:t,signal:r}){let i=this.loop.config.configurable?.[x_]??{},n=i.externalAbortSignal??r,a=t??i.timeoutAbortSignal,{signal:s,dispose:o}=kU(n,a,e),l={externalAbortSignal:n,timeoutAbortSignal:a,composedAbortSignal:s};return this.loop.config=kP(this.loop.config,{[x_]:l}),{signals:l,disposeCombinedSignal:o}}async *_executeTasksWithRetry(e,t){let r,i,{retryPolicy:n,maxConcurrency:a,signals:s}=t??{},o=((i={next:()=>void 0,wait:Promise.resolve(Ia)}).wait=new Promise(function e(t){i.next=()=>{i.wait=new Promise(e),t(Ia)}}),i),l={},u={executingTasksMap:l,barrier:o,retryPolicy:n,scheduleTask:async(e,t,r)=>this.loop.acceptPush(e,t,r)};if(s?.composedAbortSignal?.aborted)throw Error("Abort");let c=0,d=kU(s?.externalAbortSignal,s?.timeoutAbortSignal),h=d.signal?new Promise((e,t)=>{r=()=>t(Error("Abort")),d.signal?.addEventListener("abort",r,{once:!0})}):void 0;for(;(0===c||Object.keys(l).length>0)&&e.length;){for(;Object.values(l).length<(a??e.length)&&c<e.length;c+=1){let t=e[c];l[t.id]=In(t,n,{[xs]:Io?.bind(u,this,t)},s?.composedAbortSignal).catch(e=>({task:t,error:e,signalAborted:s?.composedAbortSignal?.aborted}))}let t=await Promise.race([...Object.values(l),...h?[h]:[],o.wait]);t!==Ia&&(yield t,null!=r&&(d.signal?.removeEventListener("abort",r),d.dispose?.()),delete l[t.task.id])}}_commit(e,t){if(void 0!==t)if(no(t)){if(t.interrupts.length){let r=t.interrupts.map(e=>[xb,e]),i=e.writes.filter(e=>e[0]===xw);i.length&&r.push(...i),this.loop.putWrites(e.id,r)}}else ns(t)&&e.writes.length?this.loop.putWrites(e.id,e.writes):this.loop.putWrites(e.id,[[xi,{message:t.message,name:t.name}]]);else this.nodeFinished&&(e.config?.tags==null||!e.config.tags.includes(xI))&&this.nodeFinished(String(e.name)),0===e.writes.length&&e.writes.push([x$,null]),this.loop.putWrites(e.id,e.writes)}};async function Io(e,t,r,i,n,a={}){let s=t.config?.configurable?.[xp];if(!s)throw Error(`BUG: No scratchpad found on task ${t.name}__${t.id}`);let o=s.callCounter;s.callCounter+=1;let l=new kL({func:r,name:i,input:n,cache:a.cache,retry:a.retry,callbacks:a.callbacks}),u=await this.scheduleTask(t,o,l);if(!u)return;let c=this.executingTasksMap[u.id];if(void 0!==c)return c;if(u.writes.length>0){let e=u.writes.filter(([e])=>e===xx),t=u.writes.filter(([e])=>e===xi);if(e.length>0){if(1===e.length)return Promise.resolve(e[0][1]);throw Error(`BUG: multiple returns found for task ${u.name}__${u.id}`)}if(t.length>0){if(1===t.length){let e=t[0][1];return Promise.reject(e instanceof Error?e:Error(String(e)))}throw Error(`BUG: multiple errors found for task ${u.name}__${u.id}`)}return}{let t=In(u,a.retry,{[xs]:Io.bind(this,e,u)});return this.executingTasksMap[u.id]=t,this.barrier.next(),t.then(({result:e,error:t})=>t?Promise.reject(t):e)}}var Il=class extends Error{constructor(e){super(e),this.name="GraphValidationError"}};function Iu(e,t){if(Array.isArray(e)){for(let r of e)if(!(r in t))throw Error(`Key ${String(r)} not found in channels`)}else if(!(e in t))throw Error(`Key ${String(e)} not found in channels`)}var Ic=class e extends $Q{lc_graph_name="Topic";unique=!1;accumulate=!1;seen;values;constructor(e){super(),this.unique=e?.unique??this.unique,this.accumulate=e?.accumulate??this.accumulate,this.seen=new Set,this.values=[]}fromCheckpoint(t){let r=new e({unique:this.unique,accumulate:this.accumulate});return void 0!==t&&(r.seen=new Set(t[0]),r.values=t[1]),r}update(e){let t=!1;this.accumulate||(t=this.values.length>0,this.values=[]);let r=e.flat();if(r.length>0)if(this.unique)for(let e of r)this.seen.has(e)||(t=!0,this.seen.add(e),this.values.push(e));else t=!0,this.values.push(...r);return t}get(){if(0===this.values.length)throw new nu;return this.values}checkpoint(){return[[...this.seen],this.values]}isAvailable(){return 0!==this.values.length}},Id=class{static subscribeTo(e,t){let{key:r,tags:i}={key:void 0,tags:void 0,...t??{}};if(Array.isArray(e)&&void 0!==r)throw Error("Can't specify a key when subscribing to multiple channels");return new kI({channels:"string"==typeof e?r?{[r]:e}:[e]:Object.fromEntries(e.map(e=>[e,e])),triggers:Array.isArray(e)?e:[e],tags:i})}static writeTo(e,t){let r=[];for(let t of e)r.push({channel:t,value:ky,skipNone:!1});for(let[e,i]of Object.entries(t??{}))m8.isRunnable(i)||"function"==typeof i?r.push({channel:e,value:ky,skipNone:!0,mapper:fl(i)}):r.push({channel:e,value:i,skipNone:!1});return new kb(r)}},Ih=class extends m8{lc_namespace=["langgraph","pregel"];invoke(e,t){throw Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,t){return super.stream(e,t)}},Ip=class extends Ih{static lc_name(){return"LangGraph"}lc_namespace=["langgraph","pregel"];lg_is_pregel=!0;nodes;channels;inputChannels;outputChannels;autoValidate=!0;streamMode=["values"];streamChannels;interruptAfter;interruptBefore;stepTimeout;debug=!1;checkpointer;retryPolicy;config;store;cache;userInterrupt;triggerToNodes={};constructor(e){super(e);let{streamMode:t}=e;if(null==t||Array.isArray(t)||(t=[t]),this.nodes=e.nodes,this.channels=e.channels,xS in this.channels&&"lc_graph_name"in this.channels[xS]&&"Topic"!==this.channels[xS].lc_graph_name)throw Error(`Channel '${xS}' is reserved and cannot be used in the graph.`);this.channels[xS]=new Ic({accumulate:!1}),this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=t??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.triggerToNodes=e.triggerToNodes??this.triggerToNodes,this.userInterrupt=e.userInterrupt,this.autoValidate&&this.validate()}withConfig(e){let t=nk(this.config,e);return new this.constructor({...this,config:t})}validate(){for(let[e,t]of(!function({nodes:e,channels:t,inputChannels:r,outputChannels:i,streamChannels:n,interruptAfterNodes:a,interruptBeforeNodes:s}){if(!t)throw new Il("Channels not provided");let o=new Set,l=new Set;for(let[t,r]of Object.entries(e)){if(t===xb)throw new Il(`"Node name ${xb} is reserved"`);if(r.constructor===kI)r.triggers.forEach(e=>o.add(e));else throw new Il(`Invalid node type ${typeof r}, expected PregelNode`)}for(let e of o)if(!(e in t))throw new Il(`Subscribed channel '${String(e)}' not in channels`);if(Array.isArray(r)){if(r.every(e=>!o.has(e)))throw new Il(`None of the input channels ${r} are subscribed to by any node`)}else if(!o.has(r))throw new Il(`Input channel ${String(r)} is not subscribed to by any node`);for(let e of(Array.isArray(i)?i.forEach(e=>l.add(e)):l.add(i),n&&!Array.isArray(n)?l.add(n):Array.isArray(n)&&n.forEach(e=>l.add(e)),l))if(!(e in t))throw new Il(`Output channel '${String(e)}' not in channels`);if(a&&"*"!==a){for(let t of a)if(!(t in e))throw new Il(`Node ${String(t)} not in nodes`)}if(s&&"*"!==s){for(let t of s)if(!(t in e))throw new Il(`Node ${String(t)} not in nodes`)}}({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore}),Object.entries(this.nodes)))for(let r of t.triggers)this.triggerToNodes[r]??=[],this.triggerToNodes[r].push(e);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,t){for(let[r,i]of Object.entries(this.nodes))if(void 0===e||e.startsWith(r))for(let n of i.subgraphs?.length?i.subgraphs:[i.bound]){let i=kS(n);if(void 0!==i){if(r===e)return void(yield[r,i]);if(void 0===e&&(yield[r,i]),t){let n=e;for(let[a,s]of(void 0!==e&&(n=e.slice(r.length+1)),i.getSubgraphs(n,t)))yield[`${r}|${a}`,s]}}}}async *getSubgraphsAsync(e,t){yield*this.getSubgraphs(e,t)}async _prepareStateSnapshot({config:e,saved:t,subgraphCheckpointer:r,applyPendingWrites:i=!1}){if(void 0===t)return{values:{},next:[],config:e,tasks:[]};let n=$4(this.channels,t.checkpoint);if(t.pendingWrites?.length){let e=t.pendingWrites.filter(([e,t])=>e===xA).map(([e,t,r])=>[String(t),r]);e.length>0&&kB(t.checkpoint,n,[{name:xr,writes:e,triggers:[]}],void 0,this.triggerToNodes)}let a=Object.values(kV(t.checkpoint,t.pendingWrites,this.nodes,n,t.config,!0,{step:(t.metadata?.step??-1)+1,store:this.store})),s=await km(this.getSubgraphsAsync()),o=t.config.configurable?.checkpoint_ns??"",l={};for(let e of a){let i=s.find(([t])=>t===e.name);if(!i)continue;let n=`${String(e.name)}:${e.id}`;if(o&&(n=`${o}|${n}`),void 0===r){let r={configurable:{thread_id:t.config.configurable?.thread_id,checkpoint_ns:n}};l[e.id]=r}else{let a={configurable:{[xl]:r,thread_id:t.config.configurable?.thread_id,checkpoint_ns:n}},s=i[1];l[e.id]=await s.getState(a,{subgraphs:!0})}}if(i&&t.pendingWrites?.length){let e=Object.fromEntries(a.map(e=>[e.id,e]));for(let[r,i,n]of t.pendingWrites)![xi,xb,ny].includes(i)&&r in e&&e[r].writes.push([String(i),n]);let r=a.filter(e=>e.writes.length>0);r.length>0&&kB(t.checkpoint,n,r,void 0,this.triggerToNodes)}let u=t?.metadata;u&&t?.config?.configurable?.thread_id&&(u={...u,thread_id:t.config.configurable.thread_id});let c=a.filter(e=>0===e.writes.length).map(e=>e.name);return{values:kT(n,this.streamChannelsAsIs),next:c,tasks:kQ(a,t?.pendingWrites??[],l,this.streamChannelsAsIs),metadata:u,config:kR(t.config,t.metadata),createdAt:t.checkpoint.ts,parentConfig:t.parentConfig}}async getState(e,t){let r=e.configurable?.[xl]??this.checkpointer;if(!r)throw new nr("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let i=e.configurable?.checkpoint_ns??"";if(""!==i&&e.configurable?.[xl]===void 0){let n=xV(i);for await(let[i,a]of this.getSubgraphsAsync(n,!0))if(i===n)return await a.getState(kg(e,{[xl]:r}),{subgraphs:t?.subgraphs});throw Error(`Subgraph with namespace "${n}" not found.`)}let n=nk(this.config,e),a=await r.getTuple(e);return await this._prepareStateSnapshot({config:n,saved:a,subgraphCheckpointer:t?.subgraphs?r:void 0,applyPendingWrites:!e.configurable?.checkpoint_id})}async *getStateHistory(e,t){let r=e.configurable?.[xl]??this.checkpointer;if(!r)throw new nr("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let i=e.configurable?.checkpoint_ns??"";if(""!==i&&e.configurable?.[xl]===void 0){let n=xV(i);for await(let[i,a]of this.getSubgraphsAsync(n,!0))if(i===n)return void(yield*a.getStateHistory(kg(e,{[xl]:r}),t));throw Error(`Subgraph with namespace "${n}" not found.`)}let n=nk(this.config,e,{configurable:{checkpoint_ns:i}});for await(let e of r.list(n,t))yield this._prepareStateSnapshot({config:e.config,saved:e})}async bulkUpdateState(e,t){let r=e.configurable?.[xl]??this.checkpointer;if(!r)throw new nr("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});if(0===t.length)throw Error("No supersteps provided");if(t.some(e=>0===e.updates.length))throw Error("No updates provided");let i=e.configurable?.checkpoint_ns??"";if(""!==i&&e.configurable?.[xl]===void 0){let n=xV(i);for await(let[,i]of this.getSubgraphsAsync(n,!0))return await i.bulkUpdateState(kg(e,{[xl]:r}),t);throw Error(`Subgraph "${n}" not found`)}let n=async(e,t)=>{let i=this.config?nk(this.config,e):e,a=await r.getTuple(i),s=void 0!==a?$q(a.checkpoint):$V(),o={...a?.checkpoint.channel_versions},l=a?.metadata?.step??-1,u=kg(i,{checkpoint_ns:i.configurable?.checkpoint_ns??""}),c=i.metadata??{};a?.config.configurable&&(u=kg(i,a.config.configurable),c={...a.metadata,...c});let{values:d,asNode:h}=t[0];if(null==d&&void 0===h){if(t.length>1)throw new nc("Cannot create empty checkpoint with multiple updates");return kR(await r.put(u,$2(s,void 0,l),{source:"update",step:l+1,parents:a?.metadata?.parents??{}},{}),a?a.metadata:void 0)}let p=$4(this.channels,s);if(null===d&&h===xt){if(t.length>1)throw new nc("Cannot apply multiple updates when clearing state");if(a){let e=kV(s,a.pendingWrites||[],this.nodes,p,a.config,!0,{step:(a.metadata?.step??-1)+1,checkpointer:r,store:this.store}),t=(a.pendingWrites||[]).filter(e=>e[0]===xA).map(e=>e.slice(1));for(let[i,n,o]of(t.length>0&&kB(s,p,[{name:xr,writes:t,triggers:[]}],r.getNextVersion.bind(r),this.triggerToNodes),a.pendingWrites||[]))![xi,xb,ny].includes(n)&&i in e&&e[i].writes.push([n,o]);kB(s,p,Object.values(e),r.getNextVersion.bind(r),this.triggerToNodes)}return kR(await r.put(u,$2(s,p,l),{...c,source:"update",step:l+1,parents:a?.metadata?.parents??{}},kj(o,s.channel_versions)),a?a.metadata:void 0)}if("__copy__"===h){if(t.length>1)throw new nc("Cannot copy checkpoint with multiple updates");if(null==a)throw new nc("Cannot copy a non-existent checkpoint");let e=$2(s,void 0,l),i=await r.put(a.parentConfig??kg(a.config,{checkpoint_id:void 0}),e,{source:"fork",step:l+1,parents:a.metadata?.parents??{}},{});if(Array.isArray(d)&&0!==d.length&&d.every(e=>Array.isArray(e)&&2===e.length)){let t=Object.values(kV(e,a.pendingWrites,this.nodes,p,i,!1,{step:l+2})).reduce((e,{name:t,id:r})=>(e[t]??=[],e[t].push({id:r}),e),{}),r=d.reduce((e,r)=>{let[i,n]=r;e[n]??=[];let a=e[n].length,s=t[n]?.[a]?.id;return e[n].push({values:i,asNode:n,taskId:s}),e},{});return n(kR(i,a.metadata),Object.values(r).flat())}return kR(i,a.metadata)}if(h===xr){if(t.length>1)throw new nc("Cannot apply multiple updates when updating as input");let e=await km(kA(this.inputChannels,d));if(0===e.length)throw new nc(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);kB(s,p,[{name:xr,writes:e,triggers:[]}],r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);let i=a?.metadata?.step!=null?a.metadata.step+1:-1,n=await r.put(u,$2(s,p,i),{source:"input",step:i,parents:a?.metadata?.parents??{}},kj(o,s.channel_versions));return await r.putWrites(n,e,ng(xr,s.id)),kR(n,a?a.metadata:void 0)}if(i.configurable?.checkpoint_id===void 0&&a?.pendingWrites!==void 0&&a.pendingWrites.length>0){let e=kV(s,a.pendingWrites,this.nodes,p,a.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(a.metadata?.step??-1)+1}),t=(a.pendingWrites??[]).filter(e=>e[0]===xA).map(e=>e.slice(1));for(let[r,i,n]of(t.length>0&&kB(a.checkpoint,p,[{name:xr,writes:t,triggers:[]}],void 0,this.triggerToNodes),a.pendingWrites))[xi,xb,ny].includes(i)||void 0===e[r]||e[r].writes.push([i,n]);let r=Object.values(e).filter(e=>e.writes.length>0);r.length>0&&kB(s,p,r,void 0,this.triggerToNodes)}let m=Object.values(s.versions_seen).map(e=>Object.values(e)).flat().find(e=>!!e),f=[];if(1===t.length){let{values:e,asNode:r,taskId:i}=t[0];if(void 0===r&&1===Object.keys(this.nodes).length)[r]=Object.keys(this.nodes);else if(void 0===r&&void 0===m)"string"==typeof this.inputChannels&&void 0!==this.nodes[this.inputChannels]&&(r=this.inputChannels);else if(void 0===r){let e=Object.entries(s.versions_seen).map(([e,t])=>Object.values(t).map(t=>[t,e])).flat().filter(([e,t])=>t!==xb).sort(([e],[t])=>$G(e,t));e&&(1===e.length?r=e[0][1]:e[e.length-1][0]!==e[e.length-2][0]&&(r=e[e.length-1][1]))}if(void 0===r)throw new nc('Ambiguous update, specify "asNode"');f.push({values:e,asNode:r,taskId:i})}else for(let{asNode:e,values:r,taskId:i}of t){if(null==e)throw new nc('"asNode" is required when applying multiple updates');f.push({values:r,asNode:e,taskId:i})}let g=[];for(let{asNode:e,values:t,taskId:r}of f){if(void 0===this.nodes[e])throw new nc(`Node "${e.toString()}" does not exist`);let i=this.nodes[e].getWriters();if(!i.length)throw new nc(`No writers found for node "${e.toString()}"`);g.push({name:e,input:t,proc:i.length>1?fr.from(i,{omitSequenceTags:!0}):i[0],writes:[],triggers:[xb],id:r??ng(xb,s.id),writers:[]})}for(let e of g)await e.proc.invoke(e.input,nS({...i,store:i?.store??this.store},{runName:i.runName??`${this.getName()}UpdateState`,configurable:{[xa]:t=>e.writes.push(...t),[xo]:(t,r=!1)=>kM(s,p,e,t,r)}}));for(let e of g){let t=e.writes.filter(e=>e[0]!==xO);void 0!==a&&t.length>0&&await r.putWrites(u,t,e.id)}kB(s,p,g,r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);let y=kj(o,s.channel_versions),v=await r.put(u,$2(s,p,l+1),{source:"update",step:l+1,parents:a?.metadata?.parents??{}},y);for(let e of g){let t=e.writes.filter(e=>e[0]===xO);t.length>0&&await r.putWrites(v,t,e.id)}return kR(v,a?a.metadata:void 0)},a=e;for(let{updates:e}of t)a=await n(a,e);return a}async updateState(e,t,r){return this.bulkUpdateState(e,[{updates:[{values:t,asNode:r}]}])}_defaults(e){let t,r,{debug:i,streamMode:n,inputKeys:a,outputKeys:s,interruptAfter:o,interruptBefore:l,...u}=e,c=!0,d=void 0!==i?i:this.debug,h=s;void 0===h?h=this.streamChannelsAsIs:Iu(h,this.channels);let p=a;void 0===p?p=this.inputChannels:Iu(p,this.channels);let m=l??this.interruptBefore??[],f=o??this.interruptAfter??[];if(void 0!==n?(t=Array.isArray(n)?n:[n],c="string"==typeof n):(t=e.configurable?.[xc]!==void 0?["values"]:this.streamMode,c=!0),!1===this.checkpointer)r=void 0;else if(void 0!==e&&e.configurable?.[xl]!==void 0)r=e.configurable[xl];else if(!0===this.checkpointer)throw Error("checkpointer: true cannot be used for root graphs.");else r=this.checkpointer;let g=e.store??this.store,y=e.cache??this.cache;if(null!=e.durability&&null!=e.checkpointDuring)throw Error("Cannot use both `durability` and `checkpointDuring` at the same time.");let v=(()=>{if(null!=e.checkpointDuring)return!1===e.checkpointDuring?"exit":"async"})();return[d,t,p,h,u,m,f,r,g,c,y,e.durability??v??e?.configurable?.[xf]??"async"]}async stream(e,t){let r,i=new AbortController,n={recursionLimit:this.config?.recursionLimit,...t,signal:kU(t?.signal,i.signal).signal},a=await super.stream(e,n);return new k1(t?.encoding==="text/event-stream"?(r=new TextEncoder,new ReadableStream({async start(e){let t=t=>{e.enqueue(r.encode(`event: ${t.event}
data: ${JSON.stringify(t.data,function(e,t){let r=this[e];if(null!=r&&"object"==typeof r&&"toDict"in r&&"function"==typeof r.toDict){let{type:e,data:t}=r.toDict();return{...t,type:e}}return t})}

`))};try{for await(let e of a){let[r,i,n]=e,a=n;"debug"===i&&"checkpoint"===n.type&&(a={...n,payload:k5(n.payload)}),"checkpoints"===i&&(a=k5(n));let s=r?.length?`${i}|${r.join("|")}`:i;t({event:s,data:a})}}catch(e){t({event:"error",data:e instanceof Error?{error:e.name,message:e.message}:{error:"Error",message:JSON.stringify(e)}})}e.close()}})):a,i)}streamEvents(e,t,r){let i=new AbortController,n={recursionLimit:this.config?.recursionLimit,...t,callbacks:((e,t)=>{if(e||t)return e?t?Array.isArray(e)&&Array.isArray(t)?[...e,...t]:Array.isArray(e)?[...e,t]:Array.isArray(t)?[e,...t]:[e,t]:e:t})(this.config?.callbacks,t?.callbacks),signal:kU(t?.signal,i.signal).signal};return new k1(super.streamEvents(e,n,r),i)}async _validateInput(e){return e}async _validateContext(e){return e}async *_streamIterator(e,t){let r,i,n="version"in(t??{})?void 0:t?.encoding??void 0,a=t?.subgraphs,s=xB(this.config,t);if(void 0===s.recursionLimit||s.recursionLimit<1)throw Error('Passed "recursionLimit" must be at least 1.');if(void 0!==this.checkpointer&&!1!==this.checkpointer&&void 0===s.configurable)throw Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');let o=await this._validateInput(e),{runId:l,...u}=s,[c,d,,h,p,m,f,g,y,v,_,b]=this._defaults(u);void 0!==p.context?p.context=await this._validateContext(p.context):p.configurable=await this._validateContext(p.configurable);let w=new k4({modes:new Set(d)});if(!0===this.checkpointer){p.configurable??={};let e=p.configurable[xy]??"";p.configurable[xy]=e.split("|").map(e=>e.split(":")[0]).join("|")}if(d.includes("messages")){let e=new It(e=>w.push(e)),{callbacks:t}=p;if(void 0===t)p.callbacks=[e];else if(Array.isArray(t))p.callbacks=t.concat(e);else{let r=t.copy();r.addHandler(e,!0),p.callbacks=r}}p.writer??=e=>{if(!d.includes("custom"))return;let t=i5.getRunnableConfig()?.configurable?.[xy]?.split("|").slice(0,-1);w.push([t??[],"custom",e])},p.interrupt??=this.userInterrupt??kd;let $=await nx(p),x=await $?.handleChainStart(this.toJSON(),!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{input:e}:e,l,void 0,void 0,void 0,p?.runName??this.getName()),k=$1(this.channels),I=(async()=>{try{r=await Ie.initialize({input:o,config:p,checkpointer:g,nodes:this.nodes,channelSpecs:k,outputKeys:h,streamKeys:this.streamChannelsAsIs,store:y,cache:_,stream:w,interruptAfter:f,interruptBefore:m,manager:x,debug:this.debug,triggerToNodes:this.triggerToNodes,durability:b});let e=new Is({loop:r,nodeFinished:p.configurable?.__pregel_node_finished});t?.subgraphs&&(r.config.configurable={...r.config.configurable,[xd]:r.stream}),await this._runLoop({loop:r,runner:e,debug:c,config:p}),"sync"===b&&await Promise.all(r?.checkpointerPromises??[])}catch(e){i=e}finally{try{r&&(await r.store?.stop(),await r.cache?.stop()),await Promise.all(r?.checkpointerPromises??[])}catch(e){i=i??e}i?w.error(i):w.close()}})();try{for await(let e of w){if(void 0===e)throw Error("Data structure error.");let[t,r,i]=e;if(d.includes(r)){if("text/event-stream"===n){a?yield[t,r,i]:yield[null,r,i];continue}a&&!v?yield[t,r,i]:v?a?yield[t,i]:yield i:yield[r,i]}}}catch(e){throw await x?.handleChainError(i),e}finally{await I}await x?.handleChainEnd(r?.output??{},l,void 0,void 0,void 0)}async invoke(e,t){let r,i=t?.streamMode??"values",n={...t,outputKeys:t?.outputKeys??this.outputChannels,streamMode:i,encoding:void 0},a=[],s=await this.stream(e,n),o=[];for await(let e of s)"values"===i?xL(e)?o.push(e[xb]):r=e:a.push(e);if("values"===i){if(o.length>0){let e=o.flat(1);if(null==r)return{[xb]:e};if("object"==typeof r)return{...r,[xb]:e}}return r}return a}async _runLoop(e){let t,{loop:r,runner:i,debug:n,config:a}=e;try{for(;await r.tick({inputKeys:this.inputChannels});){var s,o,l;for(let{task:e}of(await r._matchCachedWrites()))r._outputWrites(e.id,e.writes,!0);n&&(s=r.checkpointMetadata.step,o=r.channels,l=this.streamChannelsList,console.log([`${kK(kW,`[${s}:checkpoint]`)}`,`\x1b[1m State at the end of step ${s}:\x1b[0m
`,JSON.stringify(kT(o,l),null,2)].join(""))),n&&k0(r.step,Object.values(r.tasks)),await i.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(e,t)=>{n&&function(e,t,r){let i={};for(let[e,n]of t)r.includes(e)&&(i[e]||(i[e]=[]),i[e].push(n));console.log([`${kK(kW,`[${e}:writes]`)}`,`\x1b[1m Finished step ${e} with writes to ${Object.keys(i).length} channel${1!==Object.keys(i).length?"s":""}:\x1b[0m
`,Object.entries(i).map(([e,t])=>`- ${kK(kH,e)} -> ${t.map(e=>JSON.stringify(e)).join(", ")}`).join("\n")].join(""))}(e,t,this.streamChannelsList)},maxConcurrency:a.maxConcurrency,signal:a.signal})}if("out_of_steps"===r.status)throw new nt(`Recursion limit of ${a.recursionLimit} reached without hitting a stop condition. You can increase the limit by setting the "recursionLimit" config key.`,{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(e){if(t=e,!await r.finishAndHandleError(t))throw e}finally{void 0===t&&await r.finishAndHandleError()}}async clearCache(){await this.cache?.clear([])}},Im=class e extends $Q{lc_graph_name="EphemeralValue";guard;value=[];constructor(e=!0){super(),this.guard=e}fromCheckpoint(t){let r=new e(this.guard);return void 0!==t&&(r.value=[t]),r}update(e){if(0===e.length){let e=this.value.length>0;return this.value=[],e}if(1!==e.length&&this.guard)throw new nc("EphemeralValue can only receive one value per step.");return this.value=[e[e.length-1]],!0}get(){if(0===this.value.length)throw new nu;return this.value[0]}checkpoint(){if(0===this.value.length)throw new nu;return this.value[0]}isAvailable(){return 0!==this.value.length}},wM=wD,If=class{path;ends;constructor(e){m8.isRunnable(e.path)?this.path=e.path:this.path=fl(e.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(e.pathMap)?e.pathMap.reduce((e,t)=>(e[t]=t,e),{}):e.pathMap}run(e,t){return kb.registerWriter(new kh({name:"<branch_run>",trace:!1,func:async(r,i)=>{try{return await this._route(r,i,e,t)}catch(e){throw e.name===nn.unminifiable_name&&console.warn("[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.\nNodeInterrupt should only be thrown inside a node, not in edge conditions."),e}}}))}async _route(e,t,r,i){let n,a=await this.path.invoke(i?i(t):e,t);if(Array.isArray(a)||(a=[a]),(n=this.ends?a.map(e=>xU(e)?e:this.ends[e]):a).some(e=>!e))throw Error("Branch condition returned unknown or null destination");if(n.filter(xU).some(e=>e.node===xt))throw new nc("Cannot send a packet to the END node");return await r(n,t)??e}},Ig=class{nodes;edges;branches;entryPoint;compiled=!1;constructor(){this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(e){this.compiled&&console.warn(e)}get allEdges(){return this.edges}addNode(...e){let t=e.length>=1&&"string"!=typeof e[0]?Array.isArray(e[0])?e[0]:Object.entries(e[0]):[[e[0],e[1],e[2]]];if(0===t.length)throw Error("No nodes provided in `addNode`");for(let[e,r,i]of t){for(let t of["|",":"])if(e.includes(t))throw Error(`"${t}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),e in this.nodes)throw Error(`Node \`${e}\` already present.`);if(e===xt)throw Error(`Node \`${e}\` is reserved.`);let t=fl(r);this.nodes[e]={runnable:t,metadata:i?.metadata,subgraphs:kE(t)?[t]:i?.subgraphs,ends:i?.ends}}return this}addEdge(e,t){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),e===xt)throw Error("END cannot be a start node");if(t===xe)throw Error("START cannot be an end node");if(Array.from(this.edges).some(([t])=>t===e)&&!("channels"in this))throw Error(`Already found path for ${e}. For multiple edges, use StateGraph.`);return this.edges.add([e,t]),this}addConditionalEdges(e,t,r){let i="object"==typeof e?e:{source:e,path:t,pathMap:r};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!m8.isRunnable(i.path)){let e=Array.isArray(i.pathMap)?i.pathMap.join(","):Object.keys(i.pathMap??{}).join(",");i.path=fl(i.path).withConfig({runName:`Branch<${i.source}${""!==e?`,${e}`:""}>`.slice(0,63)})}let n="RunnableLambda"===i.path.getName()?"condition":i.path.getName();if(this.branches[i.source]&&this.branches[i.source][n])throw Error(`Condition \`${n}\` already present for node \`${e}\``);return this.branches[i.source]??={},this.branches[i.source][n]=new If(i),this}setEntryPoint(e){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(xe,e)}setFinishPoint(e){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(e,xt)}compile({checkpointer:e,interruptBefore:t,interruptAfter:r,name:i}={}){this.validate([...Array.isArray(t)?t:[],...Array.isArray(r)?r:[]]);let n=new Iy({builder:this,checkpointer:e,interruptAfter:r,interruptBefore:t,autoValidate:!1,nodes:{},channels:{[xe]:new Im,[xt]:new Im},inputChannels:xe,outputChannels:xt,streamChannels:[],streamMode:"values",name:i});for(let[e,t]of Object.entries(this.nodes))n.attachNode(e,t);for(let[e,t]of this.edges)n.attachEdge(e,t);for(let[e,t]of Object.entries(this.branches))for(let[r,i]of Object.entries(t))n.attachBranch(e,r,i);return n.validate()}validate(e){let t=new Set([...this.allEdges].map(([e,t])=>e));for(let[e]of Object.entries(this.branches))t.add(e);for(let e of t)if(e!==xe&&!(e in this.nodes))throw Error(`Found edge starting at unknown node \`${e}\``);let r=new Set([...this.allEdges].map(([e,t])=>t));for(let[e,t]of Object.entries(this.branches))for(let i of Object.values(t))if(null!=i.ends)for(let e of Object.values(i.ends))r.add(e);else for(let t of(r.add(xt),Object.keys(this.nodes)))t!==e&&r.add(t);for(let e of Object.values(this.nodes))for(let t of e.ends??[])r.add(t);for(let e of Object.keys(this.nodes))if(!r.has(e))throw new nd(`Node \`${e}\` is not reachable.

If you are returning Command objects from your node,
make sure you are passing names of potential destination nodes as an "ends" array
into ".addNode(..., { ends: ["node1", "node2"] })".`,{lc_error_code:"UNREACHABLE_NODE"});for(let e of r)if(e!==xt&&!(e in this.nodes))throw Error(`Found edge ending at unknown node \`${e}\``);if(e){for(let t of e)if(!(t in this.nodes))throw Error(`Interrupt node \`${t}\` is not present`)}this.compiled=!0}},Iy=class extends Ip{builder;constructor({builder:e,...t}){super(t),this.builder=e}attachNode(e,t){this.channels[e]=new Im,this.nodes[e]=new kI({channels:[],triggers:[],metadata:t.metadata,subgraphs:t.subgraphs,ends:t.ends}).pipe(t.runnable).pipe(new kb([{channel:e,value:ky}],[xI])),this.streamChannels.push(e)}attachEdge(e,t){if(t===xt){if(e===xe)throw Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new kb([{channel:xt,value:ky}],[xI]))}else this.nodes[t].triggers.push(e),this.nodes[t].channels.push(e)}attachBranch(e,t,r){for(let i of(e!==xe||this.nodes[xe]||(this.nodes[xe]=Id.subscribeTo(xe,{tags:[xI]})),this.nodes[e].pipe(r.run(r=>new kb(r.map(r=>xU(r)?r:{channel:r===xt?xt:`branch:${e}:${t}:${r}`,value:ky}),[xI]))),r.ends?Object.values(r.ends):Object.keys(this.nodes)))if(i!==xt){let r=`branch:${e}:${t}:${i}`;this.channels[r]=new Im,this.nodes[i].triggers.push(r),this.nodes[i].channels.push(r)}}async getGraphAsync(e){let t=e?.xray,r=new mH,i={[xe]:r.addNode({schema:wM.any()},xe)},n={},a={};function s(e,t,a,o=!1){if(t===xt&&void 0===n[xt]&&(n[xt]=r.addNode({schema:wM.any()},xt)),void 0!==i[e]){if(void 0===n[t])throw Error(`End node ${t} not found!`);return r.addEdge(i[e],n[t],a!==t?a:void 0,o)}}for(let[s,l]of(t&&(a=Object.fromEntries((await km(this.getSubgraphsAsync())).filter(e=>Iv(e[1])))),Object.entries(this.builder.nodes))){let u=I_(s),c=l.runnable,d=l.metadata??{};if(this.interruptBefore?.includes(s)&&this.interruptAfter?.includes(s)?d.__interrupt="before,after":this.interruptBefore?.includes(s)?d.__interrupt="before":this.interruptAfter?.includes(s)&&(d.__interrupt="after"),t){let l="number"==typeof t?t-1:t,h=void 0!==a[s]?await a[s].getGraphAsync({...e,xray:l}):c.getGraph(e);if(h.trimFirstNode(),h.trimLastNode(),Object.keys(h.nodes).length>1){let[e,t]=r.extend(h,u);if(void 0===e)throw Error(`Could not extend subgraph "${s}" due to missing entrypoint.`);function o(e,t){if(void 0!==e&&!tX(e))return e;if(!t||!t.lc_runnable)return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch(e){return t.getName()}}void 0!==t&&(i[u]={name:o(t.id,t.data),...t}),n[u]={name:o(e.id,e.data),...e}}else{let e=r.addNode(c,u,d);i[u]=e,n[u]=e}}else{let e=r.addNode(c,u,d);i[u]=e,n[u]=e}}for(let[e,t]of[...this.builder.allEdges].sort(([e],[t])=>e<t?-1:+(t>e)))s(I_(e),I_(t));for(let[e,t]of Object.entries(this.builder.branches)){let r={...Object.fromEntries(Object.keys(this.builder.nodes).filter(t=>t!==e).map(e=>[I_(e),I_(e)])),[xt]:xt};for(let i of Object.values(t)){for(let[t,n]of Object.entries(void 0!==i.ends?i.ends:r))s(I_(e),I_(n),t,!0)}}for(let[e,t]of Object.entries(this.builder.nodes))if(void 0!==t.ends)for(let r of t.ends)s(I_(e),I_(r),void 0,!0);return r}getGraph(e){let t=e?.xray,r=new mH,i={[xe]:r.addNode({schema:wM.any()},xe)},n={},a={};function s(e,t,a,o=!1){return t===xt&&void 0===n[xt]&&(n[xt]=r.addNode({schema:wM.any()},xt)),r.addEdge(i[e],n[t],a!==t?a:void 0,o)}for(let[s,l]of(t&&(a=Object.fromEntries(kf(this.getSubgraphs()).filter(e=>Iv(e[1])))),Object.entries(this.builder.nodes))){let u=I_(s),c=l.runnable,d=l.metadata??{};if(this.interruptBefore?.includes(s)&&this.interruptAfter?.includes(s)?d.__interrupt="before,after":this.interruptBefore?.includes(s)?d.__interrupt="before":this.interruptAfter?.includes(s)&&(d.__interrupt="after"),t){let l="number"==typeof t?t-1:t,h=void 0!==a[s]?a[s].getGraph({...e,xray:l}):c.getGraph(e);if(h.trimFirstNode(),h.trimLastNode(),Object.keys(h.nodes).length>1){let[e,t]=r.extend(h,u);if(void 0===e)throw Error(`Could not extend subgraph "${s}" due to missing entrypoint.`);function o(e,t){if(void 0!==e&&!tX(e))return e;if(!t||!t.lc_runnable)return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch(e){return t.getName()}}void 0!==t&&(i[u]={name:o(t.id,t.data),...t}),n[u]={name:o(e.id,e.data),...e}}else{let e=r.addNode(c,u,d);i[u]=e,n[u]=e}}else{let e=r.addNode(c,u,d);i[u]=e,n[u]=e}}for(let[e,t]of[...this.builder.allEdges].sort(([e],[t])=>e<t?-1:+(t>e)))s(I_(e),I_(t));for(let[e,t]of Object.entries(this.builder.branches)){let r={...Object.fromEntries(Object.keys(this.builder.nodes).filter(t=>t!==e).map(e=>[I_(e),I_(e)])),[xt]:xt};for(let i of Object.values(t)){for(let[t,n]of Object.entries(void 0!==i.ends?i.ends:r))s(I_(e),I_(n),t,!0)}}return r}};function Iv(e){return"function"==typeof e.attachNode&&"function"==typeof e.attachEdge}function I_(e){return"subgraph"===e?`"${e}"`:e}let Ib=(e,t)=>e.size===t.size&&[...e].every(e=>t.has(e));var Iw=class e extends $Q{lc_graph_name="NamedBarrierValue";names;seen;constructor(e){super(),this.names=e,this.seen=new Set}fromCheckpoint(t){let r=new e(this.names);return void 0!==t&&(r.seen=new Set(t)),r}update(e){let t=!1;for(let r of e)if(this.names.has(r))this.seen.has(r)||(this.seen.add(r),t=!0);else throw new nc(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!Ib(this.names,this.seen))throw new nu}checkpoint(){return[...this.seen]}consume(){return!!(this.seen&&this.names&&Ib(this.seen,this.names))&&(this.seen=new Set,!0)}isAvailable(){return!!this.names&&Ib(this.names,this.seen)}},I$=class e extends $Q{lc_graph_name="NamedBarrierValueAfterFinish";names;seen;finished;constructor(e){super(),this.names=e,this.seen=new Set,this.finished=!1}fromCheckpoint(t){let r=new e(this.names);if(void 0!==t){let[e,i]=t;r.seen=new Set(e),r.finished=i}return r}update(e){let t=!1;for(let r of e)if(this.names.has(r)&&!this.seen.has(r))this.seen.add(r),t=!0;else if(!this.names.has(r))throw new nc(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!this.finished||!Ib(this.names,this.seen))throw new nu}checkpoint(){return[[...this.seen],this.finished]}consume(){return!!(this.finished&&this.seen&&this.names&&Ib(this.seen,this.names))&&(this.seen=new Set,this.finished=!1,!0)}finish(){return!!(!this.finished&&this.names&&Ib(this.names,this.seen))&&(this.finished=!0,!0)}isAvailable(){return this.finished&&!!this.names&&Ib(this.names,this.seen)}};let Ix=new class{_map=new WeakMap;_extensionCache=new Map;get(e){return this._map.get(e)}extend(e,t){let r=this.get(e);this._map.set(e,t(r))}remove(e){return this._map.delete(e),this}has(e){return this._map.has(e)}getChannelsForSchema(e){let t={};for(let[r,i]of Object.entries(dK(e))){let e=this.get(i);e?.reducer?t[r]=new $6(e.reducer.fn,e.default):t[r]=new $9}return t}getExtendedChannelSchemas(e,t){if(0===Object.keys(t).length)return e;let r=Object.entries(t).filter(([,e])=>!0===e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}:${t}`).join("|"),i=this._extensionCache.get(r)??new WeakMap;if(i.has(e))return i.get(e);let n=e;if(t.withReducerSchema||t.withJsonSchemaExtrasAsDescription){let r=Object.entries(dK(e)).map(([e,r])=>{let i=this.get(r),n=t.withReducerSchema?i?.reducer?.schema??r:r;if(t.withJsonSchemaExtrasAsDescription&&i?.jsonSchemaExtra){let e=dZ(n)??dZ(r),t=JSON.stringify({...i.jsonSchemaExtra,description:e});n=n.describe(`lg:${t}`)}return[e,n]});dN(n=dX(e,Object.fromEntries(r)))&&(n._def.unknownKeys="strip")}return t.asPartial&&(n=dY(n)),i.set(e,n),this._extensionCache.set(r,i),n}},Ik="__root__",II=Symbol.for("langgraph.state.partial");var IE=class extends Ig{channels={};waitingEdges=new Set;_schemaDefinition;_schemaRuntimeDefinition;_inputDefinition;_inputRuntimeDefinition;_outputDefinition;_outputRuntimeDefinition;_schemaDefinitions=new Map;_metaRegistry=Ix;_configSchema;_configRuntimeSchema;_interrupt;_writer;constructor(e,t){if(super(),function(e){return"object"==typeof e&&null!=e&&"state"in e&&!!dH(e.state)&&(!("input"in e)||!!dH(e.input))&&(!("output"in e)||!!dH(e.output))}(e)){const t=this._metaRegistry.getChannelsForSchema(e.state),r=null!=e.input?this._metaRegistry.getChannelsForSchema(e.input):t,i=null!=e.output?this._metaRegistry.getChannelsForSchema(e.output):t;this._schemaDefinition=t,this._schemaRuntimeDefinition=e.state,this._inputDefinition=r,this._inputRuntimeDefinition=e.input??II,this._outputDefinition=i,this._outputRuntimeDefinition=e.output??e.state}else if(dH(e)){const t=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=t,this._schemaRuntimeDefinition=e,this._inputDefinition=t,this._inputRuntimeDefinition=II,this._outputDefinition=t,this._outputRuntimeDefinition=e}else if(function(e){return"object"==typeof e&&null!==e&&void 0===e.stateSchema&&void 0!==e.input&&void 0!==e.output}(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(function(e){return"object"==typeof e&&null!==e&&void 0!==e.stateSchema}(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=e.input?.spec??this._schemaDefinition,this._outputDefinition=e.output?.spec??this._schemaDefinition;else if(function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Object.keys(e).length>0&&Object.values(e).every(e=>"function"==typeof e||$Y(e))}(e)||IO(e)){const t=IO(e)?e.spec:e;this._schemaDefinition=t}else if(function(e){return"object"==typeof e&&null!==e&&void 0!==e.channels}(e)){const t=function(e){let t={};for(let[r,i]of Object.entries(e))t[r]=$7(i);return t}(e.channels);this._schemaDefinition=t}else throw Error("Invalid StateGraph input. Make sure to pass a valid Annotation.Root or Zod schema.");this._inputDefinition??=this._schemaDefinition,this._outputDefinition??=this._schemaDefinition,this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition),!function(e){return"object"==typeof e&&null!=e&&!("spec"in e)&&!dH(e)}(t)?dH(t)&&(this._configRuntimeSchema=t):(dH(t.context)&&(this._configRuntimeSchema=t.context),this._interrupt=t.interrupt,this._writer=t.writer)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,t])=>e.map(e=>[e,t]))])}_addSchema(e){if(!this._schemaDefinitions.has(e))for(let[t,r]of(this._schemaDefinitions.set(e,e),Object.entries(e))){let e;if(e="function"==typeof r?r():r,void 0!==this.channels[t]){if(this.channels[t]!==e&&"LastValue"!==e.lc_graph_name)throw Error(`Channel "${t}" already exists with a different type.`)}else this.channels[t]=e}}addNode(...e){let t=e.length>=1&&"string"!=typeof e[0]?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([e,t])=>[e,t]):[[e[0],e[1],e[2]]];if(0===t.length)throw Error("No nodes provided in `addNode`");for(let[e,r,i]of t){let t;if(e in this.channels)throw Error(`${e} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(let t of["|",":"])if(e.includes(t))throw Error(`"${t}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),e in this.nodes)throw Error(`Node \`${e}\` already present.`);if(e===xt||e===xe)throw Error(`Node \`${e}\` is reserved.`);let n=this._schemaDefinition;i?.input!==void 0&&(dH(i.input)?n=this._metaRegistry.getChannelsForSchema(i.input):void 0!==i.input.spec&&(n=i.input.spec)),void 0!==n&&this._addSchema(n),t=m8.isRunnable(r)?r:"function"==typeof r?new kh({func:r,name:e,trace:!1}):fl(r);let a=i?.cachePolicy;"boolean"==typeof a&&(a=a?{}:void 0);let s={runnable:t,retryPolicy:i?.retryPolicy,cachePolicy:a,metadata:i?.metadata,input:n??this._schemaDefinition,subgraphs:kE(t)?[t]:i?.subgraphs,ends:i?.ends,defer:i?.defer};this.nodes[e]=s}return this}addEdge(e,t){if("string"==typeof e)return super.addEdge(e,t);for(let t of(this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),e)){if(t===xt)throw Error("END cannot be a start node");if(!Object.keys(this.nodes).some(e=>e===t))throw Error(`Need to add a node named "${t}" first`)}if(t===xt)throw Error("END cannot be an end node");if(!Object.keys(this.nodes).some(e=>e===t))throw Error(`Need to add a node named "${t}" first`);return this.waitingEdges.add([e,t]),this}addSequence(e){let t,r=Array.isArray(e)?e:Object.entries(e);if(0===r.length)throw Error("Sequence requires at least one node.");for(let[e,i,n]of r){if(e in this.nodes)throw Error(`Node names must be unique: node with the name "${e}" already exists.`);this.addNode(e,i,n),null!=t&&this.addEdge(t,e),t=e}return this}compile({checkpointer:e,store:t,cache:r,interruptBefore:i,interruptAfter:n,name:a,description:s}={}){this.validate([...Array.isArray(i)?i:[],...Array.isArray(n)?n:[]]);let o=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),l=1===o.length&&o[0]===Ik?Ik:o,u=Object.keys(this.channels),c=1===u.length&&u[0]===Ik?Ik:u,d=this._interrupt,h=new IS({builder:this,checkpointer:e,interruptAfter:n,interruptBefore:i,autoValidate:!1,nodes:{},channels:{...this.channels,[xe]:new Im},inputChannels:xe,outputChannels:l,streamChannels:c,streamMode:"updates",store:t,cache:r,name:a,description:s,userInterrupt:d});for(let[e,t]of(h.attachNode(xe),Object.entries(this.nodes)))h.attachNode(e,t);for(let[e]of(h.attachBranch(xe,xE,IA(),{withReader:!1}),Object.entries(this.nodes)))h.attachBranch(e,xE,IA(),{withReader:!1});for(let[e,t]of this.edges)h.attachEdge(e,t);for(let[e,t]of this.waitingEdges)h.attachEdge(e,t);for(let[e,t]of Object.entries(this.branches))for(let[r,i]of Object.entries(t))h.attachBranch(e,r,i);return h.validate()}},IS=class extends Iy{description;_metaRegistry=Ix;constructor({description:e,...t}){super(t),this.description=e}attachNode(e,t){let r,i=[{value:ky,mapper:new kh({func:(r=e===xe?Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).map(([e])=>e):Object.keys(this.builder.channels)).length&&r[0]===Ik?function(e){if(xD(e))return e.graph===xz.PARENT?null:e._updateAsTuples();if(Array.isArray(e)&&e.length>0&&e.some(e=>xD(e))){let t=[];for(let r of e)if(xD(r)){if(r.graph===xz.PARENT)continue;t.push(...r._updateAsTuples())}else t.push([Ik,r]);return t}return null!=e?[[Ik,e]]:null}:function t(i){if(!i)return null;if(xD(i))return i.graph===xz.PARENT?null:i._updateAsTuples().filter(([e])=>r.includes(e));if(Array.isArray(i)&&i.length>0&&i.some(xD)){let e=[];for(let n of i)if(xD(n)){if(n.graph===xz.PARENT)continue;e.push(...n._updateAsTuples().filter(([e])=>r.includes(e)))}else{let r=t(n);r&&e.push(...r??[])}return e}{if("object"==typeof i&&!Array.isArray(i))return Object.entries(i).filter(([e])=>r.includes(e));let t=Array.isArray(i)?"array":typeof i;throw new nc(`Expected node "${e.toString()}" to return an object or an array containing at least one Command object, received ${t}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}},trace:!1,recurse:!1})}];if(e===xe)this.nodes[e]=new kI({tags:[xI],triggers:[xe],channels:[xe],writers:[new kb(i,[xI])]});else{let r=t?.input??this.builder._schemaDefinition,n=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(r)).map(e=>[e,e])),a=1===Object.keys(n).length&&Ik in n,s=`branch:to:${e}`;this.channels[s]=t?.defer?new $5:new Im(!1),this.nodes[e]=new kI({triggers:[s],channels:a?Object.keys(n):n,writers:[new kb(i,[xI])],mapper:a?void 0:e=>Object.fromEntries(Object.entries(e).filter(([e])=>e in n)),bound:t?.runnable,metadata:t?.metadata,retryPolicy:t?.retryPolicy,cachePolicy:t?.cachePolicy,subgraphs:t?.subgraphs,ends:t?.ends})}}attachEdge(e,t){if(t!==xt){if("string"==typeof e)this.nodes[e].writers.push(new kb([{channel:`branch:to:${t}`,value:null}],[xI]));else if(Array.isArray(e)){let r=`join:${e.join("+")}:${t}`;for(let i of(this.channels[r]=this.builder.nodes[t].defer?new I$(new Set(e)):new Iw(new Set(e)),this.nodes[t].triggers.push(r),e))this.nodes[i].writers.push(new kb([{channel:r,value:i}],[xI]))}}}attachBranch(e,t,r,i={withReader:!0}){let n=async(t,r)=>{let i=t.filter(e=>e!==xt);if(!i.length)return;let n=i.map(t=>xU(t)?t:{channel:t===xt?t:`branch:to:${t}`,value:e});await kb.doWrite({...r,tags:(r.tags??[]).concat([xI])},n)};this.nodes[e].writers.push(r.run(n,i.withReader?e=>kx.doRead(e,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){let t,r,i;if(null==e)return e;let n=(t=this.builder._inputRuntimeDefinition,r=this.builder._schemaRuntimeDefinition,i=e=>{if(null!=e)return this._metaRegistry.getExtendedChannelSchemas(e,{withReducerSchema:!0})},dH(t)?i(t):t===II?dY(i(r)):void 0);return xD(e)?(e.update&&null!=n&&(e.update=dM(n,e.update)),e):null!=n?dM(n,e):e}isInterrupted(e){return xL(e)}async _validateContext(e){let t=this.builder._configRuntimeSchema;return dH(t)&&dM(t,e),e}};function IO(e){return"object"==typeof e&&null!==e&&"lc_graph_name"in e&&"AnnotationRoot"===e.lc_graph_name}function IT(e){if(xU(e))return[e];let t=[];xD(e)?t.push(e):Array.isArray(e)&&t.push(...e.filter(xD));let r=[];for(let e of t){if(e.graph===xz.PARENT)throw new na(e);xU(e.goto)||"string"==typeof e.goto?r.push(e.goto):Array.isArray(e.goto)&&r.push(...e.goto)}return r}function IA(){return new If({path:new kh({func:IT,tags:[xI],trace:!1,recurse:!1,name:"<control_branch>"})})}function IN(e,t){let r,i=Array.isArray(e)?e:[e],n=Array.isArray(t)?t:[t],a=i.map(tT),s=n.map(tT);for(let e of a)(null===e.id||void 0===e.id)&&(e.id=t0(),e.lc_kwargs.id=e.id);for(let e=0;e<s.length;e+=1){let t=s[e];(null===t.id||void 0===t.id)&&(t.id=t0(),t.lc_kwargs.id=t.id),"remove"===t.getType()&&"__remove_all__"===t.id&&(r=e)}if(null!=r)return s.slice(r+1);let o=[...a],l=new Map(o.map((e,t)=>[e.id,t])),u=new Set;for(let e of s){let t=l.get(e.id);if(void 0!==t)"remove"===e.getType()?u.add(e.id):(u.delete(e.id),o[t]=e);else{if("remove"===e.getType())throw Error(`Attempting to delete a message with an ID that doesn't exist ('${e.id}')`);l.set(e.id,o.length),o.push(e)}}return o.filter(e=>!u.has(e.id))}var m5=p9;$8.Root({messages:$8({reducer:IN,default:()=>[]})}),m5.object({messages:function(e,t){if(t.reducer&&!t.default){let r=d0(e);null!=r&&(t.default=r)}if(!t.reducer)return Ix.extend(e,()=>t),e;{let r=Object.assign(e,{lg_reducer_schema:t.reducer?.schema??e});return Ix.extend(r,()=>t),r}}(m5.custom(),{reducer:{fn:IN},jsonSchemaExtra:{langgraph_type:"messages"},default:()=>[]})}),i5.initializeGlobalInstance(new i8.AsyncLocalStorage);let IC=bz(["idle","resolving","checking_warehouse","assigning_driver","dispatching","completed","error"]),Ij=b_({available:_2(),stockLevel:_H(),location:v3(),estimatedPrepTime:_H()}),IP=b_({driverId:v3(),driverName:v3(),vehicleType:v3(),estimatedArrival:_H(),distance:_H()});async function IR(e){await new Promise(e=>setTimeout(e,1e3));let t=`Starting resolution for order ${e.orderId} - ${e.orderDetails.customer}`;return{currentStep:"resolving",stepMessages:[...e.stepMessages,{step:"resolving",message:t,timestamp:new Date().toISOString()}]}}b_({orderId:v3(),orderDetails:b_({customer:v3(),items:_H(),total:_H(),address:v3()}),currentStep:IC,stepMessages:bg(b_({step:IC,message:v3(),timestamp:v3()})),warehouseResult:Ij.optional(),driverResult:IP.optional(),error:v3().optional(),dispatchConfirmed:_2(),estimatedDeliveryTime:v3().optional()});let IU=[{id:"WH-001",name:"Downtown Warehouse",stockLevel:150},{id:"WH-002",name:"North District Hub",stockLevel:89},{id:"WH-003",name:"Airport Logistics",stockLevel:234}];async function IL(e){await new Promise(e=>setTimeout(e,1500));let t=e.orderDetails.items,r=IU.find(e=>e.stockLevel>=t);if(!r)throw Error("No warehouse has sufficient stock");let i=Math.ceil(2.5*t);return{available:!0,stockLevel:r.stockLevel,location:r.name,estimatedPrepTime:i}}async function Iz(e){try{let t=await IL(e),r=` Items available at ${t.location}. Stock: ${t.stockLevel} units. Prep time: ~${t.estimatedPrepTime} min`;return{currentStep:"checking_warehouse",warehouseResult:t,stepMessages:[...e.stepMessages,{step:"checking_warehouse",message:r,timestamp:new Date().toISOString()}]}}catch(t){return{currentStep:"error",error:t instanceof Error?t.message:"Warehouse check failed",stepMessages:[...e.stepMessages,{step:"error",message:`Warehouse check failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString()}]}}}let ID=[{id:"DRV-001",name:"Ahmed Khan",vehicle:"Motorcycle",available:!0},{id:"DRV-002",name:"Sara Ali",vehicle:"Car",available:!0},{id:"DRV-003",name:"Hassan Malik",vehicle:"Van",available:!1},{id:"DRV-004",name:"Fatima Noor",vehicle:"Motorcycle",available:!0},{id:"DRV-005",name:"Usman Tariq",vehicle:"Car",available:!0}];async function IM(e){await new Promise(e=>setTimeout(e,1500));let t=ID.filter(e=>e.available);if(0===t.length)throw Error("No drivers available at the moment");let r=e.orderDetails.total>1e3&&t.find(e=>"Car"===e.vehicle||"Van"===e.vehicle)||t[0],i=Math.round(10*Math.random()+2),n=Math.round(3*i+10);return{driverId:r.id,driverName:r.name,vehicleType:r.vehicle,estimatedArrival:n,distance:i}}async function IZ(e,t){return await new Promise(e=>setTimeout(e,500)),console.log(`Assigned driver ${t} to order ${e}`),!0}async function IF(e){try{let t=await IM(e);await IZ(e.orderId,t.driverId);let r=` Driver assigned: ${t.driverName} (${t.vehicleType}). ETA: ~${t.estimatedArrival} min, Distance: ${t.distance} km`;return{currentStep:"assigning_driver",driverResult:t,stepMessages:[...e.stepMessages,{step:"assigning_driver",message:r,timestamp:new Date().toISOString()}]}}catch(t){return{currentStep:"error",error:t instanceof Error?t.message:"Driver assignment failed",stepMessages:[...e.stepMessages,{step:"error",message:`Driver assignment failed: ${t instanceof Error?t.message:"Unknown error"}`,timestamp:new Date().toISOString()}]}}}async function IB(e){await new Promise(e=>setTimeout(e,1e3));let t=(e.warehouseResult?.estimatedPrepTime||15)+(e.driverResult?.estimatedArrival||30),r=new Date;r.setMinutes(r.getMinutes()+t);let i=` Order dispatched! Estimated delivery: ${r.toLocaleTimeString()} (${t} min from now)`;return{currentStep:"completed",dispatchConfirmed:!0,estimatedDeliveryTime:r.toISOString(),stepMessages:[...e.stepMessages,{step:"completed",message:i,timestamp:new Date().toISOString()}]}}let IV=$8.Root({orderId:$8(),orderDetails:$8(),currentStep:$8(),stepMessages:$8({reducer:(e,t)=>[...e||[],...t||[]],default:()=>[]}),warehouseResult:$8(),driverResult:$8(),error:$8(),dispatchConfirmed:$8(),estimatedDeliveryTime:$8()});function Iq(e){return"error"===e.currentStep?xt:"continue"}async function IG(e,t){let r=new IE(IV).addNode("resolveOrder",IR).addNode("checkWarehouse",Iz).addNode("assignDriver",IF).addNode("confirmDispatch",IB).addEdge(xe,"resolveOrder").addConditionalEdges("resolveOrder",Iq,{continue:"checkWarehouse",[xt]:xt}).addConditionalEdges("checkWarehouse",Iq,{continue:"assignDriver",[xt]:xt}).addConditionalEdges("assignDriver",Iq,{continue:"confirmDispatch",[xt]:xt}).addEdge("confirmDispatch",xt).compile();return await r.invoke({orderId:e,orderDetails:t,currentStep:"idle",stepMessages:[],dispatchConfirmed:!1})}async function IW(e){try{let{orderId:t,orderDetails:r}=await e.json();if(!t||!r)return V.NextResponse.json({error:"Missing orderId or orderDetails"},{status:400});let i=await IG(t,r);if(i.error)return V.NextResponse.json({success:!1,error:i.error,stepMessages:i.stepMessages},{status:500});return V.NextResponse.json({success:!0,orderId:i.orderId,currentStep:i.currentStep,stepMessages:i.stepMessages,warehouseResult:i.warehouseResult,driverResult:i.driverResult,dispatchConfirmed:i.dispatchConfirmed,estimatedDeliveryTime:i.estimatedDeliveryTime})}catch(e){return console.error("Order resolution error:",e),V.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}e.s(["POST",()=>IW],7008);var IJ=e.i(7008);let IH=new E.AppRouteRouteModule({definition:{kind:S.RouteKind.APP_ROUTE,page:"/api/orders/resolve/route",pathname:"/api/orders/resolve",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/src/app/api/orders/resolve/route.ts",nextConfigOutput:"",userland:IJ}),{workAsyncStorage:IK,workUnitAsyncStorage:IX,serverHooks:IY}=IH;function IQ(){return(0,O.patchFetch)({workAsyncStorage:IK,workUnitAsyncStorage:IX})}async function I0(e,t,r){IH.isDev&&(0,T.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/orders/resolve/route";i=i.replace(/\/index$/,"")||"/";let n=await IH.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:a,params:s,nextConfig:o,parsedUrl:l,isDraftMode:u,prerenderManifest:c,routerServerContext:d,isOnDemandRevalidate:h,revalidateOnlyGenerated:p,resolvedPathname:m,clientReferenceManifest:f,serverActionsManifest:g}=n,y=(0,j.normalizeAppPath)(i),v=!!(c.dynamicRoutes[y]||c.routes[m]),_=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,l,!1):t.end("This page could not be found"),null);if(v&&!u){let e=!!c.routes[m],t=c.dynamicRoutes[y];if(t&&!1===t.fallback&&!e){if(o.experimental.adapterPath)return await _();throw new F.NoFallbackError}}let b=null;!v||IH.isDev||u||(b="/index"===(b=m)?"/":b);let w=!0===IH.isDev||!v,$=v&&!w;g&&f&&(0,N.setReferenceManifestsSingleton)({page:i,clientReferenceManifest:f,serverActionsManifest:g,serverModuleMap:(0,C.createServerModuleMap)({serverActionsManifest:g})});let x=e.method||"GET",k=(0,A.getTracer)(),I=k.getActiveScopeSpan(),E={params:s,prerenderManifest:c,renderOpts:{experimental:{authInterrupts:!!o.experimental.authInterrupts},cacheComponents:!!o.cacheComponents,supportsDynamicResponse:w,incrementalCache:(0,T.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:o.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>IH.onRequestError(e,t,i,d)},sharedContext:{buildId:a}},O=new P.NodeNextRequest(e),V=new P.NodeNextResponse(t),q=R.NextRequestAdapter.fromNodeNextRequest(O,(0,R.signalFromNodeResponse)(t));try{let n=async e=>IH.handle(q,E).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==U.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${x} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${x} ${i}`)}),a=!!(0,T.getRequestMeta)(e,"minimalMode"),s=async s=>{var l,m;let f=async({previousCacheEntry:o})=>{try{if(!a&&h&&p&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(s);e.fetchMetrics=E.renderOpts.fetchMetrics;let l=E.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=E.renderOpts.collectedTags;if(!v)return await (0,z.sendResponse)(O,V,i,E.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,D.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[Z.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==E.renderOpts.collectedRevalidate&&!(E.renderOpts.collectedRevalidate>=Z.INFINITE_CACHE)&&E.renderOpts.collectedRevalidate,n=void 0===E.renderOpts.collectedExpire||E.renderOpts.collectedExpire>=Z.INFINITE_CACHE?void 0:E.renderOpts.collectedExpire;return{value:{kind:B.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==o?void 0:o.isStale)&&await IH.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,L.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:h})},d),t}},g=await IH.handleResponse({req:e,nextConfig:o,cacheKey:b,routeKind:S.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:c,isRoutePPREnabled:!1,isOnDemandRevalidate:h,revalidateOnlyGenerated:p,responseGenerator:f,waitUntil:r.waitUntil,isMinimalMode:a});if(!v)return null;if((null==g||null==(l=g.value)?void 0:l.kind)!==B.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(m=g.value)?void 0:m.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",h?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),u&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,D.fromNodeOutgoingHttpHeaders)(g.value.headers);return a&&v||y.delete(Z.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,M.getCacheControlHeader)(g.cacheControl)),await (0,z.sendResponse)(O,V,new Response(g.value.body,{headers:y,status:g.value.status||200})),null};I?await s(I):await k.withPropagatedContext(e.headers,()=>k.trace(U.BaseServerSpan.handleRequest,{spanName:`${x} ${i}`,kind:A.SpanKind.SERVER,attributes:{"http.method":x,"http.target":e.url}},s))}catch(t){if(t instanceof F.NoFallbackError||await IH.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,L.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:h})}),v)throw t;return await (0,z.sendResponse)(O,V,new Response(null,{status:500})),null}}e.s(["handler",()=>I0,"patchFetch",()=>IQ,"routeModule",()=>IH,"serverHooks",()=>IY,"workAsyncStorage",()=>IK,"workUnitAsyncStorage",()=>IX],24605)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9f6a2125._.js.map